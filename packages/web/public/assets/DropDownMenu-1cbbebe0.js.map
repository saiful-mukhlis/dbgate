{"version":3,"file":"DropDownMenu-1cbbebe0.js","sources":["../../src/modals/DropDownMenu.svelte"],"sourcesContent":["<script context=\"module\">\n  function getElementOffset(element, side = null) {\n    var de = document.documentElement;\n    var box = element.getBoundingClientRect();\n    var top = box.top + window.pageYOffset - de.clientTop;\n    var left = box.left + window.pageXOffset - de.clientLeft;\n    if (side == 'right') return { top: top, left: left + box.width };\n    return { top: top, left: left };\n  }\n\n  function fixPopupPlacement(element) {\n    const { width, height } = element.getBoundingClientRect();\n    let offset = getElementOffset(element);\n\n    let newLeft = null;\n    let newTop = null;\n\n    if (offset.left + width > window.innerWidth) {\n      newLeft = offset.left - width;\n\n      if (newLeft < 0) newLeft = 0;\n    }\n\n    if (offset.top + height > window.innerHeight) {\n      newTop = offset.top - height;\n\n      if (newTop < 0) newTop = 0;\n      if (newTop + height > window.innerHeight) {\n        element.style.height = `${window.innerHeight - newTop}px`;\n      }\n    }\n\n    if (newLeft != null) element.style.left = `${newLeft}px`;\n    if (newTop != null) element.style.top = `${newTop}px`;\n  }\n</script>\n\n<script>\n  import _ from 'lodash';\n  import { createEventDispatcher } from 'svelte';\n  import { onMount } from 'svelte';\n  import { commandsCustomized, visibleCommandPalette } from '../stores';\n  import { prepareMenuItems } from '../utility/contextMenu';\n  import FontIcon from '../icons/FontIcon.svelte';\n  import { formatKeyText } from '../utility/common';\n\n  export let items;\n  export let top;\n  export let left;\n  export let onCloseParent;\n  export let targetElement;\n\n  let element;\n\n  let hoverItem;\n  let hoverOffset;\n\n  let submenuItem;\n  let submenuOffset;\n\n  const dispatch = createEventDispatcher();\n  let closeHandlers = [];\n\n  function dispatchClose() {\n    dispatch('close');\n    for (const handler of closeHandlers) {\n      handler();\n    }\n    closeHandlers = [];\n  }\n\n  function registerCloseHandler(handler) {\n    closeHandlers.push(handler);\n  }\n\n  function handleClick(e, item) {\n    if (item.disabled) return;\n    if (item.submenu) {\n      hoverItem = item;\n      hoverOffset = getElementOffset(e.target, 'right');\n\n      submenuItem = item;\n      submenuOffset = hoverOffset;\n      return;\n    }\n    dispatchClose();\n    if (onCloseParent) onCloseParent();\n    if (item.onClick) item.onClick();\n  }\n\n  onMount(() => {\n    fixPopupPlacement(element);\n  });\n\n  const changeActiveSubmenu = _.throttle(() => {\n    submenuItem = hoverItem;\n    submenuOffset = hoverOffset;\n  }, 500);\n\n  $: preparedItems = prepareMenuItems(items, { targetElement, registerCloseHandler }, $commandsCustomized);\n\n  const handleClickOutside = event => {\n    // if (element && !element.contains(event.target) && !event.defaultPrevented) {\n    if (event.target.closest('ul.dropDownMenuMarker')) return;\n\n    dispatchClose();\n  };\n\n  onMount(() => {\n    document.addEventListener('mousedown', handleClickOutside, true);\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside, true);\n    };\n  });\n</script>\n\n<ul class=\"dropDownMenuMarker\" style={`left: ${left}px; top: ${top}px`} bind:this={element}>\n  {#each preparedItems as item}\n    {#if item.divider}\n      <li class=\"divider\" />\n    {:else}\n      <li\n        on:mouseenter={e => {\n          hoverOffset = getElementOffset(e.target, 'right');\n          hoverItem = item;\n          changeActiveSubmenu();\n        }}\n      >\n        <a on:click={e => handleClick(e, item)} class:disabled={item.disabled}>\n          {item.text || item.label}\n          {#if item.keyText}\n            <span class=\"keyText\">{formatKeyText(item.keyText)}</span>\n          {/if}\n          {#if item.submenu}\n            <div class=\"menu-right\">\n              <FontIcon icon=\"icon menu-right\" />\n            </div>\n          {/if}\n        </a>\n      </li>\n    {/if}\n  {/each}\n</ul>\n{#if submenuItem?.submenu}\n  <svelte:self\n    items={submenuItem?.submenu}\n    {...submenuOffset}\n    onCloseParent={() => {\n      if (onCloseParent) onCloseParent();\n      dispatchClose();\n    }}\n  />\n{/if}\n\n<style>\n  ul {\n    position: absolute;\n    list-style: none;\n    background-color: var(--theme-bg-0);\n    border-radius: 4px;\n    /*border: 1px solid var(--theme-border);*/\n    border: 0;\n    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.175);\n    padding: 5px 0;\n    margin: 2px 0 0;\n    font-size: 14px;\n    text-align: left;\n    min-width: 160px;\n    z-index: 1050;\n    cursor: default;\n    white-space: nowrap;\n    overflow-y: auto;\n  }\n\n  ul li{\n    cursor: pointer;\n  }\n\n  .keyText {\n    /*font-style: italic;*/\n    /*font-weight: bold;*/\n    text-align: right;\n    margin-left: 16px;\n    color: #7c828d80;\n    font-size: 12px;\n  }\n\n  a {\n    padding: 5px 20px;\n    line-height: 1.42;\n    white-space: nop-wrap;\n    color: var(--theme-font-1);\n    display: flex;\n    justify-content: space-between;\n  }\n\n  a.disabled {\n    color: var(--theme-font-3);\n  }\n\n  a:hover:not(.disabled) {\n    background-color: var(--theme-bg-1);\n    text-decoration: none;\n    color: var(--theme-font-1);\n  }\n\n  .divider {\n    margin: 9px 0px 9px 0px;\n    border-top: 1px solid var(--theme-border);\n    border-bottom: 1px solid var(--theme-bg-0);\n  }\n\n  .menu-right {\n    position: relative;\n    left: 15px;\n  }\n</style>\n"],"names":["t0_value","ctx","if_block0","create_if_block_3","if_block1","create_if_block_2","toggle_class","a","insert","target","li","anchor","append","current","dirty","set_data","t0","formatKeyText","span","t","t_value","div","_a","i","if_block","create_if_block","attr","ul","ul_style_value","each_blocks","getElementOffset","element","side","de","box","top","left","fixPopupPlacement","width","height","offset","newLeft","newTop","items","$$props","onCloseParent","targetElement","hoverItem","hoverOffset","submenuItem","submenuOffset","dispatch","createEventDispatcher","closeHandlers","dispatchClose","handler","registerCloseHandler","handleClick","e","item","$$invalidate","onMount","changeActiveSubmenu","_","handleClickOutside","event","click_handler","$$value","preparedItems","prepareMenuItems","$commandsCustomized"],"mappings":"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"}