import{S as K,i as G,s as U,a9 as W,aa as P,B as v,K as g,ab as ee,ac as te,O as w,Q as y,T,ad as Q,ae as ne,ay as ie,j as L,az as ae,aA as oe,aB as re,m as E,af as S,ag as X,ah as le,ai as se,aj as ce,D as x,I,R as M,c as fe,aC as ue,al as pe,a0 as V,am as z,an as me,ao as de,ap as he,aq as Y,ar as $e,n as Z,e as _e,aD as be,F as ve}from"./index-632e4f1b.js";import{l as ge}from"./dbgate-datalib-0d3b84db.js";import"./lodash-29c9ec56.js";function we(a){let n,r;const i=[a[3],{data:a[0]},{title:a[0].fileLabel},{icon:H(a[0])},{menu:a[2]}];let l={};for(let t=0;t<i.length;t+=1)l=W(l,i[t]);return n=new P({props:l}),n.$on("click",a[1]),{c(){v(n.$$.fragment)},m(t,e){g(n,t,e),r=!0},p(t,[e]){const f=e&13?ee(i,[e&8&&te(t[3]),e&1&&{data:t[0]},e&1&&{title:t[0].fileLabel},e&1&&{icon:H(t[0])},e&4&&{menu:t[2]}]):{};n.$set(f)},i(t){r||(w(n.$$.fragment,t),r=!0)},o(t){y(n.$$.fragment,t),r=!1},d(t){T(n,t)}}}var ye=globalThis&&globalThis.__awaiter||function(a,n,r,i){function l(t){return t instanceof r?t:new r(function(e){e(t)})}return new(r||(r=Promise))(function(t,e){function f(s){try{u(i.next(s))}catch(d){e(d)}}function m(s){try{u(i.throw(s))}catch(d){e(d)}}function u(s){s.done?t(s.value):l(s.value).then(f,m)}u((i=i.apply(a,n||[])).next())})};function Te(a,n){E({title:a,icon:"img archive",tooltip:`${n}
${a}`,tabComponent:"ArchiveFileTab",props:{archiveFile:a,archiveFolder:n}})}function J(a,n,r,i,l){return ye(this,void 0,void 0,function*(){const t={};let e;const f=yield S("files/load",{folder:"archive:"+r,file:a+"."+n,format:"text"});E({title:a,icon:l,tabComponent:i,tooltip:e,props:Object.assign({savedFile:a+"."+n,savedFolder:"archive:"+r,savedFormat:"text",archiveFolder:r},t)},{editor:f})})}const Ne=a=>a.fileName,Ce=({fileName:a})=>n=>ge.filterName(n,a),Fe={"table.yaml":"img table","view.sql":"img view","proc.sql":"img procedure","func.sql":"img function","trigger.sql":"img sql-file","matview.sql":"img view"};function H(a){return a.fileType=="jsonl"?"img archive":Fe[a.fileType]}function je(a,n,r){const i=["data"];let l=Q(n,i);var t=this&&this.__awaiter||function(o,p,$,c){function O(h){return h instanceof $?h:new $(function(_){_(h)})}return new($||($=Promise))(function(h,_){function R(b){try{N(c.next(b))}catch(q){_(q)}}function F(b){try{N(c.throw(b))}catch(q){_(q)}}function N(b){b.done?h(b.value):O(b.value).then(R,F)}N((c=c.apply(o,p||[])).next())})};let{data:e}=n;const f=()=>{L(X,{value:e.fileName,label:"New file name",header:"Rename file",onConfirm:o=>{S("archive/rename-file",{file:e.fileName,folder:e.folderName,fileType:e.fileType,newFile:o})}})},m=()=>{L(le,{message:`Really delete file ${e.fileName}?`,onConfirm:()=>{S("archive/delete-file",{file:e.fileName,folder:e.folderName,fileType:e.fileType})}})},u=()=>{Te(e.fileName,e.folderName)},s=()=>{e.fileType=="jsonl"&&u(),e.fileType.endsWith(".sql")&&d(),e.fileType.endsWith(".yaml")&&C()},d=()=>{J(e.fileName,e.fileType,e.folderName,"QueryTab","img sql-file")},C=()=>{J(e.fileName,e.fileType,e.folderName,"YamlEditorTab","img yaml")},k=()=>{J(e.fileName,e.fileType,e.folderName,"JsonLinesEditorTab","img json")};function A(){return[e.fileType=="jsonl"&&{text:"Open",onClick:u},e.fileType=="jsonl"&&{text:"Open in text editor",onClick:k},{text:"Delete",onClick:m},{text:"Rename",onClick:f},e.fileType=="jsonl"&&ie(o=>()=>t(this,void 0,void 0,function*(){oe(e.fileName,{functionName:"archiveReader",props:{fileName:e.fileName,folderName:e.folderName}},o)}),{text:"Export",onClick:()=>{L(ae,{initialValues:{sourceStorageType:"archive",sourceArchiveFolder:e.folderName,sourceList:[e.fileName]}})}}),e.fileType.endsWith(".sql")&&{text:"Open SQL",onClick:d},e.fileType.endsWith(".yaml")&&{text:"Open YAML",onClick:C},e.fileType=="jsonl"&&{text:"Open in profiler",submenu:re().drivers.filter(o=>o.profilerFormatterFunction).map(o=>({text:o.title,onClick:()=>{E({title:"Profiler",icon:"img profiler",tabComponent:"ProfilerTab",props:{jslidLoad:`archive://${e.folderName}/${e.fileName}`,engine:o.engine}})}}))}]}return a.$$set=o=>{n=W(W({},n),ne(o)),r(3,l=Q(n,i)),"data"in o&&r(0,e=o.data)},[e,s,A,l]}class Ae extends K{constructor(n){super(),G(this,n,je,we,U,{data:0})}}const Oe=Object.freeze(Object.defineProperty({__proto__:null,createMatcher:Ce,default:Ae,extractKey:Ne},Symbol.toStringTag,{value:"Module"}));function ke(a){let n,r;return n=new ve({props:{icon:"icon refresh"}}),{c(){v(n.$$.fragment)},m(i,l){g(n,i,l),r=!0},p:Z,i(i){r||(w(n.$$.fragment,i),r=!0)},o(i){y(n.$$.fragment,i),r=!1},d(i){T(n,i)}}}function qe(a){let n,r,i,l,t,e,f,m,u,s;function d(o){a[7](o)}let C={placeholder:"Search archive files"};a[1]!==void 0&&(C.value=a[1]),n=new pe({props:C}),V.push(()=>z(n,"value",d));function k(o){a[8](o)}let A={};return a[1]!==void 0&&(A.filter=a[1]),l=new me({props:A}),V.push(()=>z(l,"filter",k)),f=new de({props:{icon:"icon plus-thick",menu:a[5]}}),u=new he({props:{title:"Refresh files of selected archive folder",$$slots:{default:[ke]},$$scope:{ctx:a}}}),u.$on("click",a[4]),{c(){v(n.$$.fragment),i=x(),v(l.$$.fragment),e=x(),v(f.$$.fragment),m=x(),v(u.$$.fragment)},m(o,p){g(n,o,p),I(o,i,p),g(l,o,p),I(o,e,p),g(f,o,p),I(o,m,p),g(u,o,p),s=!0},p(o,p){const $={};!r&&p&2&&(r=!0,$.value=o[1],Y(()=>r=!1)),n.$set($);const c={};!t&&p&2&&(t=!0,c.filter=o[1],Y(()=>t=!1)),l.$set(c);const O={};p&8192&&(O.$$scope={dirty:p,ctx:o}),u.$set(O)},i(o){s||(w(n.$$.fragment,o),w(l.$$.fragment,o),w(f.$$.fragment,o),w(u.$$.fragment,o),s=!0)},o(o){y(n.$$.fragment,o),y(l.$$.fragment,o),y(f.$$.fragment,o),y(u.$$.fragment,o),s=!1},d(o){o&&(M(i),M(e),M(m)),T(n,o),T(l,o),T(f,o),T(u,o)}}}function Se(a){let n,r;return n=new $e({props:{list:(a[3]||[]).map(a[9]),groupFunc:a[10],module:Oe,filter:a[1]}}),{c(){v(n.$$.fragment)},m(i,l){g(n,i,l),r=!0},p(i,l){const t={};l&9&&(t.list=(i[3]||[]).map(i[9])),l&2&&(t.filter=i[1]),n.$set(t)},i(i){r||(w(n.$$.fragment,i),r=!0)},o(i){y(n.$$.fragment,i),r=!1},d(i){T(n,i)}}}function Le(a){let n,r,i,l;return n=new se({props:{$$slots:{default:[qe]},$$scope:{ctx:a}}}),i=new ce({props:{$$slots:{default:[Se]},$$scope:{ctx:a}}}),{c(){v(n.$$.fragment),r=x(),v(i.$$.fragment)},m(t,e){g(n,t,e),I(t,r,e),g(i,t,e),l=!0},p(t,[e]){const f={};e&8194&&(f.$$scope={dirty:e,ctx:t}),n.$set(f);const m={};e&8203&&(m.$$scope={dirty:e,ctx:t}),i.$set(m)},i(t){l||(w(n.$$.fragment,t),w(i.$$.fragment,t),l=!0)},o(t){y(n.$$.fragment,t),y(i.$$.fragment,t),l=!1},d(t){t&&M(r),T(n,t),T(i,t)}}}globalThis&&globalThis.__awaiter;const xe={jsonl:"JSON table data","table.yaml":"Tables","view.sql":"Views","proc.sql":"Procedures","func.sql":"Functions","trigger.sql":"Triggers","matview.sql":"Materialized views"};function Ie(a,n,r){let i,l,t,e,f=Z,m=()=>(f(),f=_e(l,c=>r(3,e=c)),l);fe(a,be,c=>r(6,t=c)),a.$$.on_destroy.push(()=>f());var u=this&&this.__awaiter||function(c,O,h,_){function R(F){return F instanceof h?F:new h(function(N){N(F)})}return new(h||(h=Promise))(function(F,N){function b(j){try{B(_.next(j))}catch(D){N(D)}}function q(j){try{B(_.throw(j))}catch(D){N(D)}}function B(j){j.done?F(j.value):R(j.value).then(b,q)}B((_=_.apply(c,O||[])).next())})};let s="";const d=()=>{S("archive/refresh-files",{folder:i})};function C(){L(X,{value:"",label:"New file name",header:"Create new JSON lines",onConfirm:c=>u(this,void 0,void 0,function*(){yield S("archive/save-rows",{folder:t,file:c,rows:[{id:1,value:"val1"},{id:1,value:"val2"}]}),E({title:c,icon:"img archive",tabComponent:"ArchiveFileTab",props:{archiveFile:c,archiveFolder:t}})})})}function k(){return[{text:"New NDJSON file",onClick:C}]}function A(c){s=c,r(1,s)}function o(c){s=c,r(1,s)}const p=c=>({fileName:c.name,folderName:i,fileType:c.type,fileLabel:c.label}),$=c=>xe[c.fileType]||"Archive";return a.$$.update=()=>{a.$$.dirty&64&&r(0,i=t),a.$$.dirty&1&&m(r(2,l=ue({folder:i})))},[i,s,l,e,d,k,t,A,o,p,$]}class Be extends K{constructor(n){super(),G(this,n,Ie,Le,U,{})}}export{Be as default};
//# sourceMappingURL=ArchiveFilesList-778892be.js.map
