import{g as getDefaultExportFromCjs,c as commonjsGlobal,l as lodashExports,a as getAugmentedNamespace}from"./lodash-29c9ec56.js";function _mergeNamespaces(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const a in n)if(a!=="default"&&!(a in e)){const s=Object.getOwnPropertyDescriptor(n,a);s&&Object.defineProperty(e,a,s.get?s:{enumerable:!0,get:()=>n[a]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}var rngBrowser={exports:{}},getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(getRandomValues){var rnds8=new Uint8Array(16);rngBrowser.exports=function(){return getRandomValues(rnds8),rnds8}}else{var rnds=new Array(16);rngBrowser.exports=function(){for(var t=0,r;t<16;t++)t&3||(r=Math.random()*4294967296),rnds[t]=r>>>((t&3)<<3)&255;return rnds}}var rngBrowserExports=rngBrowser.exports,byteToHex=[];for(var i=0;i<256;++i)byteToHex[i]=(i+256).toString(16).substr(1);function bytesToUuid$2(e,t){var r=t||0,n=byteToHex;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")}var bytesToUuid_1=bytesToUuid$2,rng$1=rngBrowserExports,bytesToUuid$1=bytesToUuid_1,_nodeId,_clockseq,_lastMSecs=0,_lastNSecs=0;function v1(e,t,r){var n=t&&r||0,a=t||[];e=e||{};var s=e.node||_nodeId,o=e.clockseq!==void 0?e.clockseq:_clockseq;if(s==null||o==null){var u=rng$1();s==null&&(s=_nodeId=[u[0]|1,u[1],u[2],u[3],u[4],u[5]]),o==null&&(o=_clockseq=(u[6]<<8|u[7])&16383)}var l=e.msecs!==void 0?e.msecs:new Date().getTime(),c=e.nsecs!==void 0?e.nsecs:_lastNSecs+1,d=l-_lastMSecs+(c-_lastNSecs)/1e4;if(d<0&&e.clockseq===void 0&&(o=o+1&16383),(d<0||l>_lastMSecs)&&e.nsecs===void 0&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_lastMSecs=l,_lastNSecs=c,_clockseq=o,l+=122192928e5;var f=((l&268435455)*1e4+c)%4294967296;a[n++]=f>>>24&255,a[n++]=f>>>16&255,a[n++]=f>>>8&255,a[n++]=f&255;var h=l/4294967296*1e4&268435455;a[n++]=h>>>8&255,a[n++]=h&255,a[n++]=h>>>24&15|16,a[n++]=h>>>16&255,a[n++]=o>>>8|128,a[n++]=o&255;for(var y=0;y<6;++y)a[n+y]=s[y];return t||bytesToUuid$1(a)}var v1_1$5=v1;const uuidv1=getDefaultExportFromCjs(v1_1$5);var lib$5={},commonTypeParser={};Object.defineProperty(commonTypeParser,"__esModule",{value:!0});commonTypeParser.isTypeDateTime=commonTypeParser.isTypeLogical=commonTypeParser.isTypeString=commonTypeParser.isTypeNumber=commonTypeParser.isTypeFloat=commonTypeParser.isTypeNumeric=commonTypeParser.isTypeInteger=void 0;function isTypeInteger(e){return e&&/int/i.test(e)}commonTypeParser.isTypeInteger=isTypeInteger;function isTypeNumeric(e){return e&&/numeric|decimal/i.test(e)}commonTypeParser.isTypeNumeric=isTypeNumeric;function isTypeFloat(e){return e&&/float|single|double/i.test(e)}commonTypeParser.isTypeFloat=isTypeFloat;function isTypeNumber(e){return isTypeInteger(e)||isTypeFloat(e)||isTypeNumeric(e)}commonTypeParser.isTypeNumber=isTypeNumber;function isTypeString(e){return e&&/char|binary/i.test(e)}commonTypeParser.isTypeString=isTypeString;function isTypeLogical(e){return e&&/bit|boolean/i.test(e)}commonTypeParser.isTypeLogical=isTypeLogical;function isTypeDateTime(e){return e&&/date|time|timestamp/i.test(e)}commonTypeParser.isTypeDateTime=isTypeDateTime;var nameTools={};function listCacheClear$1(){this.__data__=[],this.size=0}var _listCacheClear=listCacheClear$1;function eq$4(e,t){return e===t||e!==e&&t!==t}var eq_1=eq$4,eq$3=eq_1;function assocIndexOf$4(e,t){for(var r=e.length;r--;)if(eq$3(e[r][0],t))return r;return-1}var _assocIndexOf=assocIndexOf$4,assocIndexOf$3=_assocIndexOf,arrayProto=Array.prototype,splice=arrayProto.splice;function listCacheDelete$1(e){var t=this.__data__,r=assocIndexOf$3(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():splice.call(t,r,1),--this.size,!0}var _listCacheDelete=listCacheDelete$1,assocIndexOf$2=_assocIndexOf;function listCacheGet$1(e){var t=this.__data__,r=assocIndexOf$2(t,e);return r<0?void 0:t[r][1]}var _listCacheGet=listCacheGet$1,assocIndexOf$1=_assocIndexOf;function listCacheHas$1(e){return assocIndexOf$1(this.__data__,e)>-1}var _listCacheHas=listCacheHas$1,assocIndexOf=_assocIndexOf;function listCacheSet$1(e,t){var r=this.__data__,n=assocIndexOf(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}var _listCacheSet=listCacheSet$1,listCacheClear=_listCacheClear,listCacheDelete=_listCacheDelete,listCacheGet=_listCacheGet,listCacheHas=_listCacheHas,listCacheSet=_listCacheSet;function ListCache$4(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ListCache$4.prototype.clear=listCacheClear;ListCache$4.prototype.delete=listCacheDelete;ListCache$4.prototype.get=listCacheGet;ListCache$4.prototype.has=listCacheHas;ListCache$4.prototype.set=listCacheSet;var _ListCache=ListCache$4,ListCache$3=_ListCache;function stackClear$1(){this.__data__=new ListCache$3,this.size=0}var _stackClear=stackClear$1;function stackDelete$1(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var _stackDelete=stackDelete$1;function stackGet$1(e){return this.__data__.get(e)}var _stackGet=stackGet$1;function stackHas$1(e){return this.__data__.has(e)}var _stackHas=stackHas$1,freeGlobal$1=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,_freeGlobal=freeGlobal$1,freeGlobal=_freeGlobal,freeSelf=typeof self=="object"&&self&&self.Object===Object&&self,root$8=freeGlobal||freeSelf||Function("return this")(),_root=root$8,root$7=_root,Symbol$7=root$7.Symbol,_Symbol=Symbol$7,Symbol$6=_Symbol,objectProto$g=Object.prototype,hasOwnProperty$d=objectProto$g.hasOwnProperty,nativeObjectToString$1=objectProto$g.toString,symToStringTag$1=Symbol$6?Symbol$6.toStringTag:void 0;function getRawTag$1(e){var t=hasOwnProperty$d.call(e,symToStringTag$1),r=e[symToStringTag$1];try{e[symToStringTag$1]=void 0;var n=!0}catch{}var a=nativeObjectToString$1.call(e);return n&&(t?e[symToStringTag$1]=r:delete e[symToStringTag$1]),a}var _getRawTag=getRawTag$1,objectProto$f=Object.prototype,nativeObjectToString=objectProto$f.toString;function objectToString$1(e){return nativeObjectToString.call(e)}var _objectToString=objectToString$1,Symbol$5=_Symbol,getRawTag=_getRawTag,objectToString=_objectToString,nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=Symbol$5?Symbol$5.toStringTag:void 0;function baseGetTag$a(e){return e==null?e===void 0?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(e)?getRawTag(e):objectToString(e)}var _baseGetTag=baseGetTag$a;function isObject$a(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var isObject_1=isObject$a,baseGetTag$9=_baseGetTag,isObject$9=isObject_1,asyncTag="[object AsyncFunction]",funcTag$2="[object Function]",genTag$1="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction$3(e){if(!isObject$9(e))return!1;var t=baseGetTag$9(e);return t==funcTag$2||t==genTag$1||t==asyncTag||t==proxyTag}var isFunction_1=isFunction$3,root$6=_root,coreJsData$1=root$6["__core-js_shared__"],_coreJsData=coreJsData$1,coreJsData=_coreJsData,maskSrcKey=function(){var e=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function isMasked$1(e){return!!maskSrcKey&&maskSrcKey in e}var _isMasked=isMasked$1,funcProto$2=Function.prototype,funcToString$2=funcProto$2.toString;function toSource$2(e){if(e!=null){try{return funcToString$2.call(e)}catch{}try{return e+""}catch{}}return""}var _toSource=toSource$2,isFunction$2=isFunction_1,isMasked=_isMasked,isObject$8=isObject_1,toSource$1=_toSource,reRegExpChar$1=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto$1=Function.prototype,objectProto$e=Object.prototype,funcToString$1=funcProto$1.toString,hasOwnProperty$c=objectProto$e.hasOwnProperty,reIsNative=RegExp("^"+funcToString$1.call(hasOwnProperty$c).replace(reRegExpChar$1,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative$1(e){if(!isObject$8(e)||isMasked(e))return!1;var t=isFunction$2(e)?reIsNative:reIsHostCtor;return t.test(toSource$1(e))}var _baseIsNative=baseIsNative$1;function getValue$1(e,t){return e==null?void 0:e[t]}var _getValue=getValue$1,baseIsNative=_baseIsNative,getValue=_getValue;function getNative$7(e,t){var r=getValue(e,t);return baseIsNative(r)?r:void 0}var _getNative=getNative$7,getNative$6=_getNative,root$5=_root,Map$3=getNative$6(root$5,"Map"),_Map=Map$3,getNative$5=_getNative,nativeCreate$4=getNative$5(Object,"create"),_nativeCreate=nativeCreate$4,nativeCreate$3=_nativeCreate;function hashClear$1(){this.__data__=nativeCreate$3?nativeCreate$3(null):{},this.size=0}var _hashClear=hashClear$1;function hashDelete$1(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var _hashDelete=hashDelete$1,nativeCreate$2=_nativeCreate,HASH_UNDEFINED$2="__lodash_hash_undefined__",objectProto$d=Object.prototype,hasOwnProperty$b=objectProto$d.hasOwnProperty;function hashGet$1(e){var t=this.__data__;if(nativeCreate$2){var r=t[e];return r===HASH_UNDEFINED$2?void 0:r}return hasOwnProperty$b.call(t,e)?t[e]:void 0}var _hashGet=hashGet$1,nativeCreate$1=_nativeCreate,objectProto$c=Object.prototype,hasOwnProperty$a=objectProto$c.hasOwnProperty;function hashHas$1(e){var t=this.__data__;return nativeCreate$1?t[e]!==void 0:hasOwnProperty$a.call(t,e)}var _hashHas=hashHas$1,nativeCreate=_nativeCreate,HASH_UNDEFINED$1="__lodash_hash_undefined__";function hashSet$1(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=nativeCreate&&t===void 0?HASH_UNDEFINED$1:t,this}var _hashSet=hashSet$1,hashClear=_hashClear,hashDelete=_hashDelete,hashGet=_hashGet,hashHas=_hashHas,hashSet=_hashSet;function Hash$1(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Hash$1.prototype.clear=hashClear;Hash$1.prototype.delete=hashDelete;Hash$1.prototype.get=hashGet;Hash$1.prototype.has=hashHas;Hash$1.prototype.set=hashSet;var _Hash=Hash$1,Hash=_Hash,ListCache$2=_ListCache,Map$2=_Map;function mapCacheClear$1(){this.size=0,this.__data__={hash:new Hash,map:new(Map$2||ListCache$2),string:new Hash}}var _mapCacheClear=mapCacheClear$1;function isKeyable$1(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var _isKeyable=isKeyable$1,isKeyable=_isKeyable;function getMapData$4(e,t){var r=e.__data__;return isKeyable(t)?r[typeof t=="string"?"string":"hash"]:r.map}var _getMapData=getMapData$4,getMapData$3=_getMapData;function mapCacheDelete$1(e){var t=getMapData$3(this,e).delete(e);return this.size-=t?1:0,t}var _mapCacheDelete=mapCacheDelete$1,getMapData$2=_getMapData;function mapCacheGet$1(e){return getMapData$2(this,e).get(e)}var _mapCacheGet=mapCacheGet$1,getMapData$1=_getMapData;function mapCacheHas$1(e){return getMapData$1(this,e).has(e)}var _mapCacheHas=mapCacheHas$1,getMapData=_getMapData;function mapCacheSet$1(e,t){var r=getMapData(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}var _mapCacheSet=mapCacheSet$1,mapCacheClear=_mapCacheClear,mapCacheDelete=_mapCacheDelete,mapCacheGet=_mapCacheGet,mapCacheHas=_mapCacheHas,mapCacheSet=_mapCacheSet;function MapCache$3(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}MapCache$3.prototype.clear=mapCacheClear;MapCache$3.prototype.delete=mapCacheDelete;MapCache$3.prototype.get=mapCacheGet;MapCache$3.prototype.has=mapCacheHas;MapCache$3.prototype.set=mapCacheSet;var _MapCache=MapCache$3,ListCache$1=_ListCache,Map$1=_Map,MapCache$2=_MapCache,LARGE_ARRAY_SIZE$2=200;function stackSet$1(e,t){var r=this.__data__;if(r instanceof ListCache$1){var n=r.__data__;if(!Map$1||n.length<LARGE_ARRAY_SIZE$2-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new MapCache$2(n)}return r.set(e,t),this.size=r.size,this}var _stackSet=stackSet$1,ListCache=_ListCache,stackClear=_stackClear,stackDelete=_stackDelete,stackGet=_stackGet,stackHas=_stackHas,stackSet=_stackSet;function Stack$3(e){var t=this.__data__=new ListCache(e);this.size=t.size}Stack$3.prototype.clear=stackClear;Stack$3.prototype.delete=stackDelete;Stack$3.prototype.get=stackGet;Stack$3.prototype.has=stackHas;Stack$3.prototype.set=stackSet;var _Stack=Stack$3;function arrayEach$1(e,t){for(var r=-1,n=e==null?0:e.length;++r<n&&t(e[r],r,e)!==!1;);return e}var _arrayEach=arrayEach$1,getNative$4=_getNative,defineProperty$2=function(){try{var e=getNative$4(Object,"defineProperty");return e({},"",{}),e}catch{}}(),_defineProperty=defineProperty$2,defineProperty$1=_defineProperty;function baseAssignValue$4(e,t,r){t=="__proto__"&&defineProperty$1?defineProperty$1(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var _baseAssignValue=baseAssignValue$4,baseAssignValue$3=_baseAssignValue,eq$2=eq_1,objectProto$b=Object.prototype,hasOwnProperty$9=objectProto$b.hasOwnProperty;function assignValue$4(e,t,r){var n=e[t];(!(hasOwnProperty$9.call(e,t)&&eq$2(n,r))||r===void 0&&!(t in e))&&baseAssignValue$3(e,t,r)}var _assignValue=assignValue$4,assignValue$3=_assignValue,baseAssignValue$2=_baseAssignValue;function copyObject$5(e,t,r,n){var a=!r;r||(r={});for(var s=-1,o=t.length;++s<o;){var u=t[s],l=n?n(r[u],e[u],u,r,e):void 0;l===void 0&&(l=e[u]),a?baseAssignValue$2(r,u,l):assignValue$3(r,u,l)}return r}var _copyObject=copyObject$5;function baseTimes$2(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var _baseTimes=baseTimes$2;function isObjectLike$d(e){return e!=null&&typeof e=="object"}var isObjectLike_1=isObjectLike$d,baseGetTag$8=_baseGetTag,isObjectLike$c=isObjectLike_1,argsTag$3="[object Arguments]";function baseIsArguments$1(e){return isObjectLike$c(e)&&baseGetTag$8(e)==argsTag$3}var _baseIsArguments=baseIsArguments$1,baseIsArguments=_baseIsArguments,isObjectLike$b=isObjectLike_1,objectProto$a=Object.prototype,hasOwnProperty$8=objectProto$a.hasOwnProperty,propertyIsEnumerable$1=objectProto$a.propertyIsEnumerable,isArguments$3=baseIsArguments(function(){return arguments}())?baseIsArguments:function(e){return isObjectLike$b(e)&&hasOwnProperty$8.call(e,"callee")&&!propertyIsEnumerable$1.call(e,"callee")},isArguments_1=isArguments$3,isArray$f=Array.isArray,isArray_1$5=isArray$f,isBuffer$3={exports:{}};function stubFalse(){return!1}var stubFalse_1=stubFalse;isBuffer$3.exports;(function(e,t){var r=_root,n=stubFalse_1,a=t&&!t.nodeType&&t,s=a&&!0&&e&&!e.nodeType&&e,o=s&&s.exports===a,u=o?r.Buffer:void 0,l=u?u.isBuffer:void 0,c=l||n;e.exports=c})(isBuffer$3,isBuffer$3.exports);var isBufferExports=isBuffer$3.exports,MAX_SAFE_INTEGER$1=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex$4(e,t){var r=typeof e;return t=t??MAX_SAFE_INTEGER$1,!!t&&(r=="number"||r!="symbol"&&reIsUint.test(e))&&e>-1&&e%1==0&&e<t}var _isIndex=isIndex$4,MAX_SAFE_INTEGER=9007199254740991;function isLength$3(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER}var isLength_1=isLength$3,baseGetTag$7=_baseGetTag,isLength$2=isLength_1,isObjectLike$a=isObjectLike_1,argsTag$2="[object Arguments]",arrayTag$2="[object Array]",boolTag$4="[object Boolean]",dateTag$4="[object Date]",errorTag$2="[object Error]",funcTag$1="[object Function]",mapTag$5="[object Map]",numberTag$4="[object Number]",objectTag$4="[object Object]",regexpTag$3="[object RegExp]",setTag$5="[object Set]",stringTag$4="[object String]",weakMapTag$2="[object WeakMap]",arrayBufferTag$3="[object ArrayBuffer]",dataViewTag$4="[object DataView]",float32Tag$2="[object Float32Array]",float64Tag$2="[object Float64Array]",int8Tag$2="[object Int8Array]",int16Tag$2="[object Int16Array]",int32Tag$2="[object Int32Array]",uint8Tag$2="[object Uint8Array]",uint8ClampedTag$2="[object Uint8ClampedArray]",uint16Tag$2="[object Uint16Array]",uint32Tag$2="[object Uint32Array]",typedArrayTags={};typedArrayTags[float32Tag$2]=typedArrayTags[float64Tag$2]=typedArrayTags[int8Tag$2]=typedArrayTags[int16Tag$2]=typedArrayTags[int32Tag$2]=typedArrayTags[uint8Tag$2]=typedArrayTags[uint8ClampedTag$2]=typedArrayTags[uint16Tag$2]=typedArrayTags[uint32Tag$2]=!0;typedArrayTags[argsTag$2]=typedArrayTags[arrayTag$2]=typedArrayTags[arrayBufferTag$3]=typedArrayTags[boolTag$4]=typedArrayTags[dataViewTag$4]=typedArrayTags[dateTag$4]=typedArrayTags[errorTag$2]=typedArrayTags[funcTag$1]=typedArrayTags[mapTag$5]=typedArrayTags[numberTag$4]=typedArrayTags[objectTag$4]=typedArrayTags[regexpTag$3]=typedArrayTags[setTag$5]=typedArrayTags[stringTag$4]=typedArrayTags[weakMapTag$2]=!1;function baseIsTypedArray$1(e){return isObjectLike$a(e)&&isLength$2(e.length)&&!!typedArrayTags[baseGetTag$7(e)]}var _baseIsTypedArray=baseIsTypedArray$1;function baseUnary$7(e){return function(t){return e(t)}}var _baseUnary=baseUnary$7,_nodeUtil={exports:{}};_nodeUtil.exports;(function(e,t){var r=_freeGlobal,n=t&&!t.nodeType&&t,a=n&&!0&&e&&!e.nodeType&&e,s=a&&a.exports===n,o=s&&r.process,u=function(){try{var l=a&&a.require&&a.require("util").types;return l||o&&o.binding&&o.binding("util")}catch{}}();e.exports=u})(_nodeUtil,_nodeUtil.exports);var _nodeUtilExports=_nodeUtil.exports,baseIsTypedArray=_baseIsTypedArray,baseUnary$6=_baseUnary,nodeUtil$3=_nodeUtilExports,nodeIsTypedArray=nodeUtil$3&&nodeUtil$3.isTypedArray,isTypedArray$2=nodeIsTypedArray?baseUnary$6(nodeIsTypedArray):baseIsTypedArray,isTypedArray_1=isTypedArray$2,baseTimes$1=_baseTimes,isArguments$2=isArguments_1,isArray$e=isArray_1$5,isBuffer$2=isBufferExports,isIndex$3=_isIndex,isTypedArray$1=isTypedArray_1,objectProto$9=Object.prototype,hasOwnProperty$7=objectProto$9.hasOwnProperty;function arrayLikeKeys$2(e,t){var r=isArray$e(e),n=!r&&isArguments$2(e),a=!r&&!n&&isBuffer$2(e),s=!r&&!n&&!a&&isTypedArray$1(e),o=r||n||a||s,u=o?baseTimes$1(e.length,String):[],l=u.length;for(var c in e)(t||hasOwnProperty$7.call(e,c))&&!(o&&(c=="length"||a&&(c=="offset"||c=="parent")||s&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||isIndex$3(c,l)))&&u.push(c);return u}var _arrayLikeKeys=arrayLikeKeys$2,objectProto$8=Object.prototype;function isPrototype$3(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||objectProto$8;return e===r}var _isPrototype=isPrototype$3;function overArg$2(e,t){return function(r){return e(t(r))}}var _overArg=overArg$2,overArg$1=_overArg,nativeKeys$1=overArg$1(Object.keys,Object),_nativeKeys=nativeKeys$1,isPrototype$2=_isPrototype,nativeKeys=_nativeKeys,objectProto$7=Object.prototype,hasOwnProperty$6=objectProto$7.hasOwnProperty;function baseKeys$1(e){if(!isPrototype$2(e))return nativeKeys(e);var t=[];for(var r in Object(e))hasOwnProperty$6.call(e,r)&&r!="constructor"&&t.push(r);return t}var _baseKeys=baseKeys$1,isFunction$1=isFunction_1,isLength$1=isLength_1;function isArrayLike$6(e){return e!=null&&isLength$1(e.length)&&!isFunction$1(e)}var isArrayLike_1=isArrayLike$6,arrayLikeKeys$1=_arrayLikeKeys,baseKeys=_baseKeys,isArrayLike$5=isArrayLike_1;function keys$6(e){return isArrayLike$5(e)?arrayLikeKeys$1(e):baseKeys(e)}var keys_1=keys$6,copyObject$4=_copyObject,keys$5=keys_1;function baseAssign$1(e,t){return e&&copyObject$4(t,keys$5(t),e)}var _baseAssign=baseAssign$1;function nativeKeysIn$1(e){var t=[];if(e!=null)for(var r in Object(e))t.push(r);return t}var _nativeKeysIn=nativeKeysIn$1,isObject$7=isObject_1,isPrototype$1=_isPrototype,nativeKeysIn=_nativeKeysIn,objectProto$6=Object.prototype,hasOwnProperty$5=objectProto$6.hasOwnProperty;function baseKeysIn$1(e){if(!isObject$7(e))return nativeKeysIn(e);var t=isPrototype$1(e),r=[];for(var n in e)n=="constructor"&&(t||!hasOwnProperty$5.call(e,n))||r.push(n);return r}var _baseKeysIn=baseKeysIn$1,arrayLikeKeys=_arrayLikeKeys,baseKeysIn=_baseKeysIn,isArrayLike$4=isArrayLike_1;function keysIn$3(e){return isArrayLike$4(e)?arrayLikeKeys(e,!0):baseKeysIn(e)}var keysIn_1=keysIn$3,copyObject$3=_copyObject,keysIn$2=keysIn_1;function baseAssignIn$1(e,t){return e&&copyObject$3(t,keysIn$2(t),e)}var _baseAssignIn=baseAssignIn$1,_cloneBuffer={exports:{}};_cloneBuffer.exports;(function(e,t){var r=_root,n=t&&!t.nodeType&&t,a=n&&!0&&e&&!e.nodeType&&e,s=a&&a.exports===n,o=s?r.Buffer:void 0,u=o?o.allocUnsafe:void 0;function l(c,d){if(d)return c.slice();var f=c.length,h=u?u(f):new c.constructor(f);return c.copy(h),h}e.exports=l})(_cloneBuffer,_cloneBuffer.exports);var _cloneBufferExports=_cloneBuffer.exports;function copyArray$1(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}var _copyArray=copyArray$1;function arrayFilter$2(e,t){for(var r=-1,n=e==null?0:e.length,a=0,s=[];++r<n;){var o=e[r];t(o,r,e)&&(s[a++]=o)}return s}var _arrayFilter=arrayFilter$2;function stubArray$2(){return[]}var stubArray_1=stubArray$2,arrayFilter$1=_arrayFilter,stubArray$1=stubArray_1,objectProto$5=Object.prototype,propertyIsEnumerable=objectProto$5.propertyIsEnumerable,nativeGetSymbols$1=Object.getOwnPropertySymbols,getSymbols$3=nativeGetSymbols$1?function(e){return e==null?[]:(e=Object(e),arrayFilter$1(nativeGetSymbols$1(e),function(t){return propertyIsEnumerable.call(e,t)}))}:stubArray$1,_getSymbols=getSymbols$3,copyObject$2=_copyObject,getSymbols$2=_getSymbols;function copySymbols$1(e,t){return copyObject$2(e,getSymbols$2(e),t)}var _copySymbols=copySymbols$1;function arrayPush$3(e,t){for(var r=-1,n=t.length,a=e.length;++r<n;)e[a+r]=t[r];return e}var _arrayPush=arrayPush$3,overArg=_overArg,getPrototype$3=overArg(Object.getPrototypeOf,Object),_getPrototype=getPrototype$3,arrayPush$2=_arrayPush,getPrototype$2=_getPrototype,getSymbols$1=_getSymbols,stubArray=stubArray_1,nativeGetSymbols=Object.getOwnPropertySymbols,getSymbolsIn$2=nativeGetSymbols?function(e){for(var t=[];e;)arrayPush$2(t,getSymbols$1(e)),e=getPrototype$2(e);return t}:stubArray,_getSymbolsIn=getSymbolsIn$2,copyObject$1=_copyObject,getSymbolsIn$1=_getSymbolsIn;function copySymbolsIn$1(e,t){return copyObject$1(e,getSymbolsIn$1(e),t)}var _copySymbolsIn=copySymbolsIn$1,arrayPush$1=_arrayPush,isArray$d=isArray_1$5;function baseGetAllKeys$2(e,t,r){var n=t(e);return isArray$d(e)?n:arrayPush$1(n,r(e))}var _baseGetAllKeys=baseGetAllKeys$2,baseGetAllKeys$1=_baseGetAllKeys,getSymbols=_getSymbols,keys$4=keys_1;function getAllKeys$2(e){return baseGetAllKeys$1(e,keys$4,getSymbols)}var _getAllKeys=getAllKeys$2,baseGetAllKeys=_baseGetAllKeys,getSymbolsIn=_getSymbolsIn,keysIn$1=keysIn_1;function getAllKeysIn$2(e){return baseGetAllKeys(e,keysIn$1,getSymbolsIn)}var _getAllKeysIn=getAllKeysIn$2,getNative$3=_getNative,root$4=_root,DataView$1=getNative$3(root$4,"DataView"),_DataView=DataView$1,getNative$2=_getNative,root$3=_root,Promise$2=getNative$2(root$3,"Promise"),_Promise=Promise$2,getNative$1=_getNative,root$2=_root,Set$3=getNative$1(root$2,"Set"),_Set=Set$3,getNative=_getNative,root$1=_root,WeakMap$1=getNative(root$1,"WeakMap"),_WeakMap=WeakMap$1,DataView=_DataView,Map=_Map,Promise$1=_Promise,Set$2=_Set,WeakMap=_WeakMap,baseGetTag$6=_baseGetTag,toSource=_toSource,mapTag$4="[object Map]",objectTag$3="[object Object]",promiseTag="[object Promise]",setTag$4="[object Set]",weakMapTag$1="[object WeakMap]",dataViewTag$3="[object DataView]",dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise$1),setCtorString=toSource(Set$2),weakMapCtorString=toSource(WeakMap),getTag$4=baseGetTag$6;(DataView&&getTag$4(new DataView(new ArrayBuffer(1)))!=dataViewTag$3||Map&&getTag$4(new Map)!=mapTag$4||Promise$1&&getTag$4(Promise$1.resolve())!=promiseTag||Set$2&&getTag$4(new Set$2)!=setTag$4||WeakMap&&getTag$4(new WeakMap)!=weakMapTag$1)&&(getTag$4=function(e){var t=baseGetTag$6(e),r=t==objectTag$3?e.constructor:void 0,n=r?toSource(r):"";if(n)switch(n){case dataViewCtorString:return dataViewTag$3;case mapCtorString:return mapTag$4;case promiseCtorString:return promiseTag;case setCtorString:return setTag$4;case weakMapCtorString:return weakMapTag$1}return t});var _getTag=getTag$4,objectProto$4=Object.prototype,hasOwnProperty$4=objectProto$4.hasOwnProperty;function initCloneArray$1(e){var t=e.length,r=new e.constructor(t);return t&&typeof e[0]=="string"&&hasOwnProperty$4.call(e,"index")&&(r.index=e.index,r.input=e.input),r}var _initCloneArray=initCloneArray$1,root=_root,Uint8Array$3=root.Uint8Array,_Uint8Array=Uint8Array$3,Uint8Array$2=_Uint8Array;function cloneArrayBuffer$3(e){var t=new e.constructor(e.byteLength);return new Uint8Array$2(t).set(new Uint8Array$2(e)),t}var _cloneArrayBuffer=cloneArrayBuffer$3,cloneArrayBuffer$2=_cloneArrayBuffer;function cloneDataView$1(e,t){var r=t?cloneArrayBuffer$2(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}var _cloneDataView=cloneDataView$1,reFlags=/\w*$/;function cloneRegExp$1(e){var t=new e.constructor(e.source,reFlags.exec(e));return t.lastIndex=e.lastIndex,t}var _cloneRegExp=cloneRegExp$1,Symbol$4=_Symbol,symbolProto$2=Symbol$4?Symbol$4.prototype:void 0,symbolValueOf$1=symbolProto$2?symbolProto$2.valueOf:void 0;function cloneSymbol$1(e){return symbolValueOf$1?Object(symbolValueOf$1.call(e)):{}}var _cloneSymbol=cloneSymbol$1,cloneArrayBuffer$1=_cloneArrayBuffer;function cloneTypedArray$1(e,t){var r=t?cloneArrayBuffer$1(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var _cloneTypedArray=cloneTypedArray$1,cloneArrayBuffer=_cloneArrayBuffer,cloneDataView=_cloneDataView,cloneRegExp=_cloneRegExp,cloneSymbol=_cloneSymbol,cloneTypedArray=_cloneTypedArray,boolTag$3="[object Boolean]",dateTag$3="[object Date]",mapTag$3="[object Map]",numberTag$3="[object Number]",regexpTag$2="[object RegExp]",setTag$3="[object Set]",stringTag$3="[object String]",symbolTag$3="[object Symbol]",arrayBufferTag$2="[object ArrayBuffer]",dataViewTag$2="[object DataView]",float32Tag$1="[object Float32Array]",float64Tag$1="[object Float64Array]",int8Tag$1="[object Int8Array]",int16Tag$1="[object Int16Array]",int32Tag$1="[object Int32Array]",uint8Tag$1="[object Uint8Array]",uint8ClampedTag$1="[object Uint8ClampedArray]",uint16Tag$1="[object Uint16Array]",uint32Tag$1="[object Uint32Array]";function initCloneByTag$1(e,t,r){var n=e.constructor;switch(t){case arrayBufferTag$2:return cloneArrayBuffer(e);case boolTag$3:case dateTag$3:return new n(+e);case dataViewTag$2:return cloneDataView(e,r);case float32Tag$1:case float64Tag$1:case int8Tag$1:case int16Tag$1:case int32Tag$1:case uint8Tag$1:case uint8ClampedTag$1:case uint16Tag$1:case uint32Tag$1:return cloneTypedArray(e,r);case mapTag$3:return new n;case numberTag$3:case stringTag$3:return new n(e);case regexpTag$2:return cloneRegExp(e);case setTag$3:return new n;case symbolTag$3:return cloneSymbol(e)}}var _initCloneByTag=initCloneByTag$1,isObject$6=isObject_1,objectCreate=Object.create,baseCreate$1=function(){function e(){}return function(t){if(!isObject$6(t))return{};if(objectCreate)return objectCreate(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),_baseCreate=baseCreate$1,baseCreate=_baseCreate,getPrototype$1=_getPrototype,isPrototype=_isPrototype;function initCloneObject$1(e){return typeof e.constructor=="function"&&!isPrototype(e)?baseCreate(getPrototype$1(e)):{}}var _initCloneObject=initCloneObject$1,getTag$3=_getTag,isObjectLike$9=isObjectLike_1,mapTag$2="[object Map]";function baseIsMap$1(e){return isObjectLike$9(e)&&getTag$3(e)==mapTag$2}var _baseIsMap=baseIsMap$1,baseIsMap=_baseIsMap,baseUnary$5=_baseUnary,nodeUtil$2=_nodeUtilExports,nodeIsMap=nodeUtil$2&&nodeUtil$2.isMap,isMap$1=nodeIsMap?baseUnary$5(nodeIsMap):baseIsMap,isMap_1=isMap$1,getTag$2=_getTag,isObjectLike$8=isObjectLike_1,setTag$2="[object Set]";function baseIsSet$1(e){return isObjectLike$8(e)&&getTag$2(e)==setTag$2}var _baseIsSet=baseIsSet$1,baseIsSet=_baseIsSet,baseUnary$4=_baseUnary,nodeUtil$1=_nodeUtilExports,nodeIsSet=nodeUtil$1&&nodeUtil$1.isSet,isSet$1=nodeIsSet?baseUnary$4(nodeIsSet):baseIsSet,isSet_1=isSet$1,Stack$2=_Stack,arrayEach=_arrayEach,assignValue$2=_assignValue,baseAssign=_baseAssign,baseAssignIn=_baseAssignIn,cloneBuffer=_cloneBufferExports,copyArray=_copyArray,copySymbols=_copySymbols,copySymbolsIn=_copySymbolsIn,getAllKeys$1=_getAllKeys,getAllKeysIn$1=_getAllKeysIn,getTag$1=_getTag,initCloneArray=_initCloneArray,initCloneByTag=_initCloneByTag,initCloneObject=_initCloneObject,isArray$c=isArray_1$5,isBuffer$1=isBufferExports,isMap=isMap_1,isObject$5=isObject_1,isSet=isSet_1,keys$3=keys_1,keysIn=keysIn_1,CLONE_DEEP_FLAG$3=1,CLONE_FLAT_FLAG$1=2,CLONE_SYMBOLS_FLAG$3=4,argsTag$1="[object Arguments]",arrayTag$1="[object Array]",boolTag$2="[object Boolean]",dateTag$2="[object Date]",errorTag$1="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag$1="[object Map]",numberTag$2="[object Number]",objectTag$2="[object Object]",regexpTag$1="[object RegExp]",setTag$1="[object Set]",stringTag$2="[object String]",symbolTag$2="[object Symbol]",weakMapTag="[object WeakMap]",arrayBufferTag$1="[object ArrayBuffer]",dataViewTag$1="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",cloneableTags={};cloneableTags[argsTag$1]=cloneableTags[arrayTag$1]=cloneableTags[arrayBufferTag$1]=cloneableTags[dataViewTag$1]=cloneableTags[boolTag$2]=cloneableTags[dateTag$2]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag$1]=cloneableTags[numberTag$2]=cloneableTags[objectTag$2]=cloneableTags[regexpTag$1]=cloneableTags[setTag$1]=cloneableTags[stringTag$2]=cloneableTags[symbolTag$2]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=!0;cloneableTags[errorTag$1]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=!1;function baseClone$3(e,t,r,n,a,s){var o,u=t&CLONE_DEEP_FLAG$3,l=t&CLONE_FLAT_FLAG$1,c=t&CLONE_SYMBOLS_FLAG$3;if(r&&(o=a?r(e,n,a,s):r(e)),o!==void 0)return o;if(!isObject$5(e))return e;var d=isArray$c(e);if(d){if(o=initCloneArray(e),!u)return copyArray(e,o)}else{var f=getTag$1(e),h=f==funcTag||f==genTag;if(isBuffer$1(e))return cloneBuffer(e,u);if(f==objectTag$2||f==argsTag$1||h&&!a){if(o=l||h?{}:initCloneObject(e),!u)return l?copySymbolsIn(e,baseAssignIn(o,e)):copySymbols(e,baseAssign(o,e))}else{if(!cloneableTags[f])return a?e:{};o=initCloneByTag(e,f,u)}}s||(s=new Stack$2);var y=s.get(e);if(y)return y;s.set(e,o),isSet(e)?e.forEach(function(C){o.add(baseClone$3(C,t,r,C,e,s))}):isMap(e)&&e.forEach(function(C,O){o.set(O,baseClone$3(C,t,r,O,e,s))});var v=c?l?getAllKeysIn$1:getAllKeys$1:l?keysIn:keys$3,g=d?void 0:v(e);return arrayEach(g||e,function(C,O){g&&(O=C,C=e[O]),assignValue$2(o,O,baseClone$3(C,t,r,O,e,s))}),o}var _baseClone=baseClone$3,baseClone$2=_baseClone,CLONE_DEEP_FLAG$2=1,CLONE_SYMBOLS_FLAG$2=4;function cloneDeep(e){return baseClone$2(e,CLONE_DEEP_FLAG$2|CLONE_SYMBOLS_FLAG$2)}var cloneDeep_1$3=cloneDeep,baseGetTag$5=_baseGetTag,isArray$b=isArray_1$5,isObjectLike$7=isObjectLike_1,stringTag$1="[object String]";function isString$1(e){return typeof e=="string"||!isArray$b(e)&&isObjectLike$7(e)&&baseGetTag$5(e)==stringTag$1}var isString_1$7=isString$1,__importDefault$B=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(nameTools,"__esModule",{value:!0});nameTools.fillConstraintNames=nameTools.makeUniqueColumnNames=nameTools.findForeignKeyForColumn=nameTools.findObjectLike=nameTools.equalFullName=nameTools.equalStringLike=nameTools.quoteFullName=nameTools.fullNameToLabel=nameTools.fullNameToString=nameTools.fullNameFromString=void 0;const cloneDeep_1$2=__importDefault$B(cloneDeep_1$3),isString_1$6=__importDefault$B(isString_1$7);function fullNameFromString(e){const t=e.match(/\[([^\]]+)\]\.\[([^\]]+)\]/);return t?{schemaName:t[1],pureName:t[2]}:{schemaName:null,pureName:e}}nameTools.fullNameFromString=fullNameFromString;function fullNameToString({schemaName:e,pureName:t}){return e?`[${e}].[${t}]`:t}nameTools.fullNameToString=fullNameToString;function fullNameToLabel({schemaName:e,pureName:t}){return e?`${e}.${t}`:t}nameTools.fullNameToLabel=fullNameToLabel;function quoteFullName(e,{schemaName:t,pureName:r}){return t?`${e.quoteIdentifier(t)}.${e.quoteIdentifier(r)}`:`${e.quoteIdentifier(r)}`}nameTools.quoteFullName=quoteFullName;function equalStringLike(e,t){return(e||"").toLowerCase().trim()==(t||"").toLowerCase().trim()}nameTools.equalStringLike=equalStringLike;function equalFullName(e,t){return!e||!t?e==t:e.pureName==t.pureName&&e.schemaName==t.schemaName}nameTools.equalFullName=equalFullName;function findObjectLike({pureName:e,schemaName:t},r,n){var a,s;return r?t?(a=r[n])===null||a===void 0?void 0:a.find(o=>equalStringLike(o.pureName,e)&&equalStringLike(o.schemaName,t)):(s=r[n])===null||s===void 0?void 0:s.find(o=>equalStringLike(o.pureName,e)):null}nameTools.findObjectLike=findObjectLike;function findForeignKeyForColumn(e,t){return(0,isString_1$6.default)(t)?(e.foreignKeys||[]).find(r=>r.columns.find(n=>n.columnName==t)):(e.foreignKeys||[]).find(r=>r.columns.find(n=>n.columnName==t.columnName))}nameTools.findForeignKeyForColumn=findForeignKeyForColumn;function makeUniqueColumnNames(e){const t=new Set;for(let r=0;r<e.length;r++){if(t.has(e[r].columnName)){let n=2;for(;t.has(`${e[r].columnName}${n}`);)n++;e[r].columnName=`${e[r].columnName}${n}`}t.add(e[r].columnName)}}nameTools.makeUniqueColumnNames=makeUniqueColumnNames;function columnsConstraintName(e,t,r){return`${e}_${t.pureName}_${r.map(n=>n.columnName.replace(" ","_")).join("_")}`}function fillConstraintNames(e,t){if(!e)return e;const r=(0,cloneDeep_1$2.default)(e);r.primaryKey&&!r.primaryKey.constraintName&&!t.anonymousPrimaryKey&&(r.primaryKey.constraintName=`PK_${r.pureName}`);for(const n of r.foreignKeys||[])n.constraintName||(n.constraintName=columnsConstraintName("FK",r,n.columns));for(const n of r.indexes||[])n.constraintName||(n.constraintName=columnsConstraintName("IX",r,n.columns));for(const n of r.uniques||[])n.constraintName||(n.constraintName=columnsConstraintName("UQ",r,n.columns));return r}nameTools.fillConstraintNames=fillConstraintNames;var tableTransforms={};function fromPairs(e){for(var t=-1,r=e==null?0:e.length,n={};++t<r;){var a=e[t];n[a[0]]=a[1]}return n}var fromPairs_1$1=fromPairs,baseGetTag$4=_baseGetTag,isObjectLike$6=isObjectLike_1,symbolTag$1="[object Symbol]";function isSymbol$6(e){return typeof e=="symbol"||isObjectLike$6(e)&&baseGetTag$4(e)==symbolTag$1}var isSymbol_1=isSymbol$6,isArray$a=isArray_1$5,isSymbol$5=isSymbol_1,reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;function isKey$3(e,t){if(isArray$a(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||isSymbol$5(e)?!0:reIsPlainProp.test(e)||!reIsDeepProp.test(e)||t!=null&&e in Object(t)}var _isKey=isKey$3,MapCache$1=_MapCache,FUNC_ERROR_TEXT="Expected a function";function memoize$1(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(FUNC_ERROR_TEXT);var r=function(){var n=arguments,a=t?t.apply(this,n):n[0],s=r.cache;if(s.has(a))return s.get(a);var o=e.apply(this,n);return r.cache=s.set(a,o)||s,o};return r.cache=new(memoize$1.Cache||MapCache$1),r}memoize$1.Cache=MapCache$1;var memoize_1=memoize$1,memoize=memoize_1,MAX_MEMOIZE_SIZE=500;function memoizeCapped$1(e){var t=memoize(e,function(n){return r.size===MAX_MEMOIZE_SIZE&&r.clear(),n}),r=t.cache;return t}var _memoizeCapped=memoizeCapped$1,memoizeCapped=_memoizeCapped,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,stringToPath$1=memoizeCapped(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(rePropName,function(r,n,a,s){t.push(a?s.replace(reEscapeChar,"$1"):n||r)}),t}),_stringToPath=stringToPath$1;function arrayMap$7(e,t){for(var r=-1,n=e==null?0:e.length,a=Array(n);++r<n;)a[r]=t(e[r],r,e);return a}var _arrayMap=arrayMap$7,Symbol$3=_Symbol,arrayMap$6=_arrayMap,isArray$9=isArray_1$5,isSymbol$4=isSymbol_1,INFINITY$3=1/0,symbolProto$1=Symbol$3?Symbol$3.prototype:void 0,symbolToString=symbolProto$1?symbolProto$1.toString:void 0;function baseToString$1(e){if(typeof e=="string")return e;if(isArray$9(e))return arrayMap$6(e,baseToString$1)+"";if(isSymbol$4(e))return symbolToString?symbolToString.call(e):"";var t=e+"";return t=="0"&&1/e==-INFINITY$3?"-0":t}var _baseToString=baseToString$1,baseToString=_baseToString;function toString$7(e){return e==null?"":baseToString(e)}var toString_1=toString$7,isArray$8=isArray_1$5,isKey$2=_isKey,stringToPath=_stringToPath,toString$6=toString_1;function castPath$6(e,t){return isArray$8(e)?e:isKey$2(e,t)?[e]:stringToPath(toString$6(e))}var _castPath=castPath$6,isSymbol$3=isSymbol_1,INFINITY$2=1/0;function toKey$6(e){if(typeof e=="string"||isSymbol$3(e))return e;var t=e+"";return t=="0"&&1/e==-INFINITY$2?"-0":t}var _toKey=toKey$6,castPath$5=_castPath,toKey$5=_toKey;function baseGet$5(e,t){t=castPath$5(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[toKey$5(t[r++])];return r&&r==n?e:void 0}var _baseGet=baseGet$5,baseGet$4=_baseGet;function get$4(e,t,r){var n=e==null?void 0:baseGet$4(e,t);return n===void 0?r:n}var get_1$2=get$4,__importDefault$A=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(tableTransforms,"__esModule",{value:!0});tableTransforms.transformRowUsingColumnMap=tableTransforms.prepareTableForImport=void 0;const cloneDeep_1$1=__importDefault$A(cloneDeep_1$3),fromPairs_1=__importDefault$A(fromPairs_1$1),get_1$1=__importDefault$A(get_1$2);function prepareTableForImport(e){const t=(0,cloneDeep_1$1.default)(e);return t.foreignKeys=[],t.indexes=[],t.uniques=[],t.checks=[],t.primaryKey&&(t.primaryKey.constraintName=null),t}tableTransforms.prepareTableForImport=prepareTableForImport;function transformRowUsingColumnMap(e,t){return(0,fromPairs_1.default)(t.map(r=>[r.dst,(0,get_1$1.default)(e,r.src)]))}tableTransforms.transformRowUsingColumnMap=transformRowUsingColumnMap;var packageTools={};function baseSlice$2(e,t,r){var n=-1,a=e.length;t<0&&(t=-t>a?0:a+t),r=r>a?a:r,r<0&&(r+=a),a=t>r?0:r-t>>>0,t>>>=0;for(var s=Array(a);++n<a;)s[n]=e[n+t];return s}var _baseSlice=baseSlice$2,baseSlice$1=_baseSlice;function castSlice$1(e,t,r){var n=e.length;return r=r===void 0?n:r,!t&&r>=n?e:baseSlice$1(e,t,r)}var _castSlice=castSlice$1,rsAstralRange$2="\\ud800-\\udfff",rsComboMarksRange$3="\\u0300-\\u036f",reComboHalfMarksRange$3="\\ufe20-\\ufe2f",rsComboSymbolsRange$3="\\u20d0-\\u20ff",rsComboRange$3=rsComboMarksRange$3+reComboHalfMarksRange$3+rsComboSymbolsRange$3,rsVarRange$2="\\ufe0e\\ufe0f",rsZWJ$2="\\u200d",reHasUnicode=RegExp("["+rsZWJ$2+rsAstralRange$2+rsComboRange$3+rsVarRange$2+"]");function hasUnicode$2(e){return reHasUnicode.test(e)}var _hasUnicode=hasUnicode$2;function asciiToArray$1(e){return e.split("")}var _asciiToArray=asciiToArray$1,rsAstralRange$1="\\ud800-\\udfff",rsComboMarksRange$2="\\u0300-\\u036f",reComboHalfMarksRange$2="\\ufe20-\\ufe2f",rsComboSymbolsRange$2="\\u20d0-\\u20ff",rsComboRange$2=rsComboMarksRange$2+reComboHalfMarksRange$2+rsComboSymbolsRange$2,rsVarRange$1="\\ufe0e\\ufe0f",rsAstral="["+rsAstralRange$1+"]",rsCombo$2="["+rsComboRange$2+"]",rsFitz$1="\\ud83c[\\udffb-\\udfff]",rsModifier$1="(?:"+rsCombo$2+"|"+rsFitz$1+")",rsNonAstral$1="[^"+rsAstralRange$1+"]",rsRegional$1="(?:\\ud83c[\\udde6-\\uddff]){2}",rsSurrPair$1="[\\ud800-\\udbff][\\udc00-\\udfff]",rsZWJ$1="\\u200d",reOptMod$1=rsModifier$1+"?",rsOptVar$1="["+rsVarRange$1+"]?",rsOptJoin$1="(?:"+rsZWJ$1+"(?:"+[rsNonAstral$1,rsRegional$1,rsSurrPair$1].join("|")+")"+rsOptVar$1+reOptMod$1+")*",rsSeq$1=rsOptVar$1+reOptMod$1+rsOptJoin$1,rsSymbol="(?:"+[rsNonAstral$1+rsCombo$2+"?",rsCombo$2,rsRegional$1,rsSurrPair$1,rsAstral].join("|")+")",reUnicode=RegExp(rsFitz$1+"(?="+rsFitz$1+")|"+rsSymbol+rsSeq$1,"g");function unicodeToArray$1(e){return e.match(reUnicode)||[]}var _unicodeToArray=unicodeToArray$1,asciiToArray=_asciiToArray,hasUnicode$1=_hasUnicode,unicodeToArray=_unicodeToArray;function stringToArray$1(e){return hasUnicode$1(e)?unicodeToArray(e):asciiToArray(e)}var _stringToArray=stringToArray$1,castSlice=_castSlice,hasUnicode=_hasUnicode,stringToArray=_stringToArray,toString$5=toString_1;function createCaseFirst$1(e){return function(t){t=toString$5(t);var r=hasUnicode(t)?stringToArray(t):void 0,n=r?r[0]:t.charAt(0),a=r?castSlice(r,1).join(""):t.slice(1);return n[e]()+a}}var _createCaseFirst=createCaseFirst$1,createCaseFirst=_createCaseFirst,upperFirst$2=createCaseFirst("toUpperCase"),upperFirst_1=upperFirst$2,toString$4=toString_1,upperFirst$1=upperFirst_1;function capitalize$1(e){return upperFirst$1(toString$4(e).toLowerCase())}var capitalize_1=capitalize$1;function arrayReduce$1(e,t,r,n){var a=-1,s=e==null?0:e.length;for(n&&s&&(r=e[++a]);++a<s;)r=t(r,e[a],a,e);return r}var _arrayReduce=arrayReduce$1;function basePropertyOf$1(e){return function(t){return e==null?void 0:e[t]}}var _basePropertyOf=basePropertyOf$1,basePropertyOf=_basePropertyOf,deburredLetters={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},deburrLetter$1=basePropertyOf(deburredLetters),_deburrLetter=deburrLetter$1,deburrLetter=_deburrLetter,toString$3=toString_1,reLatin=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,rsComboMarksRange$1="\\u0300-\\u036f",reComboHalfMarksRange$1="\\ufe20-\\ufe2f",rsComboSymbolsRange$1="\\u20d0-\\u20ff",rsComboRange$1=rsComboMarksRange$1+reComboHalfMarksRange$1+rsComboSymbolsRange$1,rsCombo$1="["+rsComboRange$1+"]",reComboMark=RegExp(rsCombo$1,"g");function deburr$1(e){return e=toString$3(e),e&&e.replace(reLatin,deburrLetter).replace(reComboMark,"")}var deburr_1=deburr$1,reAsciiWord=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function asciiWords$1(e){return e.match(reAsciiWord)||[]}var _asciiWords=asciiWords$1,reHasUnicodeWord=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function hasUnicodeWord$1(e){return reHasUnicodeWord.test(e)}var _hasUnicodeWord=hasUnicodeWord$1,rsAstralRange="\\ud800-\\udfff",rsComboMarksRange="\\u0300-\\u036f",reComboHalfMarksRange="\\ufe20-\\ufe2f",rsComboSymbolsRange="\\u20d0-\\u20ff",rsComboRange=rsComboMarksRange+reComboHalfMarksRange+rsComboSymbolsRange,rsDingbatRange="\\u2700-\\u27bf",rsLowerRange="a-z\\xdf-\\xf6\\xf8-\\xff",rsMathOpRange="\\xac\\xb1\\xd7\\xf7",rsNonCharRange="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",rsPunctuationRange="\\u2000-\\u206f",rsSpaceRange=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",rsUpperRange="A-Z\\xc0-\\xd6\\xd8-\\xde",rsVarRange="\\ufe0e\\ufe0f",rsBreakRange=rsMathOpRange+rsNonCharRange+rsPunctuationRange+rsSpaceRange,rsApos$1="['’]",rsBreak="["+rsBreakRange+"]",rsCombo="["+rsComboRange+"]",rsDigits="\\d+",rsDingbat="["+rsDingbatRange+"]",rsLower="["+rsLowerRange+"]",rsMisc="[^"+rsAstralRange+rsBreakRange+rsDigits+rsDingbatRange+rsLowerRange+rsUpperRange+"]",rsFitz="\\ud83c[\\udffb-\\udfff]",rsModifier="(?:"+rsCombo+"|"+rsFitz+")",rsNonAstral="[^"+rsAstralRange+"]",rsRegional="(?:\\ud83c[\\udde6-\\uddff]){2}",rsSurrPair="[\\ud800-\\udbff][\\udc00-\\udfff]",rsUpper="["+rsUpperRange+"]",rsZWJ="\\u200d",rsMiscLower="(?:"+rsLower+"|"+rsMisc+")",rsMiscUpper="(?:"+rsUpper+"|"+rsMisc+")",rsOptContrLower="(?:"+rsApos$1+"(?:d|ll|m|re|s|t|ve))?",rsOptContrUpper="(?:"+rsApos$1+"(?:D|LL|M|RE|S|T|VE))?",reOptMod=rsModifier+"?",rsOptVar="["+rsVarRange+"]?",rsOptJoin="(?:"+rsZWJ+"(?:"+[rsNonAstral,rsRegional,rsSurrPair].join("|")+")"+rsOptVar+reOptMod+")*",rsOrdLower="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",rsOrdUpper="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",rsSeq=rsOptVar+reOptMod+rsOptJoin,rsEmoji="(?:"+[rsDingbat,rsRegional,rsSurrPair].join("|")+")"+rsSeq,reUnicodeWord=RegExp([rsUpper+"?"+rsLower+"+"+rsOptContrLower+"(?="+[rsBreak,rsUpper,"$"].join("|")+")",rsMiscUpper+"+"+rsOptContrUpper+"(?="+[rsBreak,rsUpper+rsMiscLower,"$"].join("|")+")",rsUpper+"?"+rsMiscLower+"+"+rsOptContrLower,rsUpper+"+"+rsOptContrUpper,rsOrdUpper,rsOrdLower,rsDigits,rsEmoji].join("|"),"g");function unicodeWords$1(e){return e.match(reUnicodeWord)||[]}var _unicodeWords=unicodeWords$1,asciiWords=_asciiWords,hasUnicodeWord=_hasUnicodeWord,toString$2=toString_1,unicodeWords=_unicodeWords;function words$1(e,t,r){return e=toString$2(e),t=r?void 0:t,t===void 0?hasUnicodeWord(e)?unicodeWords(e):asciiWords(e):e.match(t)||[]}var words_1=words$1,arrayReduce=_arrayReduce,deburr=deburr_1,words=words_1,rsApos="['’]",reApos=RegExp(rsApos,"g");function createCompounder$2(e){return function(t){return arrayReduce(words(deburr(t).replace(reApos,"")),e,"")}}var _createCompounder=createCompounder$2,capitalize=capitalize_1,createCompounder$1=_createCompounder,camelCase=createCompounder$1(function(e,t,r){return t=t.toLowerCase(),e+(r?capitalize(t):t)}),camelCase_1$1=camelCase,baseGetTag$3=_baseGetTag,getPrototype=_getPrototype,isObjectLike$5=isObjectLike_1,objectTag$1="[object Object]",funcProto=Function.prototype,objectProto$3=Object.prototype,funcToString=funcProto.toString,hasOwnProperty$3=objectProto$3.hasOwnProperty,objectCtorString=funcToString.call(Object);function isPlainObject$1(e){if(!isObjectLike$5(e)||baseGetTag$3(e)!=objectTag$1)return!1;var t=getPrototype(e);if(t===null)return!0;var r=hasOwnProperty$3.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&funcToString.call(r)==objectCtorString}var isPlainObject_1$5=isPlainObject$1,__importDefault$z=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(packageTools,"__esModule",{value:!0});packageTools.findEngineDriver=packageTools.extractShellApiFunctionName=packageTools.extractPackageName=packageTools.extractShellApiPlugins=void 0;const camelCase_1=__importDefault$z(camelCase_1$1),isString_1$5=__importDefault$z(isString_1$7),isPlainObject_1$4=__importDefault$z(isPlainObject_1$5);function extractShellApiPlugins(e,t){const r=[],n=e.match(/^([^@]+)@([^@]+)/);if(n&&r.push(n[2]),t&&t.connection&&t.connection.engine){const a=t.connection.engine.match(/^([^@]+)@([^@]+)/);a&&r.push(a[2])}return r}packageTools.extractShellApiPlugins=extractShellApiPlugins;function extractPackageName(e){if(!e)return null;const t=e.match(/^([^@]+)@([^@]+)/);return t?t[2]:null}packageTools.extractPackageName=extractPackageName;function extractShellApiFunctionName(e){const t=e.match(/^([^@]+)@([^@]+)/);return t?`${(0,camelCase_1.default)(t[2])}.shellApi.${t[1]}`:`dbgateApi.${e}`}packageTools.extractShellApiFunctionName=extractShellApiFunctionName;function findEngineDriver(e,t){if((0,isString_1$5.default)(e))return t.drivers.find(r=>r.engine==e);if((0,isPlainObject_1$4.default)(e)){const{engine:r}=e;if(r)return t.drivers.find(n=>n.engine==r)}return null}packageTools.findEngineDriver=findEngineDriver;var createBulkInsertStreamBase$1={},HASH_UNDEFINED="__lodash_hash_undefined__";function setCacheAdd$1(e){return this.__data__.set(e,HASH_UNDEFINED),this}var _setCacheAdd=setCacheAdd$1;function setCacheHas$1(e){return this.__data__.has(e)}var _setCacheHas=setCacheHas$1,MapCache=_MapCache,setCacheAdd=_setCacheAdd,setCacheHas=_setCacheHas;function SetCache$4(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new MapCache;++t<r;)this.add(e[t])}SetCache$4.prototype.add=SetCache$4.prototype.push=setCacheAdd;SetCache$4.prototype.has=setCacheHas;var _SetCache=SetCache$4;function baseFindIndex$2(e,t,r,n){for(var a=e.length,s=r+(n?1:-1);n?s--:++s<a;)if(t(e[s],s,e))return s;return-1}var _baseFindIndex=baseFindIndex$2;function baseIsNaN$1(e){return e!==e}var _baseIsNaN=baseIsNaN$1;function strictIndexOf$1(e,t,r){for(var n=r-1,a=e.length;++n<a;)if(e[n]===t)return n;return-1}var _strictIndexOf=strictIndexOf$1,baseFindIndex$1=_baseFindIndex,baseIsNaN=_baseIsNaN,strictIndexOf=_strictIndexOf;function baseIndexOf$1(e,t,r){return t===t?strictIndexOf(e,t,r):baseFindIndex$1(e,baseIsNaN,r)}var _baseIndexOf=baseIndexOf$1,baseIndexOf=_baseIndexOf;function arrayIncludes$3(e,t){var r=e==null?0:e.length;return!!r&&baseIndexOf(e,t,0)>-1}var _arrayIncludes=arrayIncludes$3;function arrayIncludesWith$3(e,t,r){for(var n=-1,a=e==null?0:e.length;++n<a;)if(r(t,e[n]))return!0;return!1}var _arrayIncludesWith=arrayIncludesWith$3;function cacheHas$4(e,t){return e.has(t)}var _cacheHas=cacheHas$4,SetCache$3=_SetCache,arrayIncludes$2=_arrayIncludes,arrayIncludesWith$2=_arrayIncludesWith,arrayMap$5=_arrayMap,baseUnary$3=_baseUnary,cacheHas$3=_cacheHas,nativeMin=Math.min;function baseIntersection$1(e,t,r){for(var n=r?arrayIncludesWith$2:arrayIncludes$2,a=e[0].length,s=e.length,o=s,u=Array(s),l=1/0,c=[];o--;){var d=e[o];o&&t&&(d=arrayMap$5(d,baseUnary$3(t))),l=nativeMin(d.length,l),u[o]=!r&&(t||a>=120&&d.length>=120)?new SetCache$3(o&&d):void 0}d=e[0];var f=-1,h=u[0];e:for(;++f<a&&c.length<l;){var y=d[f],v=t?t(y):y;if(y=r||y!==0?y:0,!(h?cacheHas$3(h,v):n(c,v,r))){for(o=s;--o;){var g=u[o];if(!(g?cacheHas$3(g,v):n(e[o],v,r)))continue e}h&&h.push(v),c.push(y)}}return c}var _baseIntersection=baseIntersection$1;function identity$5(e){return e}var identity_1=identity$5;function apply$1(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var _apply=apply$1,apply=_apply,nativeMax$2=Math.max;function overRest$2(e,t,r){return t=nativeMax$2(t===void 0?e.length-1:t,0),function(){for(var n=arguments,a=-1,s=nativeMax$2(n.length-t,0),o=Array(s);++a<s;)o[a]=n[t+a];a=-1;for(var u=Array(t+1);++a<t;)u[a]=n[a];return u[t]=r(o),apply(e,this,u)}}var _overRest=overRest$2;function constant$1(e){return function(){return e}}var constant_1=constant$1,constant=constant_1,defineProperty=_defineProperty,identity$4=identity_1,baseSetToString$1=defineProperty?function(e,t){return defineProperty(e,"toString",{configurable:!0,enumerable:!1,value:constant(t),writable:!0})}:identity$4,_baseSetToString=baseSetToString$1,HOT_COUNT=800,HOT_SPAN=16,nativeNow=Date.now;function shortOut$1(e){var t=0,r=0;return function(){var n=nativeNow(),a=HOT_SPAN-(n-r);if(r=n,a>0){if(++t>=HOT_COUNT)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var _shortOut=shortOut$1,baseSetToString=_baseSetToString,shortOut=_shortOut,setToString$2=shortOut(baseSetToString),_setToString=setToString$2,identity$3=identity_1,overRest$1=_overRest,setToString$1=_setToString;function baseRest$4(e,t){return setToString$1(overRest$1(e,t,identity$3),e+"")}var _baseRest=baseRest$4,isArrayLike$3=isArrayLike_1,isObjectLike$4=isObjectLike_1;function isArrayLikeObject$3(e){return isObjectLike$4(e)&&isArrayLike$3(e)}var isArrayLikeObject_1=isArrayLikeObject$3,isArrayLikeObject$2=isArrayLikeObject_1;function castArrayLikeObject$1(e){return isArrayLikeObject$2(e)?e:[]}var _castArrayLikeObject=castArrayLikeObject$1,arrayMap$4=_arrayMap,baseIntersection=_baseIntersection,baseRest$3=_baseRest,castArrayLikeObject=_castArrayLikeObject,intersection=baseRest$3(function(e){var t=arrayMap$4(e,castArrayLikeObject);return t.length&&t[0]===e[0]?baseIntersection(t):[]}),intersection_1$1=intersection,getLogger$1={},lib$4={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.createLogger=e.logLevelNumbers=e.logLevelNames=void 0;class t{constructor(a){this.config={targets:(a==null?void 0:a.targets)||[{type:"console",level:"info"}],base:(a==null?void 0:a.base)||{}}}trace(a,s){this.log(this.packRecord(e.logLevelNumbers.trace,a,s))}debug(a,s){this.log(this.packRecord(e.logLevelNumbers.debug,a,s))}info(a,s){this.log(this.packRecord(e.logLevelNumbers.info,a,s))}warn(a,s){this.log(this.packRecord(e.logLevelNumbers.warn,a,s))}error(a,s){this.log(this.packRecord(e.logLevelNumbers.error,a,s))}fatal(a,s){this.log(this.packRecord(e.logLevelNumbers.fatal,a,s))}packRecord(a,s,o){return o?Object.assign(Object.assign(Object.assign({},this.config.base),s),{level:a,msg:o,time:new Date().getTime()}):Object.assign(Object.assign({},this.config.base),{level:a,msg:s,time:new Date().getTime()})}log(a){for(const s of this.config.targets)if(!(a.level<e.logLevelNames[s.level]))switch(s.type){case"console":console.log(JSON.stringify(a));break;case"stream":s.stream.write(JSON.stringify(a)+`
`);break}}child(a){return new t(Object.assign(Object.assign({},this.config),{base:Object.assign(Object.assign({},this.config.base),a)}))}}e.logLevelNames={10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"},e.logLevelNumbers={trace:10,debug:20,info:30,warn:40,error:50,fatal:60};function r(n){return new t(n)}e.createLogger=r,e.default=r})(lib$4);var __importDefault$y=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},_a;Object.defineProperty(getLogger$1,"__esModule",{value:!0});getLogger$1.getLogger=getLogger$1.setLoggerName=getLogger$1.setLogger=void 0;const pinomin_1=__importDefault$y(lib$4);let _logger,_name=null;const defaultLogger=(0,pinomin_1.default)({base:{pid:(_a=void 0)===null||_a===void 0?void 0:_a.pid},targets:[{type:"console",level:"info"}]});function setLogger(e){_logger=e}getLogger$1.setLogger=setLogger;function setLoggerName(e){_name=e}getLogger$1.setLoggerName=setLoggerName;function getLogger(e){let t=_logger||defaultLogger;if(e){const r={caller:e};_name&&(r.name=_name),t=t.child(r)}return t}getLogger$1.getLogger=getLogger;var __awaiter$7=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,r,n){function a(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function u(d){try{c(n.next(d))}catch(f){o(f)}}function l(d){try{c(n.throw(d))}catch(f){o(f)}}function c(d){d.done?s(d.value):a(d.value).then(u,l)}c((n=n.apply(e,t||[])).next())})},__importDefault$x=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(createBulkInsertStreamBase$1,"__esModule",{value:!0});createBulkInsertStreamBase$1.createBulkInsertStreamBase=void 0;const intersection_1=__importDefault$x(intersection_1$1),getLogger_1$3=getLogger$1,tableTransforms_1=tableTransforms,logger$3=(0,getLogger_1$3.getLogger)("bulkStreamBase");function createBulkInsertStreamBase(e,t,r,n,a){const s=n.schemaName?`${e.dialect.quoteIdentifier(n.schemaName)}.${e.dialect.quoteIdentifier(n.pureName)}`:e.dialect.quoteIdentifier(n.pureName),o=new t.Writable({objectMode:!0});return o.buffer=[],o.structure=null,o.columnNames=null,o.requireFixedStructure=e.databaseEngineTypes.includes("sql"),o.addRow=u=>__awaiter$7(this,void 0,void 0,function*(){o.structure?o.buffer.push(u):(o.structure=u,yield o.checkStructure())}),o.checkStructure=()=>__awaiter$7(this,void 0,void 0,function*(){let u=yield e.analyseSingleTable(r,n);if(u&&a.dropIfExists&&(logger$3.info(`Dropping table ${s}`),yield e.script(r,`DROP TABLE ${s}`)),a.createIfNotExists&&(!u||a.dropIfExists)){const l=e.createDumper();l.createTable((0,tableTransforms_1.prepareTableForImport)(Object.assign(Object.assign({},o.structure),n))),logger$3.info({sql:l.s},`Creating table ${s}`),yield e.script(r,l.s),u=yield e.analyseSingleTable(r,n)}a.truncate&&(yield e.script(r,`TRUNCATE TABLE ${s}`)),o.columnNames=(0,intersection_1.default)(u.columns.map(l=>l.columnName),o.structure.columns.map(l=>l.columnName))}),o.send=()=>__awaiter$7(this,void 0,void 0,function*(){const u=o.buffer;o.buffer=[];const l=e.createDumper();l.putRaw(`INSERT INTO ${s} (`),l.putCollection(",",o.columnNames,d=>l.putRaw(e.dialect.quoteIdentifier(d))),l.putRaw(`)
 VALUES
`);let c=!1;for(const d of u)c&&l.putRaw(`,
`),l.putRaw("("),l.putCollection(",",o.columnNames,f=>l.putValue(d[f])),l.putRaw(")"),c=!0;l.putRaw(";"),yield e.query(r,l.s,{discardResult:!0})}),o.sendIfFull=()=>__awaiter$7(this,void 0,void 0,function*(){o.buffer.length>100&&(yield o.send())}),o._write=(u,l,c)=>__awaiter$7(this,void 0,void 0,function*(){yield o.addRow(u),yield o.sendIfFull(),c()}),o._final=u=>__awaiter$7(this,void 0,void 0,function*(){yield o.send(),u()}),o}createBulkInsertStreamBase$1.createBulkInsertStreamBase=createBulkInsertStreamBase;var createAsyncWriteStream$1={},__awaiter$6=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,r,n){function a(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function u(d){try{c(n.next(d))}catch(f){o(f)}}function l(d){try{c(n.throw(d))}catch(f){o(f)}}function c(d){d.done?s(d.value):a(d.value).then(u,l)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(createAsyncWriteStream$1,"__esModule",{value:!0});createAsyncWriteStream$1.createAsyncWriteStream=void 0;const getLogger_1$2=getLogger$1;(0,getLogger_1$2.getLogger)("asyncWriteStream");function createAsyncWriteStream(e,t){const r=new e.Writable({objectMode:!0});return r._write=(n,a,s)=>__awaiter$6(this,void 0,void 0,function*(){try{yield t.processItem(n),s(null)}catch(o){s(o)}}),r}createAsyncWriteStream$1.createAsyncWriteStream=createAsyncWriteStream;var DatabaseAnalyser$1={},Symbol$2=_Symbol,isArguments$1=isArguments_1,isArray$7=isArray_1$5,spreadableSymbol=Symbol$2?Symbol$2.isConcatSpreadable:void 0;function isFlattenable$1(e){return isArray$7(e)||isArguments$1(e)||!!(spreadableSymbol&&e&&e[spreadableSymbol])}var _isFlattenable=isFlattenable$1,arrayPush=_arrayPush,isFlattenable=_isFlattenable;function baseFlatten$3(e,t,r,n,a){var s=-1,o=e.length;for(r||(r=isFlattenable),a||(a=[]);++s<o;){var u=e[s];t>0&&r(u)?t>1?baseFlatten$3(u,t-1,r,n,a):arrayPush(a,u):n||(a[a.length]=u)}return a}var _baseFlatten=baseFlatten$3;function arraySome$1(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var _arraySome=arraySome$1,SetCache$2=_SetCache,arraySome=_arraySome,cacheHas$2=_cacheHas,COMPARE_PARTIAL_FLAG$5=1,COMPARE_UNORDERED_FLAG$3=2;function equalArrays$2(e,t,r,n,a,s){var o=r&COMPARE_PARTIAL_FLAG$5,u=e.length,l=t.length;if(u!=l&&!(o&&l>u))return!1;var c=s.get(e),d=s.get(t);if(c&&d)return c==t&&d==e;var f=-1,h=!0,y=r&COMPARE_UNORDERED_FLAG$3?new SetCache$2:void 0;for(s.set(e,t),s.set(t,e);++f<u;){var v=e[f],g=t[f];if(n)var C=o?n(g,v,f,t,e,s):n(v,g,f,e,t,s);if(C!==void 0){if(C)continue;h=!1;break}if(y){if(!arraySome(t,function(O,j){if(!cacheHas$2(y,j)&&(v===O||a(v,O,r,n,s)))return y.push(j)})){h=!1;break}}else if(!(v===g||a(v,g,r,n,s))){h=!1;break}}return s.delete(e),s.delete(t),h}var _equalArrays=equalArrays$2;function mapToArray$1(e){var t=-1,r=Array(e.size);return e.forEach(function(n,a){r[++t]=[a,n]}),r}var _mapToArray=mapToArray$1;function setToArray$3(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var _setToArray=setToArray$3,Symbol$1=_Symbol,Uint8Array$1=_Uint8Array,eq$1=eq_1,equalArrays$1=_equalArrays,mapToArray=_mapToArray,setToArray$2=_setToArray,COMPARE_PARTIAL_FLAG$4=1,COMPARE_UNORDERED_FLAG$2=2,boolTag$1="[object Boolean]",dateTag$1="[object Date]",errorTag="[object Error]",mapTag="[object Map]",numberTag$1="[object Number]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",symbolProto=Symbol$1?Symbol$1.prototype:void 0,symbolValueOf=symbolProto?symbolProto.valueOf:void 0;function equalByTag$1(e,t,r,n,a,s,o){switch(r){case dataViewTag:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case arrayBufferTag:return!(e.byteLength!=t.byteLength||!s(new Uint8Array$1(e),new Uint8Array$1(t)));case boolTag$1:case dateTag$1:case numberTag$1:return eq$1(+e,+t);case errorTag:return e.name==t.name&&e.message==t.message;case regexpTag:case stringTag:return e==t+"";case mapTag:var u=mapToArray;case setTag:var l=n&COMPARE_PARTIAL_FLAG$4;if(u||(u=setToArray$2),e.size!=t.size&&!l)return!1;var c=o.get(e);if(c)return c==t;n|=COMPARE_UNORDERED_FLAG$2,o.set(e,t);var d=equalArrays$1(u(e),u(t),n,a,s,o);return o.delete(e),d;case symbolTag:if(symbolValueOf)return symbolValueOf.call(e)==symbolValueOf.call(t)}return!1}var _equalByTag=equalByTag$1,getAllKeys=_getAllKeys,COMPARE_PARTIAL_FLAG$3=1,objectProto$2=Object.prototype,hasOwnProperty$2=objectProto$2.hasOwnProperty;function equalObjects$1(e,t,r,n,a,s){var o=r&COMPARE_PARTIAL_FLAG$3,u=getAllKeys(e),l=u.length,c=getAllKeys(t),d=c.length;if(l!=d&&!o)return!1;for(var f=l;f--;){var h=u[f];if(!(o?h in t:hasOwnProperty$2.call(t,h)))return!1}var y=s.get(e),v=s.get(t);if(y&&v)return y==t&&v==e;var g=!0;s.set(e,t),s.set(t,e);for(var C=o;++f<l;){h=u[f];var O=e[h],j=t[h];if(n)var F=o?n(j,O,h,t,e,s):n(O,j,h,e,t,s);if(!(F===void 0?O===j||a(O,j,r,n,s):F)){g=!1;break}C||(C=h=="constructor")}if(g&&!C){var L=e.constructor,M=t.constructor;L!=M&&"constructor"in e&&"constructor"in t&&!(typeof L=="function"&&L instanceof L&&typeof M=="function"&&M instanceof M)&&(g=!1)}return s.delete(e),s.delete(t),g}var _equalObjects=equalObjects$1,Stack$1=_Stack,equalArrays=_equalArrays,equalByTag=_equalByTag,equalObjects=_equalObjects,getTag=_getTag,isArray$6=isArray_1$5,isBuffer=isBufferExports,isTypedArray=isTypedArray_1,COMPARE_PARTIAL_FLAG$2=1,argsTag="[object Arguments]",arrayTag="[object Array]",objectTag="[object Object]",objectProto$1=Object.prototype,hasOwnProperty$1=objectProto$1.hasOwnProperty;function baseIsEqualDeep$1(e,t,r,n,a,s){var o=isArray$6(e),u=isArray$6(t),l=o?arrayTag:getTag(e),c=u?arrayTag:getTag(t);l=l==argsTag?objectTag:l,c=c==argsTag?objectTag:c;var d=l==objectTag,f=c==objectTag,h=l==c;if(h&&isBuffer(e)){if(!isBuffer(t))return!1;o=!0,d=!1}if(h&&!d)return s||(s=new Stack$1),o||isTypedArray(e)?equalArrays(e,t,r,n,a,s):equalByTag(e,t,l,r,n,a,s);if(!(r&COMPARE_PARTIAL_FLAG$2)){var y=d&&hasOwnProperty$1.call(e,"__wrapped__"),v=f&&hasOwnProperty$1.call(t,"__wrapped__");if(y||v){var g=y?e.value():e,C=v?t.value():t;return s||(s=new Stack$1),a(g,C,r,n,s)}}return h?(s||(s=new Stack$1),equalObjects(e,t,r,n,a,s)):!1}var _baseIsEqualDeep=baseIsEqualDeep$1,baseIsEqualDeep=_baseIsEqualDeep,isObjectLike$3=isObjectLike_1;function baseIsEqual$3(e,t,r,n,a){return e===t?!0:e==null||t==null||!isObjectLike$3(e)&&!isObjectLike$3(t)?e!==e&&t!==t:baseIsEqualDeep(e,t,r,n,baseIsEqual$3,a)}var _baseIsEqual=baseIsEqual$3,Stack=_Stack,baseIsEqual$2=_baseIsEqual,COMPARE_PARTIAL_FLAG$1=1,COMPARE_UNORDERED_FLAG$1=2;function baseIsMatch$1(e,t,r,n){var a=r.length,s=a,o=!n;if(e==null)return!s;for(e=Object(e);a--;){var u=r[a];if(o&&u[2]?u[1]!==e[u[0]]:!(u[0]in e))return!1}for(;++a<s;){u=r[a];var l=u[0],c=e[l],d=u[1];if(o&&u[2]){if(c===void 0&&!(l in e))return!1}else{var f=new Stack;if(n)var h=n(c,d,l,e,t,f);if(!(h===void 0?baseIsEqual$2(d,c,COMPARE_PARTIAL_FLAG$1|COMPARE_UNORDERED_FLAG$1,n,f):h))return!1}}return!0}var _baseIsMatch=baseIsMatch$1,isObject$4=isObject_1;function isStrictComparable$2(e){return e===e&&!isObject$4(e)}var _isStrictComparable=isStrictComparable$2,isStrictComparable$1=_isStrictComparable,keys$2=keys_1;function getMatchData$1(e){for(var t=keys$2(e),r=t.length;r--;){var n=t[r],a=e[n];t[r]=[n,a,isStrictComparable$1(a)]}return t}var _getMatchData=getMatchData$1;function matchesStrictComparable$2(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var _matchesStrictComparable=matchesStrictComparable$2,baseIsMatch=_baseIsMatch,getMatchData=_getMatchData,matchesStrictComparable$1=_matchesStrictComparable;function baseMatches$1(e){var t=getMatchData(e);return t.length==1&&t[0][2]?matchesStrictComparable$1(t[0][0],t[0][1]):function(r){return r===e||baseIsMatch(r,e,t)}}var _baseMatches=baseMatches$1;function baseHasIn$1(e,t){return e!=null&&t in Object(e)}var _baseHasIn=baseHasIn$1,castPath$4=_castPath,isArguments=isArguments_1,isArray$5=isArray_1$5,isIndex$2=_isIndex,isLength=isLength_1,toKey$4=_toKey;function hasPath$1(e,t,r){t=castPath$4(t,e);for(var n=-1,a=t.length,s=!1;++n<a;){var o=toKey$4(t[n]);if(!(s=e!=null&&r(e,o)))break;e=e[o]}return s||++n!=a?s:(a=e==null?0:e.length,!!a&&isLength(a)&&isIndex$2(o,a)&&(isArray$5(e)||isArguments(e)))}var _hasPath=hasPath$1,baseHasIn=_baseHasIn,hasPath=_hasPath;function hasIn$2(e,t){return e!=null&&hasPath(e,t,baseHasIn)}var hasIn_1=hasIn$2,baseIsEqual$1=_baseIsEqual,get$3=get_1$2,hasIn$1=hasIn_1,isKey$1=_isKey,isStrictComparable=_isStrictComparable,matchesStrictComparable=_matchesStrictComparable,toKey$3=_toKey,COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;function baseMatchesProperty$1(e,t){return isKey$1(e)&&isStrictComparable(t)?matchesStrictComparable(toKey$3(e),t):function(r){var n=get$3(r,e);return n===void 0&&n===t?hasIn$1(r,e):baseIsEqual$1(t,n,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG)}}var _baseMatchesProperty=baseMatchesProperty$1;function baseProperty$2(e){return function(t){return t==null?void 0:t[e]}}var _baseProperty=baseProperty$2,baseGet$3=_baseGet;function basePropertyDeep$1(e){return function(t){return baseGet$3(t,e)}}var _basePropertyDeep=basePropertyDeep$1,baseProperty$1=_baseProperty,basePropertyDeep=_basePropertyDeep,isKey=_isKey,toKey$2=_toKey;function property$1(e){return isKey(e)?baseProperty$1(toKey$2(e)):basePropertyDeep(e)}var property_1=property$1,baseMatches=_baseMatches,baseMatchesProperty=_baseMatchesProperty,identity$2=identity_1,isArray$4=isArray_1$5,property=property_1;function baseIteratee$5(e){return typeof e=="function"?e:e==null?identity$2:typeof e=="object"?isArray$4(e)?baseMatchesProperty(e[0],e[1]):baseMatches(e):property(e)}var _baseIteratee=baseIteratee$5;function createBaseFor$1(e){return function(t,r,n){for(var a=-1,s=Object(t),o=n(t),u=o.length;u--;){var l=o[e?u:++a];if(r(s[l],l,s)===!1)break}return t}}var _createBaseFor=createBaseFor$1,createBaseFor=_createBaseFor,baseFor$1=createBaseFor(),_baseFor=baseFor$1,baseFor=_baseFor,keys$1=keys_1;function baseForOwn$2(e,t){return e&&baseFor(e,t,keys$1)}var _baseForOwn=baseForOwn$2,isArrayLike$2=isArrayLike_1;function createBaseEach$1(e,t){return function(r,n){if(r==null)return r;if(!isArrayLike$2(r))return e(r,n);for(var a=r.length,s=t?a:-1,o=Object(r);(t?s--:++s<a)&&n(o[s],s,o)!==!1;);return r}}var _createBaseEach=createBaseEach$1,baseForOwn$1=_baseForOwn,createBaseEach=_createBaseEach,baseEach$2=createBaseEach(baseForOwn$1),_baseEach=baseEach$2,baseEach$1=_baseEach,isArrayLike$1=isArrayLike_1;function baseMap$1(e,t){var r=-1,n=isArrayLike$1(e)?Array(e.length):[];return baseEach$1(e,function(a,s,o){n[++r]=t(a,s,o)}),n}var _baseMap=baseMap$1;function baseSortBy$1(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}var _baseSortBy=baseSortBy$1,isSymbol$2=isSymbol_1;function compareAscending$1(e,t){if(e!==t){var r=e!==void 0,n=e===null,a=e===e,s=isSymbol$2(e),o=t!==void 0,u=t===null,l=t===t,c=isSymbol$2(t);if(!u&&!c&&!s&&e>t||s&&o&&l&&!u&&!c||n&&o&&l||!r&&l||!a)return 1;if(!n&&!s&&!c&&e<t||c&&r&&a&&!n&&!s||u&&r&&a||!o&&a||!l)return-1}return 0}var _compareAscending=compareAscending$1,compareAscending=_compareAscending;function compareMultiple$1(e,t,r){for(var n=-1,a=e.criteria,s=t.criteria,o=a.length,u=r.length;++n<o;){var l=compareAscending(a[n],s[n]);if(l){if(n>=u)return l;var c=r[n];return l*(c=="desc"?-1:1)}}return e.index-t.index}var _compareMultiple=compareMultiple$1,arrayMap$3=_arrayMap,baseGet$2=_baseGet,baseIteratee$4=_baseIteratee,baseMap=_baseMap,baseSortBy=_baseSortBy,baseUnary$2=_baseUnary,compareMultiple=_compareMultiple,identity$1=identity_1,isArray$3=isArray_1$5;function baseOrderBy$1(e,t,r){t.length?t=arrayMap$3(t,function(s){return isArray$3(s)?function(o){return baseGet$2(o,s.length===1?s[0]:s)}:s}):t=[identity$1];var n=-1;t=arrayMap$3(t,baseUnary$2(baseIteratee$4));var a=baseMap(e,function(s,o,u){var l=arrayMap$3(t,function(c){return c(s)});return{criteria:l,index:++n,value:s}});return baseSortBy(a,function(s,o){return compareMultiple(s,o,r)})}var _baseOrderBy=baseOrderBy$1,eq=eq_1,isArrayLike=isArrayLike_1,isIndex$1=_isIndex,isObject$3=isObject_1;function isIterateeCall$2(e,t,r){if(!isObject$3(r))return!1;var n=typeof t;return(n=="number"?isArrayLike(r)&&isIndex$1(t,r.length):n=="string"&&t in r)?eq(r[t],e):!1}var _isIterateeCall=isIterateeCall$2,baseFlatten$2=_baseFlatten,baseOrderBy=_baseOrderBy,baseRest$2=_baseRest,isIterateeCall$1=_isIterateeCall,sortBy=baseRest$2(function(e,t){if(e==null)return[];var r=t.length;return r>1&&isIterateeCall$1(e,t[0],t[1])?t=[]:r>2&&isIterateeCall$1(t[0],t[1],t[2])&&(t=[t[0]]),baseOrderBy(e,baseFlatten$2(t,1),[])}),sortBy_1$2=sortBy;function arrayAggregator$1(e,t,r,n){for(var a=-1,s=e==null?0:e.length;++a<s;){var o=e[a];t(n,o,r(o),e)}return n}var _arrayAggregator=arrayAggregator$1,baseEach=_baseEach;function baseAggregator$1(e,t,r,n){return baseEach(e,function(a,s,o){t(n,a,r(a),o)}),n}var _baseAggregator=baseAggregator$1,arrayAggregator=_arrayAggregator,baseAggregator=_baseAggregator,baseIteratee$3=_baseIteratee,isArray$2=isArray_1$5;function createAggregator$1(e,t){return function(r,n){var a=isArray$2(r)?arrayAggregator:baseAggregator,s=t?t():{};return a(r,e,baseIteratee$3(n),s)}}var _createAggregator=createAggregator$1,baseAssignValue$1=_baseAssignValue,createAggregator=_createAggregator,objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,groupBy=createAggregator(function(e,t,r){hasOwnProperty.call(e,r)?e[r].push(t):baseAssignValue$1(e,r,[t])}),groupBy_1$1=groupBy,assignValue$1=_assignValue,castPath$3=_castPath,isIndex=_isIndex,isObject$2=isObject_1,toKey$1=_toKey;function baseSet$1(e,t,r,n){if(!isObject$2(e))return e;t=castPath$3(t,e);for(var a=-1,s=t.length,o=s-1,u=e;u!=null&&++a<s;){var l=toKey$1(t[a]),c=r;if(l==="__proto__"||l==="constructor"||l==="prototype")return e;if(a!=o){var d=u[l];c=n?n(d,l,u):void 0,c===void 0&&(c=isObject$2(d)?d:isIndex(t[a+1])?[]:{})}assignValue$1(u,l,c),u=u[l]}return e}var _baseSet=baseSet$1,baseGet$1=_baseGet,baseSet=_baseSet,castPath$2=_castPath;function basePickBy$1(e,t,r){for(var n=-1,a=t.length,s={};++n<a;){var o=t[n],u=baseGet$1(e,o);r(u,o)&&baseSet(s,castPath$2(o,e),u)}return s}var _basePickBy=basePickBy$1,basePickBy=_basePickBy,hasIn=hasIn_1;function basePick$1(e,t){return basePickBy(e,t,function(r,n){return hasIn(e,n)})}var _basePick=basePick$1,baseFlatten$1=_baseFlatten;function flatten$1(e){var t=e==null?0:e.length;return t?baseFlatten$1(e,1):[]}var flatten_1$4=flatten$1,flatten=flatten_1$4,overRest=_overRest,setToString=_setToString;function flatRest$2(e){return setToString(overRest(e,void 0,flatten),e+"")}var _flatRest=flatRest$2,basePick=_basePick,flatRest$1=_flatRest,pick=flatRest$1(function(e,t){return e==null?{}:basePick(e,t)}),pick_1$3=pick;function compact(e){for(var t=-1,r=e==null?0:e.length,n=0,a=[];++t<r;){var s=e[t];s&&(a[n++]=s)}return a}var compact_1$6=compact,__awaiter$5=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,r,n){function a(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function u(d){try{c(n.next(d))}catch(f){o(f)}}function l(d){try{c(n.throw(d))}catch(f){o(f)}}function c(d){d.done?s(d.value):a(d.value).then(u,l)}c((n=n.apply(e,t||[])).next())})},__importDefault$w=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DatabaseAnalyser$1,"__esModule",{value:!0});DatabaseAnalyser$1.DatabaseAnalyser=void 0;const sortBy_1$1=__importDefault$w(sortBy_1$2),groupBy_1=__importDefault$w(groupBy_1$1),pick_1$2=__importDefault$w(pick_1$3),compact_1$5=__importDefault$w(compact_1$6),getLogger_1$1=getLogger$1,logger$2=(0,getLogger_1$1.getLogger)("dbAnalyser"),STRUCTURE_FIELDS=["tables","collections","views","matviews","functions","procedures","triggers"],fp_pick=e=>t=>(0,pick_1$2.default)(t,e);function mergeTableRowCounts(e,t){return Object.assign(Object.assign({},e),{tables:(e.tables||[]).map(r=>{var n,a;return Object.assign(Object.assign({},r),{tableRowCount:(a=(n=t.find(s=>s.objectId==r.objectId))===null||n===void 0?void 0:n.tableRowCount)!==null&&a!==void 0?a:r.tableRowCount})})})}function areDifferentRowCounts(e,t){for(const r of e.tables||[]){const n=(t.tables||[]).find(a=>a.objectId==r.objectId);if((r==null?void 0:r.tableRowCount)!==(n==null?void 0:n.tableRowCount))return!0}return!1}class DatabaseAnalyser{constructor(t,r,n){this.pool=t,this.driver=r,this.singleObjectId=null,this.dialect=(r==null?void 0:r.dialectByVersion)&&(r==null?void 0:r.dialectByVersion(n))||(r==null?void 0:r.dialect)}_runAnalysis(){return __awaiter$5(this,void 0,void 0,function*(){return DatabaseAnalyser.createEmptyStructure()})}_getFastSnapshot(){return __awaiter$5(this,void 0,void 0,function*(){return null})}_computeSingleObjectId(){return __awaiter$5(this,void 0,void 0,function*(){})}addEngineField(t){var r;if(!((r=this.driver)===null||r===void 0)&&r.engine){for(const n of STRUCTURE_FIELDS)if(t[n])for(const a of t[n])a.engine=this.driver.engine;return t.engine=this.driver.engine,t}}fullAnalysis(){return __awaiter$5(this,void 0,void 0,function*(){return this.addEngineField(yield this._runAnalysis())})}singleObjectAnalysis(t,r){var n,a;return __awaiter$5(this,void 0,void 0,function*(){this.singleObjectFilter=Object.assign(Object.assign({},t),{typeField:r}),yield this._computeSingleObjectId();const s=this.addEngineField(yield this._runAnalysis());return((n=s[r])===null||n===void 0?void 0:n.length)==1?s[r][0]:(a=s[r])===null||a===void 0?void 0:a.find(u=>u.pureName==t.pureName&&u.schemaName==t.schemaName)})}incrementalAnalysis(t){return __awaiter$5(this,void 0,void 0,function*(){this.structure=t;const r=yield this.getModifications();if(r==null)return this.structure=null,this.addEngineField(yield this._runAnalysis());const n=r.filter(o=>o.action!="setTableRowCounts"),a=r.find(o=>o.action=="setTableRowCounts");let s=null;if(a){const o=mergeTableRowCounts(t,a.rowCounts);areDifferentRowCounts(t,o)&&(s=o)}return n.length==0?s?this.addEngineField(s):null:(this.modifications=n,s&&(this.structure=s),logger$2.info({modifications:this.modifications},"DB modifications detected:"),this.addEngineField(this.mergeAnalyseResult(yield this._runAnalysis())))})}mergeAnalyseResult(t){if(this.structure==null)return Object.assign(Object.assign({},DatabaseAnalyser.createEmptyStructure()),t);const r={};for(const n of STRUCTURE_FIELDS){const a=this.modifications.filter(l=>l.action=="remove"&&l.objectTypeField==n).map(l=>l.objectId),s=t[n]||[],o=s.map(l=>l.objectId),u=[...a,...o];r[n]=(0,sortBy_1$1.default)([...(this.structure[n]||[]).filter(l=>!u.includes(l.objectId)),...s],l=>l.pureName);for(const l of r[n]){const c=(this.structure[n]||[]).find(d=>d.objectId==l.objectId);if(c)for(const d in c)l[d]||(l[d]=c[d])}}return r}getRequestedObjectPureNames(t,r){if(this.singleObjectFilter){const{typeField:n,pureName:a}=this.singleObjectFilter;if(n==t)return[a]}return this.modifications?this.modifications.filter(n=>n.objectTypeField==t).filter(n=>n.newName).map(n=>n.newName.pureName):r}createQuery(t,r){return this.createQueryCore(t,r)}createQueryCore(t,r){if(this.singleObjectFilter){const{typeField:a}=this.singleObjectFilter;return!this.singleObjectId||!r||!r.includes(a)?null:t.replace(/=OBJECT_ID_CONDITION/g,` = '${this.singleObjectId}'`)}if(!this.modifications||!r||this.modifications.length==0)return t.replace(/=OBJECT_ID_CONDITION/g," is not null");if(this.modifications.some(a=>r.includes(a.objectTypeField)&&a.action=="all"))return t.replace(/=OBJECT_ID_CONDITION/g," is not null");const n=this.modifications.filter(a=>r.includes(a.objectTypeField)&&(a.action=="add"||a.action=="change")).map(a=>a.objectId);return n.length==0?null:t.replace(/=OBJECT_ID_CONDITION/g,` in (${n.map(a=>`'${a}'`).join(",")})`)}getDeletedObjectsForField(t,r){const n=t[r];return n?this.structure[r]?this.structure[r].filter(a=>!n.find(s=>a.objectId==s.objectId)).map(a=>({oldName:(0,pick_1$2.default)(a,["schemaName","pureName"]),objectId:a.objectId,action:"remove",objectTypeField:r})):[]:[]}getDeletedObjects(t){return[...this.getDeletedObjectsForField(t,"tables"),...this.getDeletedObjectsForField(t,"collections"),...this.getDeletedObjectsForField(t,"views"),...this.getDeletedObjectsForField(t,"matviews"),...this.getDeletedObjectsForField(t,"procedures"),...this.getDeletedObjectsForField(t,"functions"),...this.getDeletedObjectsForField(t,"triggers")]}feedback(t){this.pool.feedback&&this.pool.feedback(t),t&&t.analysingMessage&&logger$2.debug(t.analysingMessage)}getModifications(){return __awaiter$5(this,void 0,void 0,function*(){const t=yield this._getFastSnapshot();if(!t)return null;const r=[];for(const a in t){const s=t[a];if(s===null){r.push({objectTypeField:a,action:"all"});continue}if(s!==void 0)for(const o of s){const{objectId:u,schemaName:l,pureName:c,contentHash:d}=o,f=this.structure[a].find(y=>y.objectId==u);if(f&&d&&f.contentHash==d)continue;const h=f?{newName:{schemaName:l,pureName:c},oldName:(0,pick_1$2.default)(f,["schemaName","pureName"]),action:"change",objectTypeField:a,objectId:u}:{newName:{schemaName:l,pureName:c},action:"add",objectTypeField:a,objectId:u};r.push(h)}}const n=(t.tables||[]).filter(a=>a.tableRowCount!=null).map(a=>({objectId:a.objectId,tableRowCount:a.tableRowCount}));return n.length>0&&r.push({action:"setTableRowCounts",rowCounts:n}),[...(0,compact_1$5.default)(r),...this.getDeletedObjects(t)]})}analyserQuery(t,r){return __awaiter$5(this,void 0,void 0,function*(){const n=this.createQuery(t,r);if(!n)return{rows:[]};try{return yield this.driver.query(this.pool,n)}catch(a){return logger$2.error({err:a},"Error running analyser query"),{rows:[]}}})}static createEmptyStructure(){return{tables:[],collections:[],views:[],matviews:[],functions:[],procedures:[],triggers:[],schemas:[]}}static byTableFilter(t){return r=>r.pureName==t.pureName&&r.schemaName==r.schemaName}static extractPrimaryKeys(t,r){const n=r.filter(DatabaseAnalyser.byTableFilter(t));if(n.length!=0)return Object.assign(Object.assign({},(0,pick_1$2.default)(n[0],["constraintName","schemaName","pureName"])),{constraintType:"primaryKey",columns:n.map(fp_pick("columnName"))})}static extractForeignKeys(t,r){const n=(0,groupBy_1.default)(r.filter(DatabaseAnalyser.byTableFilter(t)),"constraintName");return Object.keys(n).map(a=>Object.assign(Object.assign({constraintName:a,constraintType:"foreignKey"},(0,pick_1$2.default)(n[a][0],["constraintName","schemaName","pureName","refSchemaName","refTableName","updateAction","deleteAction"])),{columns:n[a].map(fp_pick(["columnName","refColumnName"]))}))}}DatabaseAnalyser$1.DatabaseAnalyser=DatabaseAnalyser;var driverBase={},SqlDumper$1={},baseGetTag$2=_baseGetTag,isObjectLike$2=isObjectLike_1,numberTag="[object Number]";function isNumber$2(e){return typeof e=="number"||isObjectLike$2(e)&&baseGetTag$2(e)==numberTag}var isNumber_1$3=isNumber$2,baseGetTag$1=_baseGetTag,isObjectLike$1=isObjectLike_1,dateTag="[object Date]";function baseIsDate$1(e){return isObjectLike$1(e)&&baseGetTag$1(e)==dateTag}var _baseIsDate=baseIsDate$1,baseIsDate=_baseIsDate,baseUnary$1=_baseUnary,nodeUtil=_nodeUtilExports,nodeIsDate=nodeUtil&&nodeUtil.isDate,isDate$1=nodeIsDate?baseUnary$1(nodeIsDate):baseIsDate,isDate_1$1=isDate$1,__importDefault$v=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(SqlDumper$1,"__esModule",{value:!0});SqlDumper$1.SqlDumper=void 0;const lodash_1$9=__importDefault$v(lodashExports),isString_1$4=__importDefault$v(isString_1$7),isNumber_1$2=__importDefault$v(isNumber_1$3),isDate_1=__importDefault$v(isDate_1$1),isArray_1$4=__importDefault$v(isArray_1$5),isPlainObject_1$3=__importDefault$v(isPlainObject_1$5),v1_1$4=__importDefault$v(v1_1$5);class SqlDumper{constructor(t){this.s="",this.indentLevel=0,this.driver=t,this.dialect=t.dialect}static convertKeywordCase(t){var r,n;return this.keywordsCase=="lowerCase"?(r=t==null?void 0:t.toString())===null||r===void 0?void 0:r.toLowerCase():(n=t==null?void 0:t.toString())===null||n===void 0?void 0:n.toUpperCase()}endCommand(){this.putRaw(`;
`)}putRaw(t){this.s+=t}escapeString(t){const r=this.dialect.stringEscapeChar;let n="";for(let a=0;a<t.length;a++){const s=t[a];(s==r||s=="'")&&(n+=r),n+=s}return n}putStringValue(t){this.putRaw("'"),this.putRaw(this.escapeString(t)),this.putRaw("'")}putByteArrayValue(t){this.put("^null")}putValue(t){t===null?this.put("^null"):t===!0?this.putRaw("1"):t===!1?this.putRaw("0"):(0,isString_1$4.default)(t)?this.putStringValue(t):(0,isNumber_1$2.default)(t)?this.putRaw(t.toString()):(0,isDate_1.default)(t)?this.putStringValue(new Date(t).toISOString()):(t==null?void 0:t.type)=="Buffer"&&(0,isArray_1$4.default)(t==null?void 0:t.data)?this.putByteArrayValue(t==null?void 0:t.data):(0,isPlainObject_1$3.default)(t)||(0,isArray_1$4.default)(t)?this.putStringValue(JSON.stringify(t)):this.put("^null")}putCmd(t,...r){this.put(t,...r),this.endCommand()}putFormattedValue(t,r){switch(t){case"s":r!=null&&this.putRaw(r.toString());break;case"i":this.putRaw(this.dialect.quoteIdentifier(r));break;case"k":r&&this.putRaw(SqlDumper.convertKeywordCase(r));break;case"f":{const{schemaName:n,pureName:a}=r;n&&(this.putRaw(this.dialect.quoteIdentifier(n)),this.putRaw(".")),this.putRaw(this.dialect.quoteIdentifier(a))}break;case"v":this.putValue(r);break;case"c":r(this);break}}putFormattedList(t,r){r&&this.putCollection(", ",r,n=>this.putFormattedValue(t,n))}put(t,...r){let n=0,a=0;const s=t.length;for(;n<s;){let o=t[n];switch(n++,o){case"^":for(;n<s&&t[n].match(/[a-z0-9_]/i);)this.putRaw(SqlDumper.convertKeywordCase(t[n])),n++;break;case"%":switch(o=t[n],n++,o){case"%":this.putRaw("%");break;case",":o=t[n],n++,this.putFormattedList(o,r[a]);break;default:this.putFormattedValue(o,r[a]);break}a++;break;case"&":switch(o=t[n],n++,o){case"&":this.putRaw("&");break;case">":this.indentLevel++;break;case"<":this.indentLevel--;break;case"n":this.putRaw(`
`),this.putRaw(" ".repeat(2*this.indentLevel));break}break;default:this.putRaw(o);break}}}autoIncrement(){this.put(" ^auto_increment")}createDatabase(t){this.putCmd("^create ^database %i",t)}dropDatabase(t){this.putCmd("^drop ^database %i",t)}specialColumnOptions(t){}selectScopeIdentity(t){}columnDefinition(t,{includeDefault:r=!0,includeNullable:n=!0,includeCollate:a=!0}={}){var s;if(t.computedExpression){this.put("^as %s",t.computedExpression),t.isPersisted&&this.put(" ^persisted");return}this.put("%k",t.dataType||this.dialect.fallbackDataType),t.autoIncrement&&this.autoIncrement(),this.putRaw(" "),this.specialColumnOptions(t),n&&this.put(t.notNull?"^not ^null":"^null"),r&&(!((s=t.defaultValue)===null||s===void 0)&&s.trim())&&this.columnDefault(t)}columnDefault(t){t.defaultConstraint!=null?this.put(" ^constraint %i ^default %s ",t.defaultConstraint,t.defaultValue):this.put(" ^default %s ",t.defaultValue)}putCollection(t,r,n){if(!r)return;let a=!0;for(const s of r)a||this.put(t),a=!1,n(s)}createTable(t){this.put("^create ^table %f ( &>&n",t),this.putCollection(",&n",t.columns,r=>{this.put("%i ",r.columnName),this.columnDefinition(r)}),this.createTablePrimaryKeyCore(t),(t.foreignKeys||[]).forEach(r=>{this.put(",&n"),this.createForeignKeyFore(r)}),(t.uniques||[]).forEach(r=>{this.put(",&n"),this.createUniqueCore(r)}),(t.checks||[]).forEach(r=>{this.put(",&n"),this.createCheckCore(r)}),this.put("&<&n)"),this.endCommand(),(t.indexes||[]).forEach(r=>{this.createIndex(r)})}createTablePrimaryKeyCore(t){t.primaryKey&&(this.put(",&n"),t.primaryKey.constraintName&&this.put("^constraint %i",t.primaryKey.constraintName),this.put(" ^primary ^key (%,i)",t.primaryKey.columns.map(r=>r.columnName)))}createForeignKeyFore(t){t.constraintName!=null&&this.put("^constraint %i ",t.constraintName),this.put("^foreign ^key (%,i) ^references %f (%,i)",t.columns.map(r=>r.columnName),{schemaName:t.refSchemaName,pureName:t.refTableName},t.columns.map(r=>r.refColumnName)),t.deleteAction&&this.put(" ^on ^delete %k",t.deleteAction),t.updateAction&&this.put(" ^on ^update %k",t.updateAction)}transform(t,r){r()}allowIdentityInsert(t,r){}enableConstraints(t,r){}comment(t){if(t)for(const r of t.split(`
`))this.put(" -- %s",r.trimRight())}createView(t){this.putRaw(t.createSql),this.endCommand()}dropView(t,{testIfExists:r=!1}){this.putCmd("^drop ^view  %f",t)}alterView(t){this.putRaw(t.createSql.replace(/create\s+view/i,"ALTER VIEW")),this.endCommand()}changeViewSchema(t,r){}renameView(t,r){}createMatview(t){this.putRaw(t.createSql),this.endCommand()}dropMatview(t,{testIfExists:r=!1}){this.putCmd("^drop ^materialized ^view  %f",t)}alterMatview(t){this.putRaw(t.createSql.replace(/create\s+view/i,"ALTER VIEW")),this.endCommand()}changeMatviewSchema(t,r){}renameMatview(t,r){}createProcedure(t){this.putRaw(t.createSql),this.endCommand()}dropProcedure(t,{testIfExists:r=!1}){this.putCmd("^drop ^procedure  %f",t)}alterProcedure(t){this.putRaw(t.createSql.replace(/create\s+procedure/i,"ALTER PROCEDURE")),this.endCommand()}changeProcedureSchema(t,r){}renameProcedure(t,r){}createFunction(t){this.putRaw(t.createSql),this.endCommand()}dropFunction(t,{testIfExists:r=!1}){this.putCmd("^drop ^function  %f",t)}alterFunction(t){this.putRaw(t.createSql.replace(/create\s+function/i,"ALTER FUNCTION")),this.endCommand()}changeFunctionSchema(t,r){}renameFunction(t,r){}createTrigger(t){this.putRaw(t.createSql),this.endCommand()}dropTrigger(t,{testIfExists:r=!1}){this.putCmd("^drop ^trigger  %f",t)}alterTrigger(t){this.putRaw(t.createSql.replace(/create\s+trigger/i,"ALTER TRIGGER")),this.endCommand()}changeTriggerSchema(t,r){}renameTrigger(t,r){}dropConstraintCore(t){this.putCmd("^alter ^table %f ^drop ^constraint %i",t,t.constraintName)}dropConstraint(t){switch(t.constraintType){case"primaryKey":this.dropPrimaryKey(t);break;case"foreignKey":this.dropForeignKey(t);break;case"unique":this.dropUnique(t);break;case"check":this.dropCheck(t);break;case"index":this.dropIndex(t);break}}createConstraint(t){switch(t.constraintType){case"primaryKey":this.createPrimaryKey(t);break;case"foreignKey":this.createForeignKey(t);break;case"unique":this.createUnique(t);break;case"check":this.createCheck(t);break;case"index":this.createIndex(t);break}}changeConstraint(t,r){}dropForeignKey(t){this.dialect.explicitDropConstraint?this.putCmd("^alter ^table %f ^drop ^foreign ^key %i",t,t.constraintName):this.dropConstraintCore(t)}createForeignKey(t){this.put("^alter ^table %f ^add ",t),this.createForeignKeyFore(t),this.endCommand()}dropPrimaryKey(t){this.dialect.explicitDropConstraint?this.putCmd("^alter ^table %f ^drop ^primary ^key",t):this.dropConstraintCore(t)}createPrimaryKey(t){this.putCmd("^alter ^table %f ^add ^constraint %i ^primary ^key (%,i)",t,t.constraintName,t.columns.map(r=>r.columnName))}dropIndex(t){this.put("^drop ^index %i",t.constraintName),this.dialect.dropIndexContainsTableSpec&&this.put(" ^on %f",t),this.endCommand()}createIndex(t){this.put("^create"),t.isUnique&&this.put(" ^unique"),this.put(" ^index %i &n^on %f (&>&n",t.constraintName,t),this.putCollection(",&n",t.columns,r=>{this.put("%i %k",r.columnName,r.isDescending==!0?"DESC":"ASC")}),this.put("&<&n)"),this.endCommand()}dropUnique(t){this.dropConstraintCore(t)}createUniqueCore(t){this.put("^constraint %i ^unique (%,i)",t.constraintName,t.columns.map(r=>r.columnName))}createUnique(t){this.put("^alter ^table %f ^add ",t),this.createUniqueCore(t),this.endCommand()}dropCheck(t){this.dropConstraintCore(t)}createCheckCore(t){this.put("^constraint %i ^check (%s)",t.constraintName,t.definition)}createCheck(t){this.put("^alter ^table %f ^add ",t),this.createCheckCore(t),this.endCommand()}renameConstraint(t,r){}createColumn(t,r){this.put("^alter ^table %f ^add %i ",t,t.columnName),this.columnDefinition(t),this.inlineConstraints(r),this.endCommand()}inlineConstraints(t){if(t!=null)for(const r of t)r.constraintType=="primaryKey"&&(r.constraintName!=null&&!this.dialect.anonymousPrimaryKey&&this.put(" ^constraint %i",r.constraintName),this.put(" ^primary ^key "))}dropColumn(t){this.putCmd("^alter ^table %f ^drop ^column %i",t,t.columnName)}renameColumn(t,r){}changeColumn(t,r,n){}dropTable(t,{testIfExists:r=!1}={}){this.putCmd("^drop ^table %f",t)}changeTableSchema(t,r){}renameTable(t,r){}beginTransaction(){this.putCmd("^begin ^transaction")}commitTransaction(){this.putCmd("^commit")}rollbackTransaction(){this.putCmd("^rollback")}alterProlog(){}alterEpilog(){}selectTableIntoNewTable(t,r){this.putCmd("^select * ^into %f ^from %f",r,t)}truncateTable(t){this.putCmd("^truncate ^table %f",t)}dropConstraints(t,r=!1){r&&this.dialect.dropForeignKey&&t.dependencies.forEach(n=>this.dropConstraint(n)),this.dialect.dropIndex&&t.indexes.forEach(n=>this.dropIndex(n)),this.dialect.dropForeignKey&&t.foreignKeys.forEach(n=>this.dropForeignKey(n)),this.dialect.dropPrimaryKey&&t.primaryKey&&this.dropPrimaryKey(t.primaryKey)}recreateTable(t,r){if(!t.pairingId||!r.pairingId||t.pairingId!=r.pairingId)throw new Error("Recreate is not possible: oldTable.paringId != newTable.paringId");const n=`temp_${(0,v1_1$4.default)()}`,a=t.columns.map(o=>({oldcol:o,newcol:r.columns.find(u=>u.pairingId==o.pairingId)})).filter(o=>o.newcol);this.dropConstraints(t,!0),this.renameTable(t,n),this.createTable(r);const s=r.columns.find(o=>o.autoIncrement);s&&this.allowIdentityInsert(r,!0),this.putCmd("^insert ^into %f (%,i) select %,s ^from %f",r,a.map(o=>o.newcol.columnName),a.map(o=>o.oldcol.columnName),Object.assign(Object.assign({},t),{pureName:n})),s&&this.allowIdentityInsert(r,!1),this.dialect.dropForeignKey&&r.dependencies.forEach(o=>this.createConstraint(o)),this.dropTable(Object.assign(Object.assign({},t),{pureName:n}))}createSqlObject(t){this.putCmd(t.createSql)}getSqlObjectSqlName(t){switch(t){case"procedures":return"PROCEDURE";case"views":return"VIEW";case"functions":return"FUNCTION";case"triggers":return"TRIGGER";case"matviews":return"MATERIALIZED VIEW"}}dropSqlObject(t){this.putCmd("^drop %s %f",this.getSqlObjectSqlName(t.objectTypeField),t)}fillPreloadedRows(t,r,n,a,s){let o=!1;for(const u of n){const l=r==null?void 0:r.find(d=>a.every(f=>d[f]==u[f])),c=lodash_1$9.default.keys(u);if(l){const d=[];for(const f of c)u[f]!=l[f]&&!(s!=null&&s.includes(f))&&d.push(f);d.length>0&&(o&&this.put(`;
`),o=!0,this.put("^update %f ^set ",t),this.putCollection(", ",d,f=>this.put("%i=%v",f,u[f])),this.put(" ^where "),this.putCollection(" ^and ",a,f=>this.put("%i=%v",f,u[f])))}else o&&this.put(`;
`),o=!0,this.put("^insert ^into %f (%,i) ^values (%,v)",t,c,c.map(d=>u[d]))}o&&this.endCommand()}}SqlDumper$1.SqlDumper=SqlDumper;SqlDumper.keywordsCase="upperCase";var lib$3={},splitQuery$1={},options={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.redisSplitterOptions=e.noSplitSplitterOptions=e.mongoSplitterOptions=e.sqliteSplitterOptions=e.postgreSplitterOptions=e.mssqlSplitterOptions=e.mysqlSplitterOptions=e.defaultSplitterOptions=void 0,e.defaultSplitterOptions={stringsBegins:["'"],stringsEnds:{"'":"'"},stringEscapes:{"'":"'"},allowSemicolon:!0,allowCustomDelimiter:!1,allowGoDelimiter:!1,allowDollarDollarString:!1,noSplit:!1,doubleDashComments:!0,multilineComments:!0,javaScriptComments:!1,returnRichInfo:!1,splitByLines:!1,preventSingleLineSplit:!1,adaptiveGoSplit:!1,ignoreComments:!1},e.mysqlSplitterOptions=Object.assign(Object.assign({},e.defaultSplitterOptions),{allowCustomDelimiter:!0,stringsBegins:["'","`"],stringsEnds:{"'":"'","`":"`"},stringEscapes:{"'":"\\","`":"`"}}),e.mssqlSplitterOptions=Object.assign(Object.assign({},e.defaultSplitterOptions),{allowSemicolon:!1,allowGoDelimiter:!0,stringsBegins:["'","["],stringsEnds:{"'":"'","[":"]"},stringEscapes:{"'":"'"}}),e.postgreSplitterOptions=Object.assign(Object.assign({},e.defaultSplitterOptions),{allowDollarDollarString:!0,stringsBegins:["'",'"'],stringsEnds:{"'":"'",'"':'"'},stringEscapes:{"'":"'",'"':'"'}}),e.sqliteSplitterOptions=Object.assign(Object.assign({},e.defaultSplitterOptions),{stringsBegins:["'",'"'],stringsEnds:{"'":"'",'"':'"'},stringEscapes:{"'":"'",'"':'"'}}),e.mongoSplitterOptions=Object.assign(Object.assign({},e.defaultSplitterOptions),{stringsBegins:["'",'"'],stringsEnds:{"'":"'",'"':'"'},stringEscapes:{"'":"\\",'"':"\\"}}),e.noSplitSplitterOptions=Object.assign(Object.assign({},e.defaultSplitterOptions),{noSplit:!0}),e.redisSplitterOptions=Object.assign(Object.assign({},e.defaultSplitterOptions),{splitByLines:!0})})(options);Object.defineProperty(splitQuery$1,"__esModule",{value:!0});splitQuery$1.splitQuery=splitQuery$1.finishSplitStream=splitQuery$1.getInitialDelimiter=splitQuery$1.splitQueryLine=void 0;const options_1=options,SEMICOLON=";";function movePosition(e,t,r){let{source:n,position:a,line:s,column:o,streamPosition:u}=e;for(;t>0;)n[a]==`
`?(s+=1,o=0):o+=1,a+=1,u+=1,t-=1;e.position=a,e.streamPosition=u,e.line=s,e.column=o,e.wasDataInCommand||(r?(e.trimCommandStartPosition=u,e.trimCommandStartLine=s,e.trimCommandStartColumn=o):e.wasDataInCommand=!0),r||(e.noWhitePosition=u,e.noWhiteLine=s,e.noWhiteColumn=o)}function isStringEnd(e,t,r,n){return n?r==n?e[t]==r&&e[t+1]!=r:e[t]==r&&e[t-1]!=n:e[t]==r}const WHITESPACE_TOKEN={type:"whitespace",length:1},EOLN_TOKEN={type:"eoln",length:1},DATA_TOKEN={type:"data",length:1};function scanDollarQuotedString(e){if(!e.options.allowDollarDollarString)return null;let t=e.position;const r=e.source,n=/^(\$[a-zA-Z0-9_]*\$)/.exec(r.slice(t));if(!n)return null;const a=n[1];for(t+=a.length;t<e.end;){if(r.slice(t).startsWith(a))return{type:"string",length:t+a.length-e.position};t++}return null}function scanToken(e){let t=e.position;const r=e.source,n=r[t];if(e.options.stringsBegins.includes(n)){t++;const s=e.options.stringsEnds[n],o=e.options.stringEscapes[n];for(;t<e.end&&!isStringEnd(r,t,s,o);)s==o&&r[t]==s&&r[t+1]==s?t+=2:t++;return{type:"string",length:t-e.position+1}}if(e.currentDelimiter&&r.slice(t).startsWith(e.currentDelimiter))return{type:"delimiter",length:e.currentDelimiter.length};if(n==" "||n=="	"||n=="\r")return WHITESPACE_TOKEN;if(n==`
`)return EOLN_TOKEN;if(e.options.doubleDashComments&&n=="-"&&r[t+1]=="-"){for(;t<e.end&&r[t]!=`
`;)t++;return{type:"comment",length:t-e.position}}if(e.options.multilineComments&&n=="/"&&r[t+1]=="*"){for(t+=2;t<e.end&&!(r[t]=="*"&&r[t+1]=="/");)t++;return{type:"comment",length:t-e.position+2}}if(e.options.allowCustomDelimiter&&!e.wasDataOnLine){const s=r.slice(t).match(/^DELIMITER[ \t]+([^\n]+)/i);if(s)return{type:"set_delimiter",value:s[1].trim(),length:s[0].length}}if((e.options.allowGoDelimiter||e.options.adaptiveGoSplit)&&!e.wasDataOnLine){const s=r.slice(t).match(/^GO[\t\r ]*(\n|$)/i);if(s)return{type:"go_delimiter",length:s[0].length-1}}if(e.options.adaptiveGoSplit){const s=r.slice(t).match(/^(CREATE|ALTER)\s*(PROCEDURE|FUNCTION|TRIGGER)/i);if(s)return{type:"create_routine",length:s[0].length-1}}const a=scanDollarQuotedString(e);return a||DATA_TOKEN}function containsDataAfterDelimiterOnLine(e,t){var r;const n={options:e.options,source:e.source,position:e.position,currentDelimiter:e.currentDelimiter,end:e.end,wasDataOnLine:e.wasDataOnLine};for(n.position+=t.length;n.position<n.end;){const a=scanToken(n);if(!a){n.position+=1;continue}switch(a.type){case"whitespace":n.position+=a.length;continue;case"eoln":return!1;case"comment":if(!((r=a.value)===null||r===void 0)&&r.includes(`
`))return!0;n.position+=a.length;continue;default:return!0}}}function pushQuery(e){e.commandPart+=e.source.slice(e.currentCommandStart,e.position),pushCurrentQueryPart(e)}function pushCurrentQueryPart(e){const t=e.commandPart.substring(e.trimCommandStartPosition-e.commandStartPosition,e.noWhitePosition-e.commandStartPosition);t.trim()&&(e.options.returnRichInfo?e.pushOutput({text:t,start:{position:e.commandStartPosition,line:e.commandStartLine,column:e.commandStartColumn},end:{position:e.streamPosition,line:e.line,column:e.column},trimStart:{position:e.trimCommandStartPosition,line:e.trimCommandStartLine,column:e.trimCommandStartColumn},trimEnd:{position:e.noWhitePosition,line:e.noWhiteLine,column:e.noWhiteColumn}}):e.pushOutput(t))}function markStartCommand(e){e.commandStartPosition=e.streamPosition,e.commandStartLine=e.line,e.commandStartColumn=e.column,e.trimCommandStartPosition=e.streamPosition,e.trimCommandStartLine=e.line,e.trimCommandStartColumn=e.column,e.wasDataInCommand=!1}function splitByLines(e){for(;e.position<e.end;)e.source[e.position]==`
`?(pushQuery(e),e.commandPart="",movePosition(e,1,!0),e.currentCommandStart=e.position,markStartCommand(e)):movePosition(e,1,/\s/.test(e.source[e.position]));e.end>e.currentCommandStart&&(e.commandPart+=e.source.slice(e.currentCommandStart,e.position))}function splitQueryLine(e){if(e.options.splitByLines){splitByLines(e);return}for(;e.position<e.end;){const t=scanToken(e);if(!t){movePosition(e,1,!1);continue}switch(t.type){case"string":movePosition(e,t.length,!1),e.wasDataOnLine=!0;break;case"comment":movePosition(e,t.length,!!e.options.ignoreComments),e.wasDataOnLine=!0;break;case"eoln":movePosition(e,t.length,!0),e.wasDataOnLine=!1;break;case"data":movePosition(e,t.length,!1),e.wasDataOnLine=!0;break;case"whitespace":movePosition(e,t.length,!0);break;case"set_delimiter":pushQuery(e),e.commandPart="",e.currentDelimiter=t.value,movePosition(e,t.length,!1),e.currentCommandStart=e.position,markStartCommand(e);break;case"go_delimiter":pushQuery(e),e.commandPart="",movePosition(e,t.length,!1),e.currentCommandStart=e.position,markStartCommand(e),e.options.adaptiveGoSplit&&(e.currentDelimiter=SEMICOLON);break;case"create_routine":movePosition(e,t.length,!1),e.options.adaptiveGoSplit&&(e.currentDelimiter=null);break;case"delimiter":if(e.options.preventSingleLineSplit&&containsDataAfterDelimiterOnLine(e,t)){movePosition(e,t.length,!1),e.wasDataOnLine=!0;break}pushQuery(e),e.commandPart="",movePosition(e,t.length,!1),e.currentCommandStart=e.position,markStartCommand(e);break}}e.end>e.currentCommandStart&&(e.commandPart+=e.source.slice(e.currentCommandStart,e.position))}splitQuery$1.splitQueryLine=splitQueryLine;function getInitialDelimiter(e){return e!=null&&e.adaptiveGoSplit?SEMICOLON:(e==null?void 0:e.allowSemicolon)===!1?null:SEMICOLON}splitQuery$1.getInitialDelimiter=getInitialDelimiter;function finishSplitStream(e){pushCurrentQueryPart(e)}splitQuery$1.finishSplitStream=finishSplitStream;function splitQuery(e,t=null){var r;const n=Object.assign(Object.assign({},options_1.defaultSplitterOptions),t);if(n.noSplit){if(n.returnRichInfo){const o=e.split(`
`);return[{text:e,start:{position:0,line:0,column:0},end:{position:e.length,line:o.length,column:((r=o[o.length-1])===null||r===void 0?void 0:r.length)||0}}]}return[e]}const a=[],s={source:e,end:e.length,currentDelimiter:getInitialDelimiter(t),position:0,column:0,line:0,currentCommandStart:0,commandStartLine:0,commandStartColumn:0,commandStartPosition:0,streamPosition:0,noWhiteLine:0,noWhiteColumn:0,noWhitePosition:0,trimCommandStartPosition:0,trimCommandStartLine:0,trimCommandStartColumn:0,wasDataInCommand:!1,pushOutput:o=>a.push(o),wasDataOnLine:!1,options:n,commandPart:""};return splitQueryLine(s),finishSplitStream(s),a}splitQuery$1.splitQuery=splitQuery;(function(e){var t=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(a,s,o,u){u===void 0&&(u=o);var l=Object.getOwnPropertyDescriptor(s,o);(!l||("get"in l?!s.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(a,u,l)}:function(a,s,o,u){u===void 0&&(u=o),a[u]=s[o]}),r=commonjsGlobal&&commonjsGlobal.__exportStar||function(a,s){for(var o in a)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&t(s,a,o)};Object.defineProperty(e,"__esModule",{value:!0}),e.splitQuery=void 0;var n=splitQuery$1;Object.defineProperty(e,"splitQuery",{enumerable:!0,get:function(){return n.splitQuery}}),r(options,e)})(lib$3);var lib$2={},types={};Object.defineProperty(types,"__esModule",{value:!0});var dumpSqlCommand={},dumpSqlExpression={},dumpSqlSource={},dumpSqlCondition={},hasRequiredDumpSqlCondition;function requireDumpSqlCondition(){if(hasRequiredDumpSqlCondition)return dumpSqlCondition;hasRequiredDumpSqlCondition=1,Object.defineProperty(dumpSqlCondition,"__esModule",{value:!0}),dumpSqlCondition.dumpSqlCondition=void 0;const e=requireDumpSqlExpression(),t=requireDumpSqlCommand();function r(n,a){switch(a.conditionType){case"binary":(0,e.dumpSqlExpression)(n,a.left),n.put(" %s ",a.operator),(0,e.dumpSqlExpression)(n,a.right);break;case"isNull":(0,e.dumpSqlExpression)(n,a.expr),n.put(" ^is ^null");break;case"isNotNull":(0,e.dumpSqlExpression)(n,a.expr),n.put(" ^is ^not ^null");break;case"isEmpty":n.put("^trim("),(0,e.dumpSqlExpression)(n,a.expr),n.put(") = ''");break;case"isNotEmpty":n.put("^trim("),(0,e.dumpSqlExpression)(n,a.expr),n.put(") <> ''");break;case"and":case"or":n.putCollection(` ^${a.conditionType} `,a.conditions,o=>{n.putRaw("("),r(n,o),n.putRaw(")")});break;case"like":(0,e.dumpSqlExpression)(n,a.left),n.put(n.dialect.ilike?" ^ilike ":" ^like "),(0,e.dumpSqlExpression)(n,a.right);break;case"notLike":(0,e.dumpSqlExpression)(n,a.left),n.put(" ^not ^like "),(0,e.dumpSqlExpression)(n,a.right);break;case"not":n.put("^not ("),r(n,a.condition),n.put(")");break;case"exists":n.put("^exists ("),(0,t.dumpSqlSelect)(n,a.subQuery),n.put(")");break;case"notExists":n.put("^not ^exists ("),(0,t.dumpSqlSelect)(n,a.subQuery),n.put(")");break;case"between":(0,e.dumpSqlExpression)(n,a.expr),n.put(" ^between "),(0,e.dumpSqlExpression)(n,a.left),n.put(" ^and "),(0,e.dumpSqlExpression)(n,a.right);break;case"in":(0,e.dumpSqlExpression)(n,a.expr),n.put(" ^in (%,v)",a.values);break;case"rawTemplate":let s=!1;for(const o of a.templateSql.split("$$"))s&&(0,e.dumpSqlExpression)(n,a.expr),n.putRaw(o),s=!0;break}}return dumpSqlCondition.dumpSqlCondition=r,dumpSqlCondition}var hasRequiredDumpSqlSource;function requireDumpSqlSource(){if(hasRequiredDumpSqlSource)return dumpSqlSource;hasRequiredDumpSqlSource=1,Object.defineProperty(dumpSqlSource,"__esModule",{value:!0}),dumpSqlSource.dumpSqlFromDefinition=dumpSqlSource.dumpSqlRelation=dumpSqlSource.dumpSqlSourceRef=dumpSqlSource.dumpSqlSourceDef=void 0;const e=requireDumpSqlCommand(),t=requireDumpSqlCondition();function r(o,u){let l=0;if(u.name!=null&&l++,u.subQuery!=null&&l++,u.subQueryString!=null&&l++,l!=1)throw new Error("sqltree.Source should have exactly one source");u.name!=null&&o.put("%f",u.name),u.subQuery&&(o.put("("),(0,e.dumpSqlSelect)(o,u.subQuery),o.put(")")),u.subQueryString&&(o.put("("),o.putRaw(u.subQueryString),o.put(")")),u.alias&&o.put(" %i",u.alias)}dumpSqlSource.dumpSqlSourceDef=r;function n(o,u){return u.alias?(o.put("%i",u.alias),!0):u.name?(o.put("%f",u.name),!0):!1}dumpSqlSource.dumpSqlSourceRef=n;function a(o,u){o.put("&n %k ",u.joinType),r(o,u),u.conditions&&u.conditions.length>0&&(o.put(" ^on "),o.putCollection(" ^and ",u.conditions,l=>(0,t.dumpSqlCondition)(o,l)))}dumpSqlSource.dumpSqlRelation=a;function s(o,u){r(o,u),o.put(" "),u.relations&&u.relations.forEach(l=>a(o,l))}return dumpSqlSource.dumpSqlFromDefinition=s,dumpSqlSource}var hasRequiredDumpSqlExpression;function requireDumpSqlExpression(){if(hasRequiredDumpSqlExpression)return dumpSqlExpression;hasRequiredDumpSqlExpression=1,Object.defineProperty(dumpSqlExpression,"__esModule",{value:!0}),dumpSqlExpression.dumpSqlExpression=void 0;const e=requireDumpSqlSource();function t(r,n){switch(n.exprType){case"column":n.source&&(0,e.dumpSqlSourceRef)(r,n.source)&&r.put("."),r.put("%i",n.columnName);break;case"placeholder":r.putRaw("{PLACEHOLDER}");break;case"value":r.put("%v",n.value);break;case"raw":r.put("%s",n.sql);break;case"call":r.put("%s(",n.func),n.argsPrefix&&r.put("%s ",n.argsPrefix),r.putCollection(",",n.args,a=>t(r,a)),r.put(")");break;case"methodCall":t(r,n.thisObject),r.put(".%s(",n.method),r.putCollection(",",n.args,a=>t(r,a)),r.put(")");break;case"transform":r.transform(n.transform,()=>t(r,n.expr));break;case"rowNumber":r.put(" ^row_number() ^over (^order ^by "),r.putCollection(", ",n.orderBy,a=>{t(r,a),r.put(" %k",a.direction)}),r.put(")");break}}return dumpSqlExpression.dumpSqlExpression=t,dumpSqlExpression}var hasRequiredDumpSqlCommand;function requireDumpSqlCommand(){if(hasRequiredDumpSqlCommand)return dumpSqlCommand;hasRequiredDumpSqlCommand=1,Object.defineProperty(dumpSqlCommand,"__esModule",{value:!0}),dumpSqlCommand.dumpSqlCommand=dumpSqlCommand.dumpSqlInsert=dumpSqlCommand.dumpSqlDelete=dumpSqlCommand.dumpSqlUpdate=dumpSqlCommand.dumpSqlSelect=void 0;const e=requireDumpSqlExpression(),t=requireDumpSqlSource(),r=requireDumpSqlCondition();function n(l,c){l.put("^select "),c.distinct&&l.put("^distinct "),c.topRecords&&(!l.dialect.rangeSelect||l.dialect.offsetFetchRangeSyntax)&&l.put("^top %s ",c.topRecords),c.selectAll&&l.put("* "),c.columns&&(c.selectAll&&l.put("&n,"),l.put("&>&n"),l.putCollection(",&n",c.columns,d=>{(0,e.dumpSqlExpression)(l,d),d.alias&&l.put(" ^as %i",d.alias)}),l.put("&n&<")),l.put("^from "),(0,t.dumpSqlFromDefinition)(l,c.from),c.where&&(l.put("&n^where "),(0,r.dumpSqlCondition)(l,c.where),l.put("&n")),c.groupBy&&(l.put("&n^group ^by "),l.putCollection(", ",c.groupBy,d=>(0,e.dumpSqlExpression)(l,d)),l.put("&n")),c.having&&(l.put("&n^having "),(0,r.dumpSqlCondition)(l,c.having),l.put("&n")),c.orderBy&&(l.put("&n^order ^by "),l.putCollection(", ",c.orderBy,d=>{(0,e.dumpSqlExpression)(l,d),l.put(" %k",d.direction)}),l.put("&n")),c.range&&(l.dialect.offsetFetchRangeSyntax?l.put("^offset %s ^rows ^fetch ^next %s ^rows ^only",c.range.offset,c.range.limit):l.put("^limit %s ^offset %s ",c.range.limit,c.range.offset)),c.topRecords&&l.dialect.rangeSelect&&!l.dialect.offsetFetchRangeSyntax&&l.put("^limit %s ",c.topRecords)}dumpSqlCommand.dumpSqlSelect=n;function a(l,c){l.put("^update "),(0,t.dumpSqlSourceRef)(l,c.from),l.put("&n^set "),l.put("&>"),l.putCollection(", ",c.fields,d=>{l.put("%i=",d.targetColumn),(0,e.dumpSqlExpression)(l,d)}),l.put("&<"),c.where&&(l.put("&n^where "),(0,r.dumpSqlCondition)(l,c.where),l.put("&n"))}dumpSqlCommand.dumpSqlUpdate=a;function s(l,c){l.put("^delete ^from "),(0,t.dumpSqlSourceRef)(l,c.from),c.where&&(l.put("&n^where "),(0,r.dumpSqlCondition)(l,c.where),l.put("&n"))}dumpSqlCommand.dumpSqlDelete=s;function o(l,c){l.put("^insert ^into %f (%,i) ^values (",c.targetTable,c.fields.map(d=>d.targetColumn)),l.putCollection(",",c.fields,d=>(0,e.dumpSqlExpression)(l,d)),l.put(")")}dumpSqlCommand.dumpSqlInsert=o;function u(l,c){switch(c.commandType){case"select":n(l,c);break;case"update":a(l,c);break;case"delete":s(l,c);break;case"insert":o(l,c);break;case"allowIdentityInsert":l.allowIdentityInsert(c.targetTable,c.allow);break}}return dumpSqlCommand.dumpSqlCommand=u,dumpSqlCommand}var utility={};Object.defineProperty(utility,"__esModule",{value:!0});utility.mergeConditions=utility.scriptToSql=utility.treeToSql=void 0;const dumpSqlCommand_1=requireDumpSqlCommand();function treeToSql(e,t,r){const n=e.createDumper();return r(n,t),n.s}utility.treeToSql=treeToSql;function scriptToSql(e,t){const r=e.createDumper();for(const n of t)(0,dumpSqlCommand_1.dumpSqlCommand)(r,n),r.endCommand();return r.s}utility.scriptToSql=scriptToSql;function mergeConditions(e,t){return e?t?e.conditionType=="and"&&t.conditionType=="and"?{conditionType:"and",conditions:[...e.conditions,...t.conditions]}:e.conditionType=="and"?{conditionType:"and",conditions:[...e.conditions,t]}:t.conditionType=="and"?{conditionType:"and",conditions:[e,...t.conditions]}:{conditionType:"and",conditions:[e,t]}:e:t}utility.mergeConditions=mergeConditions;var evaluateCondition$1={},baseClone$1=_baseClone,CLONE_DEEP_FLAG$1=1,CLONE_SYMBOLS_FLAG$1=4;function cloneDeepWith(e,t){return t=typeof t=="function"?t:void 0,baseClone$1(e,CLONE_DEEP_FLAG$1|CLONE_SYMBOLS_FLAG$1,t)}var cloneDeepWith_1$2=cloneDeepWith,toString$1=toString_1,reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reHasRegExpChar=RegExp(reRegExpChar.source);function escapeRegExp(e){return e=toString$1(e),e&&reHasRegExpChar.test(e)?e.replace(reRegExpChar,"\\$&"):e}var escapeRegExp_1$2=escapeRegExp,evaluateExpression$1={},__importDefault$u=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(evaluateExpression$1,"__esModule",{value:!0});evaluateExpression$1.evaluateExpression=void 0;const get_1=__importDefault$u(get_1$2);function evaluateExpression(e,t){switch(e.exprType){case"column":return(0,get_1.default)(t,e.columnName);case"placeholder":return t.__placeholder;case"value":return e.value;case"raw":return e.sql;case"call":return null;case"methodCall":return null;case"transform":return null}}evaluateExpression$1.evaluateExpression=evaluateExpression;var __importDefault$t=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(evaluateCondition$1,"__esModule",{value:!0});evaluateCondition$1.evaluateCondition=void 0;const cloneDeepWith_1$1=__importDefault$t(cloneDeepWith_1$2),escapeRegExp_1$1=__importDefault$t(escapeRegExp_1$2),evaluateExpression_1=evaluateExpression$1;function isEmpty(e){return e==null?!0:e.toString().trim()==""}function isLike(e,t){if(!e||!t)return!1;const r=new RegExp(`^${(0,escapeRegExp_1$1.default)(t).replace(/%/g,".*")}$`,"i");return!!e.toString().match(r)}function evaluateCondition(e,t){switch(e.conditionType){case"binary":const r=(0,evaluateExpression_1.evaluateExpression)(e.left,t),n=(0,evaluateExpression_1.evaluateExpression)(e.right,t);switch(e.operator){case"=":return r==n;case"!=":case"<>":return r!=n;case"<=":return r<=n;case">=":return r>=n;case"<":return r<n;case">":return r>n}break;case"isNull":return(0,evaluateExpression_1.evaluateExpression)(e.expr,t)==null;case"isNotNull":return(0,evaluateExpression_1.evaluateExpression)(e.expr,t)!=null;case"isEmpty":return isEmpty((0,evaluateExpression_1.evaluateExpression)(e.expr,t));case"isNotEmpty":return!isEmpty((0,evaluateExpression_1.evaluateExpression)(e.expr,t));case"and":return e.conditions.every(a=>evaluateCondition(a,t));case"or":return e.conditions.some(a=>evaluateCondition(a,t));case"like":return isLike((0,evaluateExpression_1.evaluateExpression)(e.left,t),(0,evaluateExpression_1.evaluateExpression)(e.right,t));case"notLike":return!isLike((0,evaluateExpression_1.evaluateExpression)(e.left,t),(0,evaluateExpression_1.evaluateExpression)(e.right,t));case"not":return!evaluateCondition(e.condition,t);case"anyColumnPass":return Object.keys(t).some(a=>{const s=(0,cloneDeepWith_1$1.default)(e.placeholderCondition,o=>{if(o.exprType=="placeholder")return{exprType:"column",columnName:a}});return evaluateCondition(s,t)})}}evaluateCondition$1.evaluateCondition=evaluateCondition;(function(e){var t=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(n,a,s,o){o===void 0&&(o=s);var u=Object.getOwnPropertyDescriptor(a,s);(!u||("get"in u?!a.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return a[s]}}),Object.defineProperty(n,o,u)}:function(n,a,s,o){o===void 0&&(o=s),n[o]=a[s]}),r=commonjsGlobal&&commonjsGlobal.__exportStar||function(n,a){for(var s in n)s!=="default"&&!Object.prototype.hasOwnProperty.call(a,s)&&t(a,n,s)};Object.defineProperty(e,"__esModule",{value:!0}),r(types,e),r(requireDumpSqlCommand(),e),r(utility,e),r(requireDumpSqlSource(),e),r(requireDumpSqlCondition(),e),r(evaluateCondition$1,e),r(evaluateExpression$1,e)})(lib$2);var __awaiter$4=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,r,n){function a(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function u(d){try{c(n.next(d))}catch(f){o(f)}}function l(d){try{c(n.throw(d))}catch(f){o(f)}}function c(d){d.done?s(d.value):a(d.value).then(u,l)}c((n=n.apply(e,t||[])).next())})},__importDefault$s=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(driverBase,"__esModule",{value:!0});driverBase.driverBase=driverBase.runQueryOnDriver=driverBase.runCommandOnDriver=void 0;const compact_1$4=__importDefault$s(compact_1$6),SqlDumper_1=SqlDumper$1,dbgate_query_splitter_1=lib$3,dbgate_sqltree_1$1=lib$2,dialect={limitSelect:!0,rangeSelect:!0,offsetFetchRangeSyntax:!0,stringEscapeChar:"'",fallbackDataType:"nvarchar(max)",quoteIdentifier(e){return e},columnProperties:{isSparse:!1,isPersisted:!1},defaultSchemaName:null};function runCommandOnDriver(e,t,r){return __awaiter$4(this,void 0,void 0,function*(){const n=t.createDumper();r(n),yield t.query(e,n.s,{discardResult:!0})})}driverBase.runCommandOnDriver=runCommandOnDriver;function runQueryOnDriver(e,t,r){return __awaiter$4(this,void 0,void 0,function*(){const n=t.createDumper();return r(n),yield t.query(e,n.s)})}driverBase.runQueryOnDriver=runQueryOnDriver;driverBase.driverBase={analyserClass:null,dumperClass:SqlDumper_1.SqlDumper,dialect,databaseEngineTypes:["sql"],supportedCreateDatabase:!0,analyseFull(e,t){return __awaiter$4(this,void 0,void 0,function*(){return new this.analyserClass(e,this,t).fullAnalysis()})},analyseSingleObject(e,t,r="tables"){return __awaiter$4(this,void 0,void 0,function*(){return new this.analyserClass(e,this).singleObjectAnalysis(t,r)})},analyseSingleTable(e,t){return this.analyseSingleObject(e,t,"tables")},analyseIncremental(e,t,r){return __awaiter$4(this,void 0,void 0,function*(){return new this.analyserClass(e,this,r).incrementalAnalysis(t)})},createDumper(e=null){return new this.dumperClass(this,e)},script(e,t,r){return __awaiter$4(this,void 0,void 0,function*(){r!=null&&r.useTransaction&&runCommandOnDriver(e,this,n=>n.beginTransaction());for(const n of(0,dbgate_query_splitter_1.splitQuery)(t,this.getQuerySplitterOptions("script")))try{yield this.query(e,n,{discardResult:!0})}catch(a){throw r!=null&&r.useTransaction&&runCommandOnDriver(e,this,s=>s.rollbackTransaction()),a}r!=null&&r.useTransaction&&runCommandOnDriver(e,this,n=>n.commitTransaction())})},getNewObjectTemplates(){return this.databaseEngineTypes.includes("sql")?[{label:"New view",sql:`CREATE VIEW myview
AS
SELECT * FROM table1`}]:[]},loadFieldValues(e,t,r,n){return __awaiter$4(this,void 0,void 0,function*(){const a=this.createDumper(),s={commandType:"select",distinct:!0,topRecords:100,from:{name:t},columns:[{exprType:"column",columnName:r,alias:"value"}],orderBy:[{exprType:"column",columnName:r}]};if(n){const u=(0,compact_1$4.default)(n.split(" ").map(l=>l.trim()));u.length>0&&(s.where={conditionType:"and",conditions:u.map(l=>({conditionType:"like",left:{exprType:"column",columnName:r},right:{exprType:"value",value:`%${l}%`}}))})}return(0,dbgate_sqltree_1$1.dumpSqlSelect)(a,s),(yield this.query(e,a.s)).rows})},readJsonQuery(e,t,r){const n=this.createDumper();return(0,dbgate_sqltree_1$1.dumpSqlSelect)(n,t),this.readQuery(e,n.s,r)},showConnectionField:(e,t)=>!1,showConnectionTab:e=>!0};var testPermission$1={},__importDefault$r=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(testPermission$1,"__esModule",{value:!0});testPermission$1.testPermission=testPermission$1.compilePermissions=void 0;const escapeRegExp_1=__importDefault$r(escapeRegExp_1$2),isString_1$3=__importDefault$r(isString_1$7),compact_1$3=__importDefault$r(compact_1$6),flatten_1$3=__importDefault$r(flatten_1$4);function compileRegexp(e){return e.length==0?null:new RegExp(e.map(t=>"^"+(0,escapeRegExp_1.default)(t).replace(/\\\*/g,".*")+"$").join("|"))}function compilePermissions(e){if(!e)return null;(0,isString_1$3.default)(e)?e=e.split(/,|;|\||\s/):e=(0,flatten_1$3.default)(e.map(a=>a.split(/,|;|\||\s/))),e=(0,compact_1$3.default)(e.map(a=>a.trim()));let t=null,r=[];const n={levels:[]};for(const a of e){const s=a.startsWith("~")?"deny":"allow",o=a.startsWith("~")?a.substring(1):a;t!=null&&s!=t&&(n.levels.push({re:compileRegexp(r),type:t}),r=[]),r.push(o),t=s}return r.length>0&&n.levels.push({re:compileRegexp(r),type:t}),n}testPermission$1.compilePermissions=compilePermissions;function testPermission(e,t){let r=!0;if(!t)return!0;for(const n of t.levels)e.match(n.re)&&(n.type=="allow"&&(r=!0),n.type=="deny"&&(r=!1));return r}testPermission$1.testPermission=testPermission;var SqlGenerator$1={};function noop$1(){}var noop_1=noop$1,Set$1=_Set,noop=noop_1,setToArray$1=_setToArray,INFINITY$1=1/0,createSet$1=Set$1&&1/setToArray$1(new Set$1([,-0]))[1]==INFINITY$1?function(e){return new Set$1(e)}:noop,_createSet=createSet$1,SetCache$1=_SetCache,arrayIncludes$1=_arrayIncludes,arrayIncludesWith$1=_arrayIncludesWith,cacheHas$1=_cacheHas,createSet=_createSet,setToArray=_setToArray,LARGE_ARRAY_SIZE$1=200;function baseUniq$2(e,t,r){var n=-1,a=arrayIncludes$1,s=e.length,o=!0,u=[],l=u;if(r)o=!1,a=arrayIncludesWith$1;else if(s>=LARGE_ARRAY_SIZE$1){var c=t?null:createSet(e);if(c)return setToArray(c);o=!1,a=cacheHas$1,l=new SetCache$1}else l=t?[]:u;e:for(;++n<s;){var d=e[n],f=t?t(d):d;if(d=r||d!==0?d:0,o&&f===f){for(var h=l.length;h--;)if(l[h]===f)continue e;t&&l.push(f),u.push(d)}else a(l,f,r)||(l!==u&&l.push(f),u.push(d))}return u}var _baseUniq=baseUniq$2,baseIteratee$2=_baseIteratee,baseUniq$1=_baseUniq;function uniqBy(e,t){return e&&e.length?baseUniq$1(e,baseIteratee$2(t)):[]}var uniqBy_1$2=uniqBy,structureTools={},__importDefault$q=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(structureTools,"__esModule",{value:!0});structureTools.isCollectionInfo=structureTools.isViewInfo=structureTools.isTableInfo=structureTools.isTableColumnUnique=structureTools.extendDatabaseInfoFromApps=structureTools.extendDatabaseInfo=structureTools.extendTableInfo=structureTools.addTableDependencies=void 0;const flatten_1$2=__importDefault$q(flatten_1$4);function addTableDependencies(e){const t=(0,flatten_1$2.default)(e.tables.map(r=>r.foreignKeys||[]));return Object.assign(Object.assign({},e),{tables:e.tables.map(r=>Object.assign(Object.assign({},r),{dependencies:t.filter(n=>n.refSchemaName==r.schemaName&&n.refTableName==r.pureName)}))})}structureTools.addTableDependencies=addTableDependencies;function extendTableInfo(e){return Object.assign(Object.assign({},e),{objectTypeField:"tables",columns:(e.columns||[]).map(t=>Object.assign({pureName:e.pureName,schemaName:e.schemaName},t)),primaryKey:e.primaryKey?Object.assign(Object.assign({},e.primaryKey),{pureName:e.pureName,schemaName:e.schemaName,constraintType:"primaryKey"}):void 0,foreignKeys:(e.foreignKeys||[]).map(t=>Object.assign(Object.assign({},t),{pureName:e.pureName,schemaName:e.schemaName,constraintType:"foreignKey"})),indexes:(e.indexes||[]).map(t=>Object.assign(Object.assign({},t),{pureName:e.pureName,schemaName:e.schemaName,constraintType:"index"})),checks:(e.checks||[]).map(t=>Object.assign(Object.assign({},t),{pureName:e.pureName,schemaName:e.schemaName,constraintType:"check"})),uniques:(e.uniques||[]).map(t=>Object.assign(Object.assign({},t),{pureName:e.pureName,schemaName:e.schemaName,constraintType:"unique"}))})}structureTools.extendTableInfo=extendTableInfo;function fillDatabaseExtendedInfo(e){return Object.assign(Object.assign({},e),{tables:(e.tables||[]).map(extendTableInfo),collections:(e.collections||[]).map(t=>Object.assign(Object.assign({},t),{objectTypeField:"collections"})),views:(e.views||[]).map(t=>Object.assign(Object.assign({},t),{objectTypeField:"views"})),matviews:(e.matviews||[]).map(t=>Object.assign(Object.assign({},t),{objectTypeField:"matviews"})),procedures:(e.procedures||[]).map(t=>Object.assign(Object.assign({},t),{objectTypeField:"procedures"})),functions:(e.functions||[]).map(t=>Object.assign(Object.assign({},t),{objectTypeField:"functions"})),triggers:(e.triggers||[]).map(t=>Object.assign(Object.assign({},t),{objectTypeField:"triggers"}))})}function extendDatabaseInfo(e){return fillDatabaseExtendedInfo(addTableDependencies(e))}structureTools.extendDatabaseInfo=extendDatabaseInfo;function extendDatabaseInfoFromApps(e,t){if(!e||!t)return e;const r=Object.assign(Object.assign({},e),{tables:e.tables.map(n=>Object.assign(Object.assign({},n),{foreignKeys:[...n.foreignKeys||[],...(0,flatten_1$2.default)(t.map(a=>a.virtualReferences||[])).filter(a=>a.pureName==n.pureName&&a.schemaName==n.schemaName).map(a=>Object.assign(Object.assign({},a),{constraintType:"foreignKey",isVirtual:!0}))]}))});return addTableDependencies(r)}structureTools.extendDatabaseInfoFromApps=extendDatabaseInfoFromApps;function isTableColumnUnique(e,t){return!!(e.primaryKey&&e.primaryKey.columns.length==1&&e.primaryKey.columns[0].columnName==t||[...e.uniques||[],...(e.indexes||[]).filter(n=>n.isUnique)].find(n=>n.columns.length==1&&n.columns[0].columnName==t))}structureTools.isTableColumnUnique=isTableColumnUnique;function isTableInfo(e){return e.objectTypeField=="tables"}structureTools.isTableInfo=isTableInfo;function isViewInfo(e){return e.objectTypeField=="views"}structureTools.isViewInfo=isViewInfo;function isCollectionInfo(e){return e.objectTypeField=="collections"}structureTools.isCollectionInfo=isCollectionInfo;var __awaiter$3=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,r,n){function a(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function u(d){try{c(n.next(d))}catch(f){o(f)}}function l(d){try{c(n.throw(d))}catch(f){o(f)}}function c(d){d.done?s(d.value):a(d.value).then(u,l)}c((n=n.apply(e,t||[])).next())})},__importDefault$p=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(SqlGenerator$1,"__esModule",{value:!0});SqlGenerator$1.SqlGenerator=void 0;const flatten_1$1=__importDefault$p(flatten_1$4),uniqBy_1$1=__importDefault$p(uniqBy_1$2),getLogger_1=getLogger$1,structureTools_1=structureTools,logger$1=(0,getLogger_1.getLogger)("sqlGenerator");class SqlGenerator{constructor(t,r,n,a,s,o){this.options=r,this.objects=n,this.dmp=a,this.driver=s,this.pool=o,this.isTruncated=!1,this.isUnhandledException=!1,this.handleException=u=>{logger$1.error({error:u},"Unhandled error"),this.isUnhandledException=!0},this.dbinfo=(0,structureTools_1.extendDatabaseInfo)(t),this.tables=this.extract("tables"),this.views=this.extract("views"),this.matviews=this.extract("matviews"),this.procedures=this.extract("procedures"),this.functions=this.extract("functions"),this.triggers=this.extract("triggers")}dump(){return __awaiter$3(this,void 0,void 0,function*(){try{if(process.on("uncaughtException",this.handleException),this.dropObjects(this.procedures,"Procedure"),this.checkDumper()||(this.dropObjects(this.functions,"Function"),this.checkDumper())||(this.dropObjects(this.views,"View"),this.checkDumper())||(this.dropObjects(this.matviews,"Matview"),this.checkDumper())||(this.dropObjects(this.triggers,"Trigger"),this.checkDumper())||(this.dropTables(),this.checkDumper())||(this.createTables(),this.checkDumper())||(this.truncateTables(),this.checkDumper())||(yield this.insertData(),this.checkDumper())||(this.createForeignKeys(),this.checkDumper())||(this.createObjects(this.procedures,"Procedure"),this.checkDumper())||(this.createObjects(this.functions,"Function"),this.checkDumper())||(this.createObjects(this.views,"View"),this.checkDumper())||(this.createObjects(this.matviews,"Matview"),this.checkDumper())||(this.createObjects(this.triggers,"Trigger"),this.checkDumper()))return}finally{process.off("uncaughtException",this.handleException)}})}createForeignKeys(){const t=[];this.options.createForeignKeys&&t.push(...(0,flatten_1$1.default)(this.tables.map(r=>r.foreignKeys||[]))),this.options.createReferences&&t.push(...(0,flatten_1$1.default)(this.tables.map(r=>r.dependencies||[])));for(const r of(0,uniqBy_1$1.default)(t,"constraintName"))if(this.dmp.createForeignKey(r),this.checkDumper())return}truncateTables(){if(this.options.truncate){for(const t of this.tables)if(this.dmp.truncateTable(t),this.checkDumper())return}}createTables(){if(this.options.createTables){for(const t of this.tables)if(this.dmp.createTable(Object.assign(Object.assign({},t),{foreignKeys:[],dependencies:[],indexes:[]})),this.checkDumper())return}if(this.options.createIndexes)for(const t of(0,flatten_1$1.default)(this.tables.map(r=>r.indexes||[])))this.dmp.createIndex(t)}insertData(){return __awaiter$3(this,void 0,void 0,function*(){if(this.options.insert){this.enableConstraints(!1);for(const t of this.tables)if(yield this.insertTableData(t),this.checkDumper())return;this.enableConstraints(!0)}})}checkDumper(){return this.dmp.s.length>4e6?(this.isTruncated||(this.dmp.putRaw(`
`),this.dmp.comment(" *************** SQL is truncated ******************"),this.dmp.putRaw(`
`)),this.isTruncated=!0,!0):!1}dropObjects(t,r){if(this.options[`drop${r}s`]){for(const n of t)if(this.dmp[`drop${r}`](n,{testIfExists:this.options[`checkIf${r}Exists`]}),this.checkDumper())return}}createObjects(t,r){if(this.options[`create${r}s`]){for(const n of t)if(this.dmp[`create${r}`](n),this.checkDumper())return}}dropTables(){if(this.options.dropReferences)for(const t of(0,flatten_1$1.default)(this.tables.map(r=>r.dependencies||[])))this.dmp.dropForeignKey(t);if(this.options.dropTables)for(const t of this.tables)this.dmp.dropTable(t,{testIfExists:this.options.checkIfTableExists})}insertTableData(t){return __awaiter$3(this,void 0,void 0,function*(){const r=this.driver.createDumper();r.put("^select * ^from %f",t);const n=t.columns.find(s=>s.autoIncrement);n&&!this.options.skipAutoincrementColumn&&this.dmp.allowIdentityInsert(t,!0);const a=yield this.driver.readQuery(this.pool,r.s,t);yield this.processReadable(t,a),n&&!this.options.skipAutoincrementColumn&&this.dmp.allowIdentityInsert(t,!1)})}processReadable(t,r){const a=(this.options.skipAutoincrementColumn?t.columns.filter(u=>!u.autoIncrement):t.columns).map(u=>u.columnName);let s=!1,o=!1;return new Promise(u=>{r.on("data",l=>{if(s)return;if(!o){o=!0;return}if(this.checkDumper()){s=!0,u(void 0),r.destroy();return}const c=this.options.omitNulls?a.filter(d=>l[d]!=null):a;this.dmp.put("^insert ^into %f (%,i) ^values (%,v);&n",t,c,c.map(d=>l[d]))}),r.on("end",()=>{u(void 0)})})}extract(t){return this.dbinfo[t].filter(r=>this.objects.find(n=>r.pureName==n.pureName&&r.schemaName==n.schemaName&&n.objectTypeField==t))}enableConstraints(t){if(this.options.disableConstraints)if(this.driver.dialect.enableConstraintsPerTable)for(const r of this.tables)this.dmp.enableConstraints(r,t);else this.dmp.enableConstraints(null,t)}}SqlGenerator$1.SqlGenerator=SqlGenerator;var settingsExtractors={},isNumber$1=isNumber_1$3;function isNaN$1(e){return isNumber$1(e)&&e!=+e}var _isNaN=isNaN$1,__importDefault$o=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(settingsExtractors,"__esModule",{value:!0});settingsExtractors.extractBoolSettingsValue=settingsExtractors.extractIntSettingsValue=void 0;const isNaN_1=__importDefault$o(_isNaN),isNumber_1$1=__importDefault$o(isNumber_1$3);function extractIntSettingsValue(e,t,r,n=null,a=null){const s=parseInt(e[t]);return(0,isNaN_1.default)(s)?r:(0,isNumber_1$1.default)(s)?n!=null&&s<n?n:a!=null&&s>a?a:s:r}settingsExtractors.extractIntSettingsValue=extractIntSettingsValue;function extractBoolSettingsValue(e,t,r){const n=e[t];return n==null?r:!!n}settingsExtractors.extractBoolSettingsValue=extractBoolSettingsValue;var filterName$1={},createCompounder=_createCompounder,upperFirst=upperFirst_1,startCase=createCompounder(function(e,t,r){return e+(r?" ":"")+upperFirst(t)}),startCase_1$1=startCase,__importDefault$n=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(filterName$1,"__esModule",{value:!0});filterName$1.filterName=void 0;const compact_1$2=__importDefault$n(compact_1$6),isString_1$2=__importDefault$n(isString_1$7),startCase_1=__importDefault$n(startCase_1$1);function camelMatch(e,t){if(!t)return!1;if(!e)return!0;if(e.replace(/[A-Z]/g,"").length==0){const r=(0,startCase_1.default)(t).replace(/[^A-Z]/g,""),n=".*"+e.split("").join(".*")+".*";return new RegExp(n).test(r)}else return t.toUpperCase().includes(e.toUpperCase())}function filterName(e,...t){if(!e)return!0;const r=e.split(" ").map(o=>o.trim()),n=(0,compact_1$2.default)(t),a=n.filter(o=>(0,isString_1$2.default)(o)),s=n.filter(o=>o.childName).map(o=>o.childName);for(const o of r)if(o.startsWith("#")){if(!s.find(l=>camelMatch(o.substring(1),l)))return!1}else if(!a.find(l=>camelMatch(o,l)))return!1;return!0}filterName$1.filterName=filterName;var diffTools={},alterPlan={},databaseInfoAlterProcessor={},__importDefault$m=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(databaseInfoAlterProcessor,"__esModule",{value:!0});databaseInfoAlterProcessor.DatabaseInfoAlterProcessor=void 0;const lodash_1$8=__importDefault$m(lodashExports);class DatabaseInfoAlterProcessor{constructor(t){this.db=t}createTable(t){this.db.tables.push(t)}dropTable(t){lodash_1$8.default.remove(this.db.tables,r=>r.pureName==t.pureName&&r.schemaName==t.schemaName)}createSqlObject(t){this.db[t.objectTypeField].push(t)}dropSqlObject(t){lodash_1$8.default.remove(this.db[t.objectTypeField],r=>r.pureName==t.pureName&&r.schemaName==t.schemaName)}createColumn(t){const r=this.db.tables.find(n=>n.pureName==t.pureName&&n.schemaName==t.schemaName);if(!r)throw new Error(`createColumn error, cannot find table: ${t.schemaName}.${t.pureName}`);r.columns.push(t)}changeColumn(t,r){const n=this.db.tables.find(a=>a.pureName==t.pureName&&a.schemaName==t.schemaName);if(!n)throw new Error(`changeColumn error, cannot find table: ${t.schemaName}.${t.pureName}`);n.columns=n.columns.map(a=>a.columnName==t.columnName?r:a)}dropColumn(t){const r=this.db.tables.find(n=>n.pureName==t.pureName&&n.schemaName==t.schemaName);if(!r)throw new Error(`dropColumn error, cannot find table: ${t.schemaName}.${t.pureName}`);lodash_1$8.default.remove(r.columns,n=>n.columnName==t.columnName)}createConstraint(t){const r=this.db.tables.find(n=>n.pureName==t.pureName&&n.schemaName==t.schemaName);switch(t.constraintType){case"primaryKey":r.primaryKey=t;break;case"foreignKey":r.foreignKeys.push(t);break;case"index":r.indexes.push(t);break;case"unique":r.uniques.push(t);break;case"check":r.checks.push(t);break}}changeConstraint(t,r){this.db.tables.find(n=>n.pureName==t.pureName&&n.schemaName==t.schemaName)}dropConstraint(t){const r=this.db.tables.find(n=>n.pureName==t.pureName&&n.schemaName==t.schemaName);switch(t.constraintType){case"primaryKey":r.primaryKey=null;break;case"foreignKey":r.foreignKeys=r.foreignKeys.filter(n=>n.constraintName!=t.constraintName);break;case"index":r.indexes=r.indexes.filter(n=>n.constraintName!=t.constraintName);break;case"unique":r.uniques=r.uniques.filter(n=>n.constraintName!=t.constraintName);break;case"check":r.checks=r.checks.filter(n=>n.constraintName!=t.constraintName);break}}renameTable(t,r){this.db.tables.find(n=>n.pureName==t.pureName&&n.schemaName==t.schemaName).pureName=r}renameColumn(t,r){const n=this.db.tables.find(a=>a.pureName==t.pureName&&a.schemaName==t.schemaName);n.columns.find(a=>a.columnName==t.columnName).columnName=r}renameConstraint(t,r){}recreateTable(t,r){throw new Error("recreateTable not implemented for DatabaseInfoAlterProcessor")}fillPreloadedRows(t,r,n,a,s){const o=this.db.tables.find(u=>u.pureName==t.pureName&&u.schemaName==t.schemaName);o.preloadedRows=n,o.preloadedRowsKey=a,o.preloadedRowsInsertOnly=s}}databaseInfoAlterProcessor.DatabaseInfoAlterProcessor=DatabaseInfoAlterProcessor;var hasRequiredAlterPlan;function requireAlterPlan(){if(hasRequiredAlterPlan)return alterPlan;hasRequiredAlterPlan=1;var e=commonjsGlobal&&commonjsGlobal.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(alterPlan,"__esModule",{value:!0}),alterPlan.runAlterOperation=alterPlan.AlterPlan=void 0;const t=e(lodashExports),r=requireDiffTools(),n=databaseInfoAlterProcessor,a=DatabaseAnalyser$1;class s{constructor(l,c,d,f){this.wholeOldDb=l,this.wholeNewDb=c,this.dialect=d,this.opts=f,this.recreates={tables:0,constraints:0,sqlObjects:0},this.operations=[]}createTable(l){this.operations.push({operationType:"createTable",newObject:l})}dropTable(l){this.operations.push({operationType:"dropTable",oldObject:l})}createSqlObject(l){this.operations.push({operationType:"createSqlObject",newObject:l})}dropSqlObject(l){this.operations.push({operationType:"dropSqlObject",oldObject:l})}createColumn(l){this.operations.push({operationType:"createColumn",newObject:l})}changeColumn(l,c){this.operations.push({operationType:"changeColumn",oldObject:l,newObject:c})}dropColumn(l){this.operations.push({operationType:"dropColumn",oldObject:l})}createConstraint(l){this.operations.push({operationType:"createConstraint",newObject:l})}changeConstraint(l,c){this.operations.push({operationType:"changeConstraint",oldObject:l,newObject:c})}dropConstraint(l){this.operations.push({operationType:"dropConstraint",oldObject:l})}renameTable(l,c){this.operations.push({operationType:"renameTable",object:l,newName:c})}renameColumn(l,c){this.operations.push({operationType:"renameColumn",object:l,newName:c})}renameConstraint(l,c){this.operations.push({operationType:"renameConstraint",object:l,newName:c})}recreateTable(l,c){this.operations.push({operationType:"recreateTable",table:l,operations:c}),this.recreates.tables+=1}fillPreloadedRows(l,c,d,f,h){this.operations.push({operationType:"fillPreloadedRows",table:l,oldRows:c,newRows:d,key:f,insertOnly:h})}run(l){for(const c of this.operations)o(c,l)}_getDependendColumnConstraints(l,c){const d=this.wholeOldDb.tables.find(y=>y.pureName==l.pureName&&y.schemaName==l.schemaName);if(!d)return[];const f=c!=null&&c.includes("dependencies")?d.dependencies.filter(y=>y.columns.find(v=>v.refColumnName==l.columnName)):[],h=t.default.compact([c!=null&&c.includes("primaryKey")?d.primaryKey:null,...c!=null&&c.includes("foreignKeys")?d.foreignKeys:[],...c!=null&&c.includes("indexes")?d.indexes:[],...c!=null&&c.includes("uniques")?d.uniques:[]]).filter(y=>y.columns.find(v=>v.columnName==l.columnName));return[...f,...h]}_addLogicalDependencies(){const l=this.operations.map(c=>{if(c.operationType=="dropColumn"){const d=this._getDependendColumnConstraints(c.oldObject,this.dialect.dropColumnDependencies);return d.length>0&&this.opts.noDropConstraint?[]:[...d.map(h=>({operationType:"dropConstraint",oldObject:h})),c]}if(c.operationType=="changeColumn"){const d=this._getDependendColumnConstraints(c.oldObject,this.dialect.changeColumnDependencies);if(d.length>0&&this.opts.noDropConstraint)return[];const f=[...d.map(h=>({operationType:"dropConstraint",oldObject:h})),c,...t.default.reverse([...d]).map(h=>({operationType:"createConstraint",newObject:h}))];return d.length>0&&(this.recreates.constraints+=1),f}if(c.operationType=="dropTable")return[...this.dialect.dropReferencesWhenDropTable?(c.oldObject.dependencies||[]).map(d=>({operationType:"dropConstraint",oldObject:d})):[],c];if(c.operationType=="changeConstraint"){if(this.opts.noDropConstraint)return[];this.recreates.constraints+=1;const d={operationType:"dropConstraint",oldObject:c.oldObject},f={operationType:"createConstraint",newObject:c.newObject};return[d,f]}return[c]});return t.default.flatten(l)}_transformToImplementedOps(){const l=this.operations.map(c=>this._testTableRecreate(c,"createColumn",this.dialect.createColumn,"newObject")||this._testTableRecreate(c,"dropColumn",this.dialect.dropColumn,"oldObject")||this._testTableRecreate(c,"createConstraint",d=>this._canCreateConstraint(d),"newObject")||this._testTableRecreate(c,"dropConstraint",d=>this._canDropConstraint(d),"oldObject")||this._testTableRecreate(c,"changeColumn",this.dialect.changeColumn,"newObject")||[c]);return t.default.flatten(l)}_canCreateConstraint(l){return l.constraintType=="primaryKey"?this.dialect.createPrimaryKey:l.constraintType=="foreignKey"?this.dialect.createForeignKey:l.constraintType=="index"?this.dialect.createIndex:l.constraintType=="unique"?this.dialect.createUnique:l.constraintType=="check"?this.dialect.createCheck:null}_canDropConstraint(l){return l.constraintType=="primaryKey"?this.dialect.dropPrimaryKey:l.constraintType=="foreignKey"?this.dialect.dropForeignKey:l.constraintType=="index"?this.dialect.dropIndex:l.constraintType=="unique"?this.dialect.dropUnique:l.constraintType=="check"?this.dialect.dropCheck:null}_testTableRecreate(l,c,d,f){if(l.operationType==c){if(t.default.isFunction(d)){if(d(l[f]))return null}else if(d)return null;if(this.opts.noDropTable)return[];const h=this.wholeNewDb.tables.find(y=>y.pureName==l[f].pureName&&y.schemaName==l[f].schemaName);return this.recreates.tables+=1,[{operationType:"recreateTable",table:h,operations:[l]}]}return null}_groupTableRecreations(){const l=[],c={};for(const d of this.operations)if(d.operationType=="recreateTable"&&d.table){const f=c[`${d.table.schemaName}||${d.table.pureName}`];if(f)f.operations.push(...d.operations);else{const h=Object.assign(Object.assign({},d),{operations:[...d.operations]});l.push(h),c[`${d.table.schemaName}||${d.table.pureName}`]=h}}else{const f=d.oldObject;if(f){const h=c[`${f.schemaName}||${f.pureName}`];if(h){h.operations.push(d);continue}}l.push(d)}return l}_moveForeignKeysToLast(){if(!this.dialect.createForeignKey)return this.operations;const l=[];return[...this.operations.map(d=>d.operationType=="createTable"?(l.push(...d.newObject.foreignKeys||[]),Object.assign(Object.assign({},d),{newObject:Object.assign(Object.assign({},d.newObject),{foreignKeys:[]})})):d),...l.map(d=>({operationType:"createConstraint",newObject:d}))]}_filterAllowedOperations(){return this.operations.filter(l=>!(this.opts.noDropColumn&&l.operationType=="dropColumn"||this.opts.noDropTable&&l.operationType=="dropTable"||this.opts.noDropTable&&l.operationType=="recreateTable"||this.opts.noDropConstraint&&l.operationType=="dropConstraint"||this.opts.noDropSqlObject&&l.operationType=="dropSqlObject"))}transformPlan(){this.operations=this._addLogicalDependencies(),this.operations=this._transformToImplementedOps(),this.operations=this._groupTableRecreations(),this.operations=this._moveForeignKeysToLast(),this.operations=this._filterAllowedOperations()}}alterPlan.AlterPlan=s;function o(u,l){switch(u.operationType){case"createTable":l.createTable(u.newObject);break;case"changeColumn":l.changeColumn(u.oldObject,u.newObject);break;case"createColumn":l.createColumn(u.newObject,[]);break;case"dropColumn":l.dropColumn(u.oldObject);break;case"dropTable":l.dropTable(u.oldObject);break;case"changeConstraint":l.changeConstraint(u.oldObject,u.newObject);break;case"createConstraint":l.createConstraint(u.newObject);break;case"dropConstraint":l.dropConstraint(u.oldObject);break;case"renameColumn":l.renameColumn(u.object,u.newName);break;case"renameTable":l.renameTable(u.object,u.newName);break;case"renameConstraint":l.renameConstraint(u.object,u.newName);break;case"createSqlObject":l.createSqlObject(u.newObject);break;case"dropSqlObject":l.dropSqlObject(u.oldObject);break;case"fillPreloadedRows":l.fillPreloadedRows(u.table,u.oldRows,u.newRows,u.key,u.insertOnly);break;case"recreateTable":{const c=(0,r.generateTablePairingId)(u.table),d=t.default.cloneDeep(c),f=a.DatabaseAnalyser.createEmptyStructure();f.tables.push(d),u.operations.forEach(h=>o(h,new n.DatabaseInfoAlterProcessor(f))),l.recreateTable(c,d)}break}}return alterPlan.runAlterOperation=o,alterPlan}var jsonify={},parse,hasRequiredParse;function requireParse(){if(hasRequiredParse)return parse;hasRequiredParse=1;var e,t,r={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},n,a=function(y){throw{name:"SyntaxError",message:y,at:e,text:n}},s=function(y){return y&&y!==t&&a("Expected '"+y+"' instead of '"+t+"'"),t=n.charAt(e),e+=1,t},o=function(){var y,v="";for(t==="-"&&(v="-",s("-"));t>="0"&&t<="9";)v+=t,s();if(t===".")for(v+=".";s()&&t>="0"&&t<="9";)v+=t;if(t==="e"||t==="E")for(v+=t,s(),(t==="-"||t==="+")&&(v+=t,s());t>="0"&&t<="9";)v+=t,s();if(y=+v,!isFinite(y))a("Bad number");else return y},u=function(){var y,v,g="",C;if(t==='"')for(;s();){if(t==='"')return s(),g;if(t==="\\")if(s(),t==="u"){for(C=0,v=0;v<4&&(y=parseInt(s(),16),!!isFinite(y));v+=1)C=C*16+y;g+=String.fromCharCode(C)}else if(typeof r[t]=="string")g+=r[t];else break;else g+=t}a("Bad string")},l=function(){for(;t&&t<=" ";)s()},c=function(){switch(t){case"t":return s("t"),s("r"),s("u"),s("e"),!0;case"f":return s("f"),s("a"),s("l"),s("s"),s("e"),!1;case"n":return s("n"),s("u"),s("l"),s("l"),null}a("Unexpected '"+t+"'")},d,f=function(){var y=[];if(t==="["){if(s("["),l(),t==="]")return s("]"),y;for(;t;){if(y.push(d()),l(),t==="]")return s("]"),y;s(","),l()}}a("Bad array")},h=function(){var y,v={};if(t==="{"){if(s("{"),l(),t==="}")return s("}"),v;for(;t;){if(y=u(),l(),s(":"),Object.hasOwnProperty.call(v,y)&&a('Duplicate key "'+y+'"'),v[y]=d(),l(),t==="}")return s("}"),v;s(","),l()}}a("Bad object")};return d=function(){switch(l(),t){case"{":return h();case"[":return f();case'"':return u();case"-":return o();default:return t>="0"&&t<="9"?o():c()}},parse=function(y,v){var g;return n=y,e=0,t=" ",g=d(),l(),t&&a("Syntax error"),typeof v=="function"?function C(O,j){var F,L,M=O[j];if(M&&typeof M=="object")for(F in M)Object.prototype.hasOwnProperty.call(M,F)&&(L=C(M,F),L!==void 0?M[F]=L:delete M[F]);return v.call(O,j,M)}({"":g},""):g},parse}var stringify,hasRequiredStringify;function requireStringify(){if(hasRequiredStringify)return stringify;hasRequiredStringify=1;var e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,t,r,n={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},a;function s(u){return e.lastIndex=0,e.test(u)?'"'+u.replace(e,function(l){var c=n[l];return typeof c=="string"?c:"\\u"+("0000"+l.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+u+'"'}function o(u,l){var c,d,f,h,y=t,v,g=l[u];switch(g&&typeof g=="object"&&typeof g.toJSON=="function"&&(g=g.toJSON(u)),typeof a=="function"&&(g=a.call(l,u,g)),typeof g){case"string":return s(g);case"number":return isFinite(g)?String(g):"null";case"boolean":case"null":return String(g);case"object":if(!g)return"null";if(t+=r,v=[],Object.prototype.toString.apply(g)==="[object Array]"){for(h=g.length,c=0;c<h;c+=1)v[c]=o(c,g)||"null";return f=v.length===0?"[]":t?`[
`+t+v.join(`,
`+t)+`
`+y+"]":"["+v.join(",")+"]",t=y,f}if(a&&typeof a=="object")for(h=a.length,c=0;c<h;c+=1)d=a[c],typeof d=="string"&&(f=o(d,g),f&&v.push(s(d)+(t?": ":":")+f));else for(d in g)Object.prototype.hasOwnProperty.call(g,d)&&(f=o(d,g),f&&v.push(s(d)+(t?": ":":")+f));return f=v.length===0?"{}":t?`{
`+t+v.join(`,
`+t)+`
`+y+"}":"{"+v.join(",")+"}",t=y,f}}return stringify=function(u,l,c){var d;if(t="",r="",typeof c=="number")for(d=0;d<c;d+=1)r+=" ";else typeof c=="string"&&(r=c);if(a=l,l&&typeof l!="function"&&(typeof l!="object"||typeof l.length!="number"))throw new Error("JSON.stringify");return o("",{"":u})},stringify}var hasRequiredJsonify;function requireJsonify(){return hasRequiredJsonify||(hasRequiredJsonify=1,jsonify.parse=requireParse(),jsonify.stringify=requireStringify()),jsonify}var json=typeof JSON<"u"?JSON:requireJsonify(),jsonStableStringify=function(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var r=t.space||"";typeof r=="number"&&(r=Array(r+1).join(" "));var n=typeof t.cycles=="boolean"?t.cycles:!1,a=t.replacer||function(u,l){return l},s=t.cmp&&function(u){return function(l){return function(c,d){var f={key:c,value:l[c]},h={key:d,value:l[d]};return u(f,h)}}}(t.cmp),o=[];return function u(l,c,d,f){var h=r?`
`+new Array(f+1).join(r):"",y=r?": ":":";if(d&&d.toJSON&&typeof d.toJSON=="function"&&(d=d.toJSON()),d=a.call(l,c,d),d!==void 0){if(typeof d!="object"||d===null)return json.stringify(d);if(isArray$1(d)){for(var v=[],g=0;g<d.length;g++){var C=u(d,g,d[g],f+1)||json.stringify(null);v.push(h+r+C)}return"["+v.join(",")+h+"]"}else{if(o.indexOf(d)!==-1){if(n)return json.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}else o.push(d);for(var O=objectKeys(d).sort(s&&s(d)),v=[],g=0;g<O.length;g++){var c=O[g],j=u(d,c,d[c],f+1);if(j){var F=json.stringify(c)+y+j;v.push(h+r+F)}}return o.splice(o.indexOf(d),1),"{"+v.join(",")+h+"}"}}}({"":e},"",e,0)},isArray$1=Array.isArray||function(e){return{}.toString.call(e)==="[object Array]"},objectKeys=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},r=[];for(var n in e)t.call(e,n)&&r.push(n);return r};const stableStringify=getDefaultExportFromCjs(jsonStableStringify);function last$1(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var last_1=last$1,baseGet=_baseGet,baseSlice=_baseSlice;function parent$1(e,t){return t.length<2?e:baseGet(e,baseSlice(t,0,-1))}var _parent=parent$1,castPath$1=_castPath,last=last_1,parent=_parent,toKey=_toKey;function baseUnset$1(e,t){return t=castPath$1(t,e),e=parent(e,t),e==null||delete e[toKey(last(t))]}var _baseUnset=baseUnset$1,isPlainObject=isPlainObject_1$5;function customOmitClone$1(e){return isPlainObject(e)?void 0:e}var _customOmitClone=customOmitClone$1,arrayMap$2=_arrayMap,baseClone=_baseClone,baseUnset=_baseUnset,castPath=_castPath,copyObject=_copyObject,customOmitClone=_customOmitClone,flatRest=_flatRest,getAllKeysIn=_getAllKeysIn,CLONE_DEEP_FLAG=1,CLONE_FLAT_FLAG=2,CLONE_SYMBOLS_FLAG=4,omit=flatRest(function(e,t){var r={};if(e==null)return r;var n=!1;t=arrayMap$2(t,function(s){return s=castPath(s,e),n||(n=s.length>1),s}),copyObject(e,getAllKeysIn(e),r),n&&(r=baseClone(r,CLONE_DEEP_FLAG|CLONE_FLAT_FLAG|CLONE_SYMBOLS_FLAG,customOmitClone));for(var a=t.length;a--;)baseUnset(r,t[a]);return r}),omit_1$2=omit,baseIsEqual=_baseIsEqual;function isEqual(e,t){return baseIsEqual(e,t)}var isEqual_1$1=isEqual,hasRequiredDiffTools;function requireDiffTools(){if(hasRequiredDiffTools)return diffTools;hasRequiredDiffTools=1;var e=commonjsGlobal&&commonjsGlobal.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(diffTools,"__esModule",{value:!0}),diffTools.modelCompareDbDiffOptions=diffTools.matchPairedObjects=diffTools.getAlterDatabaseScript=diffTools.getAlterTableScript=diffTools.createAlterDatabasePlan=diffTools.createAlterTablePlan=diffTools.testEqualSqlObjects=diffTools.testEqualTables=diffTools.testEqualTypes=diffTools.testEqualColumns=diffTools.generateDbPairingId=diffTools.removeTablePairingId=diffTools.generateTablePairingId=void 0;const t=e(v1_1$5),r=requireAlterPlan(),n=e(jsonStableStringify),a=e(omit_1$2),s=e(cloneDeep_1$3),o=e(isEqual_1$1),u=e(pick_1$3);function l(_){var $,P,k,E,x;return _&&(_.pairingId?_:Object.assign(Object.assign({},_),{columns:($=_.columns)===null||$===void 0?void 0:$.map(T=>Object.assign(Object.assign({},T),{pairingId:T.pairingId||(0,t.default)()})),foreignKeys:(P=_.foreignKeys)===null||P===void 0?void 0:P.map(T=>Object.assign(Object.assign({},T),{pairingId:T.pairingId||(0,t.default)()})),checks:(k=_.checks)===null||k===void 0?void 0:k.map(T=>Object.assign(Object.assign({},T),{pairingId:T.pairingId||(0,t.default)()})),indexes:(E=_.indexes)===null||E===void 0?void 0:E.map(T=>Object.assign(Object.assign({},T),{pairingId:T.pairingId||(0,t.default)()})),uniques:(x=_.uniques)===null||x===void 0?void 0:x.map(T=>Object.assign(Object.assign({},T),{pairingId:T.pairingId||(0,t.default)()})),pairingId:_.pairingId||(0,t.default)()}))}diffTools.generateTablePairingId=l;function c(_){var $,P,k,E,x;return _&&Object.assign(Object.assign({},_),{columns:($=_.columns)===null||$===void 0?void 0:$.map(T=>Object.assign(Object.assign({},T),{pairingId:void 0})),foreignKeys:(P=_.foreignKeys)===null||P===void 0?void 0:P.map(T=>Object.assign(Object.assign({},T),{pairingId:void 0})),checks:(k=_.checks)===null||k===void 0?void 0:k.map(T=>Object.assign(Object.assign({},T),{pairingId:void 0})),indexes:(E=_.indexes)===null||E===void 0?void 0:E.map(T=>Object.assign(Object.assign({},T),{pairingId:void 0})),uniques:(x=_.uniques)===null||x===void 0?void 0:x.map(T=>Object.assign(Object.assign({},T),{pairingId:void 0})),pairingId:void 0})}diffTools.removeTablePairingId=c;function d(_){return _.objectTypeField?Object.assign(Object.assign({},_),{pairingId:_.pairingId||(0,t.default)()}):_}function f(_){var $,P,k,E,x,T;return _&&Object.assign(Object.assign({},_),{tables:($=_.tables)===null||$===void 0?void 0:$.map(l),views:(P=_.views)===null||P===void 0?void 0:P.map(d),procedures:(k=_.procedures)===null||k===void 0?void 0:k.map(d),functions:(E=_.functions)===null||E===void 0?void 0:E.map(d),triggers:(x=_.triggers)===null||x===void 0?void 0:x.map(d),matviews:(T=_.matviews)===null||T===void 0?void 0:T.map(d)})}diffTools.generateDbPairingId=f;function h(_,$,P){return P.ignoreCase?(_||"").toLowerCase()==($||"").toLowerCase():_==$}function y(_,$,P){return P.schemaMode=="ignore"&&(_=null),P.schemaMode=="ignoreImplicit"&&_==P.leftImplicitSchema&&(_=null),P.schemaMode=="ignore"&&($=null),P.schemaMode=="ignoreImplicit"&&$==P.rightImplicitSchema&&($=null),h(_,$,P)}function v(_,$,P){return _==null||$==null?_==$:y(_.schemaName,$.schemaName,P)&&h(_.pureName,$.pureName,P)}function g(_,$,P,k,E={}){if(P&&!h(_.columnName,$.columnName,E))return!1;if(_.computedExpression!=$.computedExpression)return console.debug(`Column ${_.pureName}.${_.columnName}, ${$.pureName}.${$.columnName}: different computed expression: ${_.computedExpression}, ${$.computedExpression}`),!1;if(_.computedExpression!=null)return!0;if(k){if(_.defaultValue==null){if(_.defaultValue!=$.defaultValue)return console.debug(`Column ${_.pureName}.${_.columnName}, ${$.pureName}.${$.columnName}: different default value: ${_.defaultValue}, ${$.defaultValue}`),!1}else if(_.defaultValue!=$.defaultValue)return console.debug(`Column ${_.pureName}.${_.columnName}, ${$.pureName}.${$.columnName}: different default value: ${_.defaultValue}, ${$.defaultValue}`),!1;if(_.defaultConstraint!=$.defaultConstraint)return console.debug(`Column ${_.pureName}.${_.columnName}, ${$.pureName}.${$.columnName}: different default constraint: ${_.defaultConstraint}, ${$.defaultConstraint}`),!1}return(_.notNull||!1)!=($.notNull||!1)?(console.debug(`Column ${_.pureName}.${_.columnName}, ${$.pureName}.${$.columnName}: different nullability: ${_.notNull}, ${$.notNull}`),!1):(_.autoIncrement||!1)!=($.autoIncrement||!1)?(console.debug(`Column ${_.pureName}.${_.columnName}, ${$.pureName}.${$.columnName}: different autoincrement: ${_.autoIncrement}, ${$.autoIncrement}`),!1):(_.isSparse||!1)!=($.isSparse||!1)?(console.debug(`Column ${_.pureName}.${_.columnName}, ${$.pureName}.${$.columnName}: different is_sparse: ${_.isSparse}, ${$.isSparse}`),!1):(_.isUnsigned||!1)!=($.isUnsigned||!1)?(console.debug(`Column ${_.pureName}.${_.columnName}, ${$.pureName}.${$.columnName}: different unsigned: ${_.isUnsigned}, ${$.isUnsigned}`),!1):(_.isZerofill||!1)!=($.isZerofill||!1)?(console.debug(`Column ${_.pureName}.${_.columnName}, ${$.pureName}.${$.columnName}: different zerofill: ${_.isZerofill}, ${$.isZerofill}`),!1):(_.columnComment||"")!=($.columnComment||"")?(console.debug(`Column ${_.pureName}.${_.columnName}, ${$.pureName}.${$.columnName}: different comment: ${_.columnComment}, ${$.columnComment}`),!1):!!O(_,$,E)}diffTools.testEqualColumns=g;function C(_,$,P={}){const k=[];return P.ignoreForeignKeyActions&&(k.push("updateAction"),k.push("deleteAction")),P.ignoreConstraintNames&&k.push("constraintName"),P.schemaMode=="ignore"&&(k.push("schemaName"),k.push("refSchemaName")),(0,n.default)((0,a.default)(_,k))==(0,n.default)((0,a.default)($,k))}function O(_,$,P={}){return P.ignoreDataTypes?!0:(_.dataType||"").toLowerCase()!=($.dataType||"").toLowerCase()?(console.debug(`Column ${_.pureName}.${_.columnName}, ${$.pureName}.${$.columnName}: different data type: ${_.dataType}, ${$.dataType}`),!1):!0}diffTools.testEqualTypes=O;function j(_){const $=[];return _.primaryKey&&$.push(_.primaryKey),_.foreignKeys&&$.push(..._.foreignKeys),_.indexes&&$.push(..._.indexes),_.uniques&&$.push(..._.uniques),_.checks&&$.push(..._.checks),$}function F(_,$,P=null){const k=[];for(const E of _){const x=$.find(T=>T.pairingId==E.pairingId||P&&P(E,T));x?k.push([E,x]):k.push([E,null])}for(const E of $)k.find(x=>x[1]==E)||k.push([null,E]);return k}function L(_,$,P){var k,E,x;const T=P.preloadedRowsKey||((E=(k=P.primaryKey)===null||k===void 0?void 0:k.columns)===null||E===void 0?void 0:E.map(U=>U.columnName));((x=P.preloadedRows)===null||x===void 0?void 0:x.length)>0&&(T==null?void 0:T.length)>0&&_.fillPreloadedRows(P,$==null?void 0:$.preloadedRows,P.preloadedRows,T,P.preloadedRowsInsertOnly)}function M(_,$,P,k){const E=F($.columns,P.columns),x=F(j($),j(P),(T,U)=>T.constraintType=="primaryKey"&&U.constraintType=="primaryKey");k.noDropConstraint||x.filter(T=>T[1]==null).forEach(T=>_.dropConstraint(T[0])),k.noDropColumn||E.filter(T=>T[1]==null).forEach(T=>_.dropColumn(T[0])),!v($,P,k)&&!k.noRenameTable&&_.renameTable($,P.pureName),E.filter(T=>T[0]==null).forEach(T=>_.createColumn(T[1])),E.filter(T=>T[0]&&T[1]).forEach(T=>{g(T[0],T[1],!0,!0,k)||(g(T[0],T[1],!1,!0,k)&&!k.noRenameColumn?_.renameColumn(T[0],T[1].columnName):_.changeColumn(T[0],T[1]))}),x.filter(T=>T[0]&&T[1]).forEach(T=>{C(T[0],T[1],k)||_.changeConstraint(T[0],T[1])}),x.filter(T=>T[0]==null).forEach(T=>_.createConstraint(T[1])),L(_,$,P)}function I(_,$,P,k,E,x){const T=new r.AlterPlan(k,E,x.dialect,P);return M(T,_,$,P),T.operations.length==0}diffTools.testEqualTables=I;function A(_,$,P){return _.createSql==$.createSql}diffTools.testEqualSqlObjects=A;function q(_,$,P,k,E,x){const T=new r.AlterPlan(k,E,x.dialect,P);return _==null?(T.createTable($),L(T,null,$)):$==null?T.dropTable(_):M(T,_,$,P),T.transformPlan(),T}diffTools.createAlterTablePlan=q;function G(_,$,P,k,E,x){const T=new r.AlterPlan(k,E,x.dialect,P);for(const U of["tables","views","procedures","matviews","functions"]){for(const W of _[U]||[]){const K=($[U]||[]).find(H=>H.pairingId==W.pairingId);U=="tables"?K==null?P.noDropTable||T.dropTable(W):M(T,W,K,P):K==null?P.noDropSqlObject||T.dropSqlObject(W):A(W.createSql,K.createSql)||(T.recreates.sqlObjects+=1,P.noDropSqlObject||T.dropSqlObject(W),T.createSqlObject(K))}for(const W of $[U]||[]){const K=(_[U]||[]).find(H=>H.pairingId==W.pairingId);U=="tables"?K==null&&(T.createTable(W),L(T,null,W)):K==null&&T.createSqlObject(W)}}return T.transformPlan(),T}diffTools.createAlterDatabasePlan=G;function J(_,$,P,k,E,x){if(!_&&!$||!x)return{sql:"",recreates:[]};const T=q(_,$,P,k,E,x),U=x.createDumper({useHardSeparator:!0});return T.run(U),{sql:U.s,recreates:T.recreates}}diffTools.getAlterTableScript=J;function Q(_,$,P,k,E,x){const T=G(_,$,P,k,E,x),U=x.createDumper({useHardSeparator:!0});return T.run(U),{sql:U.s,recreates:T.recreates,isEmpty:T.operations.length==0}}diffTools.getAlterDatabaseScript=Q;function X(_,$,P){if(!_||!$)return null;const k=(0,s.default)($);for(const E of["tables","views","procedures","matviews","functions"])for(const x of k[E]||[]){const T=_[E].find(U=>v(U,x,P));if(T&&(x.pairingId=T.pairingId,E=="tables")){for(const U of x.columns){const W=T.columns.find(K=>h(K.columnName,U.columnName,P));W&&(U.pairingId=W.pairingId)}for(const U of x.foreignKeys){const W=T.foreignKeys.find(K=>h(K.refTableName,U.refTableName,P)&&(0,o.default)(K.columns.map(H=>(0,u.default)(H,["columnName","refColumnName"])),U.columns.map(H=>(0,u.default)(H,["columnName","refColumnName"]))));W&&(U.pairingId=W.pairingId)}for(const U of x.uniques){const W=T.uniques.find(K=>(0,o.default)(K.columns.map(H=>(0,u.default)(H,["columnName"])),U.columns.map(H=>(0,u.default)(H,["columnName"]))));W&&(U.pairingId=W.pairingId)}for(const U of x.indexes){const W=T.indexes.find(K=>h(K.constraintName,U.constraintName,P));W&&(U.pairingId=W.pairingId)}}}return k}return diffTools.matchPairedObjects=X,diffTools.modelCompareDbDiffOptions={ignoreCase:!0,schemaMode:"ignore",ignoreConstraintNames:!0,ignoreForeignKeyActions:!0,ignoreDataTypes:!0},diffTools}var schemaEditorTools={},stringTools={},__importDefault$l=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(stringTools,"__esModule",{value:!0});stringTools.parseSqlDefaultValue=stringTools.getAsImageSrc=stringTools.arrayBufferToBase64=stringTools.isWktGeometry=stringTools.getIconForRedisType=stringTools.isJsonLikeLongString=stringTools.safeJsonParse=stringTools.stringifyCellValue=stringTools.parseCellValue=stringTools.hexStringToArray=stringTools.arrayToHexString=void 0;const isString_1$1=__importDefault$l(isString_1$7),isArray_1$3=__importDefault$l(isArray_1$5),isPlainObject_1$2=__importDefault$l(isPlainObject_1$5);function arrayToHexString(e){return e.reduce((t,r)=>t+("0"+r.toString(16)).slice(-2),"").toUpperCase()}stringTools.arrayToHexString=arrayToHexString;function hexStringToArray(e){for(var t=e.toString(),r=[],n=0;n<t.length;n+=2)r.push(parseInt(t.substr(n,2),16));return r}stringTools.hexStringToArray=hexStringToArray;function parseCellValue(e){if(!(0,isString_1$1.default)(e))return e;if(e=="(NULL)")return null;if(e.match(/^0x([0-9a-fA-F][0-9a-fA-F])+$/))return{type:"Buffer",data:hexStringToArray(e.substring(2))};const r=e.match(/^ObjectId\("([0-9a-f]{24})"\)$/);return r?{$oid:r[1]}:e}stringTools.parseCellValue=parseCellValue;function stringifyCellValue(e){return e===null?"(NULL)":e===void 0?"(NoField)":(e==null?void 0:e.type)=="Buffer"&&(0,isArray_1$3.default)(e.data)?"0x"+arrayToHexString(e.data):e!=null&&e.$oid?`ObjectId("${e==null?void 0:e.$oid}")`:(0,isPlainObject_1$2.default)(e)||(0,isArray_1$3.default)(e)?JSON.stringify(e):e}stringTools.stringifyCellValue=stringifyCellValue;function safeJsonParse(e,t,r=!1){if((0,isArray_1$3.default)(e)||(0,isPlainObject_1$2.default)(e))return e;try{return JSON.parse(e)}catch(n){return r&&console.error(`Error parsing JSON value "${e}"`,n),t}}stringTools.safeJsonParse=safeJsonParse;function isJsonLikeLongString(e){return(0,isString_1$1.default)(e)&&e.length>100&&e.match(/^\s*\{.*\}\s*$|^\s*\[.*\]\s*$/)}stringTools.isJsonLikeLongString=isJsonLikeLongString;function getIconForRedisType(e){switch(e){case"dir":return"img folder";case"string":return"img type-string";case"hash":return"img type-hash";case"set":return"img type-set";case"list":return"img type-list";case"zset":return"img type-zset";case"stream":return"img type-stream";case"binary":return"img type-binary";case"ReJSON-RL":return"img type-rejson";default:return null}}stringTools.getIconForRedisType=getIconForRedisType;function isWktGeometry(e){return(0,isString_1$1.default)(e)?!!e.match(/^POINT\s*\(|^LINESTRING\s*\(|^POLYGON\s*\(|^MULTIPOINT\s*\(|^MULTILINESTRING\s*\(|^MULTIPOLYGON\s*\(|^GEOMCOLLECTION\s*\(|^GEOMETRYCOLLECTION\s*\(/):!1}stringTools.isWktGeometry=isWktGeometry;function arrayBufferToBase64(e){var t="",r=[].slice.call(new Uint8Array(e));return r.forEach(n=>t+=String.fromCharCode(n)),btoa(t)}stringTools.arrayBufferToBase64=arrayBufferToBase64;function getAsImageSrc(e){return(e==null?void 0:e.type)=="Buffer"&&(0,isArray_1$3.default)(e==null?void 0:e.data)?`data:image/png;base64, ${arrayBufferToBase64(e==null?void 0:e.data)}`:(0,isString_1$1.default)(e)&&(e.startsWith("http://")||e.startsWith("https://"))?e:null}stringTools.getAsImageSrc=getAsImageSrc;function parseSqlDefaultValue(e){if(e&&(0,isString_1$1.default)(e)){if(e.startsWith("'")&&e.endsWith("'"))return e.slice(1,-1);if(!isNaN(e)&&!isNaN(parseFloat(e)))return parseFloat(e)}}stringTools.parseSqlDefaultValue=parseSqlDefaultValue;var __importDefault$k=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(schemaEditorTools,"__esModule",{value:!0});schemaEditorTools.editorDeleteConstraint=schemaEditorTools.editorModifyConstraint=schemaEditorTools.editorAddConstraint=schemaEditorTools.editorDeleteColumn=schemaEditorTools.editorModifyColumn=schemaEditorTools.editorAddColumn=schemaEditorTools.processJsonDataUpdateCommands=schemaEditorTools.fillEditorColumnInfo=void 0;const v1_1$3=__importDefault$k(v1_1$5),omit_1$1=__importDefault$k(omit_1$2),lodash_1$7=__importDefault$k(lodashExports),stringTools_1=stringTools;function fillEditorColumnInfo(e,t){var r,n;return Object.assign({isPrimaryKey:!!(!((n=(r=t==null?void 0:t.primaryKey)===null||r===void 0?void 0:r.columns)===null||n===void 0)&&n.find(a=>a.columnName==e.columnName)),dataType:lodash_1$7.default.isEmpty(e)?"int":void 0},e)}schemaEditorTools.fillEditorColumnInfo=fillEditorColumnInfo;function processJsonDataUpdateCommands(e,t=[]){for(const r of t)switch(r.type){case"deleteField":e=Object.assign({},e),delete e[r.oldField];break;case"renameField":e=Object.assign({},e),e[r.newField]=e[r.oldField],delete e[r.oldField];break;case"setField":e=Object.assign({},e),e[r.newField]=r.value;break;case"setFieldIfNull":e=Object.assign({},e),e[r.newField]==null&&(e[r.newField]=r.value);break}return e}schemaEditorTools.processJsonDataUpdateCommands=processJsonDataUpdateCommands;function processPrimaryKey(e,t,r){if(!(t!=null&&t.isPrimaryKey)&&(r!=null&&r.isPrimaryKey)){let n=e==null?void 0:e.primaryKey;return n||(n={constraintType:"primaryKey",pureName:e.pureName,schemaName:e.schemaName,columns:[]}),Object.assign(Object.assign({},e),{primaryKey:Object.assign(Object.assign({},n),{columns:[...n.columns,{columnName:r.columnName}]})})}if(t!=null&&t.isPrimaryKey&&!(r!=null&&r.isPrimaryKey)){let n=e==null?void 0:e.primaryKey;if(n)return n=Object.assign(Object.assign({},n),{columns:e.primaryKey.columns.filter(a=>a.columnName!=t.columnName)}),n.columns.length==0?Object.assign(Object.assign({},e),{primaryKey:null}):Object.assign(Object.assign({},e),{primaryKey:n})}return e}function defineDataCommand(e,t){e.__addDataCommands=[...e.__addDataCommands||[],t()]}function editorAddColumn(e,t,r){let n=Object.assign(Object.assign({},e),{columns:[...(e==null?void 0:e.columns)||[],Object.assign(Object.assign({},t),{pairingId:(0,v1_1$3.default)()})]});return n=processPrimaryKey(n,null,t),r&&t.defaultValue&&defineDataCommand(n,()=>({type:"setField",newField:t.columnName,value:(0,stringTools_1.parseSqlDefaultValue)(t.defaultValue)})),n}schemaEditorTools.editorAddColumn=editorAddColumn;function editorModifyColumn(e,t,r){var n;const a=(n=e==null?void 0:e.columns)===null||n===void 0?void 0:n.find(o=>o.pairingId==t.pairingId);let s=Object.assign(Object.assign({},e),{columns:e.columns.map(o=>o.pairingId==t.pairingId?(0,omit_1$1.default)(t,["isPrimaryKey"]):o)});return s=processPrimaryKey(s,fillEditorColumnInfo(a,e),t),r&&a.columnName!=t.columnName&&defineDataCommand(s,()=>({type:"renameField",oldField:a.columnName,newField:t.columnName})),r&&!a.defaultValue&&t.defaultValue&&defineDataCommand(s,()=>({type:"setFieldIfNull",newField:t.columnName,value:(0,stringTools_1.parseSqlDefaultValue)(t.defaultValue)})),s}schemaEditorTools.editorModifyColumn=editorModifyColumn;function editorDeleteColumn(e,t,r){let n=Object.assign(Object.assign({},e),{columns:e.columns.filter(a=>a.pairingId!=t.pairingId)});return n=processPrimaryKey(n,t,null),r&&defineDataCommand(n,()=>({type:"deleteField",oldField:t.columnName})),n}schemaEditorTools.editorDeleteColumn=editorDeleteColumn;function editorAddConstraint(e,t){const r=Object.assign({},e);return t.constraintType=="primaryKey"&&(r.primaryKey=Object.assign({pairingId:(0,v1_1$3.default)()},t)),t.constraintType=="foreignKey"&&(r.foreignKeys=[...r.foreignKeys||[],Object.assign({pairingId:(0,v1_1$3.default)()},t)]),t.constraintType=="index"&&(r.indexes=[...r.indexes||[],Object.assign({pairingId:(0,v1_1$3.default)()},t)]),t.constraintType=="unique"&&(r.uniques=[...r.uniques||[],Object.assign({pairingId:(0,v1_1$3.default)()},t)]),r}schemaEditorTools.editorAddConstraint=editorAddConstraint;function editorModifyConstraint(e,t){const r=Object.assign({},e);return t.constraintType=="primaryKey"&&(r.primaryKey=Object.assign(Object.assign({},r.primaryKey),t)),t.constraintType=="foreignKey"&&(r.foreignKeys=e.foreignKeys.map(n=>n.pairingId==t.pairingId?Object.assign(Object.assign({},n),t):n)),t.constraintType=="index"&&(r.indexes=e.indexes.map(n=>n.pairingId==t.pairingId?Object.assign(Object.assign({},n),t):n)),t.constraintType=="unique"&&(r.uniques=e.uniques.map(n=>n.pairingId==t.pairingId?Object.assign(Object.assign({},n),t):n)),r}schemaEditorTools.editorModifyConstraint=editorModifyConstraint;function editorDeleteConstraint(e,t){const r=Object.assign({},e);return t.constraintType=="primaryKey"&&(r.primaryKey=null),t.constraintType=="foreignKey"&&(r.foreignKeys=e.foreignKeys.filter(n=>n.pairingId!=t.pairingId)),t.constraintType=="index"&&(r.indexes=e.indexes.filter(n=>n.pairingId!=t.pairingId)),t.constraintType=="unique"&&(r.uniques=e.uniques.filter(n=>n.pairingId!=t.pairingId)),r}schemaEditorTools.editorDeleteConstraint=editorDeleteConstraint;var yamlModelConv={},__importDefault$j=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(yamlModelConv,"__esModule",{value:!0});yamlModelConv.databaseInfoFromYamlModel=yamlModelConv.tableInfoFromYaml=yamlModelConv.tableInfoToYaml=void 0;const cloneDeep_1=__importDefault$j(cloneDeep_1$3),compact_1$1=__importDefault$j(compact_1$6),DatabaseAnalyser_1=DatabaseAnalyser$1;function columnInfoToYaml(e,t){const r={name:e.columnName,type:e.dataType,default:e.defaultValue};e.autoIncrement&&(r.autoIncrement=!0),e.notNull&&(r.notNull=!0);const n=t.foreignKeys&&t.foreignKeys.find(a=>a.columns.length==1&&a.columns[0].columnName==e.columnName);return n&&(!n.deleteAction||n.deleteAction=="NO ACTION")&&(!n.updateAction||n.updateAction=="NO ACTION")&&(r.references=n.refTableName,n._dumped=!0),r}function columnInfoFromYaml(e,t){return{pureName:t.name,columnName:e.name,dataType:e.length?`${e.type}(${e.length})`:e.type,autoIncrement:e.autoIncrement,notNull:e.notNull||t.primaryKey&&t.primaryKey.includes(e.name),defaultValue:e.default}}function tableInfoToYaml(e){const t=(0,cloneDeep_1.default)(e),r={name:t.pureName,columns:t.columns.map(n=>columnInfoToYaml(n,t))};return t.primaryKey&&!t.primaryKey._dumped&&(r.primaryKey=t.primaryKey.columns.map(n=>n.columnName)),r}yamlModelConv.tableInfoToYaml=tableInfoToYaml;function convertForeignKeyFromYaml(e,t,r){const n=r.find(a=>a.name==e.references);return!n||!n.primaryKey?null:{constraintType:"foreignKey",pureName:t.name,refTableName:e.references,columns:[{columnName:e.name,refColumnName:n.primaryKey[0]}]}}function tableInfoFromYaml(e,t){const r={pureName:e.name,columns:e.columns.map(n=>columnInfoFromYaml(n,e)),foreignKeys:(0,compact_1$1.default)(e.columns.filter(n=>n.references).map(n=>convertForeignKeyFromYaml(n,e,t)))};return e.primaryKey&&(r.primaryKey={pureName:e.name,constraintType:"primaryKey",columns:e.primaryKey.map(n=>({columnName:n}))}),r.preloadedRows=e.data,r.preloadedRowsKey=e.insertKey,r.preloadedRowsInsertOnly=e.insertOnly,r}yamlModelConv.tableInfoFromYaml=tableInfoFromYaml;function databaseInfoFromYamlModel(e){const t=DatabaseAnalyser_1.DatabaseAnalyser.createEmptyStructure(),r=[];for(const n of e)(n.name.endsWith(".table.yaml")||n.name.endsWith(".sql"))&&(n.name.endsWith(".table.yaml")&&r.push(n.json),n.name.endsWith(".view.sql")&&t.views.push({pureName:n.name.slice(0,-9),createSql:n.text,columns:[]}),n.name.endsWith(".matview.sql")&&t.matviews.push({pureName:n.name.slice(0,-12),createSql:n.text,columns:[]}),n.name.endsWith(".proc.sql")&&t.procedures.push({pureName:n.name.slice(0,-9),createSql:n.text}),n.name.endsWith(".func.sql")&&t.functions.push({pureName:n.name.slice(0,-9),createSql:n.text}),n.name.endsWith(".trigger.sql")&&t.triggers.push({pureName:n.name.slice(0,-12),createSql:n.text}));return t.tables=r.map(n=>tableInfoFromYaml(n,r)),t}yamlModelConv.databaseInfoFromYamlModel=databaseInfoFromYamlModel;var computeDiffRows={};(function(e){var t=commonjsGlobal&&commonjsGlobal.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(e,"__esModule",{value:!0}),e.getCreateObjectScript=e.computeTableDiffColumns=e.computeDbDiffRows=e.DbDiffCompareDefs=e.computeDiffRowsCore=void 0;const r=requireDiffTools(),n=t(lodashExports);function a(l,c,d){const f=[];for(const h of l){const y=c.find(v=>v.pairingId==h.pairingId);if(y){const v=d(h,y);f.push({source:h,target:y,state:v?"equal":"changed",__isChanged:!v})}else f.push({source:h,state:"added",__isAdded:!0})}for(const h of c)l.find(v=>v.pairingId==h.pairingId)||f.push({target:h,state:"removed",__isDeleted:!0});return f}e.computeDiffRowsCore=a,e.DbDiffCompareDefs={tables:{test:r.testEqualTables,name:"Table",plural:"Tables",icon:"img table"},views:{test:r.testEqualSqlObjects,name:"View",plural:"Views",icon:"img view"},matviews:{test:r.testEqualSqlObjects,name:"Materialized view",plural:"Materialized views",icon:"img view"},procedures:{test:r.testEqualSqlObjects,name:"Procedure",plural:"Procedures",icon:"img procedure"},functions:{test:r.testEqualSqlObjects,name:"Function",plural:"Functions",icon:"img function"}};function s(l,c,d,f){if(!l||!c||!f)return[];const h=[];for(const y of["tables","views","procedures","matviews","functions"]){const v=e.DbDiffCompareDefs[y];h.push(...n.default.sortBy(a(l[y],c[y],(g,C)=>v.test(g,C,d,l,c,f)).map(g=>{var C,O,j,F,L,M,I,A;return Object.assign(Object.assign({},g),{sourceSchemaName:(C=g==null?void 0:g.source)===null||C===void 0?void 0:C.schemaName,sourcePureName:(O=g==null?void 0:g.source)===null||O===void 0?void 0:O.pureName,targetSchemaName:(j=g==null?void 0:g.target)===null||j===void 0?void 0:j.schemaName,targetPureName:(F=g==null?void 0:g.target)===null||F===void 0?void 0:F.pureName,typeName:v.name,typeIcon:v.icon,identifier:`${((L=g==null?void 0:g.source)===null||L===void 0?void 0:L.schemaName)||((M=g==null?void 0:g.target)===null||M===void 0?void 0:M.schemaName)}.${((I=g==null?void 0:g.source)===null||I===void 0?void 0:I.pureName)||((A=g==null?void 0:g.target)===null||A===void 0?void 0:A.pureName)}`,objectTypeField:y})}),"identifier"))}return h}e.computeDbDiffRows=s;function o(l,c,d,f){return f?a((l==null?void 0:l.columns)||[],(c==null?void 0:c.columns)||[],(h,y)=>(0,r.testEqualColumns)(h,y,!0,!0,d)).map(h=>{var y,v,g,C,O,j;return Object.assign(Object.assign({},h),{sourceColumnName:(y=h==null?void 0:h.source)===null||y===void 0?void 0:y.columnName,targetColumnName:(v=h==null?void 0:h.target)===null||v===void 0?void 0:v.columnName,sourceDataType:(g=h==null?void 0:h.source)===null||g===void 0?void 0:g.dataType,targetDataType:(C=h==null?void 0:h.target)===null||C===void 0?void 0:C.dataType,sourceNotNull:(O=h==null?void 0:h.source)===null||O===void 0?void 0:O.notNull,targetNotNull:(j=h==null?void 0:h.target)===null||j===void 0?void 0:j.notNull})}):[]}e.computeTableDiffColumns=o;function u(l,c){if(!l||!c)return"";if(l.objectTypeField=="tables"){const d=c.createDumper();return d.createTable(l),d.s}return l.createSql||""}e.getCreateObjectScript=u})(computeDiffRows);var preloadedRowsTools={},__awaiter$2=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,r,n){function a(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function u(d){try{c(n.next(d))}catch(f){o(f)}}function l(d){try{c(n.throw(d))}catch(f){o(f)}}function c(d){d.done?s(d.value):a(d.value).then(u,l)}c((n=n.apply(e,t||[])).next())})},__importDefault$i=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(preloadedRowsTools,"__esModule",{value:!0});preloadedRowsTools.enrichWithPreloadedRows=void 0;const lodash_1$6=__importDefault$i(lodashExports);function enrichWithPreloadedRows(e,t,r,n){var a,s,o;return __awaiter$2(this,void 0,void 0,function*(){const u={};for(const l of t.tables){const c=e.tables.find(y=>y.pairingId==l.pairingId);if((((a=c==null?void 0:c.preloadedRows)===null||a===void 0?void 0:a.length)||0)==0)continue;const d=c.preloadedRowsKey||((o=(s=c.primaryKey)===null||s===void 0?void 0:s.columns)===null||o===void 0?void 0:o.map(y=>y.columnName));if(((d==null?void 0:d.length)||0)==0)continue;const f=n.createDumper();d.length==1?f.putCmd("^select * ^from %f ^where %i ^in (%,v)",l,d[0],c.preloadedRows.map(y=>y[d[0]])):(f.put("^select * ^from %f ^where",l),f.putCollection(" ^or ",c.preloadedRows,y=>{f.put("("),f.putCollection(" ^and ",d,v=>f.put("%i=%v",v,y[v])),f.put(")")}),f.endCommand());const h=yield n.query(r,f.s);u[l.pairingId]=Object.assign(Object.assign({},l),{preloadedRows:h.rows,preloadedRowsKey:d})}return lodash_1$6.default.isEmpty(u)?t:Object.assign(Object.assign({},t),{tables:t.tables.map(l=>u[l.pairingId]||l)})})}preloadedRowsTools.enrichWithPreloadedRows=enrichWithPreloadedRows;var ScriptWriter$1={},baseUniq=_baseUniq;function uniq(e){return e&&e.length?baseUniq(e):[]}var uniq_1$2=uniq,__importDefault$h=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ScriptWriter$1,"__esModule",{value:!0});ScriptWriter$1.jsonScriptToJavascript=ScriptWriter$1.ScriptWriterJson=ScriptWriter$1.ScriptWriter=void 0;const uniq_1$1=__importDefault$h(uniq_1$2),packageTools_1=packageTools;class ScriptWriter{constructor(t="0"){this.s="",this.packageNames=[],this.varCount=0,this.varCount=parseInt(t)||0}allocVariable(t="var"){return this.varCount+=1,`${t}${this.varCount}`}_put(t=""){this.s+=t,this.s+=`
`}endLine(){this._put()}assignCore(t,r,n){this._put(`const ${t} = await ${r}(${JSON.stringify(n)});`)}assign(t,r,n){this.assignCore(t,(0,packageTools_1.extractShellApiFunctionName)(r),n),this.packageNames.push(...(0,packageTools_1.extractShellApiPlugins)(r,n))}assignValue(t,r){this._put(`const ${t} = ${JSON.stringify(r)};`)}requirePackage(t){this.packageNames.push(t)}copyStream(t,r,n=null){n?this._put(`await dbgateApi.copyStream(${t}, ${r}, {columns: ${n}});`):this._put(`await dbgateApi.copyStream(${t}, ${r});`)}dumpDatabase(t){this._put(`await dbgateApi.dumpDatabase(${JSON.stringify(t)});`)}importDatabase(t){this._put(`await dbgateApi.importDatabase(${JSON.stringify(t)});`)}dataDuplicator(t){this._put(`await dbgateApi.dataDuplicator(${JSON.stringify(t)});`)}comment(t){this._put(`// ${t}`)}getScript(t=null){const r=this.packageNames;let n=(0,uniq_1$1.default)(r).map(a=>`// @require ${a}
`).join("");return t&&(n+=`// @schedule ${t}`),n&&(n+=`
`),n+this.s}}ScriptWriter$1.ScriptWriter=ScriptWriter;class ScriptWriterJson{constructor(t="0"){this.s="",this.packageNames=[],this.varCount=0,this.commands=[],this.varCount=parseInt(t)||0}allocVariable(t="var"){return this.varCount+=1,`${t}${this.varCount}`}endLine(){this.commands.push({type:"endline"})}assign(t,r,n){this.commands.push({type:"assign",variableName:t,functionName:(0,packageTools_1.extractShellApiFunctionName)(r),props:n}),this.packageNames.push(...(0,packageTools_1.extractShellApiPlugins)(r,n))}assignValue(t,r){this.commands.push({type:"assignValue",variableName:t,jsonValue:r})}copyStream(t,r,n=null){this.commands.push({type:"copyStream",sourceVar:t,targetVar:r,colmapVar:n})}comment(t){this.commands.push({type:"comment",text:t})}dumpDatabase(t){this.commands.push({type:"dumpDatabase",options:t})}importDatabase(t){this.commands.push({type:"importDatabase",options:t})}dataDuplicator(t){this.commands.push({type:"dataDuplicator",options:t})}getScript(t=null){return{type:"json",schedule:t,commands:this.commands,packageNames:this.packageNames}}}ScriptWriter$1.ScriptWriterJson=ScriptWriterJson;function jsonScriptToJavascript(e){const{schedule:t,commands:r,packageNames:n}=e,a=new ScriptWriter;for(const s of n){if(!/^dbgate-plugin-.*$/.test(s))throw new Error("Unallowed package name:"+s);a.packageNames.push(s)}for(const s of r)switch(s.type){case"assign":a.assignCore(s.variableName,s.functionName,s.props);break;case"assignValue":a.assignValue(s.variableName,s.jsonValue);break;case"copyStream":a.copyStream(s.sourceVar,s.targetVar,s.colmapVar);break;case"endLine":a.endLine();break;case"comment":a.comment(s.text);break;case"dumpDatabase":a.dumpDatabase(s.options);break;case"importDatabase":a.importDatabase(s.options);break;case"dataDuplicator":a.dataDuplicator(s.options);break}return a.getScript(t)}ScriptWriter$1.jsonScriptToJavascript=jsonScriptToJavascript;(function(e){var t=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(n,a,s,o){o===void 0&&(o=s);var u=Object.getOwnPropertyDescriptor(a,s);(!u||("get"in u?!a.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return a[s]}}),Object.defineProperty(n,o,u)}:function(n,a,s,o){o===void 0&&(o=s),n[o]=a[s]}),r=commonjsGlobal&&commonjsGlobal.__exportStar||function(n,a){for(var s in n)s!=="default"&&!Object.prototype.hasOwnProperty.call(a,s)&&t(a,n,s)};Object.defineProperty(e,"__esModule",{value:!0}),r(commonTypeParser,e),r(nameTools,e),r(tableTransforms,e),r(packageTools,e),r(createBulkInsertStreamBase$1,e),r(createAsyncWriteStream$1,e),r(DatabaseAnalyser$1,e),r(driverBase,e),r(SqlDumper$1,e),r(testPermission$1,e),r(SqlGenerator$1,e),r(structureTools,e),r(settingsExtractors,e),r(filterName$1,e),r(requireDiffTools(),e),r(schemaEditorTools,e),r(yamlModelConv,e),r(stringTools,e),r(computeDiffRows,e),r(preloadedRowsTools,e),r(ScriptWriter$1,e),r(getLogger$1,e)})(lib$5);const index=getDefaultExportFromCjs(lib$5),dbgateTools=_mergeNamespaces({__proto__:null,default:index},[lib$5]);//! moment.js
//! version : 2.29.4
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
var hookCallback;function hooks(){return hookCallback.apply(null,arguments)}function setHookCallback(e){hookCallback=e}function isArray(e){return e instanceof Array||Object.prototype.toString.call(e)==="[object Array]"}function isObject$1(e){return e!=null&&Object.prototype.toString.call(e)==="[object Object]"}function hasOwnProp(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function isObjectEmpty(e){if(Object.getOwnPropertyNames)return Object.getOwnPropertyNames(e).length===0;var t;for(t in e)if(hasOwnProp(e,t))return!1;return!0}function isUndefined(e){return e===void 0}function isNumber(e){return typeof e=="number"||Object.prototype.toString.call(e)==="[object Number]"}function isDate(e){return e instanceof Date||Object.prototype.toString.call(e)==="[object Date]"}function map(e,t){var r=[],n,a=e.length;for(n=0;n<a;++n)r.push(t(e[n],n));return r}function extend(e,t){for(var r in t)hasOwnProp(t,r)&&(e[r]=t[r]);return hasOwnProp(t,"toString")&&(e.toString=t.toString),hasOwnProp(t,"valueOf")&&(e.valueOf=t.valueOf),e}function createUTC(e,t,r,n){return createLocalOrUTC(e,t,r,n,!0).utc()}function defaultParsingFlags(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function getParsingFlags(e){return e._pf==null&&(e._pf=defaultParsingFlags()),e._pf}var some;Array.prototype.some?some=Array.prototype.some:some=function(e){var t=Object(this),r=t.length>>>0,n;for(n=0;n<r;n++)if(n in t&&e.call(this,t[n],n,t))return!0;return!1};function isValid(e){if(e._isValid==null){var t=getParsingFlags(e),r=some.call(t.parsedDateParts,function(a){return a!=null}),n=!isNaN(e._d.getTime())&&t.overflow<0&&!t.empty&&!t.invalidEra&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&r);if(e._strict&&(n=n&&t.charsLeftOver===0&&t.unusedTokens.length===0&&t.bigHour===void 0),Object.isFrozen==null||!Object.isFrozen(e))e._isValid=n;else return n}return e._isValid}function createInvalid(e){var t=createUTC(NaN);return e!=null?extend(getParsingFlags(t),e):getParsingFlags(t).userInvalidated=!0,t}var momentProperties=hooks.momentProperties=[],updateInProgress=!1;function copyConfig(e,t){var r,n,a,s=momentProperties.length;if(isUndefined(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),isUndefined(t._i)||(e._i=t._i),isUndefined(t._f)||(e._f=t._f),isUndefined(t._l)||(e._l=t._l),isUndefined(t._strict)||(e._strict=t._strict),isUndefined(t._tzm)||(e._tzm=t._tzm),isUndefined(t._isUTC)||(e._isUTC=t._isUTC),isUndefined(t._offset)||(e._offset=t._offset),isUndefined(t._pf)||(e._pf=getParsingFlags(t)),isUndefined(t._locale)||(e._locale=t._locale),s>0)for(r=0;r<s;r++)n=momentProperties[r],a=t[n],isUndefined(a)||(e[n]=a);return e}function Moment(e){copyConfig(this,e),this._d=new Date(e._d!=null?e._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),updateInProgress===!1&&(updateInProgress=!0,hooks.updateOffset(this),updateInProgress=!1)}function isMoment(e){return e instanceof Moment||e!=null&&e._isAMomentObject!=null}function warn(e){hooks.suppressDeprecationWarnings===!1&&typeof console<"u"&&console.warn&&console.warn("Deprecation warning: "+e)}function deprecate(e,t){var r=!0;return extend(function(){if(hooks.deprecationHandler!=null&&hooks.deprecationHandler(null,e),r){var n=[],a,s,o,u=arguments.length;for(s=0;s<u;s++){if(a="",typeof arguments[s]=="object"){a+=`
[`+s+"] ";for(o in arguments[0])hasOwnProp(arguments[0],o)&&(a+=o+": "+arguments[0][o]+", ");a=a.slice(0,-2)}else a=arguments[s];n.push(a)}warn(e+`
Arguments: `+Array.prototype.slice.call(n).join("")+`
`+new Error().stack),r=!1}return t.apply(this,arguments)},t)}var deprecations={};function deprecateSimple(e,t){hooks.deprecationHandler!=null&&hooks.deprecationHandler(e,t),deprecations[e]||(warn(t),deprecations[e]=!0)}hooks.suppressDeprecationWarnings=!1;hooks.deprecationHandler=null;function isFunction(e){return typeof Function<"u"&&e instanceof Function||Object.prototype.toString.call(e)==="[object Function]"}function set(e){var t,r;for(r in e)hasOwnProp(e,r)&&(t=e[r],isFunction(t)?this[r]=t:this["_"+r]=t);this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function mergeConfigs(e,t){var r=extend({},e),n;for(n in t)hasOwnProp(t,n)&&(isObject$1(e[n])&&isObject$1(t[n])?(r[n]={},extend(r[n],e[n]),extend(r[n],t[n])):t[n]!=null?r[n]=t[n]:delete r[n]);for(n in e)hasOwnProp(e,n)&&!hasOwnProp(t,n)&&isObject$1(e[n])&&(r[n]=extend({},r[n]));return r}function Locale(e){e!=null&&this.set(e)}var keys;Object.keys?keys=Object.keys:keys=function(e){var t,r=[];for(t in e)hasOwnProp(e,t)&&r.push(t);return r};var defaultCalendar={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function calendar(e,t,r){var n=this._calendar[e]||this._calendar.sameElse;return isFunction(n)?n.call(t,r):n}function zeroFill(e,t,r){var n=""+Math.abs(e),a=t-n.length,s=e>=0;return(s?r?"+":"":"-")+Math.pow(10,Math.max(0,a)).toString().substr(1)+n}var formattingTokens=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,localFormattingTokens=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,formatFunctions={},formatTokenFunctions={};function addFormatToken(e,t,r,n){var a=n;typeof n=="string"&&(a=function(){return this[n]()}),e&&(formatTokenFunctions[e]=a),t&&(formatTokenFunctions[t[0]]=function(){return zeroFill(a.apply(this,arguments),t[1],t[2])}),r&&(formatTokenFunctions[r]=function(){return this.localeData().ordinal(a.apply(this,arguments),e)})}function removeFormattingTokens(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function makeFormatFunction(e){var t=e.match(formattingTokens),r,n;for(r=0,n=t.length;r<n;r++)formatTokenFunctions[t[r]]?t[r]=formatTokenFunctions[t[r]]:t[r]=removeFormattingTokens(t[r]);return function(a){var s="",o;for(o=0;o<n;o++)s+=isFunction(t[o])?t[o].call(a,e):t[o];return s}}function formatMoment(e,t){return e.isValid()?(t=expandFormat(t,e.localeData()),formatFunctions[t]=formatFunctions[t]||makeFormatFunction(t),formatFunctions[t](e)):e.localeData().invalidDate()}function expandFormat(e,t){var r=5;function n(a){return t.longDateFormat(a)||a}for(localFormattingTokens.lastIndex=0;r>=0&&localFormattingTokens.test(e);)e=e.replace(localFormattingTokens,n),localFormattingTokens.lastIndex=0,r-=1;return e}var defaultLongDateFormat={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function longDateFormat(e){var t=this._longDateFormat[e],r=this._longDateFormat[e.toUpperCase()];return t||!r?t:(this._longDateFormat[e]=r.match(formattingTokens).map(function(n){return n==="MMMM"||n==="MM"||n==="DD"||n==="dddd"?n.slice(1):n}).join(""),this._longDateFormat[e])}var defaultInvalidDate="Invalid date";function invalidDate(){return this._invalidDate}var defaultOrdinal="%d",defaultDayOfMonthOrdinalParse=/\d{1,2}/;function ordinal(e){return this._ordinal.replace("%d",e)}var defaultRelativeTime={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function relativeTime(e,t,r,n){var a=this._relativeTime[r];return isFunction(a)?a(e,t,r,n):a.replace(/%d/i,e)}function pastFuture(e,t){var r=this._relativeTime[e>0?"future":"past"];return isFunction(r)?r(t):r.replace(/%s/i,t)}var aliases={};function addUnitAlias(e,t){var r=e.toLowerCase();aliases[r]=aliases[r+"s"]=aliases[t]=e}function normalizeUnits(e){return typeof e=="string"?aliases[e]||aliases[e.toLowerCase()]:void 0}function normalizeObjectUnits(e){var t={},r,n;for(n in e)hasOwnProp(e,n)&&(r=normalizeUnits(n),r&&(t[r]=e[n]));return t}var priorities={};function addUnitPriority(e,t){priorities[e]=t}function getPrioritizedUnits(e){var t=[],r;for(r in e)hasOwnProp(e,r)&&t.push({unit:r,priority:priorities[r]});return t.sort(function(n,a){return n.priority-a.priority}),t}function isLeapYear(e){return e%4===0&&e%100!==0||e%400===0}function absFloor(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function toInt(e){var t=+e,r=0;return t!==0&&isFinite(t)&&(r=absFloor(t)),r}function makeGetSet(e,t){return function(r){return r!=null?(set$1(this,e,r),hooks.updateOffset(this,t),this):get(this,e)}}function get(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function set$1(e,t,r){e.isValid()&&!isNaN(r)&&(t==="FullYear"&&isLeapYear(e.year())&&e.month()===1&&e.date()===29?(r=toInt(r),e._d["set"+(e._isUTC?"UTC":"")+t](r,e.month(),daysInMonth(r,e.month()))):e._d["set"+(e._isUTC?"UTC":"")+t](r))}function stringGet(e){return e=normalizeUnits(e),isFunction(this[e])?this[e]():this}function stringSet(e,t){if(typeof e=="object"){e=normalizeObjectUnits(e);var r=getPrioritizedUnits(e),n,a=r.length;for(n=0;n<a;n++)this[r[n].unit](e[r[n].unit])}else if(e=normalizeUnits(e),isFunction(this[e]))return this[e](t);return this}var match1=/\d/,match2=/\d\d/,match3=/\d{3}/,match4=/\d{4}/,match6=/[+-]?\d{6}/,match1to2=/\d\d?/,match3to4=/\d\d\d\d?/,match5to6=/\d\d\d\d\d\d?/,match1to3=/\d{1,3}/,match1to4=/\d{1,4}/,match1to6=/[+-]?\d{1,6}/,matchUnsigned=/\d+/,matchSigned=/[+-]?\d+/,matchOffset=/Z|[+-]\d\d:?\d\d/gi,matchShortOffset=/Z|[+-]\d\d(?::?\d\d)?/gi,matchTimestamp=/[+-]?\d+(\.\d{1,3})?/,matchWord=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,regexes;regexes={};function addRegexToken(e,t,r){regexes[e]=isFunction(t)?t:function(n,a){return n&&r?r:t}}function getParseRegexForToken(e,t){return hasOwnProp(regexes,e)?regexes[e](t._strict,t._locale):new RegExp(unescapeFormat(e))}function unescapeFormat(e){return regexEscape(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(t,r,n,a,s){return r||n||a||s}))}function regexEscape(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var tokens={};function addParseToken(e,t){var r,n=t,a;for(typeof e=="string"&&(e=[e]),isNumber(t)&&(n=function(s,o){o[t]=toInt(s)}),a=e.length,r=0;r<a;r++)tokens[e[r]]=n}function addWeekParseToken(e,t){addParseToken(e,function(r,n,a,s){a._w=a._w||{},t(r,a._w,a,s)})}function addTimeToArrayFromToken(e,t,r){t!=null&&hasOwnProp(tokens,e)&&tokens[e](t,r._a,r,e)}var YEAR=0,MONTH=1,DATE=2,HOUR=3,MINUTE=4,SECOND=5,MILLISECOND=6,WEEK=7,WEEKDAY=8;function mod(e,t){return(e%t+t)%t}var indexOf;Array.prototype.indexOf?indexOf=Array.prototype.indexOf:indexOf=function(e){var t;for(t=0;t<this.length;++t)if(this[t]===e)return t;return-1};function daysInMonth(e,t){if(isNaN(e)||isNaN(t))return NaN;var r=mod(t,12);return e+=(t-r)/12,r===1?isLeapYear(e)?29:28:31-r%7%2}addFormatToken("M",["MM",2],"Mo",function(){return this.month()+1});addFormatToken("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)});addFormatToken("MMMM",0,0,function(e){return this.localeData().months(this,e)});addUnitAlias("month","M");addUnitPriority("month",8);addRegexToken("M",match1to2);addRegexToken("MM",match1to2,match2);addRegexToken("MMM",function(e,t){return t.monthsShortRegex(e)});addRegexToken("MMMM",function(e,t){return t.monthsRegex(e)});addParseToken(["M","MM"],function(e,t){t[MONTH]=toInt(e)-1});addParseToken(["MMM","MMMM"],function(e,t,r,n){var a=r._locale.monthsParse(e,n,r._strict);a!=null?t[MONTH]=a:getParsingFlags(r).invalidMonth=e});var defaultLocaleMonths="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),defaultLocaleMonthsShort="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),MONTHS_IN_FORMAT=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,defaultMonthsShortRegex=matchWord,defaultMonthsRegex=matchWord;function localeMonths(e,t){return e?isArray(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||MONTHS_IN_FORMAT).test(t)?"format":"standalone"][e.month()]:isArray(this._months)?this._months:this._months.standalone}function localeMonthsShort(e,t){return e?isArray(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[MONTHS_IN_FORMAT.test(t)?"format":"standalone"][e.month()]:isArray(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function handleStrictParse(e,t,r){var n,a,s,o=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],n=0;n<12;++n)s=createUTC([2e3,n]),this._shortMonthsParse[n]=this.monthsShort(s,"").toLocaleLowerCase(),this._longMonthsParse[n]=this.months(s,"").toLocaleLowerCase();return r?t==="MMM"?(a=indexOf.call(this._shortMonthsParse,o),a!==-1?a:null):(a=indexOf.call(this._longMonthsParse,o),a!==-1?a:null):t==="MMM"?(a=indexOf.call(this._shortMonthsParse,o),a!==-1?a:(a=indexOf.call(this._longMonthsParse,o),a!==-1?a:null)):(a=indexOf.call(this._longMonthsParse,o),a!==-1?a:(a=indexOf.call(this._shortMonthsParse,o),a!==-1?a:null))}function localeMonthsParse(e,t,r){var n,a,s;if(this._monthsParseExact)return handleStrictParse.call(this,e,t,r);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),n=0;n<12;n++){if(a=createUTC([2e3,n]),r&&!this._longMonthsParse[n]&&(this._longMonthsParse[n]=new RegExp("^"+this.months(a,"").replace(".","")+"$","i"),this._shortMonthsParse[n]=new RegExp("^"+this.monthsShort(a,"").replace(".","")+"$","i")),!r&&!this._monthsParse[n]&&(s="^"+this.months(a,"")+"|^"+this.monthsShort(a,""),this._monthsParse[n]=new RegExp(s.replace(".",""),"i")),r&&t==="MMMM"&&this._longMonthsParse[n].test(e))return n;if(r&&t==="MMM"&&this._shortMonthsParse[n].test(e))return n;if(!r&&this._monthsParse[n].test(e))return n}}function setMonth(e,t){var r;if(!e.isValid())return e;if(typeof t=="string"){if(/^\d+$/.test(t))t=toInt(t);else if(t=e.localeData().monthsParse(t),!isNumber(t))return e}return r=Math.min(e.date(),daysInMonth(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,r),e}function getSetMonth(e){return e!=null?(setMonth(this,e),hooks.updateOffset(this,!0),this):get(this,"Month")}function getDaysInMonth(){return daysInMonth(this.year(),this.month())}function monthsShortRegex(e){return this._monthsParseExact?(hasOwnProp(this,"_monthsRegex")||computeMonthsParse.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(hasOwnProp(this,"_monthsShortRegex")||(this._monthsShortRegex=defaultMonthsShortRegex),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)}function monthsRegex(e){return this._monthsParseExact?(hasOwnProp(this,"_monthsRegex")||computeMonthsParse.call(this),e?this._monthsStrictRegex:this._monthsRegex):(hasOwnProp(this,"_monthsRegex")||(this._monthsRegex=defaultMonthsRegex),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)}function computeMonthsParse(){function e(o,u){return u.length-o.length}var t=[],r=[],n=[],a,s;for(a=0;a<12;a++)s=createUTC([2e3,a]),t.push(this.monthsShort(s,"")),r.push(this.months(s,"")),n.push(this.months(s,"")),n.push(this.monthsShort(s,""));for(t.sort(e),r.sort(e),n.sort(e),a=0;a<12;a++)t[a]=regexEscape(t[a]),r[a]=regexEscape(r[a]);for(a=0;a<24;a++)n[a]=regexEscape(n[a]);this._monthsRegex=new RegExp("^("+n.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+r.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+t.join("|")+")","i")}addFormatToken("Y",0,0,function(){var e=this.year();return e<=9999?zeroFill(e,4):"+"+e});addFormatToken(0,["YY",2],0,function(){return this.year()%100});addFormatToken(0,["YYYY",4],0,"year");addFormatToken(0,["YYYYY",5],0,"year");addFormatToken(0,["YYYYYY",6,!0],0,"year");addUnitAlias("year","y");addUnitPriority("year",1);addRegexToken("Y",matchSigned);addRegexToken("YY",match1to2,match2);addRegexToken("YYYY",match1to4,match4);addRegexToken("YYYYY",match1to6,match6);addRegexToken("YYYYYY",match1to6,match6);addParseToken(["YYYYY","YYYYYY"],YEAR);addParseToken("YYYY",function(e,t){t[YEAR]=e.length===2?hooks.parseTwoDigitYear(e):toInt(e)});addParseToken("YY",function(e,t){t[YEAR]=hooks.parseTwoDigitYear(e)});addParseToken("Y",function(e,t){t[YEAR]=parseInt(e,10)});function daysInYear(e){return isLeapYear(e)?366:365}hooks.parseTwoDigitYear=function(e){return toInt(e)+(toInt(e)>68?1900:2e3)};var getSetYear=makeGetSet("FullYear",!0);function getIsLeapYear(){return isLeapYear(this.year())}function createDate(e,t,r,n,a,s,o){var u;return e<100&&e>=0?(u=new Date(e+400,t,r,n,a,s,o),isFinite(u.getFullYear())&&u.setFullYear(e)):u=new Date(e,t,r,n,a,s,o),u}function createUTCDate(e){var t,r;return e<100&&e>=0?(r=Array.prototype.slice.call(arguments),r[0]=e+400,t=new Date(Date.UTC.apply(null,r)),isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e)):t=new Date(Date.UTC.apply(null,arguments)),t}function firstWeekOffset(e,t,r){var n=7+t-r,a=(7+createUTCDate(e,0,n).getUTCDay()-t)%7;return-a+n-1}function dayOfYearFromWeeks(e,t,r,n,a){var s=(7+r-n)%7,o=firstWeekOffset(e,n,a),u=1+7*(t-1)+s+o,l,c;return u<=0?(l=e-1,c=daysInYear(l)+u):u>daysInYear(e)?(l=e+1,c=u-daysInYear(e)):(l=e,c=u),{year:l,dayOfYear:c}}function weekOfYear(e,t,r){var n=firstWeekOffset(e.year(),t,r),a=Math.floor((e.dayOfYear()-n-1)/7)+1,s,o;return a<1?(o=e.year()-1,s=a+weeksInYear(o,t,r)):a>weeksInYear(e.year(),t,r)?(s=a-weeksInYear(e.year(),t,r),o=e.year()+1):(o=e.year(),s=a),{week:s,year:o}}function weeksInYear(e,t,r){var n=firstWeekOffset(e,t,r),a=firstWeekOffset(e+1,t,r);return(daysInYear(e)-n+a)/7}addFormatToken("w",["ww",2],"wo","week");addFormatToken("W",["WW",2],"Wo","isoWeek");addUnitAlias("week","w");addUnitAlias("isoWeek","W");addUnitPriority("week",5);addUnitPriority("isoWeek",5);addRegexToken("w",match1to2);addRegexToken("ww",match1to2,match2);addRegexToken("W",match1to2);addRegexToken("WW",match1to2,match2);addWeekParseToken(["w","ww","W","WW"],function(e,t,r,n){t[n.substr(0,1)]=toInt(e)});function localeWeek(e){return weekOfYear(e,this._week.dow,this._week.doy).week}var defaultLocaleWeek={dow:0,doy:6};function localeFirstDayOfWeek(){return this._week.dow}function localeFirstDayOfYear(){return this._week.doy}function getSetWeek(e){var t=this.localeData().week(this);return e==null?t:this.add((e-t)*7,"d")}function getSetISOWeek(e){var t=weekOfYear(this,1,4).week;return e==null?t:this.add((e-t)*7,"d")}addFormatToken("d",0,"do","day");addFormatToken("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)});addFormatToken("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)});addFormatToken("dddd",0,0,function(e){return this.localeData().weekdays(this,e)});addFormatToken("e",0,0,"weekday");addFormatToken("E",0,0,"isoWeekday");addUnitAlias("day","d");addUnitAlias("weekday","e");addUnitAlias("isoWeekday","E");addUnitPriority("day",11);addUnitPriority("weekday",11);addUnitPriority("isoWeekday",11);addRegexToken("d",match1to2);addRegexToken("e",match1to2);addRegexToken("E",match1to2);addRegexToken("dd",function(e,t){return t.weekdaysMinRegex(e)});addRegexToken("ddd",function(e,t){return t.weekdaysShortRegex(e)});addRegexToken("dddd",function(e,t){return t.weekdaysRegex(e)});addWeekParseToken(["dd","ddd","dddd"],function(e,t,r,n){var a=r._locale.weekdaysParse(e,n,r._strict);a!=null?t.d=a:getParsingFlags(r).invalidWeekday=e});addWeekParseToken(["d","e","E"],function(e,t,r,n){t[n]=toInt(e)});function parseWeekday(e,t){return typeof e!="string"?e:isNaN(e)?(e=t.weekdaysParse(e),typeof e=="number"?e:null):parseInt(e,10)}function parseIsoWeekday(e,t){return typeof e=="string"?t.weekdaysParse(e)%7||7:isNaN(e)?null:e}function shiftWeekdays(e,t){return e.slice(t,7).concat(e.slice(0,t))}var defaultLocaleWeekdays="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),defaultLocaleWeekdaysShort="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),defaultLocaleWeekdaysMin="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),defaultWeekdaysRegex=matchWord,defaultWeekdaysShortRegex=matchWord,defaultWeekdaysMinRegex=matchWord;function localeWeekdays(e,t){var r=isArray(this._weekdays)?this._weekdays:this._weekdays[e&&e!==!0&&this._weekdays.isFormat.test(t)?"format":"standalone"];return e===!0?shiftWeekdays(r,this._week.dow):e?r[e.day()]:r}function localeWeekdaysShort(e){return e===!0?shiftWeekdays(this._weekdaysShort,this._week.dow):e?this._weekdaysShort[e.day()]:this._weekdaysShort}function localeWeekdaysMin(e){return e===!0?shiftWeekdays(this._weekdaysMin,this._week.dow):e?this._weekdaysMin[e.day()]:this._weekdaysMin}function handleStrictParse$1(e,t,r){var n,a,s,o=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],n=0;n<7;++n)s=createUTC([2e3,1]).day(n),this._minWeekdaysParse[n]=this.weekdaysMin(s,"").toLocaleLowerCase(),this._shortWeekdaysParse[n]=this.weekdaysShort(s,"").toLocaleLowerCase(),this._weekdaysParse[n]=this.weekdays(s,"").toLocaleLowerCase();return r?t==="dddd"?(a=indexOf.call(this._weekdaysParse,o),a!==-1?a:null):t==="ddd"?(a=indexOf.call(this._shortWeekdaysParse,o),a!==-1?a:null):(a=indexOf.call(this._minWeekdaysParse,o),a!==-1?a:null):t==="dddd"?(a=indexOf.call(this._weekdaysParse,o),a!==-1||(a=indexOf.call(this._shortWeekdaysParse,o),a!==-1)?a:(a=indexOf.call(this._minWeekdaysParse,o),a!==-1?a:null)):t==="ddd"?(a=indexOf.call(this._shortWeekdaysParse,o),a!==-1||(a=indexOf.call(this._weekdaysParse,o),a!==-1)?a:(a=indexOf.call(this._minWeekdaysParse,o),a!==-1?a:null)):(a=indexOf.call(this._minWeekdaysParse,o),a!==-1||(a=indexOf.call(this._weekdaysParse,o),a!==-1)?a:(a=indexOf.call(this._shortWeekdaysParse,o),a!==-1?a:null))}function localeWeekdaysParse(e,t,r){var n,a,s;if(this._weekdaysParseExact)return handleStrictParse$1.call(this,e,t,r);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),n=0;n<7;n++){if(a=createUTC([2e3,1]).day(n),r&&!this._fullWeekdaysParse[n]&&(this._fullWeekdaysParse[n]=new RegExp("^"+this.weekdays(a,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[n]=new RegExp("^"+this.weekdaysShort(a,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[n]=new RegExp("^"+this.weekdaysMin(a,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[n]||(s="^"+this.weekdays(a,"")+"|^"+this.weekdaysShort(a,"")+"|^"+this.weekdaysMin(a,""),this._weekdaysParse[n]=new RegExp(s.replace(".",""),"i")),r&&t==="dddd"&&this._fullWeekdaysParse[n].test(e))return n;if(r&&t==="ddd"&&this._shortWeekdaysParse[n].test(e))return n;if(r&&t==="dd"&&this._minWeekdaysParse[n].test(e))return n;if(!r&&this._weekdaysParse[n].test(e))return n}}function getSetDayOfWeek(e){if(!this.isValid())return e!=null?this:NaN;var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return e!=null?(e=parseWeekday(e,this.localeData()),this.add(e-t,"d")):t}function getSetLocaleDayOfWeek(e){if(!this.isValid())return e!=null?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return e==null?t:this.add(e-t,"d")}function getSetISODayOfWeek(e){if(!this.isValid())return e!=null?this:NaN;if(e!=null){var t=parseIsoWeekday(e,this.localeData());return this.day(this.day()%7?t:t-7)}else return this.day()||7}function weekdaysRegex(e){return this._weekdaysParseExact?(hasOwnProp(this,"_weekdaysRegex")||computeWeekdaysParse.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(hasOwnProp(this,"_weekdaysRegex")||(this._weekdaysRegex=defaultWeekdaysRegex),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)}function weekdaysShortRegex(e){return this._weekdaysParseExact?(hasOwnProp(this,"_weekdaysRegex")||computeWeekdaysParse.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(hasOwnProp(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=defaultWeekdaysShortRegex),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function weekdaysMinRegex(e){return this._weekdaysParseExact?(hasOwnProp(this,"_weekdaysRegex")||computeWeekdaysParse.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(hasOwnProp(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=defaultWeekdaysMinRegex),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function computeWeekdaysParse(){function e(d,f){return f.length-d.length}var t=[],r=[],n=[],a=[],s,o,u,l,c;for(s=0;s<7;s++)o=createUTC([2e3,1]).day(s),u=regexEscape(this.weekdaysMin(o,"")),l=regexEscape(this.weekdaysShort(o,"")),c=regexEscape(this.weekdays(o,"")),t.push(u),r.push(l),n.push(c),a.push(u),a.push(l),a.push(c);t.sort(e),r.sort(e),n.sort(e),a.sort(e),this._weekdaysRegex=new RegExp("^("+a.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+n.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+r.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+t.join("|")+")","i")}function hFormat(){return this.hours()%12||12}function kFormat(){return this.hours()||24}addFormatToken("H",["HH",2],0,"hour");addFormatToken("h",["hh",2],0,hFormat);addFormatToken("k",["kk",2],0,kFormat);addFormatToken("hmm",0,0,function(){return""+hFormat.apply(this)+zeroFill(this.minutes(),2)});addFormatToken("hmmss",0,0,function(){return""+hFormat.apply(this)+zeroFill(this.minutes(),2)+zeroFill(this.seconds(),2)});addFormatToken("Hmm",0,0,function(){return""+this.hours()+zeroFill(this.minutes(),2)});addFormatToken("Hmmss",0,0,function(){return""+this.hours()+zeroFill(this.minutes(),2)+zeroFill(this.seconds(),2)});function meridiem(e,t){addFormatToken(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}meridiem("a",!0);meridiem("A",!1);addUnitAlias("hour","h");addUnitPriority("hour",13);function matchMeridiem(e,t){return t._meridiemParse}addRegexToken("a",matchMeridiem);addRegexToken("A",matchMeridiem);addRegexToken("H",match1to2);addRegexToken("h",match1to2);addRegexToken("k",match1to2);addRegexToken("HH",match1to2,match2);addRegexToken("hh",match1to2,match2);addRegexToken("kk",match1to2,match2);addRegexToken("hmm",match3to4);addRegexToken("hmmss",match5to6);addRegexToken("Hmm",match3to4);addRegexToken("Hmmss",match5to6);addParseToken(["H","HH"],HOUR);addParseToken(["k","kk"],function(e,t,r){var n=toInt(e);t[HOUR]=n===24?0:n});addParseToken(["a","A"],function(e,t,r){r._isPm=r._locale.isPM(e),r._meridiem=e});addParseToken(["h","hh"],function(e,t,r){t[HOUR]=toInt(e),getParsingFlags(r).bigHour=!0});addParseToken("hmm",function(e,t,r){var n=e.length-2;t[HOUR]=toInt(e.substr(0,n)),t[MINUTE]=toInt(e.substr(n)),getParsingFlags(r).bigHour=!0});addParseToken("hmmss",function(e,t,r){var n=e.length-4,a=e.length-2;t[HOUR]=toInt(e.substr(0,n)),t[MINUTE]=toInt(e.substr(n,2)),t[SECOND]=toInt(e.substr(a)),getParsingFlags(r).bigHour=!0});addParseToken("Hmm",function(e,t,r){var n=e.length-2;t[HOUR]=toInt(e.substr(0,n)),t[MINUTE]=toInt(e.substr(n))});addParseToken("Hmmss",function(e,t,r){var n=e.length-4,a=e.length-2;t[HOUR]=toInt(e.substr(0,n)),t[MINUTE]=toInt(e.substr(n,2)),t[SECOND]=toInt(e.substr(a))});function localeIsPM(e){return(e+"").toLowerCase().charAt(0)==="p"}var defaultLocaleMeridiemParse=/[ap]\.?m?\.?/i,getSetHour=makeGetSet("Hours",!0);function localeMeridiem(e,t,r){return e>11?r?"pm":"PM":r?"am":"AM"}var baseConfig={calendar:defaultCalendar,longDateFormat:defaultLongDateFormat,invalidDate:defaultInvalidDate,ordinal:defaultOrdinal,dayOfMonthOrdinalParse:defaultDayOfMonthOrdinalParse,relativeTime:defaultRelativeTime,months:defaultLocaleMonths,monthsShort:defaultLocaleMonthsShort,week:defaultLocaleWeek,weekdays:defaultLocaleWeekdays,weekdaysMin:defaultLocaleWeekdaysMin,weekdaysShort:defaultLocaleWeekdaysShort,meridiemParse:defaultLocaleMeridiemParse},locales={},localeFamilies={},globalLocale;function commonPrefix(e,t){var r,n=Math.min(e.length,t.length);for(r=0;r<n;r+=1)if(e[r]!==t[r])return r;return n}function normalizeLocale(e){return e&&e.toLowerCase().replace("_","-")}function chooseLocale(e){for(var t=0,r,n,a,s;t<e.length;){for(s=normalizeLocale(e[t]).split("-"),r=s.length,n=normalizeLocale(e[t+1]),n=n?n.split("-"):null;r>0;){if(a=loadLocale(s.slice(0,r).join("-")),a)return a;if(n&&n.length>=r&&commonPrefix(s,n)>=r-1)break;r--}t++}return globalLocale}function isLocaleNameSane(e){return e.match("^[^/\\\\]*$")!=null}function loadLocale(e){var t=null,r;if(locales[e]===void 0&&typeof module<"u"&&module&&module.exports&&isLocaleNameSane(e))try{t=globalLocale._abbr,r=require,r("./locale/"+e),getSetGlobalLocale(t)}catch{locales[e]=null}return locales[e]}function getSetGlobalLocale(e,t){var r;return e&&(isUndefined(t)?r=getLocale(e):r=defineLocale(e,t),r?globalLocale=r:typeof console<"u"&&console.warn&&console.warn("Locale "+e+" not found. Did you forget to load it?")),globalLocale._abbr}function defineLocale(e,t){if(t!==null){var r,n=baseConfig;if(t.abbr=e,locales[e]!=null)deprecateSimple("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),n=locales[e]._config;else if(t.parentLocale!=null)if(locales[t.parentLocale]!=null)n=locales[t.parentLocale]._config;else if(r=loadLocale(t.parentLocale),r!=null)n=r._config;else return localeFamilies[t.parentLocale]||(localeFamilies[t.parentLocale]=[]),localeFamilies[t.parentLocale].push({name:e,config:t}),null;return locales[e]=new Locale(mergeConfigs(n,t)),localeFamilies[e]&&localeFamilies[e].forEach(function(a){defineLocale(a.name,a.config)}),getSetGlobalLocale(e),locales[e]}else return delete locales[e],null}function updateLocale(e,t){if(t!=null){var r,n,a=baseConfig;locales[e]!=null&&locales[e].parentLocale!=null?locales[e].set(mergeConfigs(locales[e]._config,t)):(n=loadLocale(e),n!=null&&(a=n._config),t=mergeConfigs(a,t),n==null&&(t.abbr=e),r=new Locale(t),r.parentLocale=locales[e],locales[e]=r),getSetGlobalLocale(e)}else locales[e]!=null&&(locales[e].parentLocale!=null?(locales[e]=locales[e].parentLocale,e===getSetGlobalLocale()&&getSetGlobalLocale(e)):locales[e]!=null&&delete locales[e]);return locales[e]}function getLocale(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return globalLocale;if(!isArray(e)){if(t=loadLocale(e),t)return t;e=[e]}return chooseLocale(e)}function listLocales(){return keys(locales)}function checkOverflow(e){var t,r=e._a;return r&&getParsingFlags(e).overflow===-2&&(t=r[MONTH]<0||r[MONTH]>11?MONTH:r[DATE]<1||r[DATE]>daysInMonth(r[YEAR],r[MONTH])?DATE:r[HOUR]<0||r[HOUR]>24||r[HOUR]===24&&(r[MINUTE]!==0||r[SECOND]!==0||r[MILLISECOND]!==0)?HOUR:r[MINUTE]<0||r[MINUTE]>59?MINUTE:r[SECOND]<0||r[SECOND]>59?SECOND:r[MILLISECOND]<0||r[MILLISECOND]>999?MILLISECOND:-1,getParsingFlags(e)._overflowDayOfYear&&(t<YEAR||t>DATE)&&(t=DATE),getParsingFlags(e)._overflowWeeks&&t===-1&&(t=WEEK),getParsingFlags(e)._overflowWeekday&&t===-1&&(t=WEEKDAY),getParsingFlags(e).overflow=t),e}var extendedIsoRegex=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,basicIsoRegex=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,tzRegex=/Z|[+-]\d\d(?::?\d\d)?/,isoDates=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],isoTimes=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],aspNetJsonRegex=/^\/?Date\((-?\d+)/i,rfc2822=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,obsOffsets={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function configFromISO(e){var t,r,n=e._i,a=extendedIsoRegex.exec(n)||basicIsoRegex.exec(n),s,o,u,l,c=isoDates.length,d=isoTimes.length;if(a){for(getParsingFlags(e).iso=!0,t=0,r=c;t<r;t++)if(isoDates[t][1].exec(a[1])){o=isoDates[t][0],s=isoDates[t][2]!==!1;break}if(o==null){e._isValid=!1;return}if(a[3]){for(t=0,r=d;t<r;t++)if(isoTimes[t][1].exec(a[3])){u=(a[2]||" ")+isoTimes[t][0];break}if(u==null){e._isValid=!1;return}}if(!s&&u!=null){e._isValid=!1;return}if(a[4])if(tzRegex.exec(a[4]))l="Z";else{e._isValid=!1;return}e._f=o+(u||"")+(l||""),configFromStringAndFormat(e)}else e._isValid=!1}function extractFromRFC2822Strings(e,t,r,n,a,s){var o=[untruncateYear(e),defaultLocaleMonthsShort.indexOf(t),parseInt(r,10),parseInt(n,10),parseInt(a,10)];return s&&o.push(parseInt(s,10)),o}function untruncateYear(e){var t=parseInt(e,10);return t<=49?2e3+t:t<=999?1900+t:t}function preprocessRFC2822(e){return e.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function checkWeekday(e,t,r){if(e){var n=defaultLocaleWeekdaysShort.indexOf(e),a=new Date(t[0],t[1],t[2]).getDay();if(n!==a)return getParsingFlags(r).weekdayMismatch=!0,r._isValid=!1,!1}return!0}function calculateOffset(e,t,r){if(e)return obsOffsets[e];if(t)return 0;var n=parseInt(r,10),a=n%100,s=(n-a)/100;return s*60+a}function configFromRFC2822(e){var t=rfc2822.exec(preprocessRFC2822(e._i)),r;if(t){if(r=extractFromRFC2822Strings(t[4],t[3],t[2],t[5],t[6],t[7]),!checkWeekday(t[1],r,e))return;e._a=r,e._tzm=calculateOffset(t[8],t[9],t[10]),e._d=createUTCDate.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),getParsingFlags(e).rfc2822=!0}else e._isValid=!1}function configFromString(e){var t=aspNetJsonRegex.exec(e._i);if(t!==null){e._d=new Date(+t[1]);return}if(configFromISO(e),e._isValid===!1)delete e._isValid;else return;if(configFromRFC2822(e),e._isValid===!1)delete e._isValid;else return;e._strict?e._isValid=!1:hooks.createFromInputFallback(e)}hooks.createFromInputFallback=deprecate("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))});function defaults(e,t,r){return e??t??r}function currentDateArray(e){var t=new Date(hooks.now());return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function configFromArray(e){var t,r,n=[],a,s,o;if(!e._d){for(a=currentDateArray(e),e._w&&e._a[DATE]==null&&e._a[MONTH]==null&&dayOfYearFromWeekInfo(e),e._dayOfYear!=null&&(o=defaults(e._a[YEAR],a[YEAR]),(e._dayOfYear>daysInYear(o)||e._dayOfYear===0)&&(getParsingFlags(e)._overflowDayOfYear=!0),r=createUTCDate(o,0,e._dayOfYear),e._a[MONTH]=r.getUTCMonth(),e._a[DATE]=r.getUTCDate()),t=0;t<3&&e._a[t]==null;++t)e._a[t]=n[t]=a[t];for(;t<7;t++)e._a[t]=n[t]=e._a[t]==null?t===2?1:0:e._a[t];e._a[HOUR]===24&&e._a[MINUTE]===0&&e._a[SECOND]===0&&e._a[MILLISECOND]===0&&(e._nextDay=!0,e._a[HOUR]=0),e._d=(e._useUTC?createUTCDate:createDate).apply(null,n),s=e._useUTC?e._d.getUTCDay():e._d.getDay(),e._tzm!=null&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[HOUR]=24),e._w&&typeof e._w.d<"u"&&e._w.d!==s&&(getParsingFlags(e).weekdayMismatch=!0)}}function dayOfYearFromWeekInfo(e){var t,r,n,a,s,o,u,l,c;t=e._w,t.GG!=null||t.W!=null||t.E!=null?(s=1,o=4,r=defaults(t.GG,e._a[YEAR],weekOfYear(createLocal(),1,4).year),n=defaults(t.W,1),a=defaults(t.E,1),(a<1||a>7)&&(l=!0)):(s=e._locale._week.dow,o=e._locale._week.doy,c=weekOfYear(createLocal(),s,o),r=defaults(t.gg,e._a[YEAR],c.year),n=defaults(t.w,c.week),t.d!=null?(a=t.d,(a<0||a>6)&&(l=!0)):t.e!=null?(a=t.e+s,(t.e<0||t.e>6)&&(l=!0)):a=s),n<1||n>weeksInYear(r,s,o)?getParsingFlags(e)._overflowWeeks=!0:l!=null?getParsingFlags(e)._overflowWeekday=!0:(u=dayOfYearFromWeeks(r,n,a,s,o),e._a[YEAR]=u.year,e._dayOfYear=u.dayOfYear)}hooks.ISO_8601=function(){};hooks.RFC_2822=function(){};function configFromStringAndFormat(e){if(e._f===hooks.ISO_8601){configFromISO(e);return}if(e._f===hooks.RFC_2822){configFromRFC2822(e);return}e._a=[],getParsingFlags(e).empty=!0;var t=""+e._i,r,n,a,s,o,u=t.length,l=0,c,d;for(a=expandFormat(e._f,e._locale).match(formattingTokens)||[],d=a.length,r=0;r<d;r++)s=a[r],n=(t.match(getParseRegexForToken(s,e))||[])[0],n&&(o=t.substr(0,t.indexOf(n)),o.length>0&&getParsingFlags(e).unusedInput.push(o),t=t.slice(t.indexOf(n)+n.length),l+=n.length),formatTokenFunctions[s]?(n?getParsingFlags(e).empty=!1:getParsingFlags(e).unusedTokens.push(s),addTimeToArrayFromToken(s,n,e)):e._strict&&!n&&getParsingFlags(e).unusedTokens.push(s);getParsingFlags(e).charsLeftOver=u-l,t.length>0&&getParsingFlags(e).unusedInput.push(t),e._a[HOUR]<=12&&getParsingFlags(e).bigHour===!0&&e._a[HOUR]>0&&(getParsingFlags(e).bigHour=void 0),getParsingFlags(e).parsedDateParts=e._a.slice(0),getParsingFlags(e).meridiem=e._meridiem,e._a[HOUR]=meridiemFixWrap(e._locale,e._a[HOUR],e._meridiem),c=getParsingFlags(e).era,c!==null&&(e._a[YEAR]=e._locale.erasConvertYear(c,e._a[YEAR])),configFromArray(e),checkOverflow(e)}function meridiemFixWrap(e,t,r){var n;return r==null?t:e.meridiemHour!=null?e.meridiemHour(t,r):(e.isPM!=null&&(n=e.isPM(r),n&&t<12&&(t+=12),!n&&t===12&&(t=0)),t)}function configFromStringAndArray(e){var t,r,n,a,s,o,u=!1,l=e._f.length;if(l===0){getParsingFlags(e).invalidFormat=!0,e._d=new Date(NaN);return}for(a=0;a<l;a++)s=0,o=!1,t=copyConfig({},e),e._useUTC!=null&&(t._useUTC=e._useUTC),t._f=e._f[a],configFromStringAndFormat(t),isValid(t)&&(o=!0),s+=getParsingFlags(t).charsLeftOver,s+=getParsingFlags(t).unusedTokens.length*10,getParsingFlags(t).score=s,u?s<n&&(n=s,r=t):(n==null||s<n||o)&&(n=s,r=t,o&&(u=!0));extend(e,r||t)}function configFromObject(e){if(!e._d){var t=normalizeObjectUnits(e._i),r=t.day===void 0?t.date:t.day;e._a=map([t.year,t.month,r,t.hour,t.minute,t.second,t.millisecond],function(n){return n&&parseInt(n,10)}),configFromArray(e)}}function createFromConfig(e){var t=new Moment(checkOverflow(prepareConfig(e)));return t._nextDay&&(t.add(1,"d"),t._nextDay=void 0),t}function prepareConfig(e){var t=e._i,r=e._f;return e._locale=e._locale||getLocale(e._l),t===null||r===void 0&&t===""?createInvalid({nullInput:!0}):(typeof t=="string"&&(e._i=t=e._locale.preparse(t)),isMoment(t)?new Moment(checkOverflow(t)):(isDate(t)?e._d=t:isArray(r)?configFromStringAndArray(e):r?configFromStringAndFormat(e):configFromInput(e),isValid(e)||(e._d=null),e))}function configFromInput(e){var t=e._i;isUndefined(t)?e._d=new Date(hooks.now()):isDate(t)?e._d=new Date(t.valueOf()):typeof t=="string"?configFromString(e):isArray(t)?(e._a=map(t.slice(0),function(r){return parseInt(r,10)}),configFromArray(e)):isObject$1(t)?configFromObject(e):isNumber(t)?e._d=new Date(t):hooks.createFromInputFallback(e)}function createLocalOrUTC(e,t,r,n,a){var s={};return(t===!0||t===!1)&&(n=t,t=void 0),(r===!0||r===!1)&&(n=r,r=void 0),(isObject$1(e)&&isObjectEmpty(e)||isArray(e)&&e.length===0)&&(e=void 0),s._isAMomentObject=!0,s._useUTC=s._isUTC=a,s._l=r,s._i=e,s._f=t,s._strict=n,createFromConfig(s)}function createLocal(e,t,r,n){return createLocalOrUTC(e,t,r,n,!1)}var prototypeMin=deprecate("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=createLocal.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:createInvalid()}),prototypeMax=deprecate("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=createLocal.apply(null,arguments);return this.isValid()&&e.isValid()?e>this?this:e:createInvalid()});function pickBy(e,t){var r,n;if(t.length===1&&isArray(t[0])&&(t=t[0]),!t.length)return createLocal();for(r=t[0],n=1;n<t.length;++n)(!t[n].isValid()||t[n][e](r))&&(r=t[n]);return r}function min(){var e=[].slice.call(arguments,0);return pickBy("isBefore",e)}function max$1(){var e=[].slice.call(arguments,0);return pickBy("isAfter",e)}var now=function(){return Date.now?Date.now():+new Date},ordering=["year","quarter","month","week","day","hour","minute","second","millisecond"];function isDurationValid(e){var t,r=!1,n,a=ordering.length;for(t in e)if(hasOwnProp(e,t)&&!(indexOf.call(ordering,t)!==-1&&(e[t]==null||!isNaN(e[t]))))return!1;for(n=0;n<a;++n)if(e[ordering[n]]){if(r)return!1;parseFloat(e[ordering[n]])!==toInt(e[ordering[n]])&&(r=!0)}return!0}function isValid$1(){return this._isValid}function createInvalid$1(){return createDuration(NaN)}function Duration(e){var t=normalizeObjectUnits(e),r=t.year||0,n=t.quarter||0,a=t.month||0,s=t.week||t.isoWeek||0,o=t.day||0,u=t.hour||0,l=t.minute||0,c=t.second||0,d=t.millisecond||0;this._isValid=isDurationValid(t),this._milliseconds=+d+c*1e3+l*6e4+u*1e3*60*60,this._days=+o+s*7,this._months=+a+n*3+r*12,this._data={},this._locale=getLocale(),this._bubble()}function isDuration(e){return e instanceof Duration}function absRound(e){return e<0?Math.round(-1*e)*-1:Math.round(e)}function compareArrays(e,t,r){var n=Math.min(e.length,t.length),a=Math.abs(e.length-t.length),s=0,o;for(o=0;o<n;o++)(r&&e[o]!==t[o]||!r&&toInt(e[o])!==toInt(t[o]))&&s++;return s+a}function offset(e,t){addFormatToken(e,0,0,function(){var r=this.utcOffset(),n="+";return r<0&&(r=-r,n="-"),n+zeroFill(~~(r/60),2)+t+zeroFill(~~r%60,2)})}offset("Z",":");offset("ZZ","");addRegexToken("Z",matchShortOffset);addRegexToken("ZZ",matchShortOffset);addParseToken(["Z","ZZ"],function(e,t,r){r._useUTC=!0,r._tzm=offsetFromString(matchShortOffset,e)});var chunkOffset=/([\+\-]|\d\d)/gi;function offsetFromString(e,t){var r=(t||"").match(e),n,a,s;return r===null?null:(n=r[r.length-1]||[],a=(n+"").match(chunkOffset)||["-",0,0],s=+(a[1]*60)+toInt(a[2]),s===0?0:a[0]==="+"?s:-s)}function cloneWithOffset(e,t){var r,n;return t._isUTC?(r=t.clone(),n=(isMoment(e)||isDate(e)?e.valueOf():createLocal(e).valueOf())-r.valueOf(),r._d.setTime(r._d.valueOf()+n),hooks.updateOffset(r,!1),r):createLocal(e).local()}function getDateOffset(e){return-Math.round(e._d.getTimezoneOffset())}hooks.updateOffset=function(){};function getSetOffset(e,t,r){var n=this._offset||0,a;if(!this.isValid())return e!=null?this:NaN;if(e!=null){if(typeof e=="string"){if(e=offsetFromString(matchShortOffset,e),e===null)return this}else Math.abs(e)<16&&!r&&(e=e*60);return!this._isUTC&&t&&(a=getDateOffset(this)),this._offset=e,this._isUTC=!0,a!=null&&this.add(a,"m"),n!==e&&(!t||this._changeInProgress?addSubtract(this,createDuration(e-n,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,hooks.updateOffset(this,!0),this._changeInProgress=null)),this}else return this._isUTC?n:getDateOffset(this)}function getSetZone(e,t){return e!=null?(typeof e!="string"&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}function setOffsetToUTC(e){return this.utcOffset(0,e)}function setOffsetToLocal(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(getDateOffset(this),"m")),this}function setOffsetToParsedOffset(){if(this._tzm!=null)this.utcOffset(this._tzm,!1,!0);else if(typeof this._i=="string"){var e=offsetFromString(matchOffset,this._i);e!=null?this.utcOffset(e):this.utcOffset(0,!0)}return this}function hasAlignedHourOffset(e){return this.isValid()?(e=e?createLocal(e).utcOffset():0,(this.utcOffset()-e)%60===0):!1}function isDaylightSavingTime(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function isDaylightSavingTimeShifted(){if(!isUndefined(this._isDSTShifted))return this._isDSTShifted;var e={},t;return copyConfig(e,this),e=prepareConfig(e),e._a?(t=e._isUTC?createUTC(e._a):createLocal(e._a),this._isDSTShifted=this.isValid()&&compareArrays(e._a,t.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}function isLocal(){return this.isValid()?!this._isUTC:!1}function isUtcOffset(){return this.isValid()?this._isUTC:!1}function isUtc(){return this.isValid()?this._isUTC&&this._offset===0:!1}var aspNetRegex=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,isoRegex=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function createDuration(e,t){var r=e,n=null,a,s,o;return isDuration(e)?r={ms:e._milliseconds,d:e._days,M:e._months}:isNumber(e)||!isNaN(+e)?(r={},t?r[t]=+e:r.milliseconds=+e):(n=aspNetRegex.exec(e))?(a=n[1]==="-"?-1:1,r={y:0,d:toInt(n[DATE])*a,h:toInt(n[HOUR])*a,m:toInt(n[MINUTE])*a,s:toInt(n[SECOND])*a,ms:toInt(absRound(n[MILLISECOND]*1e3))*a}):(n=isoRegex.exec(e))?(a=n[1]==="-"?-1:1,r={y:parseIso(n[2],a),M:parseIso(n[3],a),w:parseIso(n[4],a),d:parseIso(n[5],a),h:parseIso(n[6],a),m:parseIso(n[7],a),s:parseIso(n[8],a)}):r==null?r={}:typeof r=="object"&&("from"in r||"to"in r)&&(o=momentsDifference(createLocal(r.from),createLocal(r.to)),r={},r.ms=o.milliseconds,r.M=o.months),s=new Duration(r),isDuration(e)&&hasOwnProp(e,"_locale")&&(s._locale=e._locale),isDuration(e)&&hasOwnProp(e,"_isValid")&&(s._isValid=e._isValid),s}createDuration.fn=Duration.prototype;createDuration.invalid=createInvalid$1;function parseIso(e,t){var r=e&&parseFloat(e.replace(",","."));return(isNaN(r)?0:r)*t}function positiveMomentsDifference(e,t){var r={};return r.months=t.month()-e.month()+(t.year()-e.year())*12,e.clone().add(r.months,"M").isAfter(t)&&--r.months,r.milliseconds=+t-+e.clone().add(r.months,"M"),r}function momentsDifference(e,t){var r;return e.isValid()&&t.isValid()?(t=cloneWithOffset(t,e),e.isBefore(t)?r=positiveMomentsDifference(e,t):(r=positiveMomentsDifference(t,e),r.milliseconds=-r.milliseconds,r.months=-r.months),r):{milliseconds:0,months:0}}function createAdder(e,t){return function(r,n){var a,s;return n!==null&&!isNaN(+n)&&(deprecateSimple(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),s=r,r=n,n=s),a=createDuration(r,n),addSubtract(this,a,e),this}}function addSubtract(e,t,r,n){var a=t._milliseconds,s=absRound(t._days),o=absRound(t._months);e.isValid()&&(n=n??!0,o&&setMonth(e,get(e,"Month")+o*r),s&&set$1(e,"Date",get(e,"Date")+s*r),a&&e._d.setTime(e._d.valueOf()+a*r),n&&hooks.updateOffset(e,s||o))}var add=createAdder(1,"add"),subtract=createAdder(-1,"subtract");function isString(e){return typeof e=="string"||e instanceof String}function isMomentInput(e){return isMoment(e)||isDate(e)||isString(e)||isNumber(e)||isNumberOrStringArray(e)||isMomentInputObject(e)||e===null||e===void 0}function isMomentInputObject(e){var t=isObject$1(e)&&!isObjectEmpty(e),r=!1,n=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],a,s,o=n.length;for(a=0;a<o;a+=1)s=n[a],r=r||hasOwnProp(e,s);return t&&r}function isNumberOrStringArray(e){var t=isArray(e),r=!1;return t&&(r=e.filter(function(n){return!isNumber(n)&&isString(e)}).length===0),t&&r}function isCalendarSpec(e){var t=isObject$1(e)&&!isObjectEmpty(e),r=!1,n=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],a,s;for(a=0;a<n.length;a+=1)s=n[a],r=r||hasOwnProp(e,s);return t&&r}function getCalendarFormat(e,t){var r=e.diff(t,"days",!0);return r<-6?"sameElse":r<-1?"lastWeek":r<0?"lastDay":r<1?"sameDay":r<2?"nextDay":r<7?"nextWeek":"sameElse"}function calendar$1(e,t){arguments.length===1&&(arguments[0]?isMomentInput(arguments[0])?(e=arguments[0],t=void 0):isCalendarSpec(arguments[0])&&(t=arguments[0],e=void 0):(e=void 0,t=void 0));var r=e||createLocal(),n=cloneWithOffset(r,this).startOf("day"),a=hooks.calendarFormat(this,n)||"sameElse",s=t&&(isFunction(t[a])?t[a].call(this,r):t[a]);return this.format(s||this.localeData().calendar(a,this,createLocal(r)))}function clone(){return new Moment(this)}function isAfter(e,t){var r=isMoment(e)?e:createLocal(e);return this.isValid()&&r.isValid()?(t=normalizeUnits(t)||"millisecond",t==="millisecond"?this.valueOf()>r.valueOf():r.valueOf()<this.clone().startOf(t).valueOf()):!1}function isBefore(e,t){var r=isMoment(e)?e:createLocal(e);return this.isValid()&&r.isValid()?(t=normalizeUnits(t)||"millisecond",t==="millisecond"?this.valueOf()<r.valueOf():this.clone().endOf(t).valueOf()<r.valueOf()):!1}function isBetween(e,t,r,n){var a=isMoment(e)?e:createLocal(e),s=isMoment(t)?t:createLocal(t);return this.isValid()&&a.isValid()&&s.isValid()?(n=n||"()",(n[0]==="("?this.isAfter(a,r):!this.isBefore(a,r))&&(n[1]===")"?this.isBefore(s,r):!this.isAfter(s,r))):!1}function isSame(e,t){var r=isMoment(e)?e:createLocal(e),n;return this.isValid()&&r.isValid()?(t=normalizeUnits(t)||"millisecond",t==="millisecond"?this.valueOf()===r.valueOf():(n=r.valueOf(),this.clone().startOf(t).valueOf()<=n&&n<=this.clone().endOf(t).valueOf())):!1}function isSameOrAfter(e,t){return this.isSame(e,t)||this.isAfter(e,t)}function isSameOrBefore(e,t){return this.isSame(e,t)||this.isBefore(e,t)}function diff(e,t,r){var n,a,s;if(!this.isValid())return NaN;if(n=cloneWithOffset(e,this),!n.isValid())return NaN;switch(a=(n.utcOffset()-this.utcOffset())*6e4,t=normalizeUnits(t),t){case"year":s=monthDiff(this,n)/12;break;case"month":s=monthDiff(this,n);break;case"quarter":s=monthDiff(this,n)/3;break;case"second":s=(this-n)/1e3;break;case"minute":s=(this-n)/6e4;break;case"hour":s=(this-n)/36e5;break;case"day":s=(this-n-a)/864e5;break;case"week":s=(this-n-a)/6048e5;break;default:s=this-n}return r?s:absFloor(s)}function monthDiff(e,t){if(e.date()<t.date())return-monthDiff(t,e);var r=(t.year()-e.year())*12+(t.month()-e.month()),n=e.clone().add(r,"months"),a,s;return t-n<0?(a=e.clone().add(r-1,"months"),s=(t-n)/(n-a)):(a=e.clone().add(r+1,"months"),s=(t-n)/(a-n)),-(r+s)||0}hooks.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";hooks.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function toString(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function toISOString(e){if(!this.isValid())return null;var t=e!==!0,r=t?this.clone().utc():this;return r.year()<0||r.year()>9999?formatMoment(r,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):isFunction(Date.prototype.toISOString)?t?this.toDate().toISOString():new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",formatMoment(r,"Z")):formatMoment(r,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function inspect(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e="moment",t="",r,n,a,s;return this.isLocal()||(e=this.utcOffset()===0?"moment.utc":"moment.parseZone",t="Z"),r="["+e+'("]',n=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",a="-MM-DD[T]HH:mm:ss.SSS",s=t+'[")]',this.format(r+n+a+s)}function format(e){e||(e=this.isUtc()?hooks.defaultFormatUtc:hooks.defaultFormat);var t=formatMoment(this,e);return this.localeData().postformat(t)}function from(e,t){return this.isValid()&&(isMoment(e)&&e.isValid()||createLocal(e).isValid())?createDuration({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()}function fromNow(e){return this.from(createLocal(),e)}function to(e,t){return this.isValid()&&(isMoment(e)&&e.isValid()||createLocal(e).isValid())?createDuration({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()}function toNow(e){return this.to(createLocal(),e)}function locale(e){var t;return e===void 0?this._locale._abbr:(t=getLocale(e),t!=null&&(this._locale=t),this)}var lang=deprecate("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return e===void 0?this.localeData():this.locale(e)});function localeData(){return this._locale}var MS_PER_SECOND=1e3,MS_PER_MINUTE=60*MS_PER_SECOND,MS_PER_HOUR=60*MS_PER_MINUTE,MS_PER_400_YEARS=(365*400+97)*24*MS_PER_HOUR;function mod$1(e,t){return(e%t+t)%t}function localStartOfDate(e,t,r){return e<100&&e>=0?new Date(e+400,t,r)-MS_PER_400_YEARS:new Date(e,t,r).valueOf()}function utcStartOfDate(e,t,r){return e<100&&e>=0?Date.UTC(e+400,t,r)-MS_PER_400_YEARS:Date.UTC(e,t,r)}function startOf(e){var t,r;if(e=normalizeUnits(e),e===void 0||e==="millisecond"||!this.isValid())return this;switch(r=this._isUTC?utcStartOfDate:localStartOfDate,e){case"year":t=r(this.year(),0,1);break;case"quarter":t=r(this.year(),this.month()-this.month()%3,1);break;case"month":t=r(this.year(),this.month(),1);break;case"week":t=r(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":t=r(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":t=r(this.year(),this.month(),this.date());break;case"hour":t=this._d.valueOf(),t-=mod$1(t+(this._isUTC?0:this.utcOffset()*MS_PER_MINUTE),MS_PER_HOUR);break;case"minute":t=this._d.valueOf(),t-=mod$1(t,MS_PER_MINUTE);break;case"second":t=this._d.valueOf(),t-=mod$1(t,MS_PER_SECOND);break}return this._d.setTime(t),hooks.updateOffset(this,!0),this}function endOf(e){var t,r;if(e=normalizeUnits(e),e===void 0||e==="millisecond"||!this.isValid())return this;switch(r=this._isUTC?utcStartOfDate:localStartOfDate,e){case"year":t=r(this.year()+1,0,1)-1;break;case"quarter":t=r(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":t=r(this.year(),this.month()+1,1)-1;break;case"week":t=r(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":t=r(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":t=r(this.year(),this.month(),this.date()+1)-1;break;case"hour":t=this._d.valueOf(),t+=MS_PER_HOUR-mod$1(t+(this._isUTC?0:this.utcOffset()*MS_PER_MINUTE),MS_PER_HOUR)-1;break;case"minute":t=this._d.valueOf(),t+=MS_PER_MINUTE-mod$1(t,MS_PER_MINUTE)-1;break;case"second":t=this._d.valueOf(),t+=MS_PER_SECOND-mod$1(t,MS_PER_SECOND)-1;break}return this._d.setTime(t),hooks.updateOffset(this,!0),this}function valueOf(){return this._d.valueOf()-(this._offset||0)*6e4}function unix(){return Math.floor(this.valueOf()/1e3)}function toDate(){return new Date(this.valueOf())}function toArray(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]}function toObject(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}}function toJSON(){return this.isValid()?this.toISOString():null}function isValid$2(){return isValid(this)}function parsingFlags(){return extend({},getParsingFlags(this))}function invalidAt(){return getParsingFlags(this).overflow}function creationData(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}addFormatToken("N",0,0,"eraAbbr");addFormatToken("NN",0,0,"eraAbbr");addFormatToken("NNN",0,0,"eraAbbr");addFormatToken("NNNN",0,0,"eraName");addFormatToken("NNNNN",0,0,"eraNarrow");addFormatToken("y",["y",1],"yo","eraYear");addFormatToken("y",["yy",2],0,"eraYear");addFormatToken("y",["yyy",3],0,"eraYear");addFormatToken("y",["yyyy",4],0,"eraYear");addRegexToken("N",matchEraAbbr);addRegexToken("NN",matchEraAbbr);addRegexToken("NNN",matchEraAbbr);addRegexToken("NNNN",matchEraName);addRegexToken("NNNNN",matchEraNarrow);addParseToken(["N","NN","NNN","NNNN","NNNNN"],function(e,t,r,n){var a=r._locale.erasParse(e,n,r._strict);a?getParsingFlags(r).era=a:getParsingFlags(r).invalidEra=e});addRegexToken("y",matchUnsigned);addRegexToken("yy",matchUnsigned);addRegexToken("yyy",matchUnsigned);addRegexToken("yyyy",matchUnsigned);addRegexToken("yo",matchEraYearOrdinal);addParseToken(["y","yy","yyy","yyyy"],YEAR);addParseToken(["yo"],function(e,t,r,n){var a;r._locale._eraYearOrdinalRegex&&(a=e.match(r._locale._eraYearOrdinalRegex)),r._locale.eraYearOrdinalParse?t[YEAR]=r._locale.eraYearOrdinalParse(e,a):t[YEAR]=parseInt(e,10)});function localeEras(e,t){var r,n,a,s=this._eras||getLocale("en")._eras;for(r=0,n=s.length;r<n;++r){switch(typeof s[r].since){case"string":a=hooks(s[r].since).startOf("day"),s[r].since=a.valueOf();break}switch(typeof s[r].until){case"undefined":s[r].until=1/0;break;case"string":a=hooks(s[r].until).startOf("day").valueOf(),s[r].until=a.valueOf();break}}return s}function localeErasParse(e,t,r){var n,a,s=this.eras(),o,u,l;for(e=e.toUpperCase(),n=0,a=s.length;n<a;++n)if(o=s[n].name.toUpperCase(),u=s[n].abbr.toUpperCase(),l=s[n].narrow.toUpperCase(),r)switch(t){case"N":case"NN":case"NNN":if(u===e)return s[n];break;case"NNNN":if(o===e)return s[n];break;case"NNNNN":if(l===e)return s[n];break}else if([o,u,l].indexOf(e)>=0)return s[n]}function localeErasConvertYear(e,t){var r=e.since<=e.until?1:-1;return t===void 0?hooks(e.since).year():hooks(e.since).year()+(t-e.offset)*r}function getEraName(){var e,t,r,n=this.localeData().eras();for(e=0,t=n.length;e<t;++e)if(r=this.clone().startOf("day").valueOf(),n[e].since<=r&&r<=n[e].until||n[e].until<=r&&r<=n[e].since)return n[e].name;return""}function getEraNarrow(){var e,t,r,n=this.localeData().eras();for(e=0,t=n.length;e<t;++e)if(r=this.clone().startOf("day").valueOf(),n[e].since<=r&&r<=n[e].until||n[e].until<=r&&r<=n[e].since)return n[e].narrow;return""}function getEraAbbr(){var e,t,r,n=this.localeData().eras();for(e=0,t=n.length;e<t;++e)if(r=this.clone().startOf("day").valueOf(),n[e].since<=r&&r<=n[e].until||n[e].until<=r&&r<=n[e].since)return n[e].abbr;return""}function getEraYear(){var e,t,r,n,a=this.localeData().eras();for(e=0,t=a.length;e<t;++e)if(r=a[e].since<=a[e].until?1:-1,n=this.clone().startOf("day").valueOf(),a[e].since<=n&&n<=a[e].until||a[e].until<=n&&n<=a[e].since)return(this.year()-hooks(a[e].since).year())*r+a[e].offset;return this.year()}function erasNameRegex(e){return hasOwnProp(this,"_erasNameRegex")||computeErasParse.call(this),e?this._erasNameRegex:this._erasRegex}function erasAbbrRegex(e){return hasOwnProp(this,"_erasAbbrRegex")||computeErasParse.call(this),e?this._erasAbbrRegex:this._erasRegex}function erasNarrowRegex(e){return hasOwnProp(this,"_erasNarrowRegex")||computeErasParse.call(this),e?this._erasNarrowRegex:this._erasRegex}function matchEraAbbr(e,t){return t.erasAbbrRegex(e)}function matchEraName(e,t){return t.erasNameRegex(e)}function matchEraNarrow(e,t){return t.erasNarrowRegex(e)}function matchEraYearOrdinal(e,t){return t._eraYearOrdinalRegex||matchUnsigned}function computeErasParse(){var e=[],t=[],r=[],n=[],a,s,o=this.eras();for(a=0,s=o.length;a<s;++a)t.push(regexEscape(o[a].name)),e.push(regexEscape(o[a].abbr)),r.push(regexEscape(o[a].narrow)),n.push(regexEscape(o[a].name)),n.push(regexEscape(o[a].abbr)),n.push(regexEscape(o[a].narrow));this._erasRegex=new RegExp("^("+n.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+t.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+e.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+r.join("|")+")","i")}addFormatToken(0,["gg",2],0,function(){return this.weekYear()%100});addFormatToken(0,["GG",2],0,function(){return this.isoWeekYear()%100});function addWeekYearFormatToken(e,t){addFormatToken(0,[e,e.length],0,t)}addWeekYearFormatToken("gggg","weekYear");addWeekYearFormatToken("ggggg","weekYear");addWeekYearFormatToken("GGGG","isoWeekYear");addWeekYearFormatToken("GGGGG","isoWeekYear");addUnitAlias("weekYear","gg");addUnitAlias("isoWeekYear","GG");addUnitPriority("weekYear",1);addUnitPriority("isoWeekYear",1);addRegexToken("G",matchSigned);addRegexToken("g",matchSigned);addRegexToken("GG",match1to2,match2);addRegexToken("gg",match1to2,match2);addRegexToken("GGGG",match1to4,match4);addRegexToken("gggg",match1to4,match4);addRegexToken("GGGGG",match1to6,match6);addRegexToken("ggggg",match1to6,match6);addWeekParseToken(["gggg","ggggg","GGGG","GGGGG"],function(e,t,r,n){t[n.substr(0,2)]=toInt(e)});addWeekParseToken(["gg","GG"],function(e,t,r,n){t[n]=hooks.parseTwoDigitYear(e)});function getSetWeekYear(e){return getSetWeekYearHelper.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function getSetISOWeekYear(e){return getSetWeekYearHelper.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)}function getISOWeeksInYear(){return weeksInYear(this.year(),1,4)}function getISOWeeksInISOWeekYear(){return weeksInYear(this.isoWeekYear(),1,4)}function getWeeksInYear(){var e=this.localeData()._week;return weeksInYear(this.year(),e.dow,e.doy)}function getWeeksInWeekYear(){var e=this.localeData()._week;return weeksInYear(this.weekYear(),e.dow,e.doy)}function getSetWeekYearHelper(e,t,r,n,a){var s;return e==null?weekOfYear(this,n,a).year:(s=weeksInYear(e,n,a),t>s&&(t=s),setWeekAll.call(this,e,t,r,n,a))}function setWeekAll(e,t,r,n,a){var s=dayOfYearFromWeeks(e,t,r,n,a),o=createUTCDate(s.year,0,s.dayOfYear);return this.year(o.getUTCFullYear()),this.month(o.getUTCMonth()),this.date(o.getUTCDate()),this}addFormatToken("Q",0,"Qo","quarter");addUnitAlias("quarter","Q");addUnitPriority("quarter",7);addRegexToken("Q",match1);addParseToken("Q",function(e,t){t[MONTH]=(toInt(e)-1)*3});function getSetQuarter(e){return e==null?Math.ceil((this.month()+1)/3):this.month((e-1)*3+this.month()%3)}addFormatToken("D",["DD",2],"Do","date");addUnitAlias("date","D");addUnitPriority("date",9);addRegexToken("D",match1to2);addRegexToken("DD",match1to2,match2);addRegexToken("Do",function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient});addParseToken(["D","DD"],DATE);addParseToken("Do",function(e,t){t[DATE]=toInt(e.match(match1to2)[0])});var getSetDayOfMonth=makeGetSet("Date",!0);addFormatToken("DDD",["DDDD",3],"DDDo","dayOfYear");addUnitAlias("dayOfYear","DDD");addUnitPriority("dayOfYear",4);addRegexToken("DDD",match1to3);addRegexToken("DDDD",match3);addParseToken(["DDD","DDDD"],function(e,t,r){r._dayOfYear=toInt(e)});function getSetDayOfYear(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return e==null?t:this.add(e-t,"d")}addFormatToken("m",["mm",2],0,"minute");addUnitAlias("minute","m");addUnitPriority("minute",14);addRegexToken("m",match1to2);addRegexToken("mm",match1to2,match2);addParseToken(["m","mm"],MINUTE);var getSetMinute=makeGetSet("Minutes",!1);addFormatToken("s",["ss",2],0,"second");addUnitAlias("second","s");addUnitPriority("second",15);addRegexToken("s",match1to2);addRegexToken("ss",match1to2,match2);addParseToken(["s","ss"],SECOND);var getSetSecond=makeGetSet("Seconds",!1);addFormatToken("S",0,0,function(){return~~(this.millisecond()/100)});addFormatToken(0,["SS",2],0,function(){return~~(this.millisecond()/10)});addFormatToken(0,["SSS",3],0,"millisecond");addFormatToken(0,["SSSS",4],0,function(){return this.millisecond()*10});addFormatToken(0,["SSSSS",5],0,function(){return this.millisecond()*100});addFormatToken(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3});addFormatToken(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4});addFormatToken(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5});addFormatToken(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6});addUnitAlias("millisecond","ms");addUnitPriority("millisecond",16);addRegexToken("S",match1to3,match1);addRegexToken("SS",match1to3,match2);addRegexToken("SSS",match1to3,match3);var token,getSetMillisecond;for(token="SSSS";token.length<=9;token+="S")addRegexToken(token,matchUnsigned);function parseMs(e,t){t[MILLISECOND]=toInt(("0."+e)*1e3)}for(token="S";token.length<=9;token+="S")addParseToken(token,parseMs);getSetMillisecond=makeGetSet("Milliseconds",!1);addFormatToken("z",0,0,"zoneAbbr");addFormatToken("zz",0,0,"zoneName");function getZoneAbbr(){return this._isUTC?"UTC":""}function getZoneName(){return this._isUTC?"Coordinated Universal Time":""}var proto=Moment.prototype;proto.add=add;proto.calendar=calendar$1;proto.clone=clone;proto.diff=diff;proto.endOf=endOf;proto.format=format;proto.from=from;proto.fromNow=fromNow;proto.to=to;proto.toNow=toNow;proto.get=stringGet;proto.invalidAt=invalidAt;proto.isAfter=isAfter;proto.isBefore=isBefore;proto.isBetween=isBetween;proto.isSame=isSame;proto.isSameOrAfter=isSameOrAfter;proto.isSameOrBefore=isSameOrBefore;proto.isValid=isValid$2;proto.lang=lang;proto.locale=locale;proto.localeData=localeData;proto.max=prototypeMax;proto.min=prototypeMin;proto.parsingFlags=parsingFlags;proto.set=stringSet;proto.startOf=startOf;proto.subtract=subtract;proto.toArray=toArray;proto.toObject=toObject;proto.toDate=toDate;proto.toISOString=toISOString;proto.inspect=inspect;typeof Symbol<"u"&&Symbol.for!=null&&(proto[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"});proto.toJSON=toJSON;proto.toString=toString;proto.unix=unix;proto.valueOf=valueOf;proto.creationData=creationData;proto.eraName=getEraName;proto.eraNarrow=getEraNarrow;proto.eraAbbr=getEraAbbr;proto.eraYear=getEraYear;proto.year=getSetYear;proto.isLeapYear=getIsLeapYear;proto.weekYear=getSetWeekYear;proto.isoWeekYear=getSetISOWeekYear;proto.quarter=proto.quarters=getSetQuarter;proto.month=getSetMonth;proto.daysInMonth=getDaysInMonth;proto.week=proto.weeks=getSetWeek;proto.isoWeek=proto.isoWeeks=getSetISOWeek;proto.weeksInYear=getWeeksInYear;proto.weeksInWeekYear=getWeeksInWeekYear;proto.isoWeeksInYear=getISOWeeksInYear;proto.isoWeeksInISOWeekYear=getISOWeeksInISOWeekYear;proto.date=getSetDayOfMonth;proto.day=proto.days=getSetDayOfWeek;proto.weekday=getSetLocaleDayOfWeek;proto.isoWeekday=getSetISODayOfWeek;proto.dayOfYear=getSetDayOfYear;proto.hour=proto.hours=getSetHour;proto.minute=proto.minutes=getSetMinute;proto.second=proto.seconds=getSetSecond;proto.millisecond=proto.milliseconds=getSetMillisecond;proto.utcOffset=getSetOffset;proto.utc=setOffsetToUTC;proto.local=setOffsetToLocal;proto.parseZone=setOffsetToParsedOffset;proto.hasAlignedHourOffset=hasAlignedHourOffset;proto.isDST=isDaylightSavingTime;proto.isLocal=isLocal;proto.isUtcOffset=isUtcOffset;proto.isUtc=isUtc;proto.isUTC=isUtc;proto.zoneAbbr=getZoneAbbr;proto.zoneName=getZoneName;proto.dates=deprecate("dates accessor is deprecated. Use date instead.",getSetDayOfMonth);proto.months=deprecate("months accessor is deprecated. Use month instead",getSetMonth);proto.years=deprecate("years accessor is deprecated. Use year instead",getSetYear);proto.zone=deprecate("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",getSetZone);proto.isDSTShifted=deprecate("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",isDaylightSavingTimeShifted);function createUnix(e){return createLocal(e*1e3)}function createInZone(){return createLocal.apply(null,arguments).parseZone()}function preParsePostFormat(e){return e}var proto$1=Locale.prototype;proto$1.calendar=calendar;proto$1.longDateFormat=longDateFormat;proto$1.invalidDate=invalidDate;proto$1.ordinal=ordinal;proto$1.preparse=preParsePostFormat;proto$1.postformat=preParsePostFormat;proto$1.relativeTime=relativeTime;proto$1.pastFuture=pastFuture;proto$1.set=set;proto$1.eras=localeEras;proto$1.erasParse=localeErasParse;proto$1.erasConvertYear=localeErasConvertYear;proto$1.erasAbbrRegex=erasAbbrRegex;proto$1.erasNameRegex=erasNameRegex;proto$1.erasNarrowRegex=erasNarrowRegex;proto$1.months=localeMonths;proto$1.monthsShort=localeMonthsShort;proto$1.monthsParse=localeMonthsParse;proto$1.monthsRegex=monthsRegex;proto$1.monthsShortRegex=monthsShortRegex;proto$1.week=localeWeek;proto$1.firstDayOfYear=localeFirstDayOfYear;proto$1.firstDayOfWeek=localeFirstDayOfWeek;proto$1.weekdays=localeWeekdays;proto$1.weekdaysMin=localeWeekdaysMin;proto$1.weekdaysShort=localeWeekdaysShort;proto$1.weekdaysParse=localeWeekdaysParse;proto$1.weekdaysRegex=weekdaysRegex;proto$1.weekdaysShortRegex=weekdaysShortRegex;proto$1.weekdaysMinRegex=weekdaysMinRegex;proto$1.isPM=localeIsPM;proto$1.meridiem=localeMeridiem;function get$1(e,t,r,n){var a=getLocale(),s=createUTC().set(n,t);return a[r](s,e)}function listMonthsImpl(e,t,r){if(isNumber(e)&&(t=e,e=void 0),e=e||"",t!=null)return get$1(e,t,r,"month");var n,a=[];for(n=0;n<12;n++)a[n]=get$1(e,n,r,"month");return a}function listWeekdaysImpl(e,t,r,n){typeof e=="boolean"?(isNumber(t)&&(r=t,t=void 0),t=t||""):(t=e,r=t,e=!1,isNumber(t)&&(r=t,t=void 0),t=t||"");var a=getLocale(),s=e?a._week.dow:0,o,u=[];if(r!=null)return get$1(t,(r+s)%7,n,"day");for(o=0;o<7;o++)u[o]=get$1(t,(o+s)%7,n,"day");return u}function listMonths(e,t){return listMonthsImpl(e,t,"months")}function listMonthsShort(e,t){return listMonthsImpl(e,t,"monthsShort")}function listWeekdays(e,t,r){return listWeekdaysImpl(e,t,r,"weekdays")}function listWeekdaysShort(e,t,r){return listWeekdaysImpl(e,t,r,"weekdaysShort")}function listWeekdaysMin(e,t,r){return listWeekdaysImpl(e,t,r,"weekdaysMin")}getSetGlobalLocale("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10,r=toInt(e%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th";return e+r}});hooks.lang=deprecate("moment.lang is deprecated. Use moment.locale instead.",getSetGlobalLocale);hooks.langData=deprecate("moment.langData is deprecated. Use moment.localeData instead.",getLocale);var mathAbs=Math.abs;function abs(){var e=this._data;return this._milliseconds=mathAbs(this._milliseconds),this._days=mathAbs(this._days),this._months=mathAbs(this._months),e.milliseconds=mathAbs(e.milliseconds),e.seconds=mathAbs(e.seconds),e.minutes=mathAbs(e.minutes),e.hours=mathAbs(e.hours),e.months=mathAbs(e.months),e.years=mathAbs(e.years),this}function addSubtract$1(e,t,r,n){var a=createDuration(t,r);return e._milliseconds+=n*a._milliseconds,e._days+=n*a._days,e._months+=n*a._months,e._bubble()}function add$1(e,t){return addSubtract$1(this,e,t,1)}function subtract$1(e,t){return addSubtract$1(this,e,t,-1)}function absCeil(e){return e<0?Math.floor(e):Math.ceil(e)}function bubble(){var e=this._milliseconds,t=this._days,r=this._months,n=this._data,a,s,o,u,l;return e>=0&&t>=0&&r>=0||e<=0&&t<=0&&r<=0||(e+=absCeil(monthsToDays(r)+t)*864e5,t=0,r=0),n.milliseconds=e%1e3,a=absFloor(e/1e3),n.seconds=a%60,s=absFloor(a/60),n.minutes=s%60,o=absFloor(s/60),n.hours=o%24,t+=absFloor(o/24),l=absFloor(daysToMonths(t)),r+=l,t-=absCeil(monthsToDays(l)),u=absFloor(r/12),r%=12,n.days=t,n.months=r,n.years=u,this}function daysToMonths(e){return e*4800/146097}function monthsToDays(e){return e*146097/4800}function as(e){if(!this.isValid())return NaN;var t,r,n=this._milliseconds;if(e=normalizeUnits(e),e==="month"||e==="quarter"||e==="year")switch(t=this._days+n/864e5,r=this._months+daysToMonths(t),e){case"month":return r;case"quarter":return r/3;case"year":return r/12}else switch(t=this._days+Math.round(monthsToDays(this._months)),e){case"week":return t/7+n/6048e5;case"day":return t+n/864e5;case"hour":return t*24+n/36e5;case"minute":return t*1440+n/6e4;case"second":return t*86400+n/1e3;case"millisecond":return Math.floor(t*864e5)+n;default:throw new Error("Unknown unit "+e)}}function valueOf$1(){return this.isValid()?this._milliseconds+this._days*864e5+this._months%12*2592e6+toInt(this._months/12)*31536e6:NaN}function makeAs(e){return function(){return this.as(e)}}var asMilliseconds=makeAs("ms"),asSeconds=makeAs("s"),asMinutes=makeAs("m"),asHours=makeAs("h"),asDays=makeAs("d"),asWeeks=makeAs("w"),asMonths=makeAs("M"),asQuarters=makeAs("Q"),asYears=makeAs("y");function clone$1(){return createDuration(this)}function get$2(e){return e=normalizeUnits(e),this.isValid()?this[e+"s"]():NaN}function makeGetter(e){return function(){return this.isValid()?this._data[e]:NaN}}var milliseconds=makeGetter("milliseconds"),seconds=makeGetter("seconds"),minutes=makeGetter("minutes"),hours=makeGetter("hours"),days=makeGetter("days"),months=makeGetter("months"),years=makeGetter("years");function weeks(){return absFloor(this.days()/7)}var round=Math.round,thresholds={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function substituteTimeAgo(e,t,r,n,a){return a.relativeTime(t||1,!!r,e,n)}function relativeTime$1(e,t,r,n){var a=createDuration(e).abs(),s=round(a.as("s")),o=round(a.as("m")),u=round(a.as("h")),l=round(a.as("d")),c=round(a.as("M")),d=round(a.as("w")),f=round(a.as("y")),h=s<=r.ss&&["s",s]||s<r.s&&["ss",s]||o<=1&&["m"]||o<r.m&&["mm",o]||u<=1&&["h"]||u<r.h&&["hh",u]||l<=1&&["d"]||l<r.d&&["dd",l];return r.w!=null&&(h=h||d<=1&&["w"]||d<r.w&&["ww",d]),h=h||c<=1&&["M"]||c<r.M&&["MM",c]||f<=1&&["y"]||["yy",f],h[2]=t,h[3]=+e>0,h[4]=n,substituteTimeAgo.apply(null,h)}function getSetRelativeTimeRounding(e){return e===void 0?round:typeof e=="function"?(round=e,!0):!1}function getSetRelativeTimeThreshold(e,t){return thresholds[e]===void 0?!1:t===void 0?thresholds[e]:(thresholds[e]=t,e==="s"&&(thresholds.ss=t-1),!0)}function humanize(e,t){if(!this.isValid())return this.localeData().invalidDate();var r=!1,n=thresholds,a,s;return typeof e=="object"&&(t=e,e=!1),typeof e=="boolean"&&(r=e),typeof t=="object"&&(n=Object.assign({},thresholds,t),t.s!=null&&t.ss==null&&(n.ss=t.s-1)),a=this.localeData(),s=relativeTime$1(this,!r,n,a),r&&(s=a.pastFuture(+this,s)),a.postformat(s)}var abs$1=Math.abs;function sign(e){return(e>0)-(e<0)||+e}function toISOString$1(){if(!this.isValid())return this.localeData().invalidDate();var e=abs$1(this._milliseconds)/1e3,t=abs$1(this._days),r=abs$1(this._months),n,a,s,o,u=this.asSeconds(),l,c,d,f;return u?(n=absFloor(e/60),a=absFloor(n/60),e%=60,n%=60,s=absFloor(r/12),r%=12,o=e?e.toFixed(3).replace(/\.?0+$/,""):"",l=u<0?"-":"",c=sign(this._months)!==sign(u)?"-":"",d=sign(this._days)!==sign(u)?"-":"",f=sign(this._milliseconds)!==sign(u)?"-":"",l+"P"+(s?c+s+"Y":"")+(r?c+r+"M":"")+(t?d+t+"D":"")+(a||n||e?"T":"")+(a?f+a+"H":"")+(n?f+n+"M":"")+(e?f+o+"S":"")):"P0D"}var proto$2=Duration.prototype;proto$2.isValid=isValid$1;proto$2.abs=abs;proto$2.add=add$1;proto$2.subtract=subtract$1;proto$2.as=as;proto$2.asMilliseconds=asMilliseconds;proto$2.asSeconds=asSeconds;proto$2.asMinutes=asMinutes;proto$2.asHours=asHours;proto$2.asDays=asDays;proto$2.asWeeks=asWeeks;proto$2.asMonths=asMonths;proto$2.asQuarters=asQuarters;proto$2.asYears=asYears;proto$2.valueOf=valueOf$1;proto$2._bubble=bubble;proto$2.clone=clone$1;proto$2.get=get$2;proto$2.milliseconds=milliseconds;proto$2.seconds=seconds;proto$2.minutes=minutes;proto$2.hours=hours;proto$2.days=days;proto$2.weeks=weeks;proto$2.months=months;proto$2.years=years;proto$2.humanize=humanize;proto$2.toISOString=toISOString$1;proto$2.toString=toISOString$1;proto$2.toJSON=toISOString$1;proto$2.locale=locale;proto$2.localeData=localeData;proto$2.toIsoString=deprecate("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",toISOString$1);proto$2.lang=lang;addFormatToken("X",0,0,"unix");addFormatToken("x",0,0,"valueOf");addRegexToken("x",matchSigned);addRegexToken("X",matchTimestamp);addParseToken("X",function(e,t,r){r._d=new Date(parseFloat(e)*1e3)});addParseToken("x",function(e,t,r){r._d=new Date(toInt(e))});//! moment.js
hooks.version="2.29.4";setHookCallback(createLocal);hooks.fn=proto;hooks.min=min;hooks.max=max$1;hooks.now=now;hooks.utc=createUTC;hooks.unix=createUnix;hooks.months=listMonths;hooks.isDate=isDate;hooks.locale=getSetGlobalLocale;hooks.invalid=createInvalid;hooks.duration=createDuration;hooks.isMoment=isMoment;hooks.weekdays=listWeekdays;hooks.parseZone=createInZone;hooks.localeData=getLocale;hooks.isDuration=isDuration;hooks.monthsShort=listMonthsShort;hooks.weekdaysMin=listWeekdaysMin;hooks.defineLocale=defineLocale;hooks.updateLocale=updateLocale;hooks.locales=listLocales;hooks.weekdaysShort=listWeekdaysShort;hooks.normalizeUnits=normalizeUnits;hooks.relativeTimeRounding=getSetRelativeTimeRounding;hooks.relativeTimeThreshold=getSetRelativeTimeThreshold;hooks.calendarFormat=getCalendarFormat;hooks.prototype=proto;hooks.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"};const moment=Object.freeze(Object.defineProperty({__proto__:null,default:hooks},Symbol.toStringTag,{value:"Module"}));var lib$1={},GridDisplay$1={},GridConfig={};Object.defineProperty(GridConfig,"__esModule",{value:!0});GridConfig.createGridCache=GridConfig.createGridConfig=void 0;function createGridConfig(){return{hiddenColumns:[],expandedColumns:[],addedColumns:[],filters:{},columnWidths:{},sort:[],focusedColumns:null,grouping:{},formFilterColumns:[]}}GridConfig.createGridConfig=createGridConfig;function createGridCache(){return{refreshTime:new Date().getTime()}}GridConfig.createGridCache=createGridCache;var lib={},parseFilter$1={},parsimmon_umd_min={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(typeof self<"u"?self:commonjsGlobal,function(){return function(r){var n={};function a(s){if(n[s])return n[s].exports;var o=n[s]={i:s,l:!1,exports:{}};return r[s].call(o.exports,o,o.exports,a),o.l=!0,o.exports}return a.m=r,a.c=n,a.d=function(s,o,u){a.o(s,o)||Object.defineProperty(s,o,{configurable:!1,enumerable:!0,get:u})},a.r=function(s){Object.defineProperty(s,"__esModule",{value:!0})},a.n=function(s){var o=s&&s.__esModule?function(){return s.default}:function(){return s};return a.d(o,"a",o),o},a.o=function(s,o){return Object.prototype.hasOwnProperty.call(s,o)},a.p="",a(a.s=0)}([function(r,n,a){function s(m){if(!(this instanceof s))return new s(m);this._=m}var o=s.prototype;function u(m,p){for(var b=0;b<m;b++)p(b)}function l(m,p,b){return function(S,N){u(N.length,function(w){S(N[w],w,N)})}(function(S,N,w){p=m(p,S,N,w)},b),p}function c(m,p){return l(function(b,S,N,w){return b.concat([m(S,N,w)])},[],p)}function d(m,p){var b={v:0,buf:p};return u(m,function(){var S;b={v:b.v<<1|(S=b.buf,S[0]>>7),buf:function(N){var w=l(function(D,R,Y,z){return D.concat(Y===z.length-1?Buffer.from([R,0]).readUInt16BE(0):z.readUInt16BE(Y))},[],N);return Buffer.from(c(function(D){return(D<<1&65535)>>8},w))}(b.buf)}}),b}function f(){return typeof Buffer<"u"}function h(){if(!f())throw new Error("Buffer global does not exist; please use webpack if you need to parse Buffers in the browser.")}function y(m){h();var p=l(function(w,D){return w+D},0,m);if(p%8!=0)throw new Error("The bits ["+m.join(", ")+"] add up to "+p+" which is not an even number of bytes; the total should be divisible by 8");var b,S=p/8,N=(b=function(w){return w>48},l(function(w,D){return w||(b(D)?D:w)},null,m));if(N)throw new Error(N+" bit range requested exceeds 48 bit (6 byte) Number max.");return new s(function(w,D){var R=S+D;return R>w.length?q(D,S.toString()+" bytes"):A(R,l(function(Y,z){var V=d(z,Y.buf);return{coll:Y.coll.concat(V.v),buf:V.buf}},{coll:[],buf:w.slice(D,R)},m).coll)})}function v(m,p){return new s(function(b,S){return h(),S+p>b.length?q(S,p+" bytes for "+m):A(S+p,b.slice(S,S+p))})}function g(m,p){if(typeof(b=p)!="number"||Math.floor(b)!==b||p<0||p>6)throw new Error(m+" requires integer length in range [0, 6].");var b}function C(m){return g("uintBE",m),v("uintBE("+m+")",m).map(function(p){return p.readUIntBE(0,m)})}function O(m){return g("uintLE",m),v("uintLE("+m+")",m).map(function(p){return p.readUIntLE(0,m)})}function j(m){return g("intBE",m),v("intBE("+m+")",m).map(function(p){return p.readIntBE(0,m)})}function F(m){return g("intLE",m),v("intLE("+m+")",m).map(function(p){return p.readIntLE(0,m)})}function L(m){return m instanceof s}function M(m){return{}.toString.call(m)==="[object Array]"}function I(m){return f()&&Buffer.isBuffer(m)}function A(m,p){return{status:!0,index:m,value:p,furthest:-1,expected:[]}}function q(m,p){return M(p)||(p=[p]),{status:!1,index:-1,value:null,furthest:m,expected:p}}function G(m,p){if(!p||m.furthest>p.furthest)return m;var b=m.furthest===p.furthest?function(S,N){if(function(){if(s._supportsSet!==void 0)return s._supportsSet;var re=typeof Set<"u";return s._supportsSet=re,re}()&&Array.from){for(var w=new Set(S),D=0;D<N.length;D++)w.add(N[D]);var R=Array.from(w);return R.sort(),R}for(var Y={},z=0;z<S.length;z++)Y[S[z]]=!0;for(var V=0;V<N.length;V++)Y[N[V]]=!0;var te=[];for(var Z in Y)({}).hasOwnProperty.call(Y,Z)&&te.push(Z);return te.sort(),te}(m.expected,p.expected):p.expected;return{status:m.status,index:m.index,value:m.value,furthest:p.furthest,expected:b}}var J={};function Q(m,p){if(I(m))return{offset:p,line:-1,column:-1};m in J||(J[m]={});for(var b=J[m],S=0,N=0,w=0,D=p;D>=0;){if(D in b){S=b[D].line,w===0&&(w=b[D].lineStart);break}(m.charAt(D)===`
`||m.charAt(D)==="\r"&&m.charAt(D+1)!==`
`)&&(N++,w===0&&(w=D+1)),D--}var R=S+N,Y=p-w;return b[p]={line:R,lineStart:w},{offset:p,line:R+1,column:Y+1}}function X(m){if(!L(m))throw new Error("not a parser: "+m)}function _(m,p){return typeof m=="string"?m.charAt(p):m[p]}function $(m){if(typeof m!="number")throw new Error("not a number: "+m)}function P(m){if(typeof m!="function")throw new Error("not a function: "+m)}function k(m){if(typeof m!="string")throw new Error("not a string: "+m)}var E=2,x=3,T=8,U=5*T,W=4*T,K="  ";function H(m,p){return new Array(p+1).join(m)}function me(m,p,b){var S=p-m.length;return S<=0?m:H(b,S)+m}function Ce(m,p,b,S){return{from:m-p>0?m-p:0,to:m+b>S?S:m+b}}function je(m,p){var b,S,N,w,D,R=p.index,Y=R.offset,z=1;if(Y===m.length)return"Got the end of the input";if(I(m)){var V=Y-Y%T,te=Y-V,Z=Ce(V,U,W+T,m.length),re=c(function(B){return c(function(oe){return me(oe.toString(16),2,"0")},B)},function(B,oe){var le=B.length,ie=[],ue=0;if(le<=oe)return[B.slice()];for(var ce=0;ce<le;ce++)ie[ue]||ie.push([]),ie[ue].push(B[ce]),(ce+1)%oe==0&&ue++;return ie}(m.slice(Z.from,Z.to).toJSON().data,T));w=function(B){return B.from===0&&B.to===1?{from:B.from,to:B.to}:{from:B.from/T,to:Math.floor(B.to/T)}}(Z),S=V/T,b=3*te,te>=4&&(b+=1),z=2,N=c(function(B){return B.length<=4?B.join(" "):B.slice(0,4).join(" ")+"  "+B.slice(4).join(" ")},re),(D=(8*(w.to>0?w.to-1:w.to)).toString(16).length)<2&&(D=2)}else{var se=m.split(/\r\n|[\n\r\u2028\u2029]/);b=R.column-1,S=R.line-1,w=Ce(S,E,x,se.length),N=se.slice(w.from,w.to),D=w.to.toString().length}var Ue=S-w.from;return I(m)&&(D=(8*(w.to>0?w.to-1:w.to)).toString(16).length)<2&&(D=2),l(function(B,oe,le){var ie,ue=le===Ue,ce=ue?"> ":K;return ie=I(m)?me((8*(w.from+le)).toString(16),D,"0"):me((w.from+le+1).toString(),D," "),[].concat(B,[ce+ie+" | "+oe],ue?[K+H(" ",D)+" | "+me("",b," ")+H("^",z)]:[])},[],N).join(`
`)}function Te(m,p){return[`
`,"-- PARSING FAILED "+H("-",50),`

`,je(m,p),`

`,(b=p.expected,b.length===1?`Expected:

`+b[0]:`Expected one of the following: 

`+b.join(", ")),`
`].join("");var b}function Se(m){return m.flags!==void 0?m.flags:[m.global?"g":"",m.ignoreCase?"i":"",m.multiline?"m":"",m.unicode?"u":"",m.sticky?"y":""].join("")}function he(){for(var m=[].slice.call(arguments),p=m.length,b=0;b<p;b+=1)X(m[b]);return s(function(S,N){for(var w,D=new Array(p),R=0;R<p;R+=1){if(!(w=G(m[R]._(S,N),w)).status)return w;D[R]=w.value,N=w.index}return G(A(N,D),w)})}function ne(){var m=[].slice.call(arguments);if(m.length===0)throw new Error("seqMap needs at least one argument");var p=m.pop();return P(p),he.apply(null,m).map(function(b){return p.apply(null,b)})}function pe(){var m=[].slice.call(arguments),p=m.length;if(p===0)return ge("zero alternates");for(var b=0;b<p;b+=1)X(m[b]);return s(function(S,N){for(var w,D=0;D<m.length;D+=1)if((w=G(m[D]._(S,N),w)).status)return w;return w})}function Oe(m,p){return be(m,p).or(ae([]))}function be(m,p){return X(m),X(p),ne(m,p.then(m).many(),function(b,S){return[b].concat(S)})}function de(m){k(m);var p="'"+m+"'";return s(function(b,S){var N=S+m.length,w=b.slice(S,N);return w===m?A(N,w):q(S,p)})}function ee(m,p){(function(N){if(!(N instanceof RegExp))throw new Error("not a regexp: "+N);for(var w=Se(N),D=0;D<w.length;D++){var R=w.charAt(D);if(R!=="i"&&R!=="m"&&R!=="u"&&R!=="s")throw new Error('unsupported regexp flag "'+R+'": '+N)}})(m),arguments.length>=2?$(p):p=0;var b=function(N){return RegExp("^(?:"+N.source+")",Se(N))}(m),S=""+m;return s(function(N,w){var D=b.exec(N.slice(w));if(D){if(0<=p&&p<=D.length){var R=D[0],Y=D[p];return A(w+R.length,Y)}return q(w,"valid match group (0 to "+D.length+") in "+S)}return q(w,S)})}function ae(m){return s(function(p,b){return A(b,m)})}function ge(m){return s(function(p,b){return q(b,m)})}function _e(m){if(L(m))return s(function(p,b){var S=m._(p,b);return S.index=b,S.value="",S});if(typeof m=="string")return _e(de(m));if(m instanceof RegExp)return _e(ee(m));throw new Error("not a string, regexp, or parser: "+m)}function Ne(m){return X(m),s(function(p,b){var S=m._(p,b),N=p.slice(b,S.index);return S.status?q(b,'not "'+N+'"'):A(b,null)})}function ye(m){return P(m),s(function(p,b){var S=_(p,b);return b<p.length&&m(S)?A(b+1,S):q(b,"a character/byte matching "+m)})}function we(m,p){arguments.length<2&&(p=m,m=void 0);var b=s(function(S,N){return b._=p()._,b._(S,N)});return m?b.desc(m):b}function ve(){return ge("fantasy-land/empty")}o.parse=function(m){if(typeof m!="string"&&!I(m))throw new Error(".parse must be called with a string or Buffer as its argument");var p,b=this.skip($e)._(m,0);return p=b.status?{status:!0,value:b.value}:{status:!1,index:Q(m,b.furthest),expected:b.expected},delete J[m],p},o.tryParse=function(m){var p=this.parse(m);if(p.status)return p.value;var b=Te(m,p),S=new Error(b);throw S.type="ParsimmonError",S.result=p,S},o.assert=function(m,p){return this.chain(function(b){return m(b)?ae(b):ge(p)})},o.or=function(m){return pe(this,m)},o.trim=function(m){return this.wrap(m,m)},o.wrap=function(m,p){return ne(m,this,p,function(b,S){return S})},o.thru=function(m){return m(this)},o.then=function(m){return X(m),he(this,m).map(function(p){return p[1]})},o.many=function(){var m=this;return s(function(p,b){for(var S=[],N=void 0;;){if(!(N=G(m._(p,b),N)).status)return G(A(b,S),N);if(b===N.index)throw new Error("infinite loop detected in .many() parser --- calling .many() on a parser which can accept zero characters is usually the cause");b=N.index,S.push(N.value)}})},o.tieWith=function(m){return k(m),this.map(function(p){if(function(N){if(!M(N))throw new Error("not an array: "+N)}(p),p.length){k(p[0]);for(var b=p[0],S=1;S<p.length;S++)k(p[S]),b+=m+p[S];return b}return""})},o.tie=function(){return this.tieWith("")},o.times=function(m,p){var b=this;return arguments.length<2&&(p=m),$(m),$(p),s(function(S,N){for(var w=[],D=void 0,R=void 0,Y=0;Y<m;Y+=1){if(R=G(D=b._(S,N),R),!D.status)return R;N=D.index,w.push(D.value)}for(;Y<p&&(R=G(D=b._(S,N),R),D.status);Y+=1)N=D.index,w.push(D.value);return G(A(N,w),R)})},o.result=function(m){return this.map(function(){return m})},o.atMost=function(m){return this.times(0,m)},o.atLeast=function(m){return ne(this.times(m),this.many(),function(p,b){return p.concat(b)})},o.map=function(m){P(m);var p=this;return s(function(b,S){var N=p._(b,S);return N.status?G(A(N.index,m(N.value)),N):N})},o.contramap=function(m){P(m);var p=this;return s(function(b,S){var N=p.parse(m(b.slice(S)));return N.status?A(S+b.length,N.value):N})},o.promap=function(m,p){return P(m),P(p),this.contramap(m).map(p)},o.skip=function(m){return he(this,m).map(function(p){return p[0]})},o.mark=function(){return ne(fe,this,fe,function(m,p,b){return{start:m,value:p,end:b}})},o.node=function(m){return ne(fe,this,fe,function(p,b,S){return{name:m,value:b,start:p,end:S}})},o.sepBy=function(m){return Oe(this,m)},o.sepBy1=function(m){return be(this,m)},o.lookahead=function(m){return this.skip(_e(m))},o.notFollowedBy=function(m){return this.skip(Ne(m))},o.desc=function(m){M(m)||(m=[m]);var p=this;return s(function(b,S){var N=p._(b,S);return N.status||(N.expected=m),N})},o.fallback=function(m){return this.or(ae(m))},o.ap=function(m){return ne(m,this,function(p,b){return p(b)})},o.chain=function(m){var p=this;return s(function(b,S){var N=p._(b,S);return N.status?G(m(N.value)._(b,N.index),N):N})},o.concat=o.or,o.empty=ve,o.of=ae,o["fantasy-land/ap"]=o.ap,o["fantasy-land/chain"]=o.chain,o["fantasy-land/concat"]=o.concat,o["fantasy-land/empty"]=o.empty,o["fantasy-land/of"]=o.of,o["fantasy-land/map"]=o.map;var fe=s(function(m,p){return A(p,Q(m,p))}),Ae=s(function(m,p){return p>=m.length?q(p,"any character/byte"):A(p+1,_(m,p))}),Me=s(function(m,p){return A(m.length,m.slice(p))}),$e=s(function(m,p){return p<m.length?q(p,"EOF"):A(p,null)}),Ee=ee(/[0-9]/).desc("a digit"),xe=ee(/[0-9]*/).desc("optional digits"),Re=ee(/[a-z]/i).desc("a letter"),Fe=ee(/[a-z]*/i).desc("optional letters"),Le=ee(/\s*/).desc("optional whitespace"),qe=ee(/\s+/).desc("whitespace"),De=de("\r"),Pe=de(`
`),Ie=de(`\r
`),ke=pe(Ie,Pe,De).desc("newline"),Ge=pe(ke,$e);s.all=Me,s.alt=pe,s.any=Ae,s.cr=De,s.createLanguage=function(m){var p={};for(var b in m)({}).hasOwnProperty.call(m,b)&&function(S){p[S]=we(function(){return m[S](p)})}(b);return p},s.crlf=Ie,s.custom=function(m){return s(m(A,q))},s.digit=Ee,s.digits=xe,s.empty=ve,s.end=Ge,s.eof=$e,s.fail=ge,s.formatError=Te,s.index=fe,s.isParser=L,s.lazy=we,s.letter=Re,s.letters=Fe,s.lf=Pe,s.lookahead=_e,s.makeFailure=q,s.makeSuccess=A,s.newline=ke,s.noneOf=function(m){return ye(function(p){return m.indexOf(p)<0}).desc("none of '"+m+"'")},s.notFollowedBy=Ne,s.of=ae,s.oneOf=function(m){for(var p=m.split(""),b=0;b<p.length;b++)p[b]="'"+p[b]+"'";return ye(function(S){return m.indexOf(S)>=0}).desc(p)},s.optWhitespace=Le,s.Parser=s,s.range=function(m,p){return ye(function(b){return m<=b&&b<=p}).desc(m+"-"+p)},s.regex=ee,s.regexp=ee,s.sepBy=Oe,s.sepBy1=be,s.seq=he,s.seqMap=ne,s.seqObj=function(){for(var m,p={},b=0,S=(m=arguments,Array.prototype.slice.call(m)),N=S.length,w=0;w<N;w+=1){var D=S[w];if(!L(D)){if(M(D)&&D.length===2&&typeof D[0]=="string"&&L(D[1])){var R=D[0];if(Object.prototype.hasOwnProperty.call(p,R))throw new Error("seqObj: duplicate key "+R);p[R]=!0,b++;continue}throw new Error("seqObj arguments must be parsers or [string, parser] array pairs.")}}if(b===0)throw new Error("seqObj expects at least one named parser, found zero");return s(function(Y,z){for(var V,te={},Z=0;Z<N;Z+=1){var re,se;if(M(S[Z])?(re=S[Z][0],se=S[Z][1]):(re=null,se=S[Z]),!(V=G(se._(Y,z),V)).status)return V;re&&(te[re]=V.value),z=V.index}return G(A(z,te),V)})},s.string=de,s.succeed=ae,s.takeWhile=function(m){return P(m),s(function(p,b){for(var S=b;S<p.length&&m(_(p,S));)S++;return A(S,p.slice(b,S))})},s.test=ye,s.whitespace=qe,s["fantasy-land/empty"]=ve,s["fantasy-land/of"]=ae,s.Binary={bitSeq:y,bitSeqObj:function(m){h();var p={},b=0,S=c(function(w){if(M(w)){var D=w;if(D.length!==2)throw new Error("["+D.join(", ")+"] should be length 2, got length "+D.length);if(k(D[0]),$(D[1]),Object.prototype.hasOwnProperty.call(p,D[0]))throw new Error("duplicate key in bitSeqObj: "+D[0]);return p[D[0]]=!0,b++,D}return $(w),[null,w]},m);if(b<1)throw new Error("bitSeqObj expects at least one named pair, got ["+m.join(", ")+"]");var N=c(function(w){return w[0]},S);return y(c(function(w){return w[1]},S)).map(function(w){return l(function(D,R){return R[0]!==null&&(D[R[0]]=R[1]),D},{},c(function(D,R){return[D,w[R]]},N))})},byte:function(m){if(h(),$(m),m>255)throw new Error("Value specified to byte constructor ("+m+"=0x"+m.toString(16)+") is larger in value than a single byte.");var p=(m>15?"0x":"0x0")+m.toString(16);return s(function(b,S){var N=_(b,S);return N===m?A(S+1,N):q(S,p)})},buffer:function(m){return v("buffer",m).map(function(p){return Buffer.from(p)})},encodedString:function(m,p){return v("string",p).map(function(b){return b.toString(m)})},uintBE:C,uint8BE:C(1),uint16BE:C(2),uint32BE:C(4),uintLE:O,uint8LE:O(1),uint16LE:O(2),uint32LE:O(4),intBE:j,int8BE:j(1),int16BE:j(2),int32BE:j(4),intLE:F,int8LE:F(1),int16LE:F(2),int32LE:F(4),floatBE:v("floatBE",4).map(function(m){return m.readFloatBE(0)}),floatLE:v("floatLE",4).map(function(m){return m.readFloatLE(0)}),doubleBE:v("doubleBE",8).map(function(m){return m.readDoubleBE(0)}),doubleLE:v("doubleLE",8).map(function(m){return m.readDoubleLE(0)})},r.exports=s}])})})(parsimmon_umd_min);var parsimmon_umd_minExports=parsimmon_umd_min.exports,common$1={};(function(e){var t=commonjsGlobal&&commonjsGlobal.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(e,"__esModule",{value:!0}),e.interpretEscapes=e.word=e.token=e.whitespace=void 0;const r=t(parsimmon_umd_minExports);e.whitespace=r.default.regexp(/\s*/m);function n(o){return o.skip(e.whitespace)}e.token=n;function a(o){return r.default.string(o).thru(n)}e.word=a;function s(o){let u={b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};return o.replace(/\\(u[0-9a-fA-F]{4}|[^u])/,(l,c)=>{let d=c.charAt(0),f=c.slice(1);return d==="u"?String.fromCharCode(parseInt(f,16)):u.hasOwnProperty(d)?u[d]:d})}e.interpretEscapes=s})(common$1);var mongoParser={},__importDefault$g=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(mongoParser,"__esModule",{value:!0});mongoParser.mongoParser=void 0;const parsimmon_1$2=__importDefault$g(parsimmon_umd_minExports),common_1$2=common$1,operatorCondition=e=>t=>({__placeholder__:{[e]:t}}),regexCondition=e=>t=>({__placeholder__:{$regex:e.replace("#VALUE#",t),$options:"i"}}),numberTestCondition=()=>e=>({$or:[{__placeholder__:{$regex:`.*${e}.*`,$options:"i"}},{__placeholder__:e}]}),idRegex=/[('"]([0-9a-f]{24})['")]/,objectIdTestCondition=()=>e=>({$or:[{__placeholder__:{$oid:e.match(idRegex)[1]}}]}),testCondition=(e,t)=>()=>({__placeholder__:{[e]:t}}),multiTestCondition=e=>()=>({__placeholder__:e}),compoudCondition$2=e=>t=>t.length==1?t[0]:{[e]:t},negateCondition$1=e=>({__placeholder__:{$not:e.__placeholder__}}),createParser$2=()=>{const e={string1:()=>(0,common_1$2.token)(parsimmon_1$2.default.regexp(/"((?:\\.|.)*?)"/,1)).map(common_1$2.interpretEscapes).desc("string quoted"),string2:()=>(0,common_1$2.token)(parsimmon_1$2.default.regexp(/'((?:\\.|.)*?)'/,1)).map(common_1$2.interpretEscapes).desc("string quoted"),number:()=>(0,common_1$2.token)(parsimmon_1$2.default.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/)).map(Number).desc("number"),objectid:()=>(0,common_1$2.token)(parsimmon_1$2.default.regexp(/ObjectId\(['"]?[0-9a-f]{24}['"]?\)/)).desc("ObjectId"),noQuotedString:()=>parsimmon_1$2.default.regexp(/[^\s^,^'^"]+/).desc("string unquoted"),value:t=>parsimmon_1$2.default.alt(t.objectid,t.string1,t.string2,t.number,t.noQuotedString),valueTestObjectId:t=>t.objectid.map(objectIdTestCondition()),valueTestNum:t=>t.number.map(numberTestCondition()),valueTest:t=>t.value.map(regexCondition(".*#VALUE#.*")),comma:()=>(0,common_1$2.word)(","),not:()=>(0,common_1$2.word)("NOT"),empty:()=>(0,common_1$2.word)("EMPTY"),array:()=>(0,common_1$2.word)("ARRAY"),notExists:t=>t.not.then(t.exists).map(testCondition("$exists",!1)),notEmptyArray:t=>t.not.then(t.empty).then(t.array).map(multiTestCondition({$exists:!0,$type:"array",$ne:[]})),emptyArray:t=>t.empty.then(t.array).map(multiTestCondition({$exists:!0,$eq:[]})),exists:()=>(0,common_1$2.word)("EXISTS").map(testCondition("$exists",!0)),true:()=>(0,common_1$2.word)("TRUE").map(testCondition("$eq",!0)),false:()=>(0,common_1$2.word)("FALSE").map(testCondition("$eq",!1)),eq:t=>(0,common_1$2.word)("=").then(t.value).map(operatorCondition("$eq")),ne:t=>(0,common_1$2.word)("!=").then(t.value).map(operatorCondition("$ne")),ne2:t=>(0,common_1$2.word)("<>").then(t.value).map(operatorCondition("$ne")),lt:t=>(0,common_1$2.word)("<").then(t.value).map(operatorCondition("$lt")),gt:t=>(0,common_1$2.word)(">").then(t.value).map(operatorCondition("$gt")),le:t=>(0,common_1$2.word)("<=").then(t.value).map(operatorCondition("$lte")),ge:t=>(0,common_1$2.word)(">=").then(t.value).map(operatorCondition("$gte")),startsWith:t=>(0,common_1$2.word)("^").then(t.value).map(regexCondition("#VALUE#.*")),endsWith:t=>(0,common_1$2.word)("$").then(t.value).map(regexCondition(".*#VALUE#")),contains:t=>(0,common_1$2.word)("+").then(t.value).map(regexCondition(".*#VALUE#.*")),startsWithNot:t=>(0,common_1$2.word)("!^").then(t.value).map(regexCondition("#VALUE#.*")).map(negateCondition$1),endsWithNot:t=>(0,common_1$2.word)("!$").then(t.value).map(regexCondition(".*#VALUE#")).map(negateCondition$1),containsNot:t=>(0,common_1$2.word)("~").then(t.value).map(regexCondition(".*#VALUE#.*")).map(negateCondition$1),element:t=>parsimmon_1$2.default.alt(t.exists,t.notExists,t.true,t.false,t.eq,t.ne,t.ne2,t.lt,t.gt,t.le,t.ge,t.notEmptyArray,t.emptyArray,t.startsWith,t.endsWith,t.contains,t.startsWithNot,t.endsWithNot,t.containsNot,t.valueTestObjectId,t.valueTestNum,t.valueTest).trim(common_1$2.whitespace),factor:t=>t.element.sepBy(common_1$2.whitespace).map(compoudCondition$2("$and")),list:t=>t.factor.sepBy(t.comma).map(compoudCondition$2("$or"))};return parsimmon_1$2.default.createLanguage(e)};mongoParser.mongoParser=createParser$2();var datetimeParser={};const require$$3=getAugmentedNamespace(moment);var __importDefault$f=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(datetimeParser,"__esModule",{value:!0});datetimeParser.datetimeParser=void 0;const parsimmon_1$1=__importDefault$f(parsimmon_umd_minExports),moment_1$2=__importDefault$f(require$$3),common_1$1=common$1,compoudCondition$1=e=>t=>t.length==1?t[0]:{[e]:t};function getTransformCondition(e,t){return{conditionType:"binary",operator:"=",left:{exprType:"transform",transform:e,expr:{exprType:"placeholder"}},right:{exprType:"value",value:t}}}const yearCondition=()=>e=>getTransformCondition("YEAR",e),yearMonthCondition=()=>e=>{const t=e.match(/(\d\d\d\d)-(\d\d?)/);return{conditionType:"and",conditions:[getTransformCondition("YEAR",t[1]),getTransformCondition("MONTH",t[2])]}},yearMonthDayCondition=()=>e=>{const t=e.match(/(\d\d\d\d)-(\d\d?)-(\d\d?)/);return{conditionType:"and",conditions:[getTransformCondition("YEAR",t[1]),getTransformCondition("MONTH",t[2]),getTransformCondition("DAY",t[3])]}},yearEdge=e=>t=>(0,moment_1$2.default)(new Date(parseInt(t),0,1))[e]("year").format("YYYY-MM-DDTHH:mm:ss.SSS"),yearMonthEdge=e=>t=>{const r=t.match(/(\d\d\d\d)-(\d\d?)/);return(0,moment_1$2.default)(new Date(parseInt(r[1]),parseInt(r[2])-1,1))[e]("month").format("YYYY-MM-DDTHH:mm:ss.SSS")},yearMonthDayEdge=e=>t=>{const r=t.match(/(\d\d\d\d)-(\d\d?)-(\d\d?)/);return(0,moment_1$2.default)(new Date(parseInt(r[1]),parseInt(r[2])-1,parseInt(r[3])))[e]("day").format("YYYY-MM-DDTHH:mm:ss.SSS")},yearMonthDayMinuteEdge=e=>t=>{const r=t.match(/(\d\d\d\d)-(\d\d?)-(\d\d?)\s+(\d\d?):(\d\d?)/),n=r[1],a=r[2],s=r[3],o=r[4],u=r[5],l=new Date(n,a-1,s,o,u);return(0,moment_1$2.default)(l)[e]("minute").format("YYYY-MM-DDTHH:mm:ss.SSS")},yearMonthDayMinuteSecondEdge=e=>t=>{const r=t.match(/(\d\d\d\d)-(\d\d?)-(\d\d?)(T|\s+)(\d\d?):(\d\d?):(\d\d?)/),n=r[1],a=r[2],s=r[3],o=r[5],u=r[6],l=r[7],c=new Date(n,a-1,s,o,u,l);return(0,moment_1$2.default)(c)[e]("second").format("YYYY-MM-DDTHH:mm:ss.SSS")},createIntervalCondition=(e,t)=>({conditionType:"and",conditions:[{conditionType:"binary",operator:">=",left:{exprType:"placeholder"},right:{exprType:"value",value:e}},{conditionType:"binary",operator:"<=",left:{exprType:"placeholder"},right:{exprType:"value",value:t}}]}),createDateIntervalCondition=(e,t)=>createIntervalCondition(e.format("YYYY-MM-DDTHH:mm:ss.SSS"),t.format("YYYY-MM-DDTHH:mm:ss.SSS")),fixedMomentIntervalCondition=(e,t)=>()=>createDateIntervalCondition((0,moment_1$2.default)().add(e,t).startOf(e),(0,moment_1$2.default)().add(e,t).endOf(e)),yearMonthDayMinuteCondition=()=>e=>{const t=e.match(/(\d\d\d\d)-(\d\d?)-(\d\d?)\s+(\d\d?):(\d\d?)/),r=t[1],n=t[2],a=t[3],s=t[4],o=t[5],u=new Date(r,n-1,a,s,o);return createDateIntervalCondition((0,moment_1$2.default)(u).startOf("minute"),(0,moment_1$2.default)(u).endOf("minute"))},yearMonthDaySecondCondition=()=>e=>{const t=e.match(/(\d\d\d\d)-(\d\d?)-(\d\d?)(T|\s+)(\d\d?):(\d\d?):(\d\d?)/),r=t[1],n=t[2],a=t[3],s=t[5],o=t[6],u=t[7],l=new Date(r,n-1,a,s,o,u);return createDateIntervalCondition((0,moment_1$2.default)(l).startOf("second"),(0,moment_1$2.default)(l).endOf("second"))},binaryCondition$1=e=>t=>({conditionType:"binary",operator:e,left:{exprType:"placeholder"},right:{exprType:"value",value:t}}),unaryCondition$1=e=>()=>({conditionType:e,expr:{exprType:"placeholder"}}),sqlTemplate$1=e=>({conditionType:"rawTemplate",templateSql:e,expr:{exprType:"placeholder"}}),createParser$1=()=>{const e={comma:()=>(0,common_1$1.word)(","),not:()=>(0,common_1$1.word)("NOT"),notNull:t=>t.not.then(t.null).map(unaryCondition$1("isNotNull")),null:()=>(0,common_1$1.word)("NULL").map(unaryCondition$1("isNull")),sql:()=>(0,common_1$1.token)(parsimmon_1$1.default.regexp(/\{(.*?)\}/,1)).map(sqlTemplate$1).desc("sql literal"),yearNum:()=>parsimmon_1$1.default.regexp(/\d\d\d\d/).map(yearCondition()),yearMonthNum:()=>parsimmon_1$1.default.regexp(/\d\d\d\d-\d\d?/).map(yearMonthCondition()),yearMonthDayNum:()=>parsimmon_1$1.default.regexp(/\d\d\d\d-\d\d?-\d\d?/).map(yearMonthDayCondition()),yearMonthDayMinute:()=>parsimmon_1$1.default.regexp(/\d\d\d\d-\d\d?-\d\d?\s+\d\d?:\d\d?/).map(yearMonthDayMinuteCondition()),yearMonthDaySecond:()=>parsimmon_1$1.default.regexp(/\d\d\d\d-\d\d?-\d\d?(\s+|T)\d\d?:\d\d?:\d\d?/).map(yearMonthDaySecondCondition()),yearNumStart:()=>parsimmon_1$1.default.regexp(/\d\d\d\d/).map(yearEdge("startOf")),yearNumEnd:()=>parsimmon_1$1.default.regexp(/\d\d\d\d/).map(yearEdge("endOf")),yearMonthStart:()=>parsimmon_1$1.default.regexp(/\d\d\d\d-\d\d?/).map(yearMonthEdge("startOf")),yearMonthEnd:()=>parsimmon_1$1.default.regexp(/\d\d\d\d-\d\d?/).map(yearMonthEdge("endOf")),yearMonthDayStart:()=>parsimmon_1$1.default.regexp(/\d\d\d\d-\d\d?-\d\d?/).map(yearMonthDayEdge("startOf")),yearMonthDayEnd:()=>parsimmon_1$1.default.regexp(/\d\d\d\d-\d\d?-\d\d?/).map(yearMonthDayEdge("endOf")),yearMonthDayMinuteStart:()=>parsimmon_1$1.default.regexp(/\d\d\d\d-\d\d?-\d\d?\s+\d\d?:\d\d?/).map(yearMonthDayMinuteEdge("startOf")),yearMonthDayMinuteEnd:()=>parsimmon_1$1.default.regexp(/\d\d\d\d-\d\d?-\d\d?\s+\d\d?:\d\d?/).map(yearMonthDayMinuteEdge("endOf")),yearMonthDayMinuteSecondStart:()=>parsimmon_1$1.default.regexp(/\d\d\d\d-\d\d?-\d\d?(\s+|T)\d\d?:\d\d?:\d\d?/).map(yearMonthDayMinuteSecondEdge("startOf")),yearMonthDayMinuteSecondEnd:()=>parsimmon_1$1.default.regexp(/\d\d\d\d-\d\d?-\d\d?(\s+|T)\d\d?:\d\d?:\d\d?/).map(yearMonthDayMinuteSecondEdge("endOf")),this:()=>(0,common_1$1.word)("THIS"),last:()=>(0,common_1$1.word)("LAST"),next:()=>(0,common_1$1.word)("NEXT"),week:()=>(0,common_1$1.word)("WEEK"),month:()=>(0,common_1$1.word)("MONTH"),year:()=>(0,common_1$1.word)("YEAR"),yesterday:()=>(0,common_1$1.word)("YESTERDAY").map(fixedMomentIntervalCondition("day",-1)),today:()=>(0,common_1$1.word)("TODAY").map(fixedMomentIntervalCondition("day",0)),tomorrow:()=>(0,common_1$1.word)("TOMORROW").map(fixedMomentIntervalCondition("day",1)),lastWeek:t=>t.last.then(t.week).map(fixedMomentIntervalCondition("week",-1)),thisWeek:t=>t.this.then(t.week).map(fixedMomentIntervalCondition("week",0)),nextWeek:t=>t.next.then(t.week).map(fixedMomentIntervalCondition("week",1)),lastMonth:t=>t.last.then(t.month).map(fixedMomentIntervalCondition("month",-1)),thisMonth:t=>t.this.then(t.month).map(fixedMomentIntervalCondition("month",0)),nextMonth:t=>t.next.then(t.month).map(fixedMomentIntervalCondition("month",1)),lastYear:t=>t.last.then(t.year).map(fixedMomentIntervalCondition("year",-1)),thisYear:t=>t.this.then(t.year).map(fixedMomentIntervalCondition("year",0)),nextYear:t=>t.next.then(t.year).map(fixedMomentIntervalCondition("year",1)),valueStart:t=>parsimmon_1$1.default.alt(t.yearMonthDayMinuteSecondStart,t.yearMonthDayMinuteStart,t.yearMonthDayStart,t.yearMonthStart,t.yearNumStart),valueEnd:t=>parsimmon_1$1.default.alt(t.yearMonthDayMinuteSecondEnd,t.yearMonthDayMinuteEnd,t.yearMonthDayEnd,t.yearMonthEnd,t.yearNumEnd),le:t=>(0,common_1$1.word)("<=").then(t.valueEnd).map(binaryCondition$1("<=")),ge:t=>(0,common_1$1.word)(">=").then(t.valueStart).map(binaryCondition$1(">=")),lt:t=>(0,common_1$1.word)("<").then(t.valueStart).map(binaryCondition$1("<")),gt:t=>(0,common_1$1.word)(">").then(t.valueEnd).map(binaryCondition$1(">")),element:t=>parsimmon_1$1.default.alt(t.yearMonthDaySecond,t.yearMonthDayMinute,t.yearMonthDayNum,t.yearMonthNum,t.yearNum,t.yesterday,t.today,t.tomorrow,t.lastWeek,t.thisWeek,t.nextWeek,t.lastMonth,t.thisMonth,t.nextMonth,t.lastYear,t.thisYear,t.nextYear,t.null,t.notNull,t.le,t.lt,t.ge,t.gt,t.sql).trim(common_1$1.whitespace),factor:t=>t.element.sepBy(common_1$1.whitespace).map(compoudCondition$1("$and")),list:t=>t.factor.sepBy(t.comma).map(compoudCondition$1("$or"))};return parsimmon_1$1.default.createLanguage(e)};datetimeParser.datetimeParser=createParser$1();var __importDefault$e=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(parseFilter$1,"__esModule",{value:!0});parseFilter$1.parseFilter=void 0;const parsimmon_1=__importDefault$e(parsimmon_umd_minExports),common_1=common$1,mongoParser_1=mongoParser,datetimeParser_1=datetimeParser,dbgate_tools_1$9=lib$5,binaryCondition=e=>t=>({conditionType:"binary",operator:e,left:{exprType:"placeholder"},right:{exprType:"value",value:t}}),likeCondition=(e,t)=>r=>({conditionType:e,left:{exprType:"placeholder"},right:{exprType:"value",value:t.replace("#VALUE#",r)}}),compoudCondition=e=>t=>t.length==1?t[0]:{conditionType:e,conditions:t},unaryCondition=e=>()=>({conditionType:e,expr:{exprType:"placeholder"}}),binaryFixedValueCondition=e=>()=>({conditionType:"binary",operator:"=",left:{exprType:"placeholder"},right:{exprType:"value",value:e}}),negateCondition=e=>({conditionType:"not",condition:e}),sqlTemplate=e=>({conditionType:"rawTemplate",templateSql:e,expr:{exprType:"placeholder"}}),createParser=e=>{const t={string1:()=>(0,common_1.token)(parsimmon_1.default.regexp(/"((?:\\.|.)*?)"/,1)).map(common_1.interpretEscapes).desc("string quoted"),string2:()=>(0,common_1.token)(parsimmon_1.default.regexp(/'((?:\\.|.)*?)'/,1)).map(common_1.interpretEscapes).desc("string quoted"),string1Num:()=>(0,common_1.token)(parsimmon_1.default.regexp(/"-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?"/,1)).map(Number).desc("numer quoted"),string2Num:()=>(0,common_1.token)(parsimmon_1.default.regexp(/'-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?'/,1)).map(Number).desc("numer quoted"),number:()=>(0,common_1.token)(parsimmon_1.default.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/)).map(Number).desc("number"),hexstring:()=>(0,common_1.token)(parsimmon_1.default.regexp(/0x(([0-9a-fA-F][0-9a-fA-F])+)/,1)).map(a=>({type:"Buffer",data:(0,dbgate_tools_1$9.hexStringToArray)(a)})).desc("hex string"),noQuotedString:()=>parsimmon_1.default.regexp(/[^\s^,^'^"]+/).desc("string unquoted"),sql:()=>(0,common_1.token)(parsimmon_1.default.regexp(/\{(.*?)\}/,1)).map(sqlTemplate).desc("sql literal"),value:a=>parsimmon_1.default.alt(...r.map(s=>a[s])),valueTestEq:a=>a.value.map(binaryCondition("=")),hexTestEq:a=>a.hexstring.map(binaryCondition("=")),valueTestStr:a=>a.value.map(likeCondition("like","%#VALUE#%")),comma:()=>(0,common_1.word)(","),not:()=>(0,common_1.word)("NOT"),notNull:a=>a.not.then(a.null).map(unaryCondition("isNotNull")),null:()=>(0,common_1.word)("NULL").map(unaryCondition("isNull")),empty:()=>(0,common_1.word)("EMPTY").map(unaryCondition("isEmpty")),notEmpty:a=>a.not.then(a.empty).map(unaryCondition("isNotEmpty")),true:()=>parsimmon_1.default.regexp(/true/i).map(binaryFixedValueCondition("1")),false:()=>parsimmon_1.default.regexp(/false/i).map(binaryFixedValueCondition("0")),trueNum:()=>(0,common_1.word)("1").map(binaryFixedValueCondition("1")),falseNum:()=>(0,common_1.word)("0").map(binaryFixedValueCondition("0")),eq:a=>(0,common_1.word)("=").then(a.value).map(binaryCondition("=")),ne:a=>(0,common_1.word)("!=").then(a.value).map(binaryCondition("<>")),ne2:a=>(0,common_1.word)("<>").then(a.value).map(binaryCondition("<>")),le:a=>(0,common_1.word)("<=").then(a.value).map(binaryCondition("<=")),ge:a=>(0,common_1.word)(">=").then(a.value).map(binaryCondition(">=")),lt:a=>(0,common_1.word)("<").then(a.value).map(binaryCondition("<")),gt:a=>(0,common_1.word)(">").then(a.value).map(binaryCondition(">")),startsWith:a=>(0,common_1.word)("^").then(a.value).map(likeCondition("like","#VALUE#%")),endsWith:a=>(0,common_1.word)("$").then(a.value).map(likeCondition("like","%#VALUE#")),contains:a=>(0,common_1.word)("+").then(a.value).map(likeCondition("like","%#VALUE#%")),startsWithNot:a=>(0,common_1.word)("!^").then(a.value).map(likeCondition("like","#VALUE#%")).map(negateCondition),endsWithNot:a=>(0,common_1.word)("!$").then(a.value).map(likeCondition("like","%#VALUE#")).map(negateCondition),containsNot:a=>(0,common_1.word)("~").then(a.value).map(likeCondition("like","%#VALUE#%")).map(negateCondition),element:a=>parsimmon_1.default.alt(...n.map(s=>a[s])).trim(common_1.whitespace),factor:a=>a.element.sepBy(common_1.whitespace).map(compoudCondition("and")),list:a=>a.factor.sepBy(a.comma).map(compoudCondition("or"))},r=[];(e=="string"||e=="eval")&&r.push("string1","string2","noQuotedString"),e=="number"&&r.push("string1Num","string2Num","number");const n=["null","notNull","eq","ne","ne2","sql"];return(e=="number"||e=="datetime"||e=="eval")&&n.push("le","ge","lt","gt"),e=="string"&&n.push("empty","notEmpty","hexTestEq"),(e=="eval"||e=="string")&&n.push("startsWith","endsWith","contains","startsWithNot","endsWithNot","containsNot"),e=="logical"&&n.push("true","false","trueNum","falseNum"),e=="eval"&&n.push("true","false"),e=="string"||e=="eval"?n.push("valueTestStr"):n.push("valueTestEq"),parsimmon_1.default.createLanguage(t)},parsers={number:createParser("number"),string:createParser("string"),logical:createParser("logical"),eval:createParser("eval"),mongo:mongoParser_1.mongoParser,datetime:datetimeParser_1.datetimeParser};function parseFilter(e,t){return parsers[t].list.tryParse(e)}parseFilter$1.parseFilter=parseFilter;var getFilterType$1={};Object.defineProperty(getFilterType$1,"__esModule",{value:!0});getFilterType$1.getFilterType=void 0;const dbgate_tools_1$8=lib$5;function getFilterType(e){return e?(0,dbgate_tools_1$8.isTypeNumber)(e)?"number":(0,dbgate_tools_1$8.isTypeString)(e)?"string":(0,dbgate_tools_1$8.isTypeLogical)(e)?"logical":(0,dbgate_tools_1$8.isTypeDateTime)(e)?"datetime":"string":"string"}getFilterType$1.getFilterType=getFilterType;var filterTool={},__importDefault$d=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(filterTool,"__esModule",{value:!0});filterTool.createMultiLineFilter=filterTool.getFilterValueExpression=void 0;const dbgate_tools_1$7=lib$5,moment_1$1=__importDefault$d(require$$3);function getFilterValueExpression(e,t){return e==null?"NULL":(0,dbgate_tools_1$7.isTypeDateTime)(t)?(0,moment_1$1.default)(e).format("YYYY-MM-DD HH:mm:ss"):e===!0?"TRUE":e===!1?"FALSE":e.$oid?`ObjectId("${e.$oid}")`:e.type=="Buffer"&&Array.isArray(e.data)?"0x"+(0,dbgate_tools_1$7.arrayToHexString)(e.data):`="${e}"`}filterTool.getFilterValueExpression=getFilterValueExpression;function createMultiLineFilter(e,t){let r="";for(let n of t.split(`
`))if(n=n.trim(),n.length!=0){if(r.length>0)switch(e){case"is_not":r+=" ";break;default:r+=",";break}switch(e){case"is":r+="='"+n+"'";break;case"is_not":r+="<>'"+n+"'";break;case"contains":r+="'"+n+"'";break;case"begins":r+="^'"+n+"'";break;case"ends":r+="$'"+n+"'";break}}return r}filterTool.createMultiLineFilter=createMultiLineFilter;(function(e){var t=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(n,a,s,o){o===void 0&&(o=s);var u=Object.getOwnPropertyDescriptor(a,s);(!u||("get"in u?!a.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return a[s]}}),Object.defineProperty(n,o,u)}:function(n,a,s,o){o===void 0&&(o=s),n[o]=a[s]}),r=commonjsGlobal&&commonjsGlobal.__exportStar||function(n,a){for(var s in n)s!=="default"&&!Object.prototype.hasOwnProperty.call(a,s)&&t(a,n,s)};Object.defineProperty(e,"__esModule",{value:!0}),r(parseFilter$1,e),r(getFilterType$1,e),r(filterTool,e)})(lib);var __importDefault$c=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(GridDisplay$1,"__esModule",{value:!0});GridDisplay$1.reloadDataCacheFunc=GridDisplay$1.GridDisplay=void 0;const lodash_1$5=__importDefault$c(lodashExports),GridConfig_1=GridConfig,dbgate_filterparser_1$1=lib,dbgate_tools_1$6=lib$5,dbgate_sqltree_1=lib$2,dbgate_tools_2=lib$5;class GridDisplay{constructor(t,r,n,a,s,o=null,u=null){this.config=t,this.setConfig=r,this.cache=n,this.setCache=a,this.driver=s,this.dbinfo=o,this.serverVersion=u,this.formColumns=[],this.changeSetKeyFields=null,this.editableStructure=null,this.sortable=!1,this.groupable=!1,this.filterable=!1,this.editable=!1,this.isLoadedCorrectly=!0,this.supportsReload=!1,this.isDynamicStructure=!1,this.filterTypeOverride=null,this.dialect=(s==null?void 0:s.dialectByVersion)&&(s==null?void 0:s.dialectByVersion(u))||(s==null?void 0:s.dialect)}get baseTableOrSimilar(){return this.baseTable||this.baseCollection||this.baseView}get baseTableOrCollection(){return this.baseTable||this.baseCollection}get baseTableOrView(){return this.baseTable||this.baseView}setColumnVisibility(t,r){const n=t.join(".");t.length==1?this.includeInColumnSet("hiddenColumns",n,!r):(this.includeInColumnSet("addedColumns",n,r),this.isDynamicStructure||this.reload())}addDynamicColumn(t){this.includeInColumnSet("addedColumns",t,!0)}focusColumns(t){this.setConfig(r=>Object.assign(Object.assign({},r),{focusedColumns:t}))}get hasReferences(){return!1}get focusedColumns(){return this.config.focusedColumns}get engine(){var t;return(t=this.driver)===null||t===void 0?void 0:t.engine}get allColumns(){return this.getColumns(null).filter(t=>t.isChecked||t.uniquePath.length==1)}findColumn(t){return this.getColumns(null).find(r=>r.uniqueName==t)}getFkTarget(t){return null}reload(){this.setCache(reloadDataCacheFunc)}includeInColumnSet(t,r,n){n?this.setConfig(a=>Object.assign(Object.assign({},a),{[t]:[...a[t]||[],r]})):this.setConfig(a=>Object.assign(Object.assign({},a),{[t]:(a[t]||[]).filter(s=>s!=r)}))}showAllColumns(){this.setConfig(t=>Object.assign(Object.assign({},t),{hiddenColumns:[]}))}hideAllColumns(){this.setConfig(t=>Object.assign(Object.assign({},t),{hiddenColumns:this.columns.filter(r=>r.uniquePath.length==1).map(r=>r.uniqueName)}))}get hiddenColumnIndexes(){return(this.config.hiddenColumns||[]).map(t=>lodash_1$5.default.findIndex(this.allColumns,r=>r.uniqueName==t))}isColumnChecked(t){return t.uniquePath.length==1?!this.config.hiddenColumns.includes(t.uniqueName):this.config.addedColumns.includes(t.uniqueName)}applyFilterOnSelect(t,r){const n=[];for(const a in this.config.filters){const s=this.config.filters[a];if(!s)continue;const o=r[a];if(o)try{const u=(0,dbgate_filterparser_1$1.parseFilter)(s,(0,dbgate_filterparser_1$1.getFilterType)(o.dataType));u&&n.push(lodash_1$5.default.cloneDeepWith(u,l=>{if(l.exprType=="placeholder")return this.createColumnExpression(o,{alias:o.sourceAlias})}))}catch(u){console.warn(u.message);continue}}if(this.baseTableOrView&&this.config.multiColumnFilter)try{const a=(0,dbgate_filterparser_1$1.parseFilter)(this.config.multiColumnFilter,"string");if(a){const s={conditionType:"or",conditions:[]};for(const o of this.baseTableOrView.columns)s.conditions.push(lodash_1$5.default.cloneDeepWith(a,u=>{if(u.exprType=="placeholder")return this.createColumnExpression(o,{alias:"basetbl"})}));s.conditions.length>0&&n.push(s)}}catch(a){console.warn(a.message)}n.length>0&&(t.where={conditionType:"and",conditions:n})}applySortOnSelect(t,r){var n;((n=this.config.sort)===null||n===void 0?void 0:n.length)>0&&(t.orderBy=this.config.sort.map(a=>Object.assign(Object.assign({},a),{dispInfo:r[a.uniqueName]})).map(a=>Object.assign(Object.assign({},a),{expr:t.columns.find(s=>s.alias==a.uniqueName)})).filter(a=>a.dispInfo&&a.expr).map(a=>Object.assign(Object.assign({},a.expr),{direction:a.order})))}get isGrouped(){return!lodash_1$5.default.isEmpty(this.config.grouping)}get groupColumns(){return this.isGrouped?lodash_1$5.default.keys(lodash_1$5.default.pickBy(this.config.grouping,t=>t=="GROUP"||t.startsWith("GROUP:"))):null}applyGroupOnSelect(t,r){const n=this.groupColumns;if(n&&n.length>0&&(t.groupBy=n.map(a=>{const s={exprType:"column",columnName:r[a].columnName,source:{alias:r[a].sourceAlias}},o=this.config.grouping[a];return o.startsWith("GROUP:")?{exprType:"transform",transform:o,expr:s}:s})),!lodash_1$5.default.isEmpty(this.config.grouping)){for(let a=0;a<t.columns.length;a++){const s=t.columns[a].alias,o=this.getGrouping(s);if(o!="GROUP")if(o=="NULL")t.columns[a].alias=null;else if(o&&o.startsWith("GROUP:"))t.columns[a]={exprType:"transform",transform:o,expr:t.columns[a],alias:t.columns[a].alias};else{let u="MAX",l="";o&&(o=="COUNT DISTINCT"?(u="COUNT",l="DISTINCT "):u=o),t.columns[a]={alias:t.columns[a].alias,exprType:"call",func:u,argsPrefix:l,args:[t.columns[a]]}}}t.columns=t.columns.filter(a=>a.alias)}}getColumns(t){return this.columns.filter(r=>(0,dbgate_tools_1$6.filterName)(t,r.columnName))}getGridColumns(){return this.getColumns(null).filter(t=>this.isColumnChecked(t))}isExpandedColumn(t){return this.config.expandedColumns.includes(t)}toggleExpandedColumn(t,r){this.includeInColumnSet("expandedColumns",t,r??!this.isExpandedColumn(t))}getFilter(t){return this.config.filters[t]}setFilter(t,r){this.setConfig(n=>Object.assign(Object.assign({},n),{filters:Object.assign(Object.assign({},n.filters),{[t]:r}),formViewRecordNumber:0})),this.reload()}setMutliColumnFilter(t){this.setConfig(r=>Object.assign(Object.assign({},r),{multiColumnFilter:t,formViewRecordNumber:0})),this.reload()}showFilter(t){this.setConfig(r=>r.filters.uniqueName?r:Object.assign(Object.assign({},r),{filters:Object.assign(Object.assign({},lodash_1$5.default.omitBy(r.filters,n=>!n)),{[t]:""})}))}removeFilter(t){this.setConfig(r=>Object.assign(Object.assign({},r),{filters:lodash_1$5.default.omit(r.filters,[t]),formFilterColumns:(r.formFilterColumns||[]).filter(n=>n!=t)})),this.reload()}setFilters(t){this.setConfig(r=>Object.assign(Object.assign({},r),{filters:Object.assign(Object.assign({},r.filters),t)})),this.reload()}setSort(t,r){this.setConfig(n=>Object.assign(Object.assign({},n),{sort:[{uniqueName:t,order:r}]})),this.reload()}addToSort(t,r){this.setConfig(n=>Object.assign(Object.assign({},n),{sort:[...n.sort||[],{uniqueName:t,order:r}]})),this.reload()}clearSort(){this.setConfig(t=>Object.assign(Object.assign({},t),{sort:[]})),this.reload()}setGrouping(t,r){this.setConfig(n=>Object.assign(Object.assign({},n),{grouping:r?Object.assign(Object.assign({},n.grouping),{[t]:r}):lodash_1$5.default.omitBy(n.grouping,(a,s)=>s==t)})),this.reload()}getGrouping(t){var r,n;if(this.isGrouped){if(this.config.grouping[t])return this.config.grouping[t];const a=(n=(r=this.baseTable||this.baseView)===null||r===void 0?void 0:r.columns)===null||n===void 0?void 0:n.find(s=>s.columnName==t);return(0,dbgate_tools_2.isTypeLogical)(a==null?void 0:a.dataType)?"COUNT DISTINCT":a!=null&&a.autoIncrement?"COUNT":"MAX"}return null}clearGrouping(){this.setConfig(t=>Object.assign(Object.assign({},t),{grouping:{}})),this.reload()}getSortOrder(t){var r;return(r=this.config.sort.find(n=>n.uniqueName==t))===null||r===void 0?void 0:r.order}getSortOrderIndex(t){return this.config.sort.length<=1?-1:lodash_1$5.default.findIndex(this.config.sort,r=>r.uniqueName==t)}isSortDefined(){return(this.config.sort||[]).length>0}get filterCount(){return lodash_1$5.default.compact(lodash_1$5.default.values(this.config.filters)).length}clearFilters(){this.setConfig(t=>Object.assign(Object.assign({},t),{filters:{}})),this.reload()}resetConfig(){this.setConfig(t=>(0,GridConfig_1.createGridConfig)()),this.reload()}getChangeSetCondition(t){return this.changeSetKeyFields?lodash_1$5.default.pick(t,this.changeSetKeyFields):null}getChangeSetField(t,r,n,a=null,s=!1){const o=this.columns.find(l=>l.uniqueName==r);if(!o)return null;const u=this.baseTableOrSimilar;return!s&&(!u||u.pureName!=o.pureName||u.schemaName!=o.schemaName)?null:Object.assign(Object.assign({},this.getChangeSetRow(t,n,a,s)),{uniqueName:r,columnName:o.columnName})}getChangeSetRow(t,r,n,a=!1){const s=this.baseTableOrSimilar;return!a&&!s?null:{pureName:s==null?void 0:s.pureName,schemaName:s==null?void 0:s.schemaName,insertedRowIndex:r,existingRowIndex:n,condition:r==null&&n==null?this.getChangeSetCondition(t):null}}createSelect(t={}){return null}processReferences(t,r,n){}createColumnExpression(t,r,n){let a=null;return this.dialect.createColumnViewExpression&&(a=this.dialect.createColumnViewExpression(t.columnName,t.dataType,r,n),a)?a:Object.assign({exprType:"column",alias:n||t.columnName,source:r},t)}createSelectBase(t,r,n){var a;if(!r)return null;const s=r[0].columnName,o={commandType:"select",from:{name:lodash_1$5.default.pick(t,["schemaName","pureName"]),alias:"basetbl"},columns:r.map(l=>this.createColumnExpression(l,{alias:"basetbl"})),orderBy:!((a=this.driver)===null||a===void 0)&&a.requiresDefaultSortCriteria?[{exprType:"column",columnName:s,direction:"ASC"}]:null},u=lodash_1$5.default.keyBy(this.columns.map(l=>Object.assign(Object.assign({},l),{sourceAlias:"basetbl"})),"uniqueName");return this.processReferences(o,u,n),this.applyFilterOnSelect(o,u),this.applyGroupOnSelect(o,u),this.applySortOnSelect(o,u),o}getRowNumberOverSelect(t,r,n){return{commandType:"select",selectAll:!0,from:{subQuery:{commandType:"select",from:t.from,where:t.where,columns:[...t.columns,{alias:"_rowNumber",exprType:"rowNumber",orderBy:t.orderBy?t.orderBy.map(o=>o.exprType!="column"||o.source?o:Object.assign(Object.assign({},o),{source:{alias:"basetbl"}})):[Object.assign(Object.assign({},t.columns[0]),{direction:"ASC"})]}]},alias:"_RowNumberResult"},where:{conditionType:"between",expr:{exprType:"column",columnName:"_RowNumber",source:{alias:"_RowNumberResult"}},left:{exprType:"value",value:r+1},right:{exprType:"value",value:r+n}}}}getPageQuery(t,r){if(!this.driver)return null;let n=this.createSelect();return n?(this.dialect.rangeSelect?n.range={offset:t,limit:r}:this.dialect.rowNumberOverPaging&&t>0?n=this.getRowNumberOverSelect(n,t,r):this.dialect.limitSelect&&(n.topRecords=r),n):null}getExportQuery(t=null){const r=this.createSelect({isExport:!0});return r?(t&&t(r),(0,dbgate_sqltree_1.treeToSql)(this.driver,r,dbgate_sqltree_1.dumpSqlSelect)):null}getExportQueryJson(t=null){const r=this.createSelect({isExport:!0});return r?(t&&t(r),r):null}getExportColumnMap(){var t,r;const n=((t=this.config.hiddenColumns)===null||t===void 0?void 0:t.length)>0||((r=this.config.addedColumns)===null||r===void 0?void 0:r.length)>0;return this.isDynamicStructure&&!n?null:this.getColumns(null).filter(a=>a.isChecked).map(a=>({dst:a.uniqueName,src:a.uniqueName,ignore:!n}))}resizeColumn(t,r,n){this.setConfig(a=>{const s=Object.assign({},a.columnWidths);return s[t]?s[t]+=n:s[t]=r+n,Object.assign(Object.assign({},a),{columnWidths:s})})}getCountQuery(){let t=this.createSelect();return t.orderBy=null,this.isGrouped?t={commandType:"select",from:{subQuery:t,alias:"subq"},columns:[{exprType:"raw",sql:"COUNT(*)",alias:"count"}]}:t.columns=[{exprType:"raw",sql:"COUNT(*)",alias:"count"}],t}compileJslFilters(){var t;const r=this.config&&this.config.filters;if(!r)return null;const n=[];for(const a in r){const s=this.isDynamicStructure?null:this.columns.find(u=>u.columnName==a);if(!this.isDynamicStructure&&!s)continue;const o=(t=this.filterTypeOverride)!==null&&t!==void 0?t:this.isDynamicStructure?"mongo":(0,dbgate_filterparser_1$1.getFilterType)(s.dataType);try{const u=(0,dbgate_filterparser_1$1.parseFilter)(r[a],o),l=lodash_1$5.default.cloneDeepWith(u,c=>{if(c.exprType=="placeholder")return{exprType:"column",columnName:this.isDynamicStructure?a:s.columnName}});n.push(l)}catch{}}if(this.config.multiColumnFilter){const a=(0,dbgate_filterparser_1$1.parseFilter)(this.config.multiColumnFilter,"string");a&&n.push({conditionType:"anyColumnPass",placeholderCondition:a})}return n.length==0?null:{conditionType:"and",conditions:n}}switchToFormView(t){this.setConfig(r=>Object.assign(Object.assign({},r),{isFormView:!0,formViewRecordNumber:t}))}switchToJsonView(){this.setConfig(t=>Object.assign(Object.assign({},t),{isJsonView:!0}))}formViewNavigate(t,r){switch(t){case"begin":this.setConfig(n=>Object.assign(Object.assign({},n),{formViewRecordNumber:0}));break;case"previous":this.setConfig(n=>Object.assign(Object.assign({},n),{formViewRecordNumber:Math.max((n.formViewRecordNumber||0)-1,0)}));break;case"next":this.setConfig(n=>Object.assign(Object.assign({},n),{formViewRecordNumber:Math.max((n.formViewRecordNumber||0)+1,0)}));break;case"end":this.setConfig(n=>Object.assign(Object.assign({},n),{formViewRecordNumber:Math.max(r-1,0)}));break}this.reload()}}GridDisplay$1.GridDisplay=GridDisplay;function reloadDataCacheFunc(e){return Object.assign(Object.assign({},(0,GridConfig_1.createGridCache)()),{refreshTime:new Date().getTime()})}GridDisplay$1.reloadDataCacheFunc=reloadDataCacheFunc;var PerspectiveConfig={},__importDefault$b=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(PerspectiveConfig,"__esModule",{value:!0});PerspectiveConfig.switchPerspectiveReferenceDirection=PerspectiveConfig.extractPerspectiveDatabases=PerspectiveConfig.createPerspectiveConfig=PerspectiveConfig.createPerspectiveNodeConfig=void 0;const v1_1$2=__importDefault$b(v1_1$5);function createPerspectiveNodeConfig(e){return{pureName:e.pureName,schemaName:e.schemaName,designerId:(0,v1_1$2.default)(),expandedColumns:[],checkedColumns:[],columnDisplays:{},sort:[],filters:{},isNodeChecked:!0}}PerspectiveConfig.createPerspectiveNodeConfig=createPerspectiveNodeConfig;function createPerspectiveConfig(e){if(!e)return{nodes:[],references:[],isArranged:!0,rootDesignerId:null};const t=createPerspectiveNodeConfig(e);return{nodes:[t],references:[],rootDesignerId:t.designerId,isArranged:!0}}PerspectiveConfig.createPerspectiveConfig=createPerspectiveConfig;function extractPerspectiveDatabases({conid:e,database:t},r){const n=[];n.push({conid:e,database:t});function a(s,o){n.find(u=>u.conid==s&&u.database==o)||n.push({conid:s,database:o})}for(const s of r.nodes)a(s.conid||e,s.database||t);return n}PerspectiveConfig.extractPerspectiveDatabases=extractPerspectiveDatabases;function switchPerspectiveReferenceDirection(e){return{designerId:e.designerId,sourceId:e.targetId,targetId:e.sourceId,isAutoGenerated:e.isAutoGenerated,columns:e.columns.map(t=>({source:t.target,target:t.source}))}}PerspectiveConfig.switchPerspectiveReferenceDirection=switchPerspectiveReferenceDirection;var PerspectiveTreeNode$1={},reWhitespace=/\s/;function trimmedEndIndex$1(e){for(var t=e.length;t--&&reWhitespace.test(e.charAt(t)););return t}var _trimmedEndIndex=trimmedEndIndex$1,trimmedEndIndex=_trimmedEndIndex,reTrimStart=/^\s+/;function baseTrim$1(e){return e&&e.slice(0,trimmedEndIndex(e)+1).replace(reTrimStart,"")}var _baseTrim=baseTrim$1,baseTrim=_baseTrim,isObject=isObject_1,isSymbol$1=isSymbol_1,NAN=0/0,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt;function toNumber$1(e){if(typeof e=="number")return e;if(isSymbol$1(e))return NAN;if(isObject(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=isObject(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=baseTrim(e);var r=reIsBinary.test(e);return r||reIsOctal.test(e)?freeParseInt(e.slice(2),r?2:8):reIsBadHex.test(e)?NAN:+e}var toNumber_1=toNumber$1,toNumber=toNumber_1,INFINITY=1/0,MAX_INTEGER=17976931348623157e292;function toFinite$1(e){if(!e)return e===0?e:0;if(e=toNumber(e),e===INFINITY||e===-INFINITY){var t=e<0?-1:1;return t*MAX_INTEGER}return e===e?e:0}var toFinite_1=toFinite$1,toFinite=toFinite_1;function toInteger$3(e){var t=toFinite(e),r=t%1;return t===t?r?t-r:t:0}var toInteger_1=toInteger$3,baseFindIndex=_baseFindIndex,baseIteratee$1=_baseIteratee,toInteger$2=toInteger_1,nativeMax$1=Math.max;function findIndex(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var a=r==null?0:toInteger$2(r);return a<0&&(a=nativeMax$1(n+a,0)),baseFindIndex(e,baseIteratee$1(t),a)}var findIndex_1$2=findIndex,perspectiveTools={};Object.defineProperty(perspectiveTools,"__esModule",{value:!0});perspectiveTools.perspectiveValueMatcher=perspectiveTools.getPerspectiveMostNestedChildColumnName=perspectiveTools.getPerspectiveParentColumnName=void 0;function getPerspectiveParentColumnName(e){const t=e.split("::");return t.length>=2?t.slice(0,-1).join("::"):null}perspectiveTools.getPerspectiveParentColumnName=getPerspectiveParentColumnName;function getPerspectiveMostNestedChildColumnName(e){const t=e.split("::");return t[t.length-1]}perspectiveTools.getPerspectiveMostNestedChildColumnName=getPerspectiveMostNestedChildColumnName;function perspectiveValueMatcher(e,t){return e!=null&&e.$oid&&(t!=null&&t.$oid)?e.$oid==t.$oid:e==t}perspectiveTools.perspectiveValueMatcher=perspectiveValueMatcher;var __importDefault$a=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(PerspectiveTreeNode$1,"__esModule",{value:!0});PerspectiveTreeNode$1.getTableChildPerspectiveNodes=PerspectiveTreeNode$1.PerspectiveCustomJoinTreeNode=PerspectiveTreeNode$1.PerspectiveTableReferenceNode=PerspectiveTreeNode$1.PerspectiveTableNode=PerspectiveTreeNode$1.PerspectivePatternColumnNode=PerspectiveTreeNode$1.PerspectiveTableColumnNode=PerspectiveTreeNode$1.PerspectiveTreeNode=void 0;const dbgate_tools_1$5=lib$5,PerspectiveConfig_1=PerspectiveConfig,isEqual_1=__importDefault$a(isEqual_1$1),compact_1=__importDefault$a(compact_1$6),uniq_1=__importDefault$a(uniq_1$2),flatten_1=__importDefault$a(flatten_1$4),uniqBy_1=__importDefault$a(uniqBy_1$2),sortBy_1=__importDefault$a(sortBy_1$2),cloneDeepWith_1=__importDefault$a(cloneDeepWith_1$2),findIndex_1$1=__importDefault$a(findIndex_1$2),json_stable_stringify_1$1=__importDefault$a(jsonStableStringify),dbgate_filterparser_1=lib,v1_1$1=__importDefault$a(v1_1$5),perspectiveTools_1$1=perspectiveTools;class PerspectiveTreeNode{constructor(t,r,n,a,s,o,u){this.dbs=t,this.config=r,this.setConfig=n,this.parentNode=a,this.dataProvider=s,this.defaultDatabaseConfig=o,this.designerId=u,this.childNodesCache=null,this.nodeConfig=r.nodes.find(l=>l.designerId==u),this.parentNodeConfig=a==null?void 0:a.nodeConfig}get childNodes(){return this.childNodesCache||(this.childNodesCache=this.generateChildNodes()),this.childNodesCache}get fieldName(){return this.codeName}get headerTableAttributes(){return null}get dataField(){return this.codeName}get tableCode(){return null}get namedObject(){return null}get tableNodeOrParent(){return this instanceof PerspectiveTableNode?this:this.parentNode==null?null:this.parentNode.tableNodeOrParent}get engineType(){return null}get databaseConfig(){var t,r,n,a;const s=Object.assign({},this.defaultDatabaseConfig);return!((t=this.nodeConfig)===null||t===void 0)&&t.conid&&(s.conid=(r=this.nodeConfig)===null||r===void 0?void 0:r.conid),!((n=this.nodeConfig)===null||n===void 0)&&n.database&&(s.database=(a=this.nodeConfig)===null||a===void 0?void 0:a.database),s}get isRoot(){return this.parentNode==null}get rootNode(){var t;return this.isRoot?this:(t=this.parentNode)===null||t===void 0?void 0:t.rootNode}get isSortable(){return!1}get generatesHiearchicGridColumn(){return this.isExpandable&&this.isCheckedNode}get generatesDataGridColumn(){return this.isCheckedColumn}get validParentDesignerId(){var t;return this.designerId?this.designerId:(t=this.parentNode)===null||t===void 0?void 0:t.validParentDesignerId}get preloadedLevelData(){return!1}get findByDesignerIdWithoutDesignerId(){return!1}matchChildRow(t,r){return!0}hasTableCode(t){var r;return t==this.tableCode||((r=this.parentNode)===null||r===void 0?void 0:r.hasTableCode(t))}get level(){return this.parentNode?this.parentNode.level+1:0}get isExpanded(){var t,r;return(r=(t=this.parentNodeConfig)===null||t===void 0?void 0:t.expandedColumns)===null||r===void 0?void 0:r.includes(this.codeName)}get isCheckedColumn(){var t,r;return!!(!((r=(t=this.parentNodeConfig)===null||t===void 0?void 0:t.checkedColumns)===null||r===void 0)&&r.includes(this.codeName))}get isChecked(){return this.isCheckedColumn}get isCheckedNode(){var t,r;return!!this.designerId&&!!(!((r=(t=this.config.nodes)===null||t===void 0?void 0:t.find(n=>n.designerId==this.designerId))===null||r===void 0)&&r.isNodeChecked)}get isSecondaryChecked(){return!1}get secondaryCheckable(){return!1}get columnTitle(){return this.title}get filterType(){return"string"}get columnName(){return null}get customJoinConfig(){return null}get db(){var t,r;return(r=(t=this.dbs)===null||t===void 0?void 0:t[this.databaseConfig.conid])===null||r===void 0?void 0:r[this.databaseConfig.database]}get isCircular(){return!1}hasDesignerIdInIncestors(t){var r;return t==this.designerId?!0:((r=this.parentNode)===null||r===void 0?void 0:r.hasDesignerIdInIncestors(t))||!1}getChildMatchColumns(){return[]}getParentMatchColumns(){return[]}parseFilterCondition(t=null){return null}get hasUncheckedNodeInPath(){return this.parentNode?this.designerId&&!this.isCheckedNode?!0:this.parentNode.hasUncheckedNodeInPath:!1}get childDataColumn(){return this.isCheckedColumn?this.codeName:null}toggleExpanded(t){this.includeInNodeSet("expandedColumns",t??!this.isExpanded)}toggleChecked(t){this.includeInNodeSet("checkedColumns",t??!this.isChecked)}toggleCheckedNode(t){this.setConfig(r=>{var n;const a=(n=r.nodes.find(l=>l.designerId==this.designerId))===null||n===void 0?void 0:n.isNodeChecked,[s,o]=this.ensureNodeConfig(r);return Object.assign(Object.assign({},s),{nodes:s.nodes.map(l=>l.designerId==(this.designerId||o.designerId)?Object.assign(Object.assign({},l),{isNodeChecked:t??!a}):l)})})}toggleSecondaryChecked(t){}createReferenceConfigColumns(){return null}ensureNodeConfig(t){var r,n;let a=t.nodes.find(s=>s.designerId==this.designerId);if(!a){const s=Object.assign(Object.assign({},(0,PerspectiveConfig_1.createPerspectiveNodeConfig)(this.namedObject)),{isAutoGenerated:!0,conid:(r=this.parentNodeConfig)===null||r===void 0?void 0:r.conid,database:(n=this.parentNodeConfig)===null||n===void 0?void 0:n.database}),o={designerId:(0,v1_1$1.default)(),sourceId:this.parentNode.designerId,targetId:s.designerId,isAutoGenerated:!0,columns:this.createReferenceConfigColumns()};return[Object.assign(Object.assign({},t),{nodes:[...t.nodes,s],references:[...t.references,o]}),s]}return[t,a]}includeInNodeSet(t,r){this.setConfig(n=>{var a,s;const o=d=>Object.assign(Object.assign({},d),{[t]:r?[...d[t]||[],this.codeName]:(d[t]||[]).filter(f=>f!=this.codeName)}),[u,l]=(s=(a=this.parentNode)===null||a===void 0?void 0:a.tableNodeOrParent)===null||s===void 0?void 0:s.ensureNodeConfig(n);return Object.assign(Object.assign({},u),{nodes:u.nodes.map(d=>{var f,h;return d.designerId==(((h=(f=this.parentNode)===null||f===void 0?void 0:f.tableNodeOrParent)===null||h===void 0?void 0:h.designerId)||(l==null?void 0:l.designerId))?o(d):d})})})}getFilter(){var t,r;return(r=(t=this.parentNodeConfig)===null||t===void 0?void 0:t.filters)===null||r===void 0?void 0:r[this.codeName]}getDataLoadColumns(){return(0,compact_1.default)((0,uniq_1.default)([...this.childNodes.map(t=>t.childDataColumn),...(0,flatten_1.default)(this.childNodes.filter(t=>t.isExpandable&&t.isChecked).map(t=>t.getChildMatchColumns())),...this.getParentMatchColumns(),...this.childNodes.filter(t=>t instanceof PerspectivePatternColumnNode).filter(t=>{var r,n;return(n=(r=this.nodeConfig)===null||r===void 0?void 0:r.checkedColumns)===null||n===void 0?void 0:n.find(a=>a.startsWith(t.codeName+"::"))}).map(t=>t.columnName)]))}getMutliColumnSqlCondition(t){var r,n;if(!(!((r=this.nodeConfig)===null||r===void 0)&&r.multiColumnFilter))return null;const a=this.getBaseTableFromThis();if(!a)return null;try{const s=(0,dbgate_filterparser_1.parseFilter)((n=this.nodeConfig)===null||n===void 0?void 0:n.multiColumnFilter,"string");if(s){const o={conditionType:"or",conditions:[]};for(const u of a.columns||[])o.conditions.push((0,cloneDeepWith_1.default)(s,l=>{if(l.exprType=="placeholder")return{exprType:"column",alias:t,columnName:u.columnName}}));if(o.conditions.length>0)return o}}catch(s){console.warn(s.message)}return null}getMutliColumnMongoCondition(){var t,r,n,a;if(!(!((t=this.nodeConfig)===null||t===void 0)&&t.multiColumnFilter))return null;const s=(n=(r=this.dataProvider)===null||r===void 0?void 0:r.dataPatterns)===null||n===void 0?void 0:n[this.designerId];if(!s)return null;const o=(0,dbgate_filterparser_1.parseFilter)((a=this.nodeConfig)===null||a===void 0?void 0:a.multiColumnFilter,"mongo");return o?{$or:s.columns.map(l=>(0,cloneDeepWith_1.default)(o,c=>{if(c.__placeholder__)return{[l.name]:c.__placeholder__}}))}:null}getChildrenSqlCondition(t=null){const r=(0,compact_1.default)([...this.childNodes.map(n=>n.parseFilterCondition(t)),...this.buildParentFilterConditions(),this.getMutliColumnSqlCondition(t)]);return r.length==0?null:r.length==1?r[0]:{conditionType:"and",conditions:r}}getChildrenMongoCondition(t=null){const r=(0,compact_1.default)([...this.childNodes.map(n=>n.parseFilterCondition(t)),this.getMutliColumnMongoCondition()]);return r.length==0?null:r.length==1?r[0]:{$and:r}}getOrderBy(t){var r;const n=(0,compact_1.default)(this.childNodes.map(o=>{var u,l;const c=(l=(u=this.nodeConfig)===null||u===void 0?void 0:u.sort)===null||l===void 0?void 0:l.find(d=>d.columnName==o.columnName);if(c)return{columnName:o.columnName,order:c.order}}));if(n.length>0)return n;const a=(r=t==null?void 0:t.primaryKey)===null||r===void 0?void 0:r.columns.map(o=>({columnName:o.columnName,order:"ASC"}));if(a)return a;const s=t==null?void 0:t.columns;return s?[{columnName:s[0].columnName,order:"ASC"}]:[{columnName:"_id",order:"ASC"}]}getBaseTables(){const t=[],r=this.getBaseTableFromThis();r&&t.push({table:r,node:this});for(const n of this.childNodes)n.isChecked&&t.push(...n.getBaseTables());return t}getBaseTableFromThis(){return null}get filterInfo(){return null}findChildNodeByUniquePath(t){if(t.length==0)return this;const r=this.childNodes.find(n=>n.codeName==t[0]);return r==null?void 0:r.findChildNodeByUniquePath(t.slice(1))}findNodeByDesignerId(t){if(!this.designerId&&!this.findByDesignerIdWithoutDesignerId||!t)return null;if(t==this.designerId)return this;for(const r of this.childNodes){const n=r.findNodeByDesignerId(t);if(n)return n}return null}get supportsParentFilter(){var t,r,n,a,s,o,u,l,c;return(((t=this.parentNode)===null||t===void 0?void 0:t.isRoot)||((r=this.parentNode)===null||r===void 0?void 0:r.supportsParentFilter))&&((a=(n=this.parentNode)===null||n===void 0?void 0:n.databaseConfig)===null||a===void 0?void 0:a.conid)==((s=this.databaseConfig)===null||s===void 0?void 0:s.conid)&&((u=(o=this.parentNode)===null||o===void 0?void 0:o.databaseConfig)===null||u===void 0?void 0:u.database)==((l=this.databaseConfig)===null||l===void 0?void 0:l.database)&&this.engineType=="sqldb"&&((c=this.parentNode)===null||c===void 0?void 0:c.engineType)=="sqldb"}get isParentFilter(){var t;return!!(!((t=this.nodeConfig)===null||t===void 0)&&t.isParentFilter)}buildParentFilterConditions(){var t;const r=(0,compact_1.default)((((t=this.config)===null||t===void 0?void 0:t.nodes)||[]).filter(a=>a.isParentFilter).map(a=>this.rootNode.findNodeByDesignerId(a.designerId)));return(0,compact_1.default)(r.map(a=>{var s,o;if(a==this)return null;const u={commandType:"select",from:{name:a.namedObject,alias:"pert_0",relations:[]},selectAll:!0};let l=a,c=a,d=1,f="pert_0";for(;c!=null&&c.parentNode&&((s=c==null?void 0:c.parentNode)===null||s===void 0?void 0:s.designerId)!=(this===null||this===void 0?void 0:this.designerId);){c=c.parentNode;let h=`pert_${d}`;u.from.relations.push({joinType:"INNER JOIN",alias:h,name:c.namedObject,conditions:l.getParentJoinCondition(f,h)}),f=h,l=c,d+=1}return((o=c==null?void 0:c.parentNode)===null||o===void 0?void 0:o.designerId)!=(this===null||this===void 0?void 0:this.designerId)?null:(u.where={conditionType:"and",conditions:(0,compact_1.default)([...l.getParentJoinCondition(f,this.namedObject.pureName),a.getChildrenSqlCondition({alias:"pert_0"})])},{conditionType:"exists",subQuery:u})}))}getParentJoinCondition(t,r){return[]}get sortOrder(){var t,r,n;return(n=(r=(t=this.parentNodeConfig)===null||t===void 0?void 0:t.sort)===null||r===void 0?void 0:r.find(a=>a.columnName==this.columnName))===null||n===void 0?void 0:n.order}get sortOrderIndex(){var t,r,n;return((r=(t=this.parentNodeConfig)===null||t===void 0?void 0:t.sort)===null||r===void 0?void 0:r.length)>1?(0,findIndex_1$1.default)((n=this.parentNodeConfig)===null||n===void 0?void 0:n.sort,a=>a.columnName==this.columnName):-1}}PerspectiveTreeNode$1.PerspectiveTreeNode=PerspectiveTreeNode;class PerspectiveTableColumnNode extends PerspectiveTreeNode{constructor(t,r,n,a,s,o,u,l,c){var d,f,h,y,v;super(n,a,s,l,o,u,c),this.column=t,this.table=r,this.isTable=!!(!((f=(d=this.db)===null||d===void 0?void 0:d.tables)===null||f===void 0)&&f.find(g=>g.schemaName==r.schemaName&&g.pureName==r.pureName)),this.isView=!!(!((y=(h=this.db)===null||h===void 0?void 0:h.views)===null||y===void 0)&&y.find(g=>g.schemaName==r.schemaName&&g.pureName==r.pureName)),this.foreignKey=(v=r==null?void 0:r.foreignKeys)===null||v===void 0?void 0:v.find(g=>g.columns.length==1&&g.columns[0].columnName==t.columnName),this.refTable=this.db.tables.find(g=>{var C,O;return g.pureName==((C=this.foreignKey)===null||C===void 0?void 0:C.refTableName)&&g.schemaName==((O=this.foreignKey)===null||O===void 0?void 0:O.refSchemaName)})}get engineType(){return this.parentNode.engineType}matchChildRow(t,r){return this.foreignKey?t[this.foreignKey.columns[0].columnName]==r[this.foreignKey.columns[0].refColumnName]:!1}getChildMatchColumns(){return this.foreignKey?[this.foreignKey.columns[0].columnName]:[]}getParentMatchColumns(){return this.foreignKey?[this.foreignKey.columns[0].refColumnName]:[]}getParentJoinCondition(t,r){return this.foreignKey?this.foreignKey.columns.map(n=>({conditionType:"binary",operator:"=",left:{exprType:"column",columnName:n.columnName,source:{alias:r}},right:{exprType:"column",columnName:n.refColumnName,source:{alias:t}}})):[]}createReferenceConfigColumns(){var t,r;return(r=(t=this.foreignKey)===null||t===void 0?void 0:t.columns)===null||r===void 0?void 0:r.map(n=>({source:n.columnName,target:n.refColumnName}))}getNodeLoadProps(t){return this.foreignKey?{schemaName:this.foreignKey.refSchemaName,pureName:this.foreignKey.refTableName,bindingColumns:[this.foreignKey.columns[0].refColumnName],bindingValues:(0,uniqBy_1.default)(t.map(r=>[r[this.foreignKey.columns[0].columnName]]),json_stable_stringify_1$1.default),dataColumns:this.getDataLoadColumns(),databaseConfig:this.databaseConfig,orderBy:this.getOrderBy(this.refTable),sqlCondition:this.getChildrenSqlCondition(),engineType:"sqldb"}:null}get icon(){return this.isCircular?"img circular":this.column.autoIncrement?"img autoincrement":this.foreignKey?"img foreign-key":"img column"}get codeName(){return this.column.columnName}get columnName(){return this.column.columnName}get fieldName(){return this.codeName+"Ref"}get title(){return this.column.columnName}get isExpandable(){return!!this.foreignKey}get isSortable(){return!0}get filterType(){return(0,dbgate_filterparser_1.getFilterType)(this.column.dataType)}get isCircular(){var t,r;return!!(!((r=(t=this.parentNode)===null||t===void 0?void 0:t.parentNode)===null||r===void 0)&&r.hasTableCode(this.tableCode))}get isSecondaryChecked(){return super.isCheckedColumn}get isChecked(){return this.foreignKey?this.isCheckedNode:super.isCheckedColumn}get secondaryCheckable(){return!!this.foreignKey}toggleChecked(t){this.foreignKey?this.toggleCheckedNode(t):super.toggleChecked(t)}toggleSecondaryChecked(t){super.toggleChecked(t??!this.isSecondaryChecked)}generateChildNodes(){var t,r;if(!this.foreignKey)return[];const n=(r=(t=this===null||this===void 0?void 0:this.db)===null||t===void 0?void 0:t.tables)===null||r===void 0?void 0:r.find(a=>{var s,o;return a.pureName==((s=this.foreignKey)===null||s===void 0?void 0:s.refTableName)&&a.schemaName==((o=this.foreignKey)===null||o===void 0?void 0:o.refSchemaName)});return getTableChildPerspectiveNodes(n,this.dbs,this.config,this.setConfig,this.dataProvider,this.defaultDatabaseConfig,this)}getBaseTableFromThis(){return this.refTable}get filterInfo(){return{columnName:this.columnName,filterType:this.filterType,pureName:this.column.pureName,schemaName:this.column.schemaName,foreignKey:this.foreignKey}}parseFilterCondition(t=null){const r=this.getFilter();if(!r)return null;const n=(0,dbgate_filterparser_1.parseFilter)(r,this.filterType);return n?(0,cloneDeepWith_1.default)(n,a=>{if(a.exprType=="placeholder")return{exprType:"column",columnName:this.column.columnName,source:t}}):null}get headerTableAttributes(){return this.foreignKey?{schemaName:this.foreignKey.refSchemaName,pureName:this.foreignKey.refTableName,conid:this.databaseConfig.conid,database:this.databaseConfig.database,objectTypeField:this.table.objectTypeField}:null}get tableCode(){return this.foreignKey?`${this.foreignKey.refSchemaName}|${this.foreignKey.refTableName}`:`${this.table.schemaName}|${this.table.pureName}`}get namedObject(){return this.foreignKey?{schemaName:this.foreignKey.refSchemaName,pureName:this.foreignKey.refTableName}:null}}PerspectiveTreeNode$1.PerspectiveTableColumnNode=PerspectiveTableColumnNode;class PerspectivePatternColumnNode extends PerspectiveTreeNode{constructor(t,r,n,a,s,o,u,l,c,d){var f;super(a,s,o,c,u,l,d),this.table=t,this.column=r,this.tableColumn=n,this.parentNodeConfig=(f=this.tableNodeOrParent)===null||f===void 0?void 0:f.nodeConfig}get isChildColumn(){return this.parentNode instanceof PerspectivePatternColumnNode}get findByDesignerIdWithoutDesignerId(){return this.isExpandable}getNodeLoadProps(t){return null}get generatesHiearchicGridColumn(){var t,r,n;return!((n=(r=(t=this.tableNodeOrParent)===null||t===void 0?void 0:t.nodeConfig)===null||r===void 0?void 0:r.checkedColumns)===null||n===void 0)&&n.find(a=>a.startsWith(this.codeName+"::"))?!0:this.hasCheckedJoinChild()}get icon(){return this.column.types.includes("json")?"img json":"img column"}get codeName(){return this.parentNode instanceof PerspectivePatternColumnNode?`${this.parentNode.codeName}::${this.column.name}`:this.column.name}get columnName(){return this.column.name}get fieldName(){return this.column.name}get title(){return this.column.name}get isExpandable(){return this.column.columns.length>0}get isSortable(){return!this.isChildColumn}get filterType(){return this.tableColumn?(0,dbgate_filterparser_1.getFilterType)(this.tableColumn.dataType):"mongo"}get preloadedLevelData(){return!0}generatePatternChildNodes(){return this.column.columns.map(t=>new PerspectivePatternColumnNode(this.table,t,this.tableColumn,this.dbs,this.config,this.setConfig,this.dataProvider,this.defaultDatabaseConfig,this,null))}hasCheckedJoinChild(){for(const t of this.childNodes)if(t instanceof PerspectivePatternColumnNode&&t.hasCheckedJoinChild()||t.isCheckedNode)return!0;return!1}generateChildNodes(){var t,r,n,a,s;const o=this.generatePatternChildNodes(),u=[];for(const l of this.config.nodes)for(const c of this.config.references){const d=this.validParentDesignerId;if(c.sourceId==d&&c.targetId==l.designerId||c.targetId==d&&c.sourceId==l.designerId){if(c.columns.length!=1)continue;if(c.sourceId==d&&this.codeName==(0,perspectiveTools_1$1.getPerspectiveParentColumnName)(c.columns[0].source)){if(c.columns[0].target.includes("::"))continue}else if(c.targetId==d&&this.codeName==(0,perspectiveTools_1$1.getPerspectiveParentColumnName)(c.columns[0].target)){if(c.columns[0].source.includes("::"))continue}else continue;const f=Object.assign({},this.defaultDatabaseConfig);l.conid&&(f.conid=l.conid),l.database&&(f.database=l.database);const h=(r=(t=this.dbs)===null||t===void 0?void 0:t[f.conid])===null||r===void 0?void 0:r[f.database],y=(n=h==null?void 0:h.tables)===null||n===void 0?void 0:n.find(O=>O.pureName==l.pureName&&O.schemaName==l.schemaName),v=(a=h==null?void 0:h.views)===null||a===void 0?void 0:a.find(O=>O.pureName==l.pureName&&O.schemaName==l.schemaName),g=(s=h==null?void 0:h.collections)===null||s===void 0?void 0:s.find(O=>O.pureName==l.pureName&&O.schemaName==l.schemaName),C={refNodeDesignerId:l.designerId,referenceDesignerId:c.designerId,baseDesignerId:d,joinName:l.alias,refTableName:l.pureName,refSchemaName:l.schemaName,conid:l.conid,database:l.database,columns:c.sourceId==d?c.columns.map(O=>({baseColumnName:O.source,refColumnName:O.target})):c.columns.map(O=>({baseColumnName:O.target,refColumnName:O.source}))};(y||v||g)&&u.push(new PerspectiveCustomJoinTreeNode(C,y||v||g,this.dbs,this.config,this.setConfig,this.dataProvider,this.defaultDatabaseConfig,this,l.designerId))}}return[...o,...u]}get filterInfo(){return this.isChildColumn?null:{columnName:this.columnName,filterType:this.filterType,pureName:this.table.pureName,schemaName:this.table.schemaName,foreignKey:this.foreignKey}}parseFilterCondition(t=null){const r=this.getFilter();if(!r)return null;const n=(0,dbgate_filterparser_1.parseFilter)(r,"mongo");return n?(0,cloneDeepWith_1.default)(n,a=>{if(a.__placeholder__)return{[this.columnName]:a.__placeholder__}}):null}}PerspectiveTreeNode$1.PerspectivePatternColumnNode=PerspectivePatternColumnNode;class PerspectiveTableNode extends PerspectiveTreeNode{constructor(t,r,n,a,s,o,u,l){super(r,n,a,u,s,o,l),this.table=t,this.dataProvider=s}get engineType(){return(0,dbgate_tools_1$5.isCollectionInfo)(this.table)?"docdb":"sqldb"}getNodeLoadProps(t){const r=(0,dbgate_tools_1$5.isCollectionInfo)(this.table);return{schemaName:this.table.schemaName,pureName:this.table.pureName,dataColumns:this.getDataLoadColumns(),allColumns:r,databaseConfig:this.databaseConfig,orderBy:this.getOrderBy(this.table),sqlCondition:r?null:this.getChildrenSqlCondition(),mongoCondition:r?this.getChildrenMongoCondition():null,engineType:r?"docdb":"sqldb"}}get codeName(){return this.table.schemaName?`${this.table.schemaName}:${this.table.pureName}`:this.table.pureName}get title(){var t;return((t=this.nodeConfig)===null||t===void 0?void 0:t.alias)||this.table.pureName}get isExpandable(){return!0}generateChildNodes(){return getTableChildPerspectiveNodes(this.table,this.dbs,this.config,this.setConfig,this.dataProvider,this.defaultDatabaseConfig,this)}get icon(){return"img table"}getBaseTableFromThis(){return this.table}get headerTableAttributes(){return{schemaName:this.table.schemaName,pureName:this.table.pureName,conid:this.databaseConfig.conid,database:this.databaseConfig.database,objectTypeField:this.table.objectTypeField}}get tableCode(){return`${this.table.schemaName}|${this.table.pureName}`}get namedObject(){return{schemaName:this.table.schemaName,pureName:this.table.pureName}}}PerspectiveTreeNode$1.PerspectiveTableNode=PerspectiveTableNode;class PerspectiveTableReferenceNode extends PerspectiveTableNode{constructor(t,r,n,a,s,o,u,l,c,d){super(r,n,a,s,o,u,c,d),this.foreignKey=t,this.dataProvider=o,this.isMultiple=l}matchChildRow(t,r){return this.foreignKey?t[this.foreignKey.columns[0].refColumnName]==r[this.foreignKey.columns[0].columnName]:!1}getChildMatchColumns(){return this.foreignKey?[this.foreignKey.columns[0].refColumnName]:[]}getParentMatchColumns(){return this.foreignKey?[this.foreignKey.columns[0].columnName]:[]}getNodeLoadProps(t){return this.foreignKey?{schemaName:this.table.schemaName,pureName:this.table.pureName,bindingColumns:[this.foreignKey.columns[0].columnName],bindingValues:(0,uniqBy_1.default)(t.map(r=>[r[this.foreignKey.columns[0].refColumnName]]),json_stable_stringify_1$1.default),dataColumns:this.getDataLoadColumns(),databaseConfig:this.databaseConfig,orderBy:this.getOrderBy(this.table),sqlCondition:this.getChildrenSqlCondition(),engineType:"sqldb"}:null}createReferenceConfigColumns(){var t,r;return(r=(t=this.foreignKey)===null||t===void 0?void 0:t.columns)===null||r===void 0?void 0:r.map(n=>({source:n.refColumnName,target:n.columnName}))}get columnTitle(){return this.table.pureName}get title(){return this.isMultiple?`${super.title} (${this.foreignKey.columns.map(t=>t.columnName).join(", ")})`:super.title}get codeName(){return this.isMultiple?`${super.codeName}-${this.foreignKey.columns.map(t=>t.columnName).join("_")}`:super.codeName}get isChecked(){return this.isCheckedNode}toggleChecked(t){this.toggleCheckedNode(t)}getParentJoinCondition(t,r){return this.foreignKey?this.foreignKey.columns.map(n=>({conditionType:"binary",operator:"=",left:{exprType:"column",columnName:n.refColumnName,source:{alias:r}},right:{exprType:"column",columnName:n.columnName,source:{alias:t}}})):[]}}PerspectiveTreeNode$1.PerspectiveTableReferenceNode=PerspectiveTableReferenceNode;class PerspectiveCustomJoinTreeNode extends PerspectiveTableNode{constructor(t,r,n,a,s,o,u,l,c){super(r,n,a,s,o,u,l,c),this.customJoin=t,this.dataProvider=o}matchChildRow(t,r){for(const n of this.customJoin.columns)if(!(0,perspectiveTools_1$1.perspectiveValueMatcher)(t[(0,perspectiveTools_1$1.getPerspectiveMostNestedChildColumnName)(n.baseColumnName)],r[n.refColumnName]))return!1;return!0}getChildMatchColumns(){return this.customJoin.columns.map(t=>t.baseColumnName)}getParentMatchColumns(){return this.customJoin.columns.map(t=>t.refColumnName)}getNodeLoadProps(t){const r=(0,dbgate_tools_1$5.isCollectionInfo)(this.table),n=t.map(a=>this.customJoin.columns.map(s=>a[(0,perspectiveTools_1$1.getPerspectiveMostNestedChildColumnName)(s.baseColumnName)]));return{schemaName:this.table.schemaName,pureName:this.table.pureName,bindingColumns:this.getParentMatchColumns(),bindingValues:(0,uniqBy_1.default)(n,a=>JSON.stringify(a)),dataColumns:this.getDataLoadColumns(),allColumns:r,databaseConfig:this.databaseConfig,orderBy:this.getOrderBy(this.table),sqlCondition:r?null:this.getChildrenSqlCondition(),mongoCondition:r?this.getChildrenMongoCondition():null,engineType:r?"docdb":"sqldb"}}get icon(){return"icon custom-join"}get codeName(){return this.customJoin.refNodeDesignerId}get customJoinConfig(){return this.customJoin}get isChecked(){return this.isCheckedNode}toggleChecked(t){this.toggleCheckedNode(t)}getParentJoinCondition(t,r){return this.customJoin.columns.map(n=>({conditionType:"binary",operator:"=",left:{exprType:"column",columnName:n.baseColumnName,source:{alias:r}},right:{exprType:"column",columnName:n.refColumnName,source:{alias:t}}}))}}PerspectiveTreeNode$1.PerspectiveCustomJoinTreeNode=PerspectiveCustomJoinTreeNode;function findDesignerIdForNode(e,t,r){const n=r(null),a=n.createReferenceConfigColumns();if(!(a!=null&&a.length))return n;const s=e.references.find(u=>u.sourceId==t.designerId&&(0,isEqual_1.default)(a.map(l=>l.source),u.columns.map(l=>l.source))&&(0,isEqual_1.default)(a.map(l=>l.target),u.columns.map(l=>l.target))&&(0,dbgate_tools_1$5.equalFullName)(e.nodes.find(l=>l.designerId==u.targetId),n.namedObject));if(s&&!t.hasDesignerIdInIncestors(s.targetId))return r(s.targetId);const o=e.references.find(u=>u.targetId==t.designerId&&(0,isEqual_1.default)(a.map(l=>l.target),u.columns.map(l=>l.source))&&(0,isEqual_1.default)(a.map(l=>l.source),u.columns.map(l=>l.target))&&(0,dbgate_tools_1$5.equalFullName)(e.nodes.find(l=>l.designerId==u.sourceId),n.namedObject));return o&&!t.hasDesignerIdInIncestors(o.sourceId)?r(o.sourceId):n}function getTableChildPerspectiveNodes(e,t,r,n,a,s,o){var u,l,c,d,f,h,y,v;if(!e)return[];const g=o.db,C=(u=a==null?void 0:a.dataPatterns)===null||u===void 0?void 0:u[o.designerId],O=(0,dbgate_tools_1$5.isTableInfo)(e)||(0,dbgate_tools_1$5.isViewInfo)(e)?e:null,j=((l=O==null?void 0:O.columns)===null||l===void 0?void 0:l.map(I=>findDesignerIdForNode(r,o,A=>{var q,G,J;return!((G=(q=C==null?void 0:C.columns)===null||q===void 0?void 0:q.find(Q=>Q.name==I.columnName))===null||G===void 0)&&G.types.includes("json")?new PerspectivePatternColumnNode(e,(J=C==null?void 0:C.columns)===null||J===void 0?void 0:J.find(Q=>Q.name==I.columnName),I,t,r,n,a,s,o,A):new PerspectiveTableColumnNode(I,O,t,r,n,a,s,o,A)})))||((c=C==null?void 0:C.columns)===null||c===void 0?void 0:c.map(I=>findDesignerIdForNode(r,o,A=>new PerspectivePatternColumnNode(e,I,null,t,r,n,a,s,o,A))))||[],F=[];F.push(...j);const L=[];if(g&&(e!=null&&e.dependencies))for(const I of e==null?void 0:e.dependencies){const A=g.tables.find(q=>q.pureName==I.pureName&&q.schemaName==I.schemaName);if(A){const q=(e==null?void 0:e.dependencies.filter(G=>G.pureName==I.pureName&&G.schemaName==I.schemaName).length)>=2;L.push(findDesignerIdForNode(r,o,G=>new PerspectiveTableReferenceNode(I,A,t,r,n,a,s,q,o,G)))}}F.push(...(0,sortBy_1.default)(L,"title"));const M=[];for(const I of r.nodes)if(!(I.designerId==((d=o.parentNode)===null||d===void 0?void 0:d.designerId)||F.find(A=>A.designerId==I.designerId))){for(const A of r.references)if(A.sourceId==o.designerId&&A.targetId==I.designerId||A.targetId==o.designerId&&A.sourceId==I.designerId){if(A.columns.find($=>$.source.includes("::")||$.target.includes("::")))continue;const q=Object.assign({},s);I.conid&&(q.conid=I.conid),I.database&&(q.database=I.database);const G=(f=t==null?void 0:t[q.conid])===null||f===void 0?void 0:f[q.database],J=(h=G==null?void 0:G.tables)===null||h===void 0?void 0:h.find($=>$.pureName==I.pureName&&$.schemaName==I.schemaName),Q=(y=G==null?void 0:G.views)===null||y===void 0?void 0:y.find($=>$.pureName==I.pureName&&$.schemaName==I.schemaName),X=(v=G==null?void 0:G.collections)===null||v===void 0?void 0:v.find($=>$.pureName==I.pureName&&$.schemaName==I.schemaName),_={refNodeDesignerId:I.designerId,referenceDesignerId:A.designerId,baseDesignerId:o.designerId,joinName:I.alias,refTableName:I.pureName,refSchemaName:I.schemaName,conid:I.conid,database:I.database,columns:A.sourceId==o.designerId?A.columns.map($=>({baseColumnName:$.source,refColumnName:$.target})):A.columns.map($=>({baseColumnName:$.target,refColumnName:$.source}))};(J||Q||X)&&M.push(new PerspectiveCustomJoinTreeNode(_,J||Q||X,t,r,n,a,s,o,I.designerId))}}return F.push(...(0,sortBy_1.default)(M,"title")),F}PerspectiveTreeNode$1.getTableChildPerspectiveNodes=getTableChildPerspectiveNodes;var TableGridDisplay$1={};Object.defineProperty(TableGridDisplay$1,"__esModule",{value:!0});TableGridDisplay$1.TableGridDisplay=void 0;const dbgate_tools_1$4=lib$5,GridDisplay_1$3=GridDisplay$1;class TableGridDisplay extends GridDisplay_1$3.GridDisplay{constructor(t,r,n,a,s,o,u,l,c,d=null,f=!1){super(n,a,s,o,r,u,c),this.tableName=t,this.displayOptions=l,this.getDictionaryDescription=d,this.addAllExpandedColumnsToSelected=!1,this.table=this.findTable(t),this.table?(!this.table.columns||this.table.columns.length==0)&&(this.isLoadedCorrectly=!1):this.isLoadedCorrectly=!1,this.columns=this.getDisplayColumns(this.table,[]),this.addFormDisplayColumns(this.getDisplayColumns(this.table,[])),this.filterable=!0,this.sortable=!0,this.groupable=!0,this.editable=!f,this.supportsReload=!0,this.baseTable=this.table,this.table&&this.table.columns&&(this.changeSetKeyFields=this.table.primaryKey?this.table.primaryKey.columns.map(h=>h.columnName):this.table.columns.map(h=>h.columnName)),this.config.isFormView&&(this.addAllExpandedColumnsToSelected=!0,this.hintBaseColumns=this.formColumns)}addFormDisplayColumns(t){for(const r of t)if(this.formColumns.push(r),this.isExpandedColumn(r.uniqueName)){const n=this.getFkTarget(r);if(n){const a=this.getDisplayColumns(n,r.uniquePath);this.addFormDisplayColumns(a)}}}findTable({schemaName:t=void 0,pureName:r}){return this.dbinfo&&this.dbinfo.tables&&this.dbinfo.tables.find(n=>n.pureName==r&&n.schemaName==t)}getDisplayColumns(t,r){var n,a;return((a=(n=t==null?void 0:t.columns)===null||n===void 0?void 0:n.map(s=>this.getDisplayColumn(t,s,r)))===null||a===void 0?void 0:a.map(s=>{var o,u,l;return Object.assign(Object.assign({},s),{isChecked:this.isColumnChecked(s),hintColumnNames:((u=(o=this.getFkDictionaryDescription(s.isForeignKeyUnique?s.foreignKey:null))===null||o===void 0?void 0:o.columns)===null||u===void 0?void 0:u.map(c=>`hint_${s.uniqueName}_${c}`))||null,hintColumnDelimiter:(l=this.getFkDictionaryDescription(s.isForeignKeyUnique?s.foreignKey:null))===null||l===void 0?void 0:l.delimiter,isExpandable:!!s.foreignKey})}))||[]}addJoinsFromExpandedColumns(t,r,n,a){for(const s of r)if(this.isExpandedColumn(s.uniqueName)){const o=this.getFkTarget(s);if(o){const u=`${s.uniqueName}_ref`,l=this.getDisplayColumns(o,s.uniquePath);this.addReferenceToSelect(t,n,s),this.addJoinsFromExpandedColumns(t,l,u,a),this.addAddedColumnsToSelect(t,l,u,a)}}}addReferenceToSelect(t,r,n){const a=`${n.uniqueName}_ref`;if((t.from.relations||[]).find(o=>o.alias==a))return;const s=this.getFkTarget(n);s&&s.primaryKey&&(t.from.relations=[...t.from.relations||[],{joinType:"LEFT JOIN",name:s,alias:a,conditions:[{conditionType:"binary",operator:"=",left:{exprType:"column",columnName:n.columnName,source:{name:n,alias:r}},right:{exprType:"column",columnName:s.primaryKey.columns[0].columnName,source:{name:s,alias:a}}}]}])}getFkDictionaryDescription(t){if(!t)return null;const r=t.refTableName,n=t.refSchemaName,a=this.findTable({schemaName:n,pureName:r});return a&&a.columns&&a.columns.length>0&&a.primaryKey?this.getDictionaryDescription(a):null}addHintsToSelect(t){let r=!1;const n=this.groupColumns;for(const a of this.hintBaseColumns||this.getGridColumns())if(a.foreignKey){if(n&&!n.includes(a.uniqueName))continue;const s=this.getFkTarget(a);if(s&&s.columns&&s.columns.length>0&&s.primaryKey){const o=this.getDictionaryDescription(s);if(o){const u=a.uniquePath.slice(0,-1).join(".");this.addReferenceToSelect(t,u?`${u}_ref`:"basetbl",a);const l=`${a.uniqueName}_ref`;t.columns.push(...o.columns.map(c=>({exprType:"column",columnName:c,alias:`hint_${a.uniqueName}_${c}`,source:{alias:l}}))),r=!0}}}return r}enrichExpandedColumns(t){const r=[];for(const n of t)r.push(n),this.isExpandedColumn(n.uniqueName)&&r.push(...this.getExpandedColumns(n));return r}getExpandedColumns(t){const r=this.getFkTarget(t);return r?this.enrichExpandedColumns(this.getDisplayColumns(r,t.uniquePath)):[]}getFkTarget(t){const{uniqueName:r,foreignKey:n,isForeignKeyUnique:a}=t;if(!a)return null;const s=n.refTableName,o=n.refSchemaName;return this.findTable({schemaName:o,pureName:s})}processReferences(t,r,n){this.addJoinsFromExpandedColumns(t,this.columns,"basetbl",r),!n.isExport&&this.displayOptions.showHintColumns&&this.addHintsToSelect(t)}createSelect(t={}){return this.table?this.createSelectBase(this.table,this.table.columns,t):null}getColumns(t){return this.enrichExpandedColumns(this.columns.filter(r=>(0,dbgate_tools_1$4.filterName)(t,r.columnName)))}getDisplayColumn(t,r,n){const a=[...n,r.columnName],s=a.join("."),o=Object.assign(Object.assign({},r),{pureName:t.pureName,schemaName:t.schemaName,headerText:a.length==1?r.columnName:`${t.pureName}.${r.columnName}`,uniqueName:s,uniquePath:a,isPrimaryKey:t.primaryKey&&!!t.primaryKey.columns.find(u=>u.columnName==r.columnName),foreignKey:t.foreignKeys&&t.foreignKeys.find(u=>u.columns.length==1&&u.columns[0].columnName==r.columnName),isForeignKeyUnique:!1});if(o.foreignKey){const u=this.dbinfo.tables.find(l=>l.schemaName==o.foreignKey.refSchemaName&&l.pureName==o.foreignKey.refTableName);u&&(0,dbgate_tools_1$4.isTableColumnUnique)(u,o.foreignKey.columns[0].refColumnName)&&(o.isForeignKeyUnique=!0)}return o}addAddedColumnsToSelect(t,r,n,a){for(const s of r)(this.addAllExpandedColumnsToSelected||this.config.addedColumns.includes(s.uniqueName))&&(t.columns.push(this.createColumnExpression(s,{name:s,alias:n},s.uniqueName)),a[s.uniqueName]=Object.assign(Object.assign({},s),{sourceAlias:n}))}get hasReferences(){return this.table?!!(this.table.foreignKeys&&this.table.foreignKeys.length>0||this.table.dependencies&&this.table.dependencies.length>0):!1}}TableGridDisplay$1.TableGridDisplay=TableGridDisplay;var ViewGridDisplay$1={};Object.defineProperty(ViewGridDisplay$1,"__esModule",{value:!0});ViewGridDisplay$1.ViewGridDisplay=void 0;const GridDisplay_1$2=GridDisplay$1;class ViewGridDisplay extends GridDisplay_1$2.GridDisplay{constructor(t,r,n,a,s,o,u){super(n,a,s,o,r,u),this.view=t,this.columns=this.getDisplayColumns(t),this.formColumns=this.columns,this.filterable=!0,this.sortable=!0,this.groupable=!1,this.editable=!1,this.supportsReload=!0,this.baseView=t}getDisplayColumns(t){var r,n;return((n=(r=t==null?void 0:t.columns)===null||r===void 0?void 0:r.map(a=>this.getDisplayColumn(t,a)))===null||n===void 0?void 0:n.map(a=>Object.assign(Object.assign({},a),{isChecked:this.isColumnChecked(a)})))||[]}getDisplayColumn(t,r){const n=[r.columnName],a=n.join(".");return Object.assign(Object.assign({},r),{pureName:t.pureName,schemaName:t.schemaName,headerText:r.columnName,uniqueName:a,uniquePath:n})}createSelect(t={}){return this.createSelectBase(this.view,this.view.columns,t)}}ViewGridDisplay$1.ViewGridDisplay=ViewGridDisplay;var JslGridDisplay$1={},CollectionGridDisplay$1={},__importDefault$9=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(CollectionGridDisplay$1,"__esModule",{value:!0});CollectionGridDisplay$1.CollectionGridDisplay=CollectionGridDisplay$1.analyseCollectionDisplayColumns=void 0;const lodash_1$4=__importDefault$9(lodashExports),GridDisplay_1$1=GridDisplay$1;function getObjectKeys(e){return lodash_1$4.default.isArray(e)?Object.keys(e).slice(0,10).map(t=>parseInt(t)):lodash_1$4.default.isPlainObject(e)?Object.keys(e):[]}function createHeaderText(e){let t=`${e[0]}`;for(let r=1;r<e.length;r++){const n=e[r];lodash_1$4.default.isNumber(n)?t+=`[${n}]`:t+=`.${n}`}return t}function getColumnsForObject(e,t,r,n){for(const a of getObjectKeys(t)){const s=[...e,a].join(".");let o=r.find(u=>u.uniqueName==s);if(!o)if(o=getDisplayColumn(e,a,n),e.length>0){const u=lodash_1$4.default.findLastIndex(r,c=>c.parentHeaderText.startsWith(o.parentHeaderText)),l=lodash_1$4.default.findLastIndex(r,c=>c.headerText==o.parentHeaderText);u>=0?r.splice(u+1,0,o):l>=0?r.splice(l+1,0,o):r.push(o)}else r.push(o);(lodash_1$4.default.isPlainObject(t[a])||lodash_1$4.default.isArray(t[a]))&&(o.isExpandable=!0),n.isExpandedColumn(o.uniqueName)&&getColumnsForObject([...e,a],t[a],r,n)}}function getDisplayColumn(e,t,r){var n,a;const s=[...e,t],o=s.join(".");return{columnName:t,headerText:createHeaderText(s),uniqueName:o,uniquePath:s,isStructured:!0,parentHeaderText:createHeaderText(e),filterType:"mongo",pureName:(n=r.collection)===null||n===void 0?void 0:n.pureName,schemaName:(a=r.collection)===null||a===void 0?void 0:a.schemaName}}function analyseCollectionDisplayColumns(e,t){var r;const n=[],a=(r=t==null?void 0:t.config)===null||r===void 0?void 0:r.addedColumns;for(const s of e||[])getColumnsForObject([],s,n,t);for(const s of a||[])n.find(o=>o.uniqueName==s)||n.push(getDisplayColumn([],s,t));return n.map(s=>Object.assign(Object.assign({},s),{isChecked:t.isColumnChecked(s)}))||[]}CollectionGridDisplay$1.analyseCollectionDisplayColumns=analyseCollectionDisplayColumns;class CollectionGridDisplay extends GridDisplay_1$1.GridDisplay{constructor(t,r,n,a,s,o,u,l,c=!1){super(n,a,s,o,r),this.collection=t;const d=lodash_1$4.default.compact(l.updates.map(h=>h.document)),f=lodash_1$4.default.compact(l.inserts.map(h=>h.fields));this.columns=analyseCollectionDisplayColumns([...u||[],...d,...f],this),this.filterable=!0,this.sortable=!0,this.editable=!c,this.supportsReload=!0,this.isDynamicStructure=!0,this.changeSetKeyFields=["_id"],this.baseCollection=t}}CollectionGridDisplay$1.CollectionGridDisplay=CollectionGridDisplay;var __importDefault$8=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(JslGridDisplay$1,"__esModule",{value:!0});JslGridDisplay$1.JslGridDisplay=void 0;const lodash_1$3=__importDefault$8(lodashExports),GridDisplay_1=GridDisplay$1,CollectionGridDisplay_1=CollectionGridDisplay$1;class JslGridDisplay extends GridDisplay_1.GridDisplay{constructor(t,r,n,a,s,o,u,l,c,d=!1){var f;super(n,a,s,o,null),this.filterable=!0,this.sortable=!0,this.supportsReload=c,this.isDynamicStructure=l,this.filterTypeOverride="eval",this.editable=d,this.editableStructure=d?r:null,r!=null&&r.columns&&(this.columns=lodash_1$3.default.uniqBy((f=r.columns.map(h=>({columnName:h.columnName,headerText:h.columnName,uniqueName:h.columnName,uniquePath:[h.columnName],notNull:h.notNull,autoIncrement:h.autoIncrement,pureName:null,schemaName:null})))===null||f===void 0?void 0:f.map(h=>Object.assign(Object.assign({},h),{isChecked:this.isColumnChecked(h)})),h=>h.uniqueName)),r!=null&&r.__isDynamicStructure&&(this.columns=(0,CollectionGridDisplay_1.analyseCollectionDisplayColumns)(u,this)),this.columns||(this.columns=[]),this.formColumns=this.columns}}JslGridDisplay$1.JslGridDisplay=JslGridDisplay;var ChangeSet={},__importDefault$7=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ChangeSet,"__esModule",{value:!0});ChangeSet.changeSetContainsChanges=ChangeSet.changeSetInsertDocuments=ChangeSet.changeSetInsertNewRow=ChangeSet.getChangeSetInsertedRows=ChangeSet.deleteChangeSetRows=ChangeSet.revertChangeSetRowChanges=ChangeSet.changeSetToSql=ChangeSet.extractChangeSetCondition=ChangeSet.batchUpdateChangeSet=ChangeSet.setChangeSetRowData=ChangeSet.setChangeSetValue=ChangeSet.findExistingChangeSetItem=ChangeSet.createChangeSet=void 0;const lodash_1$2=__importDefault$7(lodashExports);function createChangeSet(){return{inserts:[],updates:[],deletes:[]}}ChangeSet.createChangeSet=createChangeSet;function findExistingChangeSetItem(e,t){if(!e||!t)return["updates",null];if(t.insertedRowIndex!=null)return["inserts",e.inserts.find(r=>r.pureName==t.pureName&&r.schemaName==t.schemaName&&r.insertedRowIndex==t.insertedRowIndex)];{const r=e.updates.find(a=>a.pureName==t.pureName&&a.schemaName==t.schemaName&&(t.existingRowIndex!=null&&a.existingRowIndex==t.existingRowIndex||t.existingRowIndex==null&&lodash_1$2.default.isEqual(a.condition,t.condition)));if(r)return["updates",r];const n=e.deletes.find(a=>a.pureName==t.pureName&&a.schemaName==t.schemaName&&(t.existingRowIndex!=null&&a.existingRowIndex==t.existingRowIndex||t.existingRowIndex==null&&lodash_1$2.default.isEqual(a.condition,t.condition)));return n?["deletes",n]:["updates",null]}}ChangeSet.findExistingChangeSetItem=findExistingChangeSetItem;function setChangeSetValue(e,t,r){if(!e||!t)return e;let[n,a]=findExistingChangeSetItem(e,t);return n=="deletes"&&(e=revertChangeSetRowChanges(e,t),[n,a]=findExistingChangeSetItem(e,t)),a?Object.assign(Object.assign({},e),{[n]:e[n].map(s=>s==a?Object.assign(Object.assign({},s),{fields:Object.assign(Object.assign({},s.fields),{[t.uniqueName]:r})}):s)}):Object.assign(Object.assign({},e),{[n]:[...e[n],{pureName:t.pureName,schemaName:t.schemaName,condition:t.condition,insertedRowIndex:t.insertedRowIndex,existingRowIndex:t.existingRowIndex,fields:{[t.uniqueName]:r}}]})}ChangeSet.setChangeSetValue=setChangeSetValue;function setChangeSetRowData(e,t,r){if(!e||!t)return e;let[n,a]=findExistingChangeSetItem(e,t);return n=="deletes"&&(e=revertChangeSetRowChanges(e,t),[n,a]=findExistingChangeSetItem(e,t)),a?Object.assign(Object.assign({},e),{[n]:e[n].map(s=>s==a?Object.assign(Object.assign({},s),{fields:{},document:r}):s)}):Object.assign(Object.assign({},e),{[n]:[...e[n],{pureName:t.pureName,schemaName:t.schemaName,condition:t.condition,insertedRowIndex:t.insertedRowIndex,existingRowIndex:t.existingRowIndex,document:r}]})}ChangeSet.setChangeSetRowData=setChangeSetRowData;function batchUpdateChangeSet(e,t,r){for(const n of lodash_1$2.default.zip(t,r)){const[a,s]=n;for(const o of lodash_1$2.default.keys(s))e=setChangeSetValue(e,Object.assign(Object.assign({},a),{columnName:o,uniqueName:o}),s[o])}return e}ChangeSet.batchUpdateChangeSet=batchUpdateChangeSet;function extractFields(e,t=!0){return lodash_1$2.default.keys(e.fields).filter(r=>t||e.fields[r]!=null).map(r=>({targetColumn:r,exprType:"value",value:e.fields[r]}))}function changeSetInsertToSql(e,t=null){const r=extractFields(e,!1);if(r.length==0)return null;let n=!1;if(t){const s=t.tables.find(o=>o.schemaName==e.schemaName&&o.pureName==e.pureName);if(s){const o=s.columns.find(u=>u.autoIncrement);o&&r.find(u=>u.targetColumn==o.columnName)&&(n=!0)}}const a={pureName:e.pureName,schemaName:e.schemaName};return[n?{targetTable:a,commandType:"allowIdentityInsert",allow:!0}:null,{targetTable:a,commandType:"insert",fields:r},n?{targetTable:a,commandType:"allowIdentityInsert",allow:!1}:null]}function extractChangeSetCondition(e,t){function r(n){const a=e.condition[n],s={exprType:"column",columnName:n,source:{name:{pureName:e.pureName,schemaName:e.schemaName},alias:t}};return a==null?{conditionType:"isNull",expr:s}:{conditionType:"binary",operator:"=",left:s,right:{exprType:"value",value:a}}}return{conditionType:"and",conditions:lodash_1$2.default.keys(e.condition).map(n=>r(n))}}ChangeSet.extractChangeSetCondition=extractChangeSetCondition;function changeSetUpdateToSql(e){return{from:{name:{pureName:e.pureName,schemaName:e.schemaName}},commandType:"update",fields:extractFields(e),where:extractChangeSetCondition(e)}}function changeSetDeleteToSql(e){return{from:{name:{pureName:e.pureName,schemaName:e.schemaName}},commandType:"delete",where:extractChangeSetCondition(e)}}function changeSetToSql(e,t){return lodash_1$2.default.compact(lodash_1$2.default.flatten([...e.inserts.map(r=>changeSetInsertToSql(r,t)),...e.updates.map(changeSetUpdateToSql),...e.deletes.map(changeSetDeleteToSql)]))}ChangeSet.changeSetToSql=changeSetToSql;function revertChangeSetRowChanges(e,t){const[r,n]=findExistingChangeSetItem(e,t);return n?Object.assign(Object.assign({},e),{[r]:e[r].filter(a=>a!=n)}):e}ChangeSet.revertChangeSetRowChanges=revertChangeSetRowChanges;function consolidateInsertIndexes(e,t){const r=e.inserts.filter(n=>n.pureName==t.pureName&&n.schemaName==t.schemaName).map(n=>n.insertedRowIndex);return r.sort((n,a)=>n-a),r[r.length-1]!=r.length-1?Object.assign(Object.assign({},e),{inserts:e.inserts.map(n=>Object.assign(Object.assign({},n),{insertedRowIndex:r.indexOf(n.insertedRowIndex)}))}):e}function deleteChangeSetRows(e,t){let[r,n]=findExistingChangeSetItem(e,t);return r=="updates"&&(e=revertChangeSetRowChanges(e,t),[r,n]=findExistingChangeSetItem(e,t)),r=="inserts"?consolidateInsertIndexes(revertChangeSetRowChanges(e,t),t):n&&r=="deletes"?e:Object.assign(Object.assign({},e),{deletes:[...e.deletes,{pureName:t.pureName,schemaName:t.schemaName,condition:t.condition,existingRowIndex:t.existingRowIndex}]})}ChangeSet.deleteChangeSetRows=deleteChangeSetRows;function getChangeSetInsertedRows(e,t){var r;if(!e)return[];const n=e.inserts.filter(o=>t==null||o.pureName==t.pureName&&o.schemaName==t.schemaName),a=(r=lodash_1$2.default.maxBy(n,o=>o.insertedRowIndex))===null||r===void 0?void 0:r.insertedRowIndex;if(a==null)return[];const s=Array(a+1).fill({});for(const o of n)s[o.insertedRowIndex]=o.fields;return s}ChangeSet.getChangeSetInsertedRows=getChangeSetInsertedRows;function changeSetInsertNewRow(e,t){const r=getChangeSetInsertedRows(e,t);return Object.assign(Object.assign({},e),{inserts:[...e.inserts,Object.assign(Object.assign({},t),{insertedRowIndex:r.length,fields:{}})]})}ChangeSet.changeSetInsertNewRow=changeSetInsertNewRow;function changeSetInsertDocuments(e,t,r){const n=getChangeSetInsertedRows(e,r);return Object.assign(Object.assign({},e),{inserts:[...e.inserts,...t.map((a,s)=>Object.assign(Object.assign({},r),{insertedRowIndex:n.length+s,fields:a}))]})}ChangeSet.changeSetInsertDocuments=changeSetInsertDocuments;function changeSetContainsChanges(e){var t;return e?e.deletes.length>0||e.updates.length>0||e.inserts.length>0||!!e.structure||!!e.setColumnMode||((t=e.dataUpdateCommands)===null||t===void 0?void 0:t.length)>0:!1}ChangeSet.changeSetContainsChanges=changeSetContainsChanges;var MacroDefinition={};Object.defineProperty(MacroDefinition,"__esModule",{value:!0});var runMacro={},rng=rngBrowserExports,bytesToUuid=bytesToUuid_1;function v4(e,t,r){var n=t&&r||0;typeof e=="string"&&(t=e==="binary"?new Array(16):null,e=null),e=e||{};var a=e.random||(e.rng||rng)();if(a[6]=a[6]&15|64,a[8]=a[8]&63|128,t)for(var s=0;s<16;++s)t[n+s]=a[s];return t||bytesToUuid(a)}var v4_1$1=v4,__importDefault$6=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(runMacro,"__esModule",{value:!0});runMacro.runMacroOnChangeSet=runMacro.runMacroOnRow=runMacro.runMacroOnValue=runMacro.compileMacroFunction=void 0;const lodash_1$1=__importDefault$6(lodashExports),v1_1=__importDefault$6(v1_1$5),v4_1=__importDefault$6(v4_1$1),moment_1=__importDefault$6(require$$3),ChangeSet_1$1=ChangeSet,getMacroFunction={transformValue:e=>`
(value, args, modules, rowIndex, row, columnName) => {
    ${e}
}
`,transformRow:e=>`
(row, args, modules, rowIndex, columns) => {
  ${e}
}
`},modules={lodash:lodash_1$1.default,uuidv1:v1_1.default,uuidv4:v4_1.default,moment:moment_1.default};function compileMacroFunction(macro,errors=[]){if(!macro)return null;let func;try{return func=eval(getMacroFunction[macro.type](macro.code)),func}catch(e){return errors.push(`Error compiling macro ${macro.name}: ${e.message}`),null}}runMacro.compileMacroFunction=compileMacroFunction;function runMacroOnValue(e,t,r,n,a,s,o=[]){if(!e)return r;try{return e(r,t,modules,n,a,s)}catch(u){return o.push(`Error processing column ${s} on row ${n}: ${u.message}`),r}}runMacro.runMacroOnValue=runMacroOnValue;function runMacroOnRow(e,t,r,n,a,s=[]){if(!e)return n;try{return e(n,t,modules,r,a)}catch(o){return s.push(`Error processing row ${r}: ${o.message}`),n}}runMacro.runMacroOnRow=runMacroOnRow;function runMacroOnChangeSet(e,t,r,n,a,s){var o;const u=[],l=compileMacroFunction(e,u);if(!l)return null;if(e.type=="transformValue"){let c=n;for(const d of r){const f=a.getChangeSetField(d.rowData,d.column,void 0,s?d.row:void 0,s),h=runMacroOnValue(l,t,d.value,d.row,d.rowData,d.column,u);c=(0,ChangeSet_1$1.setChangeSetValue)(c,f,h)}return c}if(e.type=="transformRow"){let c=n;const d=lodash_1$1.default.uniq(r.map(f=>f.row));for(const f of d){const h=(o=r.find(C=>C.row==f))===null||o===void 0?void 0:o.rowData,y=lodash_1$1.default.uniq(r.map(C=>C.column)),v=a.getChangeSetRow(h,null,f,!0),g=runMacroOnRow(l,t,f,h,y);c=(0,ChangeSet_1$1.setChangeSetRowData)(c,v,g)}return c}}runMacro.runMacroOnChangeSet=runMacroOnChangeSet;var deleteCascade={},__importDefault$5=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(deleteCascade,"__esModule",{value:!0});deleteCascade.getDeleteCascades=void 0;const lodash_1=__importDefault$5(lodashExports),ChangeSet_1=ChangeSet;function processDependencies(e,t,r,n,a,s,o,u){if(t.find(c=>c.title==a.pureName))return;const l=r.filter(c=>c.refSchemaName==a.schemaName&&c.refTableName==a.pureName);for(const c of l){const d=o.tables.find(v=>v.pureName==c.pureName&&v.schemaName==c.schemaName),f=[...n,c];d&&!u.includes(d.pureName)&&processDependencies(e,t,r,f,d,s,o,[...u,d.pureName]);const h={commandType:"delete",from:{name:{pureName:c.pureName,schemaName:c.schemaName}},where:{conditionType:"exists",subQuery:{commandType:"select",selectAll:!0,from:{name:{pureName:c.pureName,schemaName:c.schemaName},alias:"t0",relations:[...f].reverse().map((v,g)=>({joinType:"INNER JOIN",alias:`t${g+1}`,name:{pureName:v.refTableName,schemaName:v.refSchemaName},conditions:v.columns.map(C=>({conditionType:"binary",operator:"=",left:{exprType:"column",columnName:C.columnName,source:{alias:`t${g}`}},right:{exprType:"column",columnName:C.refColumnName,source:{alias:`t${g+1}`}}}))}))},where:{conditionType:"and",conditions:[(0,ChangeSet_1.extractChangeSetCondition)(s,`t${f.length}`),...a.primaryKey.columns.map(v=>({conditionType:"binary",operator:"=",left:{exprType:"column",columnName:v.columnName,source:{alias:"t0"}},right:{exprType:"column",columnName:v.columnName,source:{name:c}}}))]}}}};let y=t.find(v=>v.title==c.pureName);y||(y={title:c.pureName,commands:[]},t.push(y)),y.commands.push(h)}}function getDeleteCascades(e,t){const r=[],n=lodash_1.default.flatten(t.tables.map(a=>a.foreignKeys));for(const a of e.deletes){const s=t.tables.find(u=>u.pureName==a.pureName&&u.schemaName==a.schemaName);if(!s.primaryKey)continue;const o=[];processDependencies(e,o,n,[],s,a,t,[s.pureName]);for(const u of o){const l=r.find(c=>c.title==u.title);l?l.commands.push(...u.commands):r.push(u)}}return r}deleteCascade.getDeleteCascades=getDeleteCascades;var PerspectiveDisplay$1={},isSymbol=isSymbol_1;function baseExtremum$1(e,t,r){for(var n=-1,a=e.length;++n<a;){var s=e[n],o=t(s);if(o!=null&&(u===void 0?o===o&&!isSymbol(o):r(o,u)))var u=o,l=s}return l}var _baseExtremum=baseExtremum$1;function baseGt$1(e,t){return e>t}var _baseGt=baseGt$1,baseExtremum=_baseExtremum,baseGt=_baseGt,identity=identity_1;function max(e){return e&&e.length?baseExtremum(e,identity,baseGt):void 0}var max_1$1=max;function baseClamp$1(e,t,r){return e===e&&(r!==void 0&&(e=e<=r?e:r),t!==void 0&&(e=e>=t?e:t)),e}var _baseClamp=baseClamp$1,baseClamp=_baseClamp,toInteger$1=toInteger_1,MAX_ARRAY_LENGTH=4294967295;function toLength$1(e){return e?baseClamp(toInteger$1(e),0,MAX_ARRAY_LENGTH):0}var toLength_1=toLength$1,toInteger=toInteger_1,toLength=toLength_1;function baseFill$1(e,t,r,n){var a=e.length;for(r=toInteger(r),r<0&&(r=-r>a?0:a+r),n=n===void 0||n>a?a:toInteger(n),n<0&&(n+=a),n=r>n?0:toLength(n);r<n;)e[r++]=t;return e}var _baseFill=baseFill$1,baseFill=_baseFill,isIterateeCall=_isIterateeCall;function fill(e,t,r,n){var a=e==null?0:e.length;return a?(r&&typeof r!="number"&&isIterateeCall(e,t,r)&&(r=0,n=a),baseFill(e,t,r,n)):[]}var fill_1$1=fill,browser={exports:{}},ms,hasRequiredMs;function requireMs(){if(hasRequiredMs)return ms;hasRequiredMs=1;var e=1e3,t=e*60,r=t*60,n=r*24,a=n*7,s=n*365.25;ms=function(d,f){f=f||{};var h=typeof d;if(h==="string"&&d.length>0)return o(d);if(h==="number"&&isFinite(d))return f.long?l(d):u(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))};function o(d){if(d=String(d),!(d.length>100)){var f=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(d);if(f){var h=parseFloat(f[1]),y=(f[2]||"ms").toLowerCase();switch(y){case"years":case"year":case"yrs":case"yr":case"y":return h*s;case"weeks":case"week":case"w":return h*a;case"days":case"day":case"d":return h*n;case"hours":case"hour":case"hrs":case"hr":case"h":return h*r;case"minutes":case"minute":case"mins":case"min":case"m":return h*t;case"seconds":case"second":case"secs":case"sec":case"s":return h*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}function u(d){var f=Math.abs(d);return f>=n?Math.round(d/n)+"d":f>=r?Math.round(d/r)+"h":f>=t?Math.round(d/t)+"m":f>=e?Math.round(d/e)+"s":d+"ms"}function l(d){var f=Math.abs(d);return f>=n?c(d,f,n,"day"):f>=r?c(d,f,r,"hour"):f>=t?c(d,f,t,"minute"):f>=e?c(d,f,e,"second"):d+" ms"}function c(d,f,h,y){var v=f>=h*1.5;return Math.round(d/h)+" "+y+(v?"s":"")}return ms}function setup(e){r.debug=r,r.default=r,r.coerce=l,r.disable=s,r.enable=a,r.enabled=o,r.humanize=requireMs(),r.destroy=c,Object.keys(e).forEach(d=>{r[d]=e[d]}),r.names=[],r.skips=[],r.formatters={};function t(d){let f=0;for(let h=0;h<d.length;h++)f=(f<<5)-f+d.charCodeAt(h),f|=0;return r.colors[Math.abs(f)%r.colors.length]}r.selectColor=t;function r(d){let f,h=null,y,v;function g(...C){if(!g.enabled)return;const O=g,j=Number(new Date),F=j-(f||j);O.diff=F,O.prev=f,O.curr=j,f=j,C[0]=r.coerce(C[0]),typeof C[0]!="string"&&C.unshift("%O");let L=0;C[0]=C[0].replace(/%([a-zA-Z%])/g,(I,A)=>{if(I==="%%")return"%";L++;const q=r.formatters[A];if(typeof q=="function"){const G=C[L];I=q.call(O,G),C.splice(L,1),L--}return I}),r.formatArgs.call(O,C),(O.log||r.log).apply(O,C)}return g.namespace=d,g.useColors=r.useColors(),g.color=r.selectColor(d),g.extend=n,g.destroy=r.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(y!==r.namespaces&&(y=r.namespaces,v=r.enabled(d)),v),set:C=>{h=C}}),typeof r.init=="function"&&r.init(g),g}function n(d,f){const h=r(this.namespace+(typeof f>"u"?":":f)+d);return h.log=this.log,h}function a(d){r.save(d),r.namespaces=d,r.names=[],r.skips=[];let f;const h=(typeof d=="string"?d:"").split(/[\s,]+/),y=h.length;for(f=0;f<y;f++)h[f]&&(d=h[f].replace(/\*/g,".*?"),d[0]==="-"?r.skips.push(new RegExp("^"+d.slice(1)+"$")):r.names.push(new RegExp("^"+d+"$")))}function s(){const d=[...r.names.map(u),...r.skips.map(u).map(f=>"-"+f)].join(",");return r.enable(""),d}function o(d){if(d[d.length-1]==="*")return!0;let f,h;for(f=0,h=r.skips.length;f<h;f++)if(r.skips[f].test(d))return!1;for(f=0,h=r.names.length;f<h;f++)if(r.names[f].test(d))return!0;return!1}function u(d){return d.toString().substring(2,d.toString().length-2).replace(/\.\*\?$/,"*")}function l(d){return d instanceof Error?d.stack||d.message:d}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}var common=setup;(function(e,t){t.formatArgs=n,t.save=a,t.load=s,t.useColors=r,t.storage=o(),t.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const c="color: "+this.color;l.splice(1,0,c,"color: inherit");let d=0,f=0;l[0].replace(/%[a-zA-Z%]/g,h=>{h!=="%%"&&(d++,h==="%c"&&(f=d))}),l.splice(f,0,c)}t.log=console.debug||console.log||(()=>{});function a(l){try{l?t.storage.setItem("debug",l):t.storage.removeItem("debug")}catch{}}function s(){let l;try{l=t.storage.getItem("debug")}catch{}return!l&&typeof process<"u"&&"env"in process&&(l={}.DEBUG),l}function o(){try{return localStorage}catch{}}e.exports=common(t);const{formatters:u}=e.exports;u.j=function(l){try{return JSON.stringify(l)}catch(c){return"[UnexpectedJSONParseError]: "+c.message}}})(browser,browser.exports);var browserExports=browser.exports;const debug=getDefaultExportFromCjs(browserExports);var __importDefault$4=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(PerspectiveDisplay$1,"__esModule",{value:!0});PerspectiveDisplay$1.PerspectiveDisplay=PerspectiveDisplay$1.PerspectiveDisplayRow=PerspectiveDisplay$1.PerspectiveDisplayColumn=void 0;const max_1=__importDefault$4(max_1$1),fill_1=__importDefault$4(fill_1$1),findIndex_1=__importDefault$4(findIndex_1$2),isPlainObject_1$1=__importDefault$4(isPlainObject_1$5),isArray_1$2=__importDefault$4(isArray_1$5),debug_1$2=__importDefault$4(browserExports),dbg$2=(0,debug_1$2.default)("dbgate:PerspectiveDisplay");let lastJoinId=0;function getJoinId(){return lastJoinId+=1,lastJoinId}class PerspectiveDisplayColumn{constructor(t){this.display=t,this.parentNodes=[],this.colSpanAtLevel={},this.columnIndex=0,this.dataNode=null}get rowSpan(){return this.display.columnLevelCount-this.parentNodes.length}showParent(t){return!!this.colSpanAtLevel[t]}getColSpan(t){return this.colSpanAtLevel[t]}isVisible(t){return t==this.columnLevel}get columnLevel(){return this.parentNodes.length}getParentName(t){var r;return(r=this.parentNodes[t])===null||r===void 0?void 0:r.title}getParentNode(t){return this.parentNodes[t]}getParentTableDesignerId(t){var r,n;return!((r=this.parentNodes[t])===null||r===void 0)&&r.headerTableAttributes?(n=this.parentNodes[t])===null||n===void 0?void 0:n.designerId:""}}PerspectiveDisplay$1.PerspectiveDisplayColumn=PerspectiveDisplayColumn;class PerspectiveDisplayRow{constructor(t){this.display=t,this.rowData=[],this.rowSpans=null,this.rowCellSkips=null,this.rowJoinIds=[],this.rowData=(0,fill_1.default)(Array(t.columns.length),void 0),this.rowSpans=(0,fill_1.default)(Array(t.columns.length),1),this.rowJoinIds=(0,fill_1.default)(Array(t.columns.length),0),this.rowCellSkips=(0,fill_1.default)(Array(t.columns.length),!1)}}PerspectiveDisplay$1.PerspectiveDisplayRow=PerspectiveDisplayRow;class PerspectiveDisplay{constructor(t,r){this.root=t,this.columns=[],this.rows=[],this.loadIndicatorsCounts={},this.fillColumns(t.childNodes,[t]),this.columns.length>0&&(this.columns[0].colSpanAtLevel[0]=this.columns.length),this.columnLevelCount=(0,max_1.default)(this.columns.map(a=>a.parentNodes.length))+1;const n=this.collectRows(r,t.childNodes);dbg$2("collected rows",n),this.mergeRows(n)}getRowAt(t){for(;this.rows.length<=t;)this.rows.push(new PerspectiveDisplayRow(this));return this.rows[t]}fillColumns(t,r){for(const n of t)(n.generatesHiearchicGridColumn||n.generatesDataGridColumn)&&this.processColumn(n,r)}processColumn(t,r){var n,a;if(t.generatesDataGridColumn){const s=new PerspectiveDisplayColumn(this);s.title=t.columnTitle,s.dataField=t.dataField,s.parentNodes=r,s.display=this,s.columnIndex=this.columns.length,s.dataNode=t,s.displayType=(a=(n=t.parentNodeConfig)===null||n===void 0?void 0:n.columnDisplays)===null||a===void 0?void 0:a[t.columnName],this.columns.push(s)}if(t.generatesHiearchicGridColumn){const s=this.columns.length;this.fillColumns(t.childNodes,[...r,t]),this.columns.length>s&&(this.columns[s].colSpanAtLevel[r.length]=this.columns.length-s)}}findColumnIndexFromNode(t){return(0,findIndex_1.default)(this.columns,r=>{var n,a,s;return r.dataNode.columnName==t.columnName&&((a=(n=r.dataNode)===null||n===void 0?void 0:n.parentNode)===null||a===void 0?void 0:a.designerId)==((s=t==null?void 0:t.parentNode)===null||s===void 0?void 0:s.designerId)})}extractArray(t){return(0,isArray_1$2.default)(t)?t:(0,isPlainObject_1$1.default)(t)?[t]:[]}collectRows(t,r){const n=r.filter(u=>u.generatesDataGridColumn),a=r.filter(u=>u.generatesHiearchicGridColumn),s=n.map(u=>this.findColumnIndexFromNode(u)),o=[];for(const u of t){const l=n.map(d=>u[d.columnName]),c=[];for(const d of a)if(u[d.fieldName]){const f={rows:this.collectRows(this.extractArray(u[d.fieldName]),d.childNodes)};c.push(f)}o.push({rowData:l,columnIndexes:s,subRowCollections:c,incompleteRowsIndicator:u.incompleteRowsIndicator})}return o}fillRowSpans(){for(let t=0;t<this.columns.length;t++){let r=0,n=0;for(const a of this.rows)a.rowData[t]===void 0&&a.rowJoinIds[t]==this.rows[r].rowJoinIds[t]&&a.rowJoinIds[t]?(a.rowCellSkips[t]=!0,this.rows[r].rowSpans[t]=n-r+1):r=n,n++}}mergeRows(t){let r=0;for(const n of t){const a=this.mergeRow(n,r);r+=a}this.fillRowSpans()}mergeRow(t,r){var n;if(((n=t.incompleteRowsIndicator)===null||n===void 0?void 0:n.length)>0){for(const u of t.incompleteRowsIndicator)this.loadIndicatorsCounts[u]||(this.loadIndicatorsCounts[u]=r),r<this.loadIndicatorsCounts[u]&&(this.loadIndicatorsCounts[u]=r);return 0}const a=this.getRowAt(r);for(let u=0;u<t.columnIndexes.length;u++)a.rowData[t.columnIndexes[u]]=t.rowData[u];let s=1;for(const u of t.subRowCollections){let l=0,c=r;for(const d of u.rows){const f=this.mergeRow(d,c);l+=f,c+=f}l>s&&(s=l)}const o=getJoinId();for(let u=0;u<s;u++){const l=this.getRowAt(r+u);for(let c=0;c<t.columnIndexes.length;c++)l.rowJoinIds[t.columnIndexes[c]]=o}return s}}PerspectiveDisplay$1.PerspectiveDisplay=PerspectiveDisplay;var PerspectiveDataProvider={};(function(e){var t=commonjsGlobal&&commonjsGlobal.__awaiter||function(u,l,c,d){function f(h){return h instanceof c?h:new c(function(y){y(h)})}return new(c||(c=Promise))(function(h,y){function v(O){try{C(d.next(O))}catch(j){y(j)}}function g(O){try{C(d.throw(O))}catch(j){y(j)}}function C(O){O.done?h(O.value):f(O.value).then(v,g)}C((d=d.apply(u,l||[])).next())})},r=commonjsGlobal&&commonjsGlobal.__rest||function(u,l){var c={};for(var d in u)Object.prototype.hasOwnProperty.call(u,d)&&l.indexOf(d)<0&&(c[d]=u[d]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,d=Object.getOwnPropertySymbols(u);f<d.length;f++)l.indexOf(d[f])<0&&Object.prototype.propertyIsEnumerable.call(u,d[f])&&(c[d[f]]=u[d[f]]);return c},n=commonjsGlobal&&commonjsGlobal.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(e,"__esModule",{value:!0}),e.PerspectiveDataProvider=e.PERSPECTIVE_PAGE_SIZE=void 0;const a=n(browserExports);e.PERSPECTIVE_PAGE_SIZE=100;const s=(0,a.default)("dbgate:PerspectiveDataProvider");class o{constructor(l,c,d){this.cache=l,this.loader=c,this.dataPatterns=d}loadData(l){return t(this,void 0,void 0,function*(){return s("load data",l),l.bindingColumns?this.loadDataNested(l):this.loadDataFlat(l)})}loadDataNested(l){return t(this,void 0,void 0,function*(){const c=this.cache.getTableCache(l),d=c.getUncachedBindingGroups(l);if(d.length>0){const g=yield this.loader.loadGrouping(Object.assign(Object.assign({},l),{bindingValues:d}));for(const C of d)c.storeGroupSize(l,C,0);for(const C of g){const{_perspective_group_size_:O}=C,j=r(C,["_perspective_group_size_"]);c.storeGroupSize(l,l.bindingColumns.map(F=>j[F]),O)}}const f=[];let h=0,y=!1,v=!1;for(;h<l.bindingValues.length;h++){const g=l.bindingValues[h],C=c.getBindingGroup(g);if(C.loadedAll||(y?v=!0:(yield this.loadNextGroup(l,h),y=!0)),f.push(...C.loadedRows),f.length>=l.topCount||v)return{rows:f.slice(0,l.topCount),incomplete:l.topCount<f.length||!C.loadedAll||h<l.bindingValues.length-1}}if(h>=l.bindingValues.length)return{rows:f,incomplete:!1}})}loadNextGroup(l,c){return t(this,void 0,void 0,function*(){const d=this.cache.getTableCache(l),f=[],h=[];let y=0;const v=()=>t(this,void 0,void 0,function*(){const g=yield this.loader.loadData(Object.assign(Object.assign({},l),{bindingValues:f.map(C=>l.bindingValues[C])}));for(const C of g){const O=h.find(j=>j.matchRow(C));O&&O.loadedRows.push(C)}for(const C of h)C.loadedAll=!0});for(;c<l.bindingValues.length;c++){const g=l.bindingValues[c],C=d.getBindingGroup(g);if(C&&!C.loadedAll){if(C.groupSize==0){C.loadedAll=!0;continue}if(C.groupSize>=e.PERSPECTIVE_PAGE_SIZE){if(f.length>0){yield v();return}const O=yield this.loader.loadData(Object.assign(Object.assign({},l),{topCount:null,range:{offset:C.loadedRows.length,limit:e.PERSPECTIVE_PAGE_SIZE},bindingValues:[C.bindingValues]}));C.loadedRows=[...C.loadedRows,...O],C.loadedAll=O.length<e.PERSPECTIVE_PAGE_SIZE;return}else{if(y+C.groupSize>e.PERSPECTIVE_PAGE_SIZE){yield v();return}f.push(c),h.push(C),y+=C.groupSize}}}f.length>0&&(yield v())})}loadDataFlat(l){return t(this,void 0,void 0,function*(){const c=this.cache.getTableCache(l);if(l.topCount<=c.loadedCount)return c.getRowsResult(l);c.dataColumns=l.dataColumns,c.allColumns=l.allColumns;const d=yield this.loader.loadData(Object.assign(Object.assign({},l),{topCount:null,range:{offset:c.loadedCount,limit:l.topCount-c.loadedCount}}));if(!d)return{rows:[],incomplete:!1};if(d.errorMessage)throw new Error(d.errorMessage);return c.loadedRows=[...c.loadedRows,...d],c.loadedAll=d.length<l.topCount-c.loadedCount,c.getRowsResult(l)})}loadRowCount(l){return t(this,void 0,void 0,function*(){const c=this.cache.getTableCache(l);if(c.allRowCount!=null)return c.allRowCount;const d=yield this.loader.loadRowCount(Object.assign({},l));if(d.errorMessage)throw new Error(d.errorMessage);return c.allRowCount=parseInt(d.count),c.allRowCount})}}e.PerspectiveDataProvider=o})(PerspectiveDataProvider);var PerspectiveCache$1={},arrayFilter=_arrayFilter,arrayMap$1=_arrayMap,baseProperty=_baseProperty,baseTimes=_baseTimes,isArrayLikeObject$1=isArrayLikeObject_1,nativeMax=Math.max;function unzip$1(e){if(!(e&&e.length))return[];var t=0;return e=arrayFilter(e,function(r){if(isArrayLikeObject$1(r))return t=nativeMax(r.length,t),!0}),baseTimes(t,function(r){return arrayMap$1(e,baseProperty(r))})}var unzip_1=unzip$1,baseRest$1=_baseRest,unzip=unzip_1,zip=baseRest$1(unzip),zip_1$1=zip,SetCache=_SetCache,arrayIncludes=_arrayIncludes,arrayIncludesWith=_arrayIncludesWith,arrayMap=_arrayMap,baseUnary=_baseUnary,cacheHas=_cacheHas,LARGE_ARRAY_SIZE=200;function baseDifference$1(e,t,r,n){var a=-1,s=arrayIncludes,o=!0,u=e.length,l=[],c=t.length;if(!u)return l;r&&(t=arrayMap(t,baseUnary(r))),n?(s=arrayIncludesWith,o=!1):t.length>=LARGE_ARRAY_SIZE&&(s=cacheHas,o=!1,t=new SetCache(t));e:for(;++a<u;){var d=e[a],f=r==null?d:r(d);if(d=n||d!==0?d:0,o&&f===f){for(var h=c;h--;)if(t[h]===f)continue e;l.push(d)}else s(t,f,n)||l.push(d)}return l}var _baseDifference=baseDifference$1,baseDifference=_baseDifference,baseFlatten=_baseFlatten,baseRest=_baseRest,isArrayLikeObject=isArrayLikeObject_1,difference=baseRest(function(e,t){return isArrayLikeObject(e)?baseDifference(e,baseFlatten(t,1,isArrayLikeObject,!0)):[]}),difference_1$1=difference,__importDefault$3=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(PerspectiveCache$1,"__esModule",{value:!0});PerspectiveCache$1.PerspectiveCache=PerspectiveCache$1.PerspectiveCacheTable=PerspectiveCache$1.PerspectiveBindingGroup=void 0;const pick_1$1=__importDefault$3(pick_1$3),zip_1=__importDefault$3(zip_1$1),difference_1=__importDefault$3(difference_1$1),debug_1$1=__importDefault$3(browserExports),json_stable_stringify_1=__importDefault$3(jsonStableStringify),perspectiveTools_1=perspectiveTools,dbg$1=(0,debug_1$1.default)("dbgate:PerspectiveCache");class PerspectiveBindingGroup{constructor(t){this.table=t,this.loadedRows=[]}matchRow(t){return this.table.bindingColumns.every((r,n)=>(0,perspectiveTools_1.perspectiveValueMatcher)(t[r],this.bindingValues[n]))}}PerspectiveCache$1.PerspectiveBindingGroup=PerspectiveBindingGroup;class PerspectiveCacheTable{constructor(t,r){this.cache=r,this.loadedRows=[],this.bindingGroups={},this.allRowCount=null,this.schemaName=t.schemaName,this.pureName=t.pureName,this.bindingColumns=t.bindingColumns,this.dataColumns=t.dataColumns,this.loadedAll=!1}get loadedCount(){return this.loadedRows.length}getRowsResult(t){return{rows:this.loadedRows.slice(0,t.topCount),incomplete:t.topCount<this.loadedCount||!this.loadedAll}}getBindingGroup(t){const r=(0,json_stable_stringify_1.default)(t);return this.bindingGroups[r]}getUncachedBindingGroups(t){const r=[];for(const n of t.bindingValues){const a=(0,json_stable_stringify_1.default)(n);this.bindingGroups[a]||r.push(n)}return r}storeGroupSize(t,r,n){const a=t.bindingValues.find(s=>(0,zip_1.default)(s,r).every(([o,u])=>(0,perspectiveTools_1.perspectiveValueMatcher)(o,u)));if(a){const s=(0,json_stable_stringify_1.default)(a),o=new PerspectiveBindingGroup(this);o.bindingValues=r,o.groupSize=n,this.bindingGroups[s]=o}else dbg$1("Group not found",r)}}PerspectiveCache$1.PerspectiveCacheTable=PerspectiveCacheTable;class PerspectiveCache{constructor(){this.tables={},this.dataPatterns=[]}getTableCache(t){const r=(0,json_stable_stringify_1.default)((0,pick_1$1.default)(t,["schemaName","pureName","bindingColumns","databaseConfig","orderBy","sqlCondition","mongoCondition"]));let n=this.tables[r];return n&&(0,difference_1.default)(t.dataColumns,n.dataColumns).length>0&&!n.allColumns&&(dbg$1("Delete cache because incomplete columns",t.pureName,n.dataColumns),delete this.tables[r],n=null),n||(n=new PerspectiveCacheTable(t,this),this.tables[r]=n,n)}clear(){this.tables={},this.dataPatterns=[]}}PerspectiveCache$1.PerspectiveCache=PerspectiveCache;var processPerspectiveDefaultColunns$1={};Object.defineProperty(processPerspectiveDefaultColunns$1,"__esModule",{value:!0});processPerspectiveDefaultColunns$1.processPerspectiveDefaultColunns=processPerspectiveDefaultColunns$1.shouldProcessPerspectiveDefaultColunns=processPerspectiveDefaultColunns$1.perspectiveNodesHaveStructure=void 0;const dbgate_tools_1$3=lib$5,PerspectiveTreeNode_1=PerspectiveTreeNode$1,namePredicates=[e=>e.toLowerCase()=="name",e=>e.toLowerCase()=="title",e=>e.toLowerCase().includes("name"),e=>e.toLowerCase().includes("title"),e=>e.toLowerCase().includes("subject")];function getPerspectiveDefaultColumns(e,t,r){const n=e.columns.map(s=>s.columnName),a=[...namePredicates,s=>{var o,u,l;return(l=(u=(o=e.columns.find(c=>c.columnName==s))===null||o===void 0?void 0:o.dataType)===null||u===void 0?void 0:u.toLowerCase())===null||l===void 0?void 0:l.includes("char")}];for(const s of a){const o=n.find(s);if(o)return[[o],null]}if(r){const s=[o=>{var u,l;return((l=(u=(0,dbgate_tools_1$3.findForeignKeyForColumn)(e,o))===null||u===void 0?void 0:u.columns)===null||l===void 0?void 0:l.length)==1&&!r.includes(o)},o=>{var u,l;return((l=(u=(0,dbgate_tools_1$3.findForeignKeyForColumn)(e,o))===null||u===void 0?void 0:u.columns)===null||l===void 0?void 0:l.length)==1}];for(const o of s){const u=n.find(o);if(u)return[null,[u]]}}return[[n[0]],null]}function getPerspectiveDefaultCollectionColumns(e){const t=e.columns.map(n=>n.name),r=[...namePredicates,n=>{var a,s;return(s=(a=e.columns.find(o=>o.name==n))===null||a===void 0?void 0:a.types)===null||s===void 0?void 0:s.includes("string")}];for(const n of r){const a=t.find(n);if(a)return[a]}}function perspectiveNodesHaveStructure(e,t,r,n,a){var s;for(const o of e.nodes){const u=(s=t==null?void 0:t[o.conid||n])===null||s===void 0?void 0:s[o.database||a];if(!u)return!1;const l=u.tables.find(f=>f.pureName==o.pureName&&f.schemaName==o.schemaName),c=u.views.find(f=>f.pureName==o.pureName&&f.schemaName==o.schemaName),d=u.collections.find(f=>f.pureName==o.pureName&&f.schemaName==o.schemaName);if(!l&&!c&&!d||d&&!(r!=null&&r[o.designerId]))return!1}return!0}processPerspectiveDefaultColunns$1.perspectiveNodesHaveStructure=perspectiveNodesHaveStructure;function shouldProcessPerspectiveDefaultColunns(e,t,r,n,a){return e.nodes.filter(o=>!o.defaultColumnsProcessed).length==0?!1:perspectiveNodesHaveStructure(e,t,r,n,a)}processPerspectiveDefaultColunns$1.shouldProcessPerspectiveDefaultColunns=shouldProcessPerspectiveDefaultColunns;function processPerspectiveDefaultColunnsStep(e,t,r,n,a){var s,o;const u=e.nodes.find(h=>h.designerId==e.rootDesignerId);if(!u)return null;const l=(s=t==null?void 0:t[u.conid||n])===null||s===void 0?void 0:s[u.database||a];if(!l)return null;const c=l.tables.find(h=>h.pureName==u.pureName&&h.schemaName==u.schemaName),d=l.views.find(h=>h.pureName==u.pureName&&h.schemaName==u.schemaName),f=new PerspectiveTreeNode_1.PerspectiveTableNode(c||d,t,e,null,null,{conid:n,database:a},null,e.rootDesignerId);for(const h of e.nodes){if(h.defaultColumnsProcessed)continue;const y=(o=t==null?void 0:t[h.conid||n])===null||o===void 0?void 0:o[h.database||a];if(!y)continue;const v=y.tables.find(O=>O.pureName==h.pureName&&O.schemaName==h.schemaName),g=y.views.find(O=>O.pureName==h.pureName&&O.schemaName==h.schemaName),C=y.collections.find(O=>O.pureName==h.pureName&&O.schemaName==h.schemaName);if(v||g){const O=f.findNodeByDesignerId(h.designerId);if(!O){const[M]=getPerspectiveDefaultColumns(v||g,y,null);return Object.assign(Object.assign({},e),{nodes:e.nodes.map(I=>I.designerId==h.designerId?Object.assign(Object.assign({},I),{defaultColumnsProcessed:!0,checkedColumns:M}):I)})}const j=O.childNodes.filter(M=>M.isCircular).map(M=>M.columnName),[F,L]=getPerspectiveDefaultColumns(v||g,y,j);if(L){const M=O.childNodes.find(I=>I.columnName==L[0]);if(M!=null&&M.designerId)return Object.assign(Object.assign({},e),{nodes:e.nodes.map(I=>I.designerId==M.designerId?Object.assign(Object.assign({},I),{isNodeChecked:!0}):I.designerId==h.designerId?Object.assign(Object.assign({},I),{defaultColumnsProcessed:!0}):I)});if(M){const[I,A]=M.ensureNodeConfig(e);return A.isNodeChecked=!0,Object.assign(Object.assign({},I),{nodes:I.nodes.map(q=>q.designerId==h.designerId?Object.assign(Object.assign({},q),{defaultColumnsProcessed:!0}):q)})}}else return Object.assign(Object.assign({},e),{nodes:e.nodes.map(M=>M.designerId==h.designerId?Object.assign(Object.assign({},M),{defaultColumnsProcessed:!0,checkedColumns:F}):M)})}if(C){const O=getPerspectiveDefaultCollectionColumns(r==null?void 0:r[h.designerId]);return Object.assign(Object.assign({},e),{nodes:e.nodes.map(j=>j.designerId==h.designerId?Object.assign(Object.assign({},j),{defaultColumnsProcessed:!0,checkedColumns:O}):j)})}}return null}function markAllProcessed(e){return Object.assign(Object.assign({},e),{nodes:e.nodes.map(t=>Object.assign(Object.assign({},t),{defaultColumnsProcessed:!0}))})}function processPerspectiveDefaultColunns(e,t,r,n,a){for(;e.nodes.filter(s=>!s.defaultColumnsProcessed).length>0;){const s=processPerspectiveDefaultColunnsStep(e,t,r,n,a);if(!s||s.nodes.filter(o=>o.defaultColumnsProcessed).length<=e.nodes.filter(o=>o.defaultColumnsProcessed).length)return markAllProcessed(e);e=s}return markAllProcessed(e)}processPerspectiveDefaultColunns$1.processPerspectiveDefaultColunns=processPerspectiveDefaultColunns;var PerspectiveDataPattern={},baseGetTag=_baseGetTag,isObjectLike=isObjectLike_1,boolTag="[object Boolean]";function isBoolean(e){return e===!0||e===!1||isObjectLike(e)&&baseGetTag(e)==boolTag}var isBoolean_1$1=isBoolean,__importDefault$2=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(PerspectiveDataPattern,"__esModule",{value:!0});PerspectiveDataPattern.analyseDataPattern=void 0;const isString_1=__importDefault$2(isString_1$7),isPlainObject_1=__importDefault$2(isPlainObject_1$5),isNumber_1=__importDefault$2(isNumber_1$3),isBoolean_1=__importDefault$2(isBoolean_1$1),isArray_1$1=__importDefault$2(isArray_1$5),dbgate_tools_1$2=lib$5;function detectValueType(e){if((0,isString_1.default)(e))return"string";if((0,isNumber_1.default)(e))return"number";if((0,isBoolean_1.default)(e))return"boolean";if(e!=null&&e.$oid)return"oid";if((0,isPlainObject_1.default)(e)||(0,isArray_1$1.default)(e))return"json";if(e==null)return"null"}function addObjectToColumns(e,t){if((0,isPlainObject_1.default)(t))for(const r of Object.keys(t)){let n=e.find(o=>o.name==r);n||(n={name:r,types:[],columns:[]},e.push(n));const a=t[r],s=detectValueType(a);if(n.types.includes(s)||n.types.push(s),(0,isPlainObject_1.default)(a)&&s!="oid"&&addObjectToColumns(n.columns,a),(0,isArray_1$1.default)(a))for(const o of a)addObjectToColumns(n.columns,o);if((0,isString_1.default)(a)){const o=(0,dbgate_tools_1$2.safeJsonParse)(a);if(o&&((0,isPlainObject_1.default)(o)||(0,isArray_1$1.default)(o))&&(n.types.includes("json")||n.types.push("json"),(0,isPlainObject_1.default)(o)&&addObjectToColumns(n.columns,o),(0,isArray_1$1.default)(o)))for(const u of o)addObjectToColumns(n.columns,u)}}}function analyseDataPattern(e,t){const r=Object.assign(Object.assign({},e),{columns:[]});for(const n of t)addObjectToColumns(r.columns,n);return r}PerspectiveDataPattern.analyseDataPattern=analyseDataPattern;var PerspectiveDataLoader$1={};function baseZipObject$1(e,t,r){for(var n=-1,a=e.length,s=t.length,o={};++n<a;){var u=n<s?t[n]:void 0;r(o,e[n],u)}return o}var _baseZipObject=baseZipObject$1,assignValue=_assignValue,baseZipObject=_baseZipObject;function zipObject(e,t){return baseZipObject(e||[],t||[],assignValue)}var zipObject_1$1=zipObject,baseAssignValue=_baseAssignValue,baseForOwn=_baseForOwn,baseIteratee=_baseIteratee;function mapValues(e,t){var r={};return t=baseIteratee(t),baseForOwn(e,function(n,a,s){baseAssignValue(r,a,t(n,a,s))}),r}var mapValues_1$1=mapValues,__awaiter$1=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,r,n){function a(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function u(d){try{c(n.next(d))}catch(f){o(f)}}function l(d){try{c(n.throw(d))}catch(f){o(f)}}function c(d){d.done?s(d.value):a(d.value).then(u,l)}c((n=n.apply(e,t||[])).next())})},__importDefault$1=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(PerspectiveDataLoader$1,"__esModule",{value:!0});PerspectiveDataLoader$1.PerspectiveDataLoader=void 0;const debug_1=__importDefault$1(browserExports),zipObject_1=__importDefault$1(zipObject_1$1),mapValues_1=__importDefault$1(mapValues_1$1),isArray_1=__importDefault$1(isArray_1$5),dbgate_tools_1$1=lib$5;function normalizeLoadedRow(e){return(0,mapValues_1.default)(e,t=>(0,dbgate_tools_1$1.safeJsonParse)(t)||t)}function normalizeResult(e){return(0,isArray_1.default)(e)?e.map(normalizeLoadedRow):e.errorMessage?e:Object.assign(Object.assign({},e),{errorMessage:"Unspecified error"})}const dbg=(0,debug_1.default)("dbgate:PerspectiveDataLoader");class PerspectiveDataLoader{constructor(t){this.apiCall=t}buildSqlCondition(t){const{schemaName:r,pureName:n,bindingColumns:a,bindingValues:s,dataColumns:o,orderBy:u,sqlCondition:l}=t,c=[];return l&&c.push(l),(a==null?void 0:a.length)==1&&c.push({conditionType:"in",expr:{exprType:"column",columnName:a[0],source:{name:{schemaName:r,pureName:n}}},values:s.map(d=>d[0])}),c.length>0?{conditionType:"and",conditions:c}:null}buildMongoCondition(t){const{schemaName:r,pureName:n,bindingColumns:a,bindingValues:s,dataColumns:o,orderBy:u,mongoCondition:l}=t,c=[];return l&&c.push(l),(a==null?void 0:a.length)==1&&c.push({[a[0]]:{$in:s.map(d=>d[0])}}),c.length==1?c[0]:c.length>0?{$and:c}:null}loadGroupingSqlDb(t){return __awaiter$1(this,void 0,void 0,function*(){const{schemaName:r,pureName:n,bindingColumns:a}=t,s=a.map(l=>({exprType:"column",columnName:l,source:{name:{schemaName:r,pureName:n}}})),o={commandType:"select",from:{name:{schemaName:r,pureName:n}},columns:[{exprType:"call",func:"COUNT",args:[{exprType:"raw",sql:"*"}],alias:"_perspective_group_size_"},...s],where:this.buildSqlCondition(t)};o.groupBy=s,dbg!=null&&dbg.enabled&&dbg(`LOAD COUNTS, table=${t.pureName}, columns=${a==null?void 0:a.join(",")}`);const u=yield this.apiCall("database-connections/sql-select",{conid:t.databaseConfig.conid,database:t.databaseConfig.database,select:o});return u.errorMessage?u:u.rows.map(l=>Object.assign(Object.assign({},l),{_perspective_group_size_:parseInt(l._perspective_group_size_)}))})}loadGroupingDocDb(t){return __awaiter$1(this,void 0,void 0,function*(){const{schemaName:r,pureName:n,bindingColumns:a}=t,s=[{$match:this.buildMongoCondition(t)},{$group:{_id:(0,zipObject_1.default)(a,a.map(u=>"$"+u)),count:{$sum:1}}}];dbg!=null&&dbg.enabled&&dbg(`LOAD COUNTS, table=${t.pureName}, columns=${a==null?void 0:a.join(",")}`);const o=yield this.apiCall("database-connections/collection-data",{conid:t.databaseConfig.conid,database:t.databaseConfig.database,options:{pureName:n,aggregate:s}});return o.errorMessage?o:o.rows.map(u=>Object.assign(Object.assign({},u._id),{_perspective_group_size_:parseInt(u.count)}))})}loadGrouping(t){return __awaiter$1(this,void 0,void 0,function*(){const{engineType:r}=t;switch(r){case"sqldb":return this.loadGroupingSqlDb(t);case"docdb":return this.loadGroupingDocDb(t)}})}loadDataSqlDb(t){var r,n,a;return __awaiter$1(this,void 0,void 0,function*(){const{schemaName:s,pureName:o,bindingColumns:u,bindingValues:l,dataColumns:c,orderBy:d,sqlCondition:f,engineType:h}=t;if((c==null?void 0:c.length)==0)return[];const y={commandType:"select",from:{name:{schemaName:s,pureName:o}},columns:c==null?void 0:c.map(g=>({exprType:"column",columnName:g,source:{name:{schemaName:s,pureName:o}}})),selectAll:!c,orderBy:(d==null?void 0:d.length)>0?d==null?void 0:d.map(({columnName:g,order:C})=>({exprType:"column",columnName:g,direction:C,source:{name:{schemaName:s,pureName:o}}})):null,range:t.range,where:this.buildSqlCondition(t)};dbg!=null&&dbg.enabled&&dbg(`LOAD DATA, table=${t.pureName}, columns=${(r=t.dataColumns)===null||r===void 0?void 0:r.join(",")}, range=${(n=t.range)===null||n===void 0?void 0:n.offset},${(a=t.range)===null||a===void 0?void 0:a.limit}`);const v=yield this.apiCall("database-connections/sql-select",{conid:t.databaseConfig.conid,database:t.databaseConfig.database,select:y});return v.errorMessage?v:v.rows})}getDocDbLoadOptions(t,r){var n,a,s;const{pureName:o}=t,u={pureName:o,condition:this.buildMongoCondition(t),skip:(n=t.range)===null||n===void 0?void 0:n.offset,limit:(a=t.range)===null||a===void 0?void 0:a.limit};return r&&((s=t.orderBy)===null||s===void 0?void 0:s.length)>0&&(u.sort=(0,zipObject_1.default)(t.orderBy.map(l=>l.columnName),t.orderBy.map(l=>l.order=="DESC"?-1:1))),u}loadDataDocDb(t){var r,n,a;return __awaiter$1(this,void 0,void 0,function*(){dbg!=null&&dbg.enabled&&dbg(`LOAD DATA, collection=${t.pureName}, columns=${(r=t.dataColumns)===null||r===void 0?void 0:r.join(",")}, range=${(n=t.range)===null||n===void 0?void 0:n.offset},${(a=t.range)===null||a===void 0?void 0:a.limit}`);const s=this.getDocDbLoadOptions(t,!0),o=yield this.apiCall("database-connections/collection-data",{conid:t.databaseConfig.conid,database:t.databaseConfig.database,options:s});return o.errorMessage?o:o.rows})}loadData(t){return __awaiter$1(this,void 0,void 0,function*(){const{engineType:r}=t;switch(r){case"sqldb":return normalizeResult(yield this.loadDataSqlDb(t));case"docdb":return normalizeResult(yield this.loadDataDocDb(t))}})}loadRowCountSqlDb(t){return __awaiter$1(this,void 0,void 0,function*(){const{schemaName:r,pureName:n,bindingColumns:a,bindingValues:s,dataColumns:o,orderBy:u,sqlCondition:l}=t,c={commandType:"select",from:{name:{schemaName:r,pureName:n}},columns:[{exprType:"raw",sql:"COUNT(*)",alias:"count"}],where:this.buildSqlCondition(t)},d=yield this.apiCall("database-connections/sql-select",{conid:t.databaseConfig.conid,database:t.databaseConfig.database,select:c});return d.errorMessage?d:d.rows[0]})}loadRowCountDocDb(t){return __awaiter$1(this,void 0,void 0,function*(){const r=Object.assign(Object.assign({},this.getDocDbLoadOptions(t,!1)),{countDocuments:!0});return yield this.apiCall("database-connections/collection-data",{conid:t.databaseConfig.conid,database:t.databaseConfig.database,options:r})})}loadRowCount(t){return __awaiter$1(this,void 0,void 0,function*(){const{engineType:r}=t;switch(r){case"sqldb":return this.loadRowCountSqlDb(t);case"docdb":return this.loadRowCountDocDb(t)}})}}PerspectiveDataLoader$1.PerspectiveDataLoader=PerspectiveDataLoader;var DataDuplicator$1={},__awaiter=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,r,n){function a(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function u(d){try{c(n.next(d))}catch(f){o(f)}}function l(d){try{c(n.throw(d))}catch(f){o(f)}}function c(d){d.done?s(d.value):a(d.value).then(u,l)}c((n=n.apply(e,t||[])).next())})},__importDefault=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(DataDuplicator$1,"__esModule",{value:!0});DataDuplicator$1.DataDuplicator=void 0;const dbgate_tools_1=lib$5,pick_1=__importDefault(pick_1$3),omit_1=__importDefault(omit_1$2),logger=(0,dbgate_tools_1.getLogger)("dataDuplicator");class DuplicatorReference{constructor(t,r,n,a){this.base=t,this.ref=r,this.isMandatory=n,this.foreignKey=a}get columnName(){return this.foreignKey.columns[0].columnName}}class DuplicatorItemHolder{constructor(t,r){var n,a,s,o,u;this.item=t,this.duplicator=r,this.references=[],this.backReferences=[],this.isPlanned=!1,this.idMap={},this.refByColumn={},this.table=r.db.tables.find(l=>l.pureName.toUpperCase()==t.name.toUpperCase()),this.autoColumn=(n=this.table.columns.find(l=>l.autoIncrement))===null||n===void 0?void 0:n.columnName,(((s=(a=this.table.primaryKey)===null||a===void 0?void 0:a.columns)===null||s===void 0?void 0:s.length)!=1||((u=(o=this.table.primaryKey)===null||o===void 0?void 0:o.columns)===null||u===void 0?void 0:u[0].columnName)!=this.autoColumn)&&(this.autoColumn=null)}get name(){return this.item.name}initializeReferences(){var t,r;for(const n of this.table.foreignKeys){if(((t=n.columns)===null||t===void 0?void 0:t.length)!=1)continue;const a=this.duplicator.itemHolders.find(u=>u.name.toUpperCase()==n.refTableName.toUpperCase());if(a==null)continue;const s=(r=this.table.columns.find(u=>{var l;return u.columnName==((l=n.columns[0])===null||l===void 0?void 0:l.columnName)}))===null||r===void 0?void 0:r.notNull,o=new DuplicatorReference(this,a,s,n);this.references.push(o),this.refByColumn[o.columnName]=o,a.isReferenced=!0}}createInsertObject(t){const r=(0,omit_1.default)((0,pick_1.default)(t,this.table.columns.map(n=>n.columnName)),[this.autoColumn,...this.backReferences.map(n=>n.columnName)]);for(const n in r){const a=this.refByColumn[n];if(a&&(r[n]=a.ref.idMap[r[n]],a.isMandatory&&r[n]==null)){if(this.duplicator.options.skipRowsWithUnresolvedRefs)return null;throw new Error(`Unresolved reference, base=${a.base.name}, ref=${a.ref.name}, ${n}=${t[n]}`)}}return r}runImport(){return __awaiter(this,void 0,void 0,function*(){const t=yield this.item.openStream(),r=this.duplicator.driver,n=this.duplicator.pool;let a=0,s=0,o=0,u=0,l=new Date;const c=(0,dbgate_tools_1.createAsyncWriteStream)(this.duplicator.stream,{processItem:d=>__awaiter(this,void 0,void 0,function*(){var f,h,y;if(d.__isStreamHeader)return;const v=()=>__awaiter(this,void 0,void 0,function*(){var g,C,O;const j=this.createInsertObject(d);if(j==null){u+=1;return}let F=yield(0,dbgate_tools_1.runQueryOnDriver)(n,r,L=>{L.put("^insert ^into %f (%,i) ^values (%,v)",this.table,Object.keys(j),Object.values(j)),this.autoColumn&&this.isReferenced&&!this.duplicator.driver.dialect.requireStandaloneSelectForScopeIdentity&&L.selectScopeIdentity(this.table)});if(a+=1,this.autoColumn&&this.isReferenced){this.duplicator.driver.dialect.requireStandaloneSelectForScopeIdentity&&(F=yield(0,dbgate_tools_1.runQueryOnDriver)(n,r,M=>M.selectScopeIdentity(this.table)));const L=(O=(C=Object.entries((g=F==null?void 0:F.rows)===null||g===void 0?void 0:g[0]))===null||C===void 0?void 0:C[0])===null||O===void 0?void 0:O[1];L!=null&&(this.idMap[d[this.autoColumn]]=L)}});switch(this.item.operation){case"copy":{yield v();break}case"insertMissing":case"lookup":{const g=yield(0,dbgate_tools_1.runQueryOnDriver)(n,r,O=>O.put("^select %i ^from %f ^where %i = %v",this.autoColumn,this.table,this.item.matchColumns[0],d[this.item.matchColumns[0]])),C=(y=(h=Object.entries((f=g==null?void 0:g.rows)===null||f===void 0?void 0:f[0]))===null||h===void 0?void 0:h[0])===null||y===void 0?void 0:y[1];C!=null?(s+=1,this.idMap[d[this.autoColumn]]=C):this.item.operation=="insertMissing"?yield v():o+=1;break}}new Date().getTime()-l.getTime()>5e3&&(logger.info(`Duplicating ${this.item.name} in progress, inserted ${a} rows, mapped ${s} rows, missing ${o} rows, skipped ${u} rows`),l=new Date)})});return yield this.duplicator.copyStream(t,c),{inserted:a,mapped:s,missing:o,skipped:u}})}}class DataDuplicator{constructor(t,r,n,a,s,o,u={}){this.pool=t,this.driver=r,this.db=n,this.items=a,this.stream=s,this.copyStream=o,this.options=u,this.itemPlan=[],this.itemHolders=a.map(l=>new DuplicatorItemHolder(l,this)),this.itemHolders.forEach(l=>l.initializeReferences())}findItemToPlan(){for(const t of this.itemHolders)if(!t.isPlanned&&t.references.every(r=>r.ref.isPlanned))return t;for(const t of this.itemHolders)if(!t.isPlanned&&t.references.every(r=>r.ref.isPlanned||!r.isMandatory)){const r=t.references.filter(n=>!n.ref.isPlanned);return t.backReferences=r,t}throw new Error("Cycle in mandatory references")}createPlan(){for(;this.itemPlan.length<this.itemHolders.length;){const t=this.findItemToPlan();t.isPlanned=!0,this.itemPlan.push(t)}}run(){return __awaiter(this,void 0,void 0,function*(){this.createPlan(),yield(0,dbgate_tools_1.runCommandOnDriver)(this.pool,this.driver,t=>t.beginTransaction());try{for(const t of this.itemPlan){const r=yield t.runImport();logger.info(`Duplicated ${t.name}, inserted ${r.inserted} rows, mapped ${r.mapped} rows, missing ${r.missing} rows, skipped ${r.skipped} rows`)}}catch(t){logger.error({err:t},`Failed duplicator job, rollbacking. ${t.message}`),yield(0,dbgate_tools_1.runCommandOnDriver)(this.pool,this.driver,r=>r.rollbackTransaction());return}this.options.rollbackAfterFinish?(logger.info("Rollbacking transaction, nothing was changed"),yield(0,dbgate_tools_1.runCommandOnDriver)(this.pool,this.driver,t=>t.rollbackTransaction())):(logger.info("Committing duplicator transaction"),yield(0,dbgate_tools_1.runCommandOnDriver)(this.pool,this.driver,t=>t.commitTransaction()))})}}DataDuplicator$1.DataDuplicator=DataDuplicator;(function(e){var t=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(n,a,s,o){o===void 0&&(o=s);var u=Object.getOwnPropertyDescriptor(a,s);(!u||("get"in u?!a.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return a[s]}}),Object.defineProperty(n,o,u)}:function(n,a,s,o){o===void 0&&(o=s),n[o]=a[s]}),r=commonjsGlobal&&commonjsGlobal.__exportStar||function(n,a){for(var s in n)s!=="default"&&!Object.prototype.hasOwnProperty.call(a,s)&&t(a,n,s)};Object.defineProperty(e,"__esModule",{value:!0}),r(GridDisplay$1,e),r(GridConfig,e),r(PerspectiveConfig,e),r(PerspectiveTreeNode$1,e),r(TableGridDisplay$1,e),r(ViewGridDisplay$1,e),r(JslGridDisplay$1,e),r(ChangeSet,e),r(MacroDefinition,e),r(runMacro,e),r(CollectionGridDisplay$1,e),r(deleteCascade,e),r(PerspectiveDisplay$1,e),r(PerspectiveDataProvider,e),r(PerspectiveCache$1,e),r(PerspectiveConfig,e),r(processPerspectiveDefaultColunns$1,e),r(PerspectiveDataPattern,e),r(PerspectiveDataLoader$1,e),r(perspectiveTools,e),r(DataDuplicator$1,e)})(lib$1);export{lib as a,lib$3 as b,lib$1 as c,dbgateTools as d,lib$2 as e,debug as f,hooks as h,lib$5 as l,stableStringify as s,uuidv1 as u};
//# sourceMappingURL=dbgate-datalib-0d3b84db.js.map
