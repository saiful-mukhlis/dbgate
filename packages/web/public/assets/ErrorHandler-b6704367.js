import{S as D,i as C,s as _,n as u,l as S,d as b,g as v}from"./index-632e4f1b.js";import{_ as O}from"./lodash-29c9ec56.js";import"./dbgate-datalib-0d3b84db.js";const j=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,{window:G}=j;function I(r){let s,d;return{c:u,m(c,p){s||(d=S(G,"unhandledrejection",r[0]),s=!0)},p:u,i:u,o:u,d(c){s=!1,d()}}}function x(r,s,d){let c;var p=this&&this.__awaiter||function(h,w,o,t){function f(n){return n instanceof o?n:new o(function(e){e(n)})}return new(o||(o=Promise))(function(n,e){function a(i){try{m(t.next(i))}catch(g){e(g)}}function T(i){try{m(t.throw(i))}catch(g){e(g)}}function m(i){i.done?n(i.value):f(i.value).then(a,T)}m((t=t.apply(h,w||[])).next())})};let l=0;const y=h=>p(void 0,void 0,void 0,function*(){console.log("Unhandler error, checking whether crashed",h);const w=l;d(1,l++,l),window.setTimeout(()=>p(void 0,void 0,void 0,function*(){var o,t;if(c<=w){console.log("CRASH DETECTED!!!");const f=localStorage.getItem("lastDbGateCrash"),n=f?JSON.parse(f):null;if(n&&new Date().getTime()-n<30*1e3)if(window.confirm(`Sorry, DbGate has crashed again.
Do you want to close all tabs in order to avoid crashing after next reload?
You can reopen closed tabs in closed tabs history.`)){try{let e=(yield b.getItem("openedTabs"))||[];O.isArray(e)||(e=[]),e=e.map(a=>a.closedTime?a:Object.assign(Object.assign({},a),{closedTime:new Date().getTime()})).map(a=>Object.assign(Object.assign({},a),{selected:!1})),yield b.setItem("openedTabs",e),yield localStorage.setItem("selectedWidget","history")}catch{b.removeItem("openedTabs")}window.location.reload()}else(o=v())===null||o===void 0||o.send("open-dev-tools");else window.confirm(`Sorry, DbGate has crashed.
Press OK for reload application
Press Cancel and inspect Console in Developer tools for error details`)?(localStorage.setItem("lastDbGateCrash",JSON.stringify(new Date().getTime())),window.location.reload()):(t=v())===null||t===void 0||t.send("open-dev-tools")}}),500)});return r.$$.update=()=>{r.$$.dirty&2&&(c=l)},[y,l]}class A extends D{constructor(s){super(),C(this,s,x,I,_,{})}}export{A as default};
//# sourceMappingURL=ErrorHandler-b6704367.js.map
