import{S as V,i as X,s as Y,a9 as L,aa as te,B as h,K as b,ab as ae,ac as oe,O as g,Q as v,T as w,ad as G,c as Q,a as re,aD as q,ae as se,_ as K,j as I,af as A,ah as ie,ag as le,m as N,E as ce,at as ue,ai as fe,aj as de,D as M,I as O,R as B,aE as me,al as pe,a0 as z,am as J,an as $e,ap as H,aq as U,ar as _e,n as E,e as he,r as be,F as Z}from"./index-632e4f1b.js";import{_ as S}from"./lodash-29c9ec56.js";import{l as P}from"./dbgate-datalib-0d3b84db.js";function ge(a){let n,o;const t=[a[3],{data:a[0]},{title:a[0].name.endsWith(".link")?a[0].name.slice(0,-5):a[0].name},{icon:a[0].name.endsWith(".link")?"img link":"img archive-folder"},{isBold:a[0].name==a[1]},{menu:a[2]}];let s={};for(let e=0;e<t.length;e+=1)s=L(s,t[e]);return n=new te({props:s}),n.$on("click",a[4]),{c(){h(n.$$.fragment)},m(e,r){b(n,e,r),o=!0},p(e,[r]){const u=r&15?ae(t,[r&8&&oe(e[3]),r&1&&{data:e[0]},r&1&&{title:e[0].name.endsWith(".link")?e[0].name.slice(0,-5):e[0].name},r&1&&{icon:e[0].name.endsWith(".link")?"img link":"img archive-folder"},r&3&&{isBold:e[0].name==e[1]},r&4&&{menu:e[2]}]):{};n.$set(u)},i(e){o||(g(n.$$.fragment,e),o=!0)},o(e){v(n.$$.fragment,e),o=!1},d(e){w(n,e)}}}globalThis&&globalThis.__awaiter;const ve=a=>a.name,we=a=>n=>P.filterName(n,a.name);function ke(a,n,o){const t=["data"];let s=G(n,t),e,r;Q(a,re,c=>o(5,e=c)),Q(a,q,c=>o(1,r=c));var u=this&&this.__awaiter||function(c,D,$,_){function x(j){return j instanceof $?j:new $(function(y){y(j)})}return new($||($=Promise))(function(j,y){function ee(C){try{W(_.next(C))}catch(R){y(R)}}function ne(C){try{W(_.throw(C))}catch(R){y(R)}}function W(C){C.done?j(C.value):x(C.value).then(ee,ne)}W((_=_.apply(c,D||[])).next())})};let{data:l}=n;const f=()=>{I(ie,{message:l.name.endsWith(".link")?`Really delete link to folder ${l.name}? Folder content remains untouched.`:`Really delete folder ${l.name}?`,onConfirm:()=>{A("archive/delete-folder",{folder:l.name})}})},d=()=>{const c=l.name.endsWith(".link"),D=c?l.name.slice(0,-5):l.name,$=c?".link":"";I(le,{value:D,label:"New folder name",header:"Rename folder",onConfirm:_=>u(void 0,void 0,void 0,function*(){yield A("archive/rename-folder",{folder:l.name,newFolder:_+$}),r==l.name&&K(q,r=_+$,r)})})},k=()=>{N({title:"Shell #",icon:"img shell",tabComponent:"ShellTab"},{editor:`// @require ${P.extractPackageName(e.connection.engine)}
        
await dbgateApi.deployDb(${JSON.stringify({connection:Object.assign(Object.assign({},S.omit(e.connection,"_id","displayName")),{database:e.name}),modelFolder:`archive:${l.name}`},void 0,2)})`})},p=()=>u(void 0,void 0,void 0,function*(){const c=yield A("database-connections/generate-deploy-sql",{conid:e.connection._id,database:e.name,archiveFolder:l.name});c.errorMessage?I(ce,{message:c.errorMessage}):ue({initialData:c.sql})}),T=()=>{var c;N({title:"Compare",icon:"img compare",tabComponent:"CompareModelTab"},{editor:{sourceConid:"__model",sourceDatabase:`archive:${l.name}`,targetConid:(c=e==null?void 0:e.connection)===null||c===void 0?void 0:c._id,targetDatabase:e==null?void 0:e.name}})},F=()=>{var c;N({title:l.name,icon:"img duplicator",tabComponent:"DataDuplicatorTab",props:{conid:(c=e==null?void 0:e.connection)===null||c===void 0?void 0:c._id,database:e==null?void 0:e.name}},{editor:{archiveFolder:l.name}})};function i(){return[l.name!="default"&&{text:"Delete",onClick:f},l.name!="default"&&{text:"Rename",onClick:d},l.name!="default"&&e&&[{text:"Data duplicator",onClick:F},{text:"Generate deploy DB SQL - experimental",onClick:p},{text:"Shell: Deploy DB - experimental",onClick:k}],l.name!="default"&&S.get(e,"connection._id")&&{onClick:T,text:`Compare with ${S.get(e,"name")}`}]}const m=()=>K(q,r=l.name,r);return a.$$set=c=>{n=L(L({},n),se(c)),o(3,s=G(n,t)),"data"in c&&o(0,l=c.data)},[l,r,i,s,m]}class Ce extends V{constructor(n){super(),X(this,n,ke,ge,Y,{data:0})}}const De=Object.freeze(Object.defineProperty({__proto__:null,createMatcher:we,default:Ce,extractKey:ve},Symbol.toStringTag,{value:"Module"}));function je(a){let n,o;return n=new Z({props:{icon:"icon plus-thick"}}),{c(){h(n.$$.fragment)},m(t,s){b(n,t,s),o=!0},p:E,i(t){o||(g(n.$$.fragment,t),o=!0)},o(t){v(n.$$.fragment,t),o=!1},d(t){w(n,t)}}}function Se(a){let n,o;return n=new Z({props:{icon:"icon refresh"}}),{c(){h(n.$$.fragment)},m(t,s){b(n,t,s),o=!0},p:E,i(t){o||(g(n.$$.fragment,t),o=!0)},o(t){v(n.$$.fragment,t),o=!1},d(t){w(n,t)}}}function Fe(a){let n,o,t,s,e,r,u,l,f,d;function k(i){a[4](i)}let p={placeholder:"Search archive folders"};a[0]!==void 0&&(p.value=a[0]),n=new pe({props:p}),z.push(()=>J(n,"value",k));function T(i){a[5](i)}let F={};return a[0]!==void 0&&(F.filter=a[0]),s=new $e({props:F}),z.push(()=>J(s,"filter",T)),u=new H({props:{title:"Add new archive folder",$$slots:{default:[je]},$$scope:{ctx:a}}}),u.$on("click",a[6]),f=new H({props:{title:"Refresh archive folder list",$$slots:{default:[Se]},$$scope:{ctx:a}}}),f.$on("click",a[3]),{c(){h(n.$$.fragment),t=M(),h(s.$$.fragment),r=M(),h(u.$$.fragment),l=M(),h(f.$$.fragment)},m(i,m){b(n,i,m),O(i,t,m),b(s,i,m),O(i,r,m),b(u,i,m),O(i,l,m),b(f,i,m),d=!0},p(i,m){const c={};!o&&m&1&&(o=!0,c.value=i[0],U(()=>o=!1)),n.$set(c);const D={};!e&&m&1&&(e=!0,D.filter=i[0],U(()=>e=!1)),s.$set(D);const $={};m&128&&($.$$scope={dirty:m,ctx:i}),u.$set($);const _={};m&128&&(_.$$scope={dirty:m,ctx:i}),f.$set(_)},i(i){d||(g(n.$$.fragment,i),g(s.$$.fragment,i),g(u.$$.fragment,i),g(f.$$.fragment,i),d=!0)},o(i){v(n.$$.fragment,i),v(s.$$.fragment,i),v(u.$$.fragment,i),v(f.$$.fragment,i),d=!1},d(i){i&&(B(t),B(r),B(l)),w(n,i),w(s,i),w(u,i),w(f,i)}}}function ye(a){let n,o;return n=new _e({props:{list:S.sortBy(a[2],"name"),module:De,filter:a[0]}}),{c(){h(n.$$.fragment)},m(t,s){b(n,t,s),o=!0},p(t,s){const e={};s&4&&(e.list=S.sortBy(t[2],"name")),s&1&&(e.filter=t[0]),n.$set(e)},i(t){o||(g(n.$$.fragment,t),o=!0)},o(t){v(n.$$.fragment,t),o=!1},d(t){w(n,t)}}}function Ae(a){let n,o,t,s;return n=new fe({props:{$$slots:{default:[Fe]},$$scope:{ctx:a}}}),t=new de({props:{$$slots:{default:[ye]},$$scope:{ctx:a}}}),{c(){h(n.$$.fragment),o=M(),h(t.$$.fragment)},m(e,r){b(n,e,r),O(e,o,r),b(t,e,r),s=!0},p(e,[r]){const u={};r&129&&(u.$$scope={dirty:r,ctx:e}),n.$set(u);const l={};r&133&&(l.$$scope={dirty:r,ctx:e}),t.$set(l)},i(e){s||(g(n.$$.fragment,e),g(t.$$.fragment,e),s=!0)},o(e){v(n.$$.fragment,e),v(t.$$.fragment,e),s=!1},d(e){e&&B(o),w(n,e),w(t,e)}}}function Me(a,n,o){let t,s,e=E,r=()=>(e(),e=he(t,p=>o(2,s=p)),t);a.$$.on_destroy.push(()=>e());let u="";const l=()=>{A("archive/refresh-folders")};function f(p){u=p,o(0,u)}function d(p){u=p,o(0,u)}const k=()=>be("new.archiveFolder");return r(o(1,t=me())),[u,t,s,l,f,d,k]}class We extends V{constructor(n){super(),X(this,n,Me,Ae,Y,{})}}export{We as default};
//# sourceMappingURL=ArchiveFolderList-aafa3a8e.js.map
